const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FlatPlate1x2CenterStud-CgU774Nu.js","./FlatPlate1x2-WO8sp-SC.js","./SideStudBrick1x1-Bw5mv8V9.js","./Brick1x1-EdxTdz51.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function tm(i){const e=Object.create(null);for(const t of i.split(","))e[t]=1;return t=>t in e}const fn={},Wo=[],js=()=>{},Fy=()=>!1,Rd=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),nm=i=>i.startsWith("onUpdate:"),Qn=Object.assign,im=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},zw=Object.prototype.hasOwnProperty,on=(i,e)=>zw.call(i,e),Rt=Array.isArray,$o=i=>Ld(i)==="[object Map]",Uy=i=>Ld(i)==="[object Set]",Ot=i=>typeof i=="function",Ln=i=>typeof i=="string",Ir=i=>typeof i=="symbol",vn=i=>i!==null&&typeof i=="object",zy=i=>(vn(i)||Ot(i))&&Ot(i.then)&&Ot(i.catch),Vy=Object.prototype.toString,Ld=i=>Vy.call(i),Vw=i=>Ld(i).slice(8,-1),Gy=i=>Ld(i)==="[object Object]",sm=i=>Ln(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Xl=tm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Id=i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},Gw=/-\w/g,ps=Id(i=>i.replace(Gw,e=>e.slice(1).toUpperCase())),Hw=/\B([A-Z])/g,ha=Id(i=>i.replace(Hw,"-$1").toLowerCase()),Dd=Id(i=>i.charAt(0).toUpperCase()+i.slice(1)),ch=Id(i=>i?`on${Dd(i)}`:""),Zr=(i,e)=>!Object.is(i,e),ku=(i,...e)=>{for(let t=0;t<i.length;t++)i[t](...e)},Hy=(i,e,t,n=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:n,value:t})},Ef=i=>{const e=parseFloat(i);return isNaN(e)?i:e},Ww=i=>{const e=Ln(i)?Number(i):NaN;return isNaN(e)?i:e};let b_;const kd=()=>b_||(b_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function fi(i){if(Rt(i)){const e={};for(let t=0;t<i.length;t++){const n=i[t],s=Ln(n)?Yw(n):fi(n);if(s)for(const r in s)e[r]=s[r]}return e}else if(Ln(i)||vn(i))return i}const $w=/;(?![^(]*\))/g,Xw=/:([^]+)/,qw=/\/\*[^]*?\*\//g;function Yw(i){const e={};return i.replace(qw,"").split($w).forEach(t=>{if(t){const n=t.split(Xw);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function qt(i){let e="";if(Ln(i))e=i;else if(Rt(i))for(let t=0;t<i.length;t++){const n=qt(i[t]);n&&(e+=n+" ")}else if(vn(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const jw="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Kw=tm(jw);function Wy(i){return!!i||i===""}const $y=i=>!!(i&&i.__v_isRef===!0),se=i=>Ln(i)?i:i==null?"":Rt(i)||vn(i)&&(i.toString===Vy||!Ot(i.toString))?$y(i)?se(i.value):JSON.stringify(i,Xy,2):String(i),Xy=(i,e)=>$y(e)?Xy(i,e.value):$o(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s],r)=>(t[uh(n,r)+" =>"]=s,t),{})}:Uy(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>uh(t))}:Ir(e)?uh(e):vn(e)&&!Rt(e)&&!Gy(e)?String(e):e,uh=(i,e="")=>{var t;return Ir(i)?`Symbol(${(t=i.description)!=null?t:e})`:i};/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Li;class qy{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Li,!e&&Li&&(this.index=(Li.scopes||(Li.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Li;try{return Li=this,e()}finally{Li=t}}}on(){++this._on===1&&(this.prevScope=Li,Li=this)}off(){this._on>0&&--this._on===0&&(Li=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function Zw(i){return new qy(i)}function Jw(){return Li}let pn;const dh=new WeakSet;class Yy{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Li&&Li.active&&Li.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,dh.has(this)&&(dh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Ky(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,w_(this),Zy(this);const e=pn,t=Ps;pn=this,Ps=!0;try{return this.fn()}finally{Jy(this),pn=e,Ps=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)om(e);this.deps=this.depsTail=void 0,w_(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?dh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Mf(this)&&this.run()}get dirty(){return Mf(this)}}let jy=0,ql,Yl;function Ky(i,e=!1){if(i.flags|=8,e){i.next=Yl,Yl=i;return}i.next=ql,ql=i}function rm(){jy++}function am(){if(--jy>0)return;if(Yl){let e=Yl;for(Yl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let i;for(;ql;){let e=ql;for(ql=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){i||(i=n)}e=t}}if(i)throw i}function Zy(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Jy(i){let e,t=i.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),om(n),Qw(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}i.deps=e,i.depsTail=t}function Mf(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Qy(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function Qy(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===rc)||(i.globalVersion=rc,!i.isSSR&&i.flags&128&&(!i.deps&&!i._dirty||!Mf(i))))return;i.flags|=2;const e=i.dep,t=pn,n=Ps;pn=i,Ps=!0;try{Zy(i);const s=i.fn(i._value);(e.version===0||Zr(s,i._value))&&(i.flags|=128,i._value=s,e.version++)}catch(s){throw e.version++,s}finally{pn=t,Ps=n,Jy(i),i.flags&=-3}}function om(i,e=!1){const{dep:t,prevSub:n,nextSub:s}=i;if(n&&(n.nextSub=s,i.prevSub=void 0),s&&(s.prevSub=n,i.nextSub=void 0),t.subs===i&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let r=t.computed.deps;r;r=r.nextDep)om(r,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function Qw(i){const{prevDep:e,nextDep:t}=i;e&&(e.nextDep=t,i.prevDep=void 0),t&&(t.prevDep=e,i.nextDep=void 0)}let Ps=!0;const e0=[];function Tr(){e0.push(Ps),Ps=!1}function Ar(){const i=e0.pop();Ps=i===void 0?!0:i}function w_(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const t=pn;pn=void 0;try{e()}finally{pn=t}}}let rc=0;class eS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class lm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!pn||!Ps||pn===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==pn)t=this.activeLink=new eS(pn,this),pn.deps?(t.prevDep=pn.depsTail,pn.depsTail.nextDep=t,pn.depsTail=t):pn.deps=pn.depsTail=t,t0(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=pn.depsTail,t.nextDep=void 0,pn.depsTail.nextDep=t,pn.depsTail=t,pn.deps===t&&(pn.deps=n)}return t}trigger(e){this.version++,rc++,this.notify(e)}notify(e){rm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{am()}}}function t0(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)t0(n)}const t=i.dep.subs;t!==i&&(i.prevSub=t,t&&(t.nextSub=i)),i.dep.subs=i}}const Tf=new WeakMap,Za=Symbol(""),Af=Symbol(""),ac=Symbol("");function ci(i,e,t){if(Ps&&pn){let n=Tf.get(i);n||Tf.set(i,n=new Map);let s=n.get(t);s||(n.set(t,s=new lm),s.map=n,s.key=t),s.track()}}function xr(i,e,t,n,s,r){const a=Tf.get(i);if(!a){rc++;return}const o=l=>{l&&l.trigger()};if(rm(),e==="clear")a.forEach(o);else{const l=Rt(i),c=l&&sm(t);if(l&&t==="length"){const u=Number(n);a.forEach((d,h)=>{(h==="length"||h===ac||!Ir(h)&&h>=u)&&o(d)})}else switch((t!==void 0||a.has(void 0))&&o(a.get(t)),c&&o(a.get(ac)),e){case"add":l?c&&o(a.get("length")):(o(a.get(Za)),$o(i)&&o(a.get(Af)));break;case"delete":l||(o(a.get(Za)),$o(i)&&o(a.get(Af)));break;case"set":$o(i)&&o(a.get(Za));break}}am()}function po(i){const e=an(i);return e===i?e:(ci(e,"iterate",ac),fs(i)?e:e.map(ti))}function Bd(i){return ci(i=an(i),"iterate",ac),i}const tS={__proto__:null,[Symbol.iterator](){return hh(this,Symbol.iterator,ti)},concat(...i){return po(this).concat(...i.map(e=>Rt(e)?po(e):e))},entries(){return hh(this,"entries",i=>(i[1]=ti(i[1]),i))},every(i,e){return tr(this,"every",i,e,void 0,arguments)},filter(i,e){return tr(this,"filter",i,e,t=>t.map(ti),arguments)},find(i,e){return tr(this,"find",i,e,ti,arguments)},findIndex(i,e){return tr(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return tr(this,"findLast",i,e,ti,arguments)},findLastIndex(i,e){return tr(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return tr(this,"forEach",i,e,void 0,arguments)},includes(...i){return fh(this,"includes",i)},indexOf(...i){return fh(this,"indexOf",i)},join(i){return po(this).join(i)},lastIndexOf(...i){return fh(this,"lastIndexOf",i)},map(i,e){return tr(this,"map",i,e,void 0,arguments)},pop(){return Tl(this,"pop")},push(...i){return Tl(this,"push",i)},reduce(i,...e){return S_(this,"reduce",i,e)},reduceRight(i,...e){return S_(this,"reduceRight",i,e)},shift(){return Tl(this,"shift")},some(i,e){return tr(this,"some",i,e,void 0,arguments)},splice(...i){return Tl(this,"splice",i)},toReversed(){return po(this).toReversed()},toSorted(i){return po(this).toSorted(i)},toSpliced(...i){return po(this).toSpliced(...i)},unshift(...i){return Tl(this,"unshift",i)},values(){return hh(this,"values",ti)}};function hh(i,e,t){const n=Bd(i),s=n[e]();return n!==i&&!fs(i)&&(s._next=s.next,s.next=()=>{const r=s._next();return r.done||(r.value=t(r.value)),r}),s}const nS=Array.prototype;function tr(i,e,t,n,s,r){const a=Bd(i),o=a!==i&&!fs(i),l=a[e];if(l!==nS[e]){const d=l.apply(i,r);return o?ti(d):d}let c=t;a!==i&&(o?c=function(d,h){return t.call(this,ti(d),h,i)}:t.length>2&&(c=function(d,h){return t.call(this,d,h,i)}));const u=l.call(a,c,n);return o&&s?s(u):u}function S_(i,e,t,n){const s=Bd(i);let r=t;return s!==i&&(fs(i)?t.length>3&&(r=function(a,o,l){return t.call(this,a,o,l,i)}):r=function(a,o,l){return t.call(this,a,ti(o),l,i)}),s[e](r,...n)}function fh(i,e,t){const n=an(i);ci(n,"iterate",ac);const s=n[e](...t);return(s===-1||s===!1)&&dm(t[0])?(t[0]=an(t[0]),n[e](...t)):s}function Tl(i,e,t=[]){Tr(),rm();const n=an(i)[e].apply(i,t);return am(),Ar(),n}const iS=tm("__proto__,__v_isRef,__isVue"),n0=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(Ir));function sS(i){Ir(i)||(i=String(i));const e=an(this);return ci(e,"has",i),e.hasOwnProperty(i)}class i0{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,r=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return r;if(t==="__v_raw")return n===(s?r?pS:o0:r?a0:r0).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const a=Rt(e);if(!s){let l;if(a&&(l=tS[t]))return l;if(t==="hasOwnProperty")return sS}const o=Reflect.get(e,t,ii(e)?e:n);if((Ir(t)?n0.has(t):iS(t))||(s||ci(e,"get",t),r))return o;if(ii(o)){const l=a&&sm(t)?o:o.value;return s&&vn(l)?Pf(l):l}return vn(o)?s?Pf(o):Od(o):o}}class s0 extends i0{constructor(e=!1){super(!1,e)}set(e,t,n,s){let r=e[t];if(!this._isShallow){const l=na(r);if(!fs(n)&&!na(n)&&(r=an(r),n=an(n)),!Rt(e)&&ii(r)&&!ii(n))return l||(r.value=n),!0}const a=Rt(e)&&sm(t)?Number(t)<e.length:on(e,t),o=Reflect.set(e,t,n,ii(e)?e:s);return e===an(s)&&(a?Zr(n,r)&&xr(e,"set",t,n):xr(e,"add",t,n)),o}deleteProperty(e,t){const n=on(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&xr(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!Ir(t)||!n0.has(t))&&ci(e,"has",t),n}ownKeys(e){return ci(e,"iterate",Rt(e)?"length":Za),Reflect.ownKeys(e)}}class rS extends i0{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const aS=new s0,oS=new rS,lS=new s0(!0);const Cf=i=>i,qc=i=>Reflect.getPrototypeOf(i);function cS(i,e,t){return function(...n){const s=this.__v_raw,r=an(s),a=$o(r),o=i==="entries"||i===Symbol.iterator&&a,l=i==="keys"&&a,c=s[i](...n),u=t?Cf:e?Ju:ti;return!e&&ci(r,"iterate",l?Af:Za),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:o?[u(d[0]),u(d[1])]:u(d),done:h}},[Symbol.iterator](){return this}}}}function Yc(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function uS(i,e){const t={get(s){const r=this.__v_raw,a=an(r),o=an(s);i||(Zr(s,o)&&ci(a,"get",s),ci(a,"get",o));const{has:l}=qc(a),c=e?Cf:i?Ju:ti;if(l.call(a,s))return c(r.get(s));if(l.call(a,o))return c(r.get(o));r!==a&&r.get(s)},get size(){const s=this.__v_raw;return!i&&ci(an(s),"iterate",Za),s.size},has(s){const r=this.__v_raw,a=an(r),o=an(s);return i||(Zr(s,o)&&ci(a,"has",s),ci(a,"has",o)),s===o?r.has(s):r.has(s)||r.has(o)},forEach(s,r){const a=this,o=a.__v_raw,l=an(o),c=e?Cf:i?Ju:ti;return!i&&ci(l,"iterate",Za),o.forEach((u,d)=>s.call(r,c(u),c(d),a))}};return Qn(t,i?{add:Yc("add"),set:Yc("set"),delete:Yc("delete"),clear:Yc("clear")}:{add(s){!e&&!fs(s)&&!na(s)&&(s=an(s));const r=an(this);return qc(r).has.call(r,s)||(r.add(s),xr(r,"add",s,s)),this},set(s,r){!e&&!fs(r)&&!na(r)&&(r=an(r));const a=an(this),{has:o,get:l}=qc(a);let c=o.call(a,s);c||(s=an(s),c=o.call(a,s));const u=l.call(a,s);return a.set(s,r),c?Zr(r,u)&&xr(a,"set",s,r):xr(a,"add",s,r),this},delete(s){const r=an(this),{has:a,get:o}=qc(r);let l=a.call(r,s);l||(s=an(s),l=a.call(r,s)),o&&o.call(r,s);const c=r.delete(s);return l&&xr(r,"delete",s,void 0),c},clear(){const s=an(this),r=s.size!==0,a=s.clear();return r&&xr(s,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=cS(s,i,e)}),t}function cm(i,e){const t=uS(i,e);return(n,s,r)=>s==="__v_isReactive"?!i:s==="__v_isReadonly"?i:s==="__v_raw"?n:Reflect.get(on(t,s)&&s in n?t:n,s,r)}const dS={get:cm(!1,!1)},hS={get:cm(!1,!0)},fS={get:cm(!0,!1)};const r0=new WeakMap,a0=new WeakMap,o0=new WeakMap,pS=new WeakMap;function mS(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function _S(i){return i.__v_skip||!Object.isExtensible(i)?0:mS(Vw(i))}function Od(i){return na(i)?i:um(i,!1,aS,dS,r0)}function vS(i){return um(i,!1,lS,hS,a0)}function Pf(i){return um(i,!0,oS,fS,o0)}function um(i,e,t,n,s){if(!vn(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const r=_S(i);if(r===0)return i;const a=s.get(i);if(a)return a;const o=new Proxy(i,r===2?n:t);return s.set(i,o),o}function Xo(i){return na(i)?Xo(i.__v_raw):!!(i&&i.__v_isReactive)}function na(i){return!!(i&&i.__v_isReadonly)}function fs(i){return!!(i&&i.__v_isShallow)}function dm(i){return i?!!i.__v_raw:!1}function an(i){const e=i&&i.__v_raw;return e?an(e):i}function gS(i){return!on(i,"__v_skip")&&Object.isExtensible(i)&&Hy(i,"__v_skip",!0),i}const ti=i=>vn(i)?Od(i):i,Ju=i=>vn(i)?Pf(i):i;function ii(i){return i?i.__v_isRef===!0:!1}function ze(i){return c0(i,!1)}function l0(i){return c0(i,!0)}function c0(i,e){return ii(i)?i:new yS(i,e)}class yS{constructor(e,t){this.dep=new lm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:an(e),this._value=t?e:ti(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||fs(e)||na(e);e=n?e:an(e),Zr(e,t)&&(this._rawValue=e,this._value=n?e:ti(e),this.dep.trigger())}}function Ii(i){return ii(i)?i.value:i}const xS={get:(i,e,t)=>e==="__v_raw"?i:Ii(Reflect.get(i,e,t)),set:(i,e,t,n)=>{const s=i[e];return ii(s)&&!ii(t)?(s.value=t,!0):Reflect.set(i,e,t,n)}};function u0(i){return Xo(i)?i:new Proxy(i,xS)}class bS{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new lm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=rc-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&pn!==this)return Ky(this,!0),!0}get value(){const e=this.dep.track();return Qy(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function wS(i,e,t=!1){let n,s;return Ot(i)?n=i:(n=i.get,s=i.set),new bS(n,s,t)}const jc={},Qu=new WeakMap;let Fa;function SS(i,e=!1,t=Fa){if(t){let n=Qu.get(t);n||Qu.set(t,n=[]),n.push(i)}}function ES(i,e,t=fn){const{immediate:n,deep:s,once:r,scheduler:a,augmentJob:o,call:l}=t,c=g=>s?g:fs(g)||s===!1||s===0?br(g,1):br(g);let u,d,h,f,p=!1,m=!1;if(ii(i)?(d=()=>i.value,p=fs(i)):Xo(i)?(d=()=>c(i),p=!0):Rt(i)?(m=!0,p=i.some(g=>Xo(g)||fs(g)),d=()=>i.map(g=>{if(ii(g))return g.value;if(Xo(g))return c(g);if(Ot(g))return l?l(g,2):g()})):Ot(i)?e?d=l?()=>l(i,2):i:d=()=>{if(h){Tr();try{h()}finally{Ar()}}const g=Fa;Fa=u;try{return l?l(i,3,[f]):i(f)}finally{Fa=g}}:d=js,e&&s){const g=d,w=s===!0?1/0:s;d=()=>br(g(),w)}const _=Jw(),v=()=>{u.stop(),_&&_.active&&im(_.effects,u)};if(r&&e){const g=e;e=(...w)=>{g(...w),v()}}let x=m?new Array(i.length).fill(jc):jc;const y=g=>{if(!(!(u.flags&1)||!u.dirty&&!g))if(e){const w=u.run();if(s||p||(m?w.some((b,T)=>Zr(b,x[T])):Zr(w,x))){h&&h();const b=Fa;Fa=u;try{const T=[w,x===jc?void 0:m&&x[0]===jc?[]:x,f];x=w,l?l(e,3,T):e(...T)}finally{Fa=b}}}else u.run()};return o&&o(y),u=new Yy(d),u.scheduler=a?()=>a(y,!1):y,f=g=>SS(g,!1,u),h=u.onStop=()=>{const g=Qu.get(u);if(g){if(l)l(g,4);else for(const w of g)w();Qu.delete(u)}},e?n?y(!0):x=u.run():a?a(y.bind(null,!0),!0):u.run(),v.pause=u.pause.bind(u),v.resume=u.resume.bind(u),v.stop=v,v}function br(i,e=1/0,t){if(e<=0||!vn(i)||i.__v_skip||(t=t||new Map,(t.get(i)||0)>=e))return i;if(t.set(i,e),e--,ii(i))br(i.value,e,t);else if(Rt(i))for(let n=0;n<i.length;n++)br(i[n],e,t);else if(Uy(i)||$o(i))i.forEach(n=>{br(n,e,t)});else if(Gy(i)){for(const n in i)br(i[n],e,t);for(const n of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,n)&&br(i[n],e,t)}return i}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ic(i,e,t,n){try{return n?i(...n):i()}catch(s){Nd(s,e,t)}}function Is(i,e,t,n){if(Ot(i)){const s=Ic(i,e,t,n);return s&&zy(s)&&s.catch(r=>{Nd(r,e,t)}),s}if(Rt(i)){const s=[];for(let r=0;r<i.length;r++)s.push(Is(i[r],e,t,n));return s}}function Nd(i,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:a}=e&&e.appContext.config||fn;if(e){let o=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;o;){const u=o.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](i,l,c)===!1)return}o=o.parent}if(r){Tr(),Ic(r,null,10,[i,l,c]),Ar();return}}MS(i,t,s,n,a)}function MS(i,e,t,n=!0,s=!1){if(s)throw i;console.error(i)}const xi=[];let zs=-1;const qo=[];let Wr=null,Bo=0;const d0=Promise.resolve();let ed=null;function Cr(i){const e=ed||d0;return i?e.then(this?i.bind(this):i):e}function TS(i){let e=zs+1,t=xi.length;for(;e<t;){const n=e+t>>>1,s=xi[n],r=oc(s);r<i||r===i&&s.flags&2?e=n+1:t=n}return e}function hm(i){if(!(i.flags&1)){const e=oc(i),t=xi[xi.length-1];!t||!(i.flags&2)&&e>=oc(t)?xi.push(i):xi.splice(TS(e),0,i),i.flags|=1,h0()}}function h0(){ed||(ed=d0.then(p0))}function AS(i){Rt(i)?qo.push(...i):Wr&&i.id===-1?Wr.splice(Bo+1,0,i):i.flags&1||(qo.push(i),i.flags|=1),h0()}function E_(i,e,t=zs+1){for(;t<xi.length;t++){const n=xi[t];if(n&&n.flags&2){if(i&&n.id!==i.uid)continue;xi.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function f0(i){if(qo.length){const e=[...new Set(qo)].sort((t,n)=>oc(t)-oc(n));if(qo.length=0,Wr){Wr.push(...e);return}for(Wr=e,Bo=0;Bo<Wr.length;Bo++){const t=Wr[Bo];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Wr=null,Bo=0}}const oc=i=>i.id==null?i.flags&2?-1:1/0:i.id;function p0(i){try{for(zs=0;zs<xi.length;zs++){const e=xi[zs];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Ic(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;zs<xi.length;zs++){const e=xi[zs];e&&(e.flags&=-2)}zs=-1,xi.length=0,f0(),ed=null,(xi.length||qo.length)&&p0()}}let ni=null,m0=null;function td(i){const e=ni;return ni=i,m0=i&&i.type.__scopeId||null,e}function Le(i,e=ni,t){if(!e||i._n)return i;const n=(...s)=>{n._d&&sd(-1);const r=td(e);let a;try{a=i(...s)}finally{td(r),n._d&&sd(1)}return a};return n._n=!0,n._c=!0,n._d=!0,n}function CS(i,e){if(ni===null)return i;const t=Vd(ni),n=i.dirs||(i.dirs=[]);for(let s=0;s<e.length;s++){let[r,a,o,l=fn]=e[s];r&&(Ot(r)&&(r={mounted:r,updated:r}),r.deep&&br(a),n.push({dir:r,instance:t,value:a,oldValue:void 0,arg:o,modifiers:l}))}return i}function wa(i,e,t,n){const s=i.dirs,r=e&&e.dirs;for(let a=0;a<s.length;a++){const o=s[a];r&&(o.oldValue=r[a].value);let l=o.dir[n];l&&(Tr(),Is(l,t,8,[i.el,o,i,e]),Ar())}}const _0=Symbol("_vte"),v0=i=>i.__isTeleport,jl=i=>i&&(i.disabled||i.disabled===""),M_=i=>i&&(i.defer||i.defer===""),T_=i=>typeof SVGElement<"u"&&i instanceof SVGElement,A_=i=>typeof MathMLElement=="function"&&i instanceof MathMLElement,Rf=(i,e)=>{const t=i&&i.to;return Ln(t)?e?e(t):null:t},g0={name:"Teleport",__isTeleport:!0,process(i,e,t,n,s,r,a,o,l,c){const{mc:u,pc:d,pbc:h,o:{insert:f,querySelector:p,createText:m,createComment:_}}=c,v=jl(e.props);let{shapeFlag:x,children:y,dynamicChildren:g}=e;if(i==null){const w=e.el=m(""),b=e.anchor=m("");f(w,t,n),f(b,t,n);const T=(S,M)=>{x&16&&u(y,S,M,s,r,a,o,l)},E=()=>{const S=e.target=Rf(e.props,p),M=x0(S,e,m,f);S&&(a!=="svg"&&T_(S)?a="svg":a!=="mathml"&&A_(S)&&(a="mathml"),s&&s.isCE&&(s.ce._teleportTargets||(s.ce._teleportTargets=new Set)).add(S),v||(T(S,M),Bu(e,!1)))};v&&(T(t,b),Bu(e,!0)),M_(e.props)?(e.el.__isMounted=!1,yi(()=>{E(),delete e.el.__isMounted},r)):E()}else{if(M_(e.props)&&i.el.__isMounted===!1){yi(()=>{g0.process(i,e,t,n,s,r,a,o,l,c)},r);return}e.el=i.el,e.targetStart=i.targetStart;const w=e.anchor=i.anchor,b=e.target=i.target,T=e.targetAnchor=i.targetAnchor,E=jl(i.props),S=E?t:b,M=E?w:T;if(a==="svg"||T_(b)?a="svg":(a==="mathml"||A_(b))&&(a="mathml"),g?(h(i.dynamicChildren,g,S,s,r,a,o),_m(i,e,!0)):l||d(i,e,S,M,s,r,a,o,!1),v)E?e.props&&i.props&&e.props.to!==i.props.to&&(e.props.to=i.props.to):Kc(e,t,w,c,1);else if((e.props&&e.props.to)!==(i.props&&i.props.to)){const A=e.target=Rf(e.props,p);A&&Kc(e,A,null,c,0)}else E&&Kc(e,b,T,c,1);Bu(e,v)}},remove(i,e,t,{um:n,o:{remove:s}},r){const{shapeFlag:a,children:o,anchor:l,targetStart:c,targetAnchor:u,target:d,props:h}=i;if(d&&(s(c),s(u)),r&&s(l),a&16){const f=r||!jl(h);for(let p=0;p<o.length;p++){const m=o[p];n(m,e,t,f,!!m.dynamicChildren)}}},move:Kc,hydrate:PS};function Kc(i,e,t,{o:{insert:n},m:s},r=2){r===0&&n(i.targetAnchor,e,t);const{el:a,anchor:o,shapeFlag:l,children:c,props:u}=i,d=r===2;if(d&&n(a,e,t),(!d||jl(u))&&l&16)for(let h=0;h<c.length;h++)s(c[h],e,t,2);d&&n(o,e,t)}function PS(i,e,t,n,s,r,{o:{nextSibling:a,parentNode:o,querySelector:l,insert:c,createText:u}},d){function h(m,_,v,x){_.anchor=d(a(m),_,o(m),t,n,s,r),_.targetStart=v,_.targetAnchor=x}const f=e.target=Rf(e.props,l),p=jl(e.props);if(f){const m=f._lpa||f.firstChild;if(e.shapeFlag&16)if(p)h(i,e,m,m&&a(m));else{e.anchor=a(i);let _=m;for(;_;){if(_&&_.nodeType===8){if(_.data==="teleport start anchor")e.targetStart=_;else if(_.data==="teleport anchor"){e.targetAnchor=_,f._lpa=e.targetAnchor&&a(e.targetAnchor);break}}_=a(_)}e.targetAnchor||x0(f,e,u,c),d(m&&a(m),e,f,t,n,s,r)}Bu(e,p)}else p&&e.shapeFlag&16&&h(i,e,i,a(i));return e.anchor&&a(e.anchor)}const y0=g0;function Bu(i,e){const t=i.ctx;if(t&&t.ut){let n,s;for(e?(n=i.el,s=i.anchor):(n=i.targetStart,s=i.targetAnchor);n&&n!==s;)n.nodeType===1&&n.setAttribute("data-v-owner",t.uid),n=n.nextSibling;t.ut()}}function x0(i,e,t,n){const s=e.targetStart=t(""),r=e.targetAnchor=t("");return s[_0]=r,i&&(n(s,i),n(r,i)),r}const gr=Symbol("_leaveCb"),Zc=Symbol("_enterCb");function RS(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return In(()=>{i.isMounted=!0}),P0(()=>{i.isUnmounting=!0}),i}const ns=[Function,Array],b0={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ns,onEnter:ns,onAfterEnter:ns,onEnterCancelled:ns,onBeforeLeave:ns,onLeave:ns,onAfterLeave:ns,onLeaveCancelled:ns,onBeforeAppear:ns,onAppear:ns,onAfterAppear:ns,onAppearCancelled:ns},w0=i=>{const e=i.subTree;return e.component?w0(e.component):e},LS={name:"BaseTransition",props:b0,setup(i,{slots:e}){const t=sa(),n=RS();return()=>{const s=e.default&&M0(e.default(),!0);if(!s||!s.length)return;const r=S0(s),a=an(i),{mode:o}=a;if(n.isLeaving)return ph(r);const l=C_(r);if(!l)return ph(r);let c=Lf(l,a,n,t,d=>c=d);l.type!==ui&&lc(l,c);let u=t.subTree&&C_(t.subTree);if(u&&u.type!==ui&&!Ga(u,l)&&w0(t).type!==ui){let d=Lf(u,a,n,t);if(lc(u,d),o==="out-in"&&l.type!==ui)return n.isLeaving=!0,d.afterLeave=()=>{n.isLeaving=!1,t.job.flags&8||t.update(),delete d.afterLeave,u=void 0},ph(r);o==="in-out"&&l.type!==ui?d.delayLeave=(h,f,p)=>{const m=E0(n,u);m[String(u.key)]=u,h[gr]=()=>{f(),h[gr]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{p(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return r}}};function S0(i){let e=i[0];if(i.length>1){for(const t of i)if(t.type!==ui){e=t;break}}return e}const IS=LS;function E0(i,e){const{leavingVNodes:t}=i;let n=t.get(e.type);return n||(n=Object.create(null),t.set(e.type,n)),n}function Lf(i,e,t,n,s){const{appear:r,mode:a,persisted:o=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:h,onLeave:f,onAfterLeave:p,onLeaveCancelled:m,onBeforeAppear:_,onAppear:v,onAfterAppear:x,onAppearCancelled:y}=e,g=String(i.key),w=E0(t,i),b=(S,M)=>{S&&Is(S,n,9,M)},T=(S,M)=>{const A=M[1];b(S,M),Rt(S)?S.every(C=>C.length<=1)&&A():S.length<=1&&A()},E={mode:a,persisted:o,beforeEnter(S){let M=l;if(!t.isMounted)if(r)M=_||l;else return;S[gr]&&S[gr](!0);const A=w[g];A&&Ga(i,A)&&A.el[gr]&&A.el[gr](),b(M,[S])},enter(S){let M=c,A=u,C=d;if(!t.isMounted)if(r)M=v||c,A=x||u,C=y||d;else return;let I=!1;const H=S[Zc]=W=>{I||(I=!0,W?b(C,[S]):b(A,[S]),E.delayedLeave&&E.delayedLeave(),S[Zc]=void 0)};M?T(M,[S,H]):H()},leave(S,M){const A=String(i.key);if(S[Zc]&&S[Zc](!0),t.isUnmounting)return M();b(h,[S]);let C=!1;const I=S[gr]=H=>{C||(C=!0,M(),H?b(m,[S]):b(p,[S]),S[gr]=void 0,w[A]===i&&delete w[A])};w[A]=i,f?T(f,[S,I]):I()},clone(S){const M=Lf(S,e,t,n,s);return s&&s(M),M}};return E}function ph(i){if(Fd(i))return i=ia(i),i.children=null,i}function C_(i){if(!Fd(i))return v0(i.type)&&i.children?S0(i.children):i;if(i.component)return i.component.subTree;const{shapeFlag:e,children:t}=i;if(t){if(e&16)return t[0];if(e&32&&Ot(t.default))return t.default()}}function lc(i,e){i.shapeFlag&6&&i.component?(i.transition=e,lc(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function M0(i,e=!1,t){let n=[],s=0;for(let r=0;r<i.length;r++){let a=i[r];const o=t==null?a.key:String(t)+String(a.key!=null?a.key:r);a.type===At?(a.patchFlag&128&&s++,n=n.concat(M0(a.children,e,o))):(e||a.type!==ui)&&n.push(o!=null?ia(a,{key:o}):a)}if(s>1)for(let r=0;r<n.length;r++)n[r].patchFlag=-2;return n}function fm(i,e){return Ot(i)?Qn({name:i.name},e,{setup:i}):i}function Dc(){const i=sa();return i?(i.appContext.config.idPrefix||"v")+"-"+i.ids[0]+i.ids[1]++:""}function T0(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}const nd=new WeakMap;function Kl(i,e,t,n,s=!1){if(Rt(i)){i.forEach((p,m)=>Kl(p,e&&(Rt(e)?e[m]:e),t,n,s));return}if(Yo(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Kl(i,e,t,n.component.subTree);return}const r=n.shapeFlag&4?Vd(n.component):n.el,a=s?null:r,{i:o,r:l}=i,c=e&&e.r,u=o.refs===fn?o.refs={}:o.refs,d=o.setupState,h=an(d),f=d===fn?Fy:p=>on(h,p);if(c!=null&&c!==l){if(P_(e),Ln(c))u[c]=null,f(c)&&(d[c]=null);else if(ii(c)){c.value=null;const p=e;p.k&&(u[p.k]=null)}}if(Ot(l))Ic(l,o,12,[a,u]);else{const p=Ln(l),m=ii(l);if(p||m){const _=()=>{if(i.f){const v=p?f(l)?d[l]:u[l]:l.value;if(s)Rt(v)&&im(v,r);else if(Rt(v))v.includes(r)||v.push(r);else if(p)u[l]=[r],f(l)&&(d[l]=u[l]);else{const x=[r];l.value=x,i.k&&(u[i.k]=x)}}else p?(u[l]=a,f(l)&&(d[l]=a)):m&&(l.value=a,i.k&&(u[i.k]=a))};if(a){const v=()=>{_(),nd.delete(i)};v.id=-1,nd.set(i,v),yi(v,t)}else P_(i),_()}}}function P_(i){const e=nd.get(i);e&&(e.flags|=8,nd.delete(i))}kd().requestIdleCallback;kd().cancelIdleCallback;const Yo=i=>!!i.type.__asyncLoader,Fd=i=>i.type.__isKeepAlive;function DS(i,e){A0(i,"a",e)}function kS(i,e){A0(i,"da",e)}function A0(i,e,t=di){const n=i.__wdc||(i.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return i()});if(Ud(e,n,t),t){let s=t.parent;for(;s&&s.parent;)Fd(s.parent.vnode)&&BS(n,e,t,s),s=s.parent}}function BS(i,e,t,n){const s=Ud(e,i,n,!0);Ds(()=>{im(n[e],s)},t)}function Ud(i,e,t=di,n=!1){if(t){const s=t[i]||(t[i]=[]),r=e.__weh||(e.__weh=(...a)=>{Tr();const o=Bc(t),l=Is(e,t,i,a);return o(),Ar(),l});return n?s.unshift(r):s.push(r),r}}const Dr=i=>(e,t=di)=>{(!dc||i==="sp")&&Ud(i,(...n)=>e(...n),t)},C0=Dr("bm"),In=Dr("m"),OS=Dr("bu"),NS=Dr("u"),P0=Dr("bum"),Ds=Dr("um"),FS=Dr("sp"),US=Dr("rtg"),zS=Dr("rtc");function VS(i,e=di){Ud("ec",i,e)}const GS="components";function If(i,e){return WS(GS,i,!0,e)||i}const HS=Symbol.for("v-ndc");function WS(i,e,t=!0,n=!1){const s=ni||di;if(s){const r=s.type;{const o=DE(r,!1);if(o&&(o===e||o===ps(e)||o===Dd(ps(e))))return r}const a=R_(s[i]||r[i],e)||R_(s.appContext[i],e);return!a&&n?r:a}}function R_(i,e){return i&&(i[e]||i[ps(e)]||i[Dd(ps(e))])}function Zt(i,e,t,n){let s;const r=t,a=Rt(i);if(a||Ln(i)){const o=a&&Xo(i);let l=!1,c=!1;o&&(l=!fs(i),c=na(i),i=Bd(i)),s=new Array(i.length);for(let u=0,d=i.length;u<d;u++)s[u]=e(l?c?Ju(ti(i[u])):ti(i[u]):i[u],u,void 0,r)}else if(typeof i=="number"){s=new Array(i);for(let o=0;o<i;o++)s[o]=e(o+1,o,void 0,r)}else if(vn(i))if(i[Symbol.iterator])s=Array.from(i,(o,l)=>e(o,l,void 0,r));else{const o=Object.keys(i);s=new Array(o.length);for(let l=0,c=o.length;l<c;l++){const u=o[l];s[l]=e(i[u],u,l,r)}}else s=[];return s}function Hn(i,e,t={},n,s){if(ni.ce||ni.parent&&Yo(ni.parent)&&ni.parent.ce){const c=Object.keys(t).length>0;return e!=="default"&&(t.name=e),oe(),jt(At,null,[we("slot",t,n&&n())],c?-2:64)}let r=i[e];r&&r._c&&(r._d=!1),oe();const a=r&&R0(r(t)),o=t.key||a&&a.key,l=jt(At,{key:(o&&!Ir(o)?o:`_${e}`)+(!a&&n?"_fb":"")},a||(n?n():[]),a&&i._===1?64:-2);return r&&r._c&&(r._d=!0),l}function R0(i){return i.some(e=>uc(e)?!(e.type===ui||e.type===At&&!R0(e.children)):!0)?i:null}const Df=i=>i?j0(i)?Vd(i):Df(i.parent):null,Zl=Qn(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Df(i.parent),$root:i=>Df(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>I0(i),$forceUpdate:i=>i.f||(i.f=()=>{hm(i.update)}),$nextTick:i=>i.n||(i.n=Cr.bind(i.proxy)),$watch:i=>hE.bind(i)}),mh=(i,e)=>i!==fn&&!i.__isScriptSetup&&on(i,e),$S={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:r,accessCache:a,type:o,appContext:l}=i;let c;if(e[0]!=="$"){const f=a[e];if(f!==void 0)switch(f){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(mh(n,e))return a[e]=1,n[e];if(s!==fn&&on(s,e))return a[e]=2,s[e];if((c=i.propsOptions[0])&&on(c,e))return a[e]=3,r[e];if(t!==fn&&on(t,e))return a[e]=4,t[e];kf&&(a[e]=0)}}const u=Zl[e];let d,h;if(u)return e==="$attrs"&&ci(i.attrs,"get",""),u(i);if((d=o.__cssModules)&&(d=d[e]))return d;if(t!==fn&&on(t,e))return a[e]=4,t[e];if(h=l.config.globalProperties,on(h,e))return h[e]},set({_:i},e,t){const{data:n,setupState:s,ctx:r}=i;return mh(s,e)?(s[e]=t,!0):n!==fn&&on(n,e)?(n[e]=t,!0):on(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(r[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:r,type:a}},o){let l,c;return!!(t[o]||i!==fn&&o[0]!=="$"&&on(i,o)||mh(e,o)||(l=r[0])&&on(l,o)||on(n,o)||on(Zl,o)||on(s.config.globalProperties,o)||(c=a.__cssModules)&&c[o])},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:on(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};function L_(i){return Rt(i)?i.reduce((e,t)=>(e[t]=null,e),{}):i}let kf=!0;function XS(i){const e=I0(i),t=i.proxy,n=i.ctx;kf=!1,e.beforeCreate&&I_(e.beforeCreate,i,"bc");const{data:s,computed:r,methods:a,watch:o,provide:l,inject:c,created:u,beforeMount:d,mounted:h,beforeUpdate:f,updated:p,activated:m,deactivated:_,beforeDestroy:v,beforeUnmount:x,destroyed:y,unmounted:g,render:w,renderTracked:b,renderTriggered:T,errorCaptured:E,serverPrefetch:S,expose:M,inheritAttrs:A,components:C,directives:I,filters:H}=e;if(c&&qS(c,n,null),a)for(const q in a){const O=a[q];Ot(O)&&(n[q]=O.bind(t))}if(s){const q=s.call(t,t);vn(q)&&(i.data=Od(q))}if(kf=!0,r)for(const q in r){const O=r[q],re=Ot(O)?O.bind(t,t):Ot(O.get)?O.get.bind(t,t):js,le=!Ot(O)&&Ot(O.set)?O.set.bind(t):js,Z=tt({get:re,set:le});Object.defineProperty(n,q,{enumerable:!0,configurable:!0,get:()=>Z.value,set:ne=>Z.value=ne})}if(o)for(const q in o)L0(o[q],n,t,q);if(l){const q=Ot(l)?l.call(t):l;Reflect.ownKeys(q).forEach(O=>{QS(O,q[O])})}u&&I_(u,i,"c");function z(q,O){Rt(O)?O.forEach(re=>q(re.bind(t))):O&&q(O.bind(t))}if(z(C0,d),z(In,h),z(OS,f),z(NS,p),z(DS,m),z(kS,_),z(VS,E),z(zS,b),z(US,T),z(P0,x),z(Ds,g),z(FS,S),Rt(M))if(M.length){const q=i.exposed||(i.exposed={});M.forEach(O=>{Object.defineProperty(q,O,{get:()=>t[O],set:re=>t[O]=re,enumerable:!0})})}else i.exposed||(i.exposed={});w&&i.render===js&&(i.render=w),A!=null&&(i.inheritAttrs=A),C&&(i.components=C),I&&(i.directives=I),S&&T0(i)}function qS(i,e,t=js){Rt(i)&&(i=Bf(i));for(const n in i){const s=i[n];let r;vn(s)?"default"in s?r=Ko(s.from||n,s.default,!0):r=Ko(s.from||n):r=Ko(s),ii(r)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>r.value,set:a=>r.value=a}):e[n]=r}}function I_(i,e,t){Is(Rt(i)?i.map(n=>n.bind(e.proxy)):i.bind(e.proxy),e,t)}function L0(i,e,t,n){let s=n.includes(".")?W0(t,n):()=>t[n];if(Ln(i)){const r=e[i];Ot(r)&&Wn(s,r)}else if(Ot(i))Wn(s,i.bind(t));else if(vn(i))if(Rt(i))i.forEach(r=>L0(r,e,t,n));else{const r=Ot(i.handler)?i.handler.bind(t):e[i.handler];Ot(r)&&Wn(s,r,i)}}function I0(i){const e=i.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:a}}=i.appContext,o=r.get(e);let l;return o?l=o:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(c=>id(l,c,a,!0)),id(l,e,a)),vn(e)&&r.set(e,l),l}function id(i,e,t,n=!1){const{mixins:s,extends:r}=e;r&&id(i,r,t,!0),s&&s.forEach(a=>id(i,a,t,!0));for(const a in e)if(!(n&&a==="expose")){const o=YS[a]||t&&t[a];i[a]=o?o(i[a],e[a]):e[a]}return i}const YS={data:D_,props:k_,emits:k_,methods:Vl,computed:Vl,beforeCreate:_i,created:_i,beforeMount:_i,mounted:_i,beforeUpdate:_i,updated:_i,beforeDestroy:_i,beforeUnmount:_i,destroyed:_i,unmounted:_i,activated:_i,deactivated:_i,errorCaptured:_i,serverPrefetch:_i,components:Vl,directives:Vl,watch:KS,provide:D_,inject:jS};function D_(i,e){return e?i?function(){return Qn(Ot(i)?i.call(this,this):i,Ot(e)?e.call(this,this):e)}:e:i}function jS(i,e){return Vl(Bf(i),Bf(e))}function Bf(i){if(Rt(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function _i(i,e){return i?[...new Set([].concat(i,e))]:e}function Vl(i,e){return i?Qn(Object.create(null),i,e):e}function k_(i,e){return i?Rt(i)&&Rt(e)?[...new Set([...i,...e])]:Qn(Object.create(null),L_(i),L_(e??{})):e}function KS(i,e){if(!i)return e;if(!e)return i;const t=Qn(Object.create(null),i);for(const n in e)t[n]=_i(i[n],e[n]);return t}function D0(){return{app:null,config:{isNativeTag:Fy,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ZS=0;function JS(i,e){return function(n,s=null){Ot(n)||(n=Qn({},n)),s!=null&&!vn(s)&&(s=null);const r=D0(),a=new WeakSet,o=[];let l=!1;const c=r.app={_uid:ZS++,_component:n,_props:s,_container:null,_context:r,_instance:null,version:BE,get config(){return r.config},set config(u){},use(u,...d){return a.has(u)||(u&&Ot(u.install)?(a.add(u),u.install(c,...d)):Ot(u)&&(a.add(u),u(c,...d))),c},mixin(u){return r.mixins.includes(u)||r.mixins.push(u),c},component(u,d){return d?(r.components[u]=d,c):r.components[u]},directive(u,d){return d?(r.directives[u]=d,c):r.directives[u]},mount(u,d,h){if(!l){const f=c._ceVNode||we(n,s);return f.appContext=r,h===!0?h="svg":h===!1&&(h=void 0),i(f,u,h),l=!0,c._container=u,u.__vue_app__=c,Vd(f.component)}},onUnmount(u){o.push(u)},unmount(){l&&(Is(o,c._instance,16),i(null,c._container),delete c._container.__vue_app__)},provide(u,d){return r.provides[u]=d,c},runWithContext(u){const d=jo;jo=c;try{return u()}finally{jo=d}}};return c}}let jo=null;function QS(i,e){if(di){let t=di.provides;const n=di.parent&&di.parent.provides;n===t&&(t=di.provides=Object.create(n)),t[i]=e}}function Ko(i,e,t=!1){const n=sa();if(n||jo){let s=jo?jo._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&i in s)return s[i];if(arguments.length>1)return t&&Ot(e)?e.call(n&&n.proxy):e}}const k0={},B0=()=>Object.create(k0),O0=i=>Object.getPrototypeOf(i)===k0;function eE(i,e,t,n=!1){const s={},r=B0();i.propsDefaults=Object.create(null),N0(i,e,s,r);for(const a in i.propsOptions[0])a in s||(s[a]=void 0);t?i.props=n?s:vS(s):i.type.props?i.props=s:i.props=r,i.attrs=r}function tE(i,e,t,n){const{props:s,attrs:r,vnode:{patchFlag:a}}=i,o=an(s),[l]=i.propsOptions;let c=!1;if((n||a>0)&&!(a&16)){if(a&8){const u=i.vnode.dynamicProps;for(let d=0;d<u.length;d++){let h=u[d];if(zd(i.emitsOptions,h))continue;const f=e[h];if(l)if(on(r,h))f!==r[h]&&(r[h]=f,c=!0);else{const p=ps(h);s[p]=Of(l,o,p,f,i,!1)}else f!==r[h]&&(r[h]=f,c=!0)}}}else{N0(i,e,s,r)&&(c=!0);let u;for(const d in o)(!e||!on(e,d)&&((u=ha(d))===d||!on(e,u)))&&(l?t&&(t[d]!==void 0||t[u]!==void 0)&&(s[d]=Of(l,o,d,void 0,i,!0)):delete s[d]);if(r!==o)for(const d in r)(!e||!on(e,d))&&(delete r[d],c=!0)}c&&xr(i.attrs,"set","")}function N0(i,e,t,n){const[s,r]=i.propsOptions;let a=!1,o;if(e)for(let l in e){if(Xl(l))continue;const c=e[l];let u;s&&on(s,u=ps(l))?!r||!r.includes(u)?t[u]=c:(o||(o={}))[u]=c:zd(i.emitsOptions,l)||(!(l in n)||c!==n[l])&&(n[l]=c,a=!0)}if(r){const l=an(t),c=o||fn;for(let u=0;u<r.length;u++){const d=r[u];t[d]=Of(s,l,d,c[d],i,!on(c,d))}}return a}function Of(i,e,t,n,s,r){const a=i[t];if(a!=null){const o=on(a,"default");if(o&&n===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&Ot(l)){const{propsDefaults:c}=s;if(t in c)n=c[t];else{const u=Bc(s);n=c[t]=l.call(null,e),u()}}else n=l;s.ce&&s.ce._setProp(t,n)}a[0]&&(r&&!o?n=!1:a[1]&&(n===""||n===ha(t))&&(n=!0))}return n}const nE=new WeakMap;function F0(i,e,t=!1){const n=t?nE:e.propsCache,s=n.get(i);if(s)return s;const r=i.props,a={},o=[];let l=!1;if(!Ot(i)){const u=d=>{l=!0;const[h,f]=F0(d,e,!0);Qn(a,h),f&&o.push(...f)};!t&&e.mixins.length&&e.mixins.forEach(u),i.extends&&u(i.extends),i.mixins&&i.mixins.forEach(u)}if(!r&&!l)return vn(i)&&n.set(i,Wo),Wo;if(Rt(r))for(let u=0;u<r.length;u++){const d=ps(r[u]);B_(d)&&(a[d]=fn)}else if(r)for(const u in r){const d=ps(u);if(B_(d)){const h=r[u],f=a[d]=Rt(h)||Ot(h)?{type:h}:Qn({},h),p=f.type;let m=!1,_=!0;if(Rt(p))for(let v=0;v<p.length;++v){const x=p[v],y=Ot(x)&&x.name;if(y==="Boolean"){m=!0;break}else y==="String"&&(_=!1)}else m=Ot(p)&&p.name==="Boolean";f[0]=m,f[1]=_,(m||on(f,"default"))&&o.push(d)}}const c=[a,o];return vn(i)&&n.set(i,c),c}function B_(i){return i[0]!=="$"&&!Xl(i)}const pm=i=>i==="_"||i==="_ctx"||i==="$stable",mm=i=>Rt(i)?i.map(Gs):[Gs(i)],iE=(i,e,t)=>{if(e._n)return e;const n=Le((...s)=>mm(e(...s)),t);return n._c=!1,n},U0=(i,e,t)=>{const n=i._ctx;for(const s in i){if(pm(s))continue;const r=i[s];if(Ot(r))e[s]=iE(s,r,n);else if(r!=null){const a=mm(r);e[s]=()=>a}}},z0=(i,e)=>{const t=mm(e);i.slots.default=()=>t},V0=(i,e,t)=>{for(const n in e)(t||!pm(n))&&(i[n]=e[n])},sE=(i,e,t)=>{const n=i.slots=B0();if(i.vnode.shapeFlag&32){const s=e._;s?(V0(n,e,t),t&&Hy(n,"_",s,!0)):U0(e,n)}else e&&z0(i,e)},rE=(i,e,t)=>{const{vnode:n,slots:s}=i;let r=!0,a=fn;if(n.shapeFlag&32){const o=e._;o?t&&o===1?r=!1:V0(s,e,t):(r=!e.$stable,U0(e,s)),a=e}else e&&(z0(i,e),a={default:1});if(r)for(const o in s)!pm(o)&&a[o]==null&&delete s[o]},yi=xE;function aE(i){return oE(i)}function oE(i,e){const t=kd();t.__VUE__=!0;const{insert:n,remove:s,patchProp:r,createElement:a,createText:o,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:h,setScopeId:f=js,insertStaticContent:p}=i,m=(Y,P,R,N=null,$=null,ie=null,ye=void 0,ve=null,k=!!P.dynamicChildren)=>{if(Y===P)return;Y&&!Ga(Y,P)&&(N=Q(Y),ne(Y,$,ie,!0),Y=null),P.patchFlag===-2&&(k=!1,P.dynamicChildren=null);const{type:V,ref:de,shapeFlag:D}=P;switch(V){case kc:_(Y,P,R,N);break;case ui:v(Y,P,R,N);break;case Ou:Y==null&&x(P,R,N,ye);break;case At:C(Y,P,R,N,$,ie,ye,ve,k);break;default:D&1?w(Y,P,R,N,$,ie,ye,ve,k):D&6?I(Y,P,R,N,$,ie,ye,ve,k):(D&64||D&128)&&V.process(Y,P,R,N,$,ie,ye,ve,k,xe)}de!=null&&$?Kl(de,Y&&Y.ref,ie,P||Y,!P):de==null&&Y&&Y.ref!=null&&Kl(Y.ref,null,ie,Y,!0)},_=(Y,P,R,N)=>{if(Y==null)n(P.el=o(P.children),R,N);else{const $=P.el=Y.el;P.children!==Y.children&&c($,P.children)}},v=(Y,P,R,N)=>{Y==null?n(P.el=l(P.children||""),R,N):P.el=Y.el},x=(Y,P,R,N)=>{[Y.el,Y.anchor]=p(Y.children,P,R,N,Y.el,Y.anchor)},y=({el:Y,anchor:P},R,N)=>{let $;for(;Y&&Y!==P;)$=h(Y),n(Y,R,N),Y=$;n(P,R,N)},g=({el:Y,anchor:P})=>{let R;for(;Y&&Y!==P;)R=h(Y),s(Y),Y=R;s(P)},w=(Y,P,R,N,$,ie,ye,ve,k)=>{P.type==="svg"?ye="svg":P.type==="math"&&(ye="mathml"),Y==null?b(P,R,N,$,ie,ye,ve,k):S(Y,P,$,ie,ye,ve,k)},b=(Y,P,R,N,$,ie,ye,ve)=>{let k,V;const{props:de,shapeFlag:D,transition:L,dirs:J}=Y;if(k=Y.el=a(Y.type,ie,de&&de.is,de),D&8?u(k,Y.children):D&16&&E(Y.children,k,null,N,$,_h(Y,ie),ye,ve),J&&wa(Y,null,N,"created"),T(k,Y,Y.scopeId,ye,N),de){for(const te in de)te!=="value"&&!Xl(te)&&r(k,te,null,de[te],ie,N);"value"in de&&r(k,"value",null,de.value,ie),(V=de.onVnodeBeforeMount)&&Os(V,N,Y)}J&&wa(Y,null,N,"beforeMount");const K=lE($,L);K&&L.beforeEnter(k),n(k,P,R),((V=de&&de.onVnodeMounted)||K||J)&&yi(()=>{V&&Os(V,N,Y),K&&L.enter(k),J&&wa(Y,null,N,"mounted")},$)},T=(Y,P,R,N,$)=>{if(R&&f(Y,R),N)for(let ie=0;ie<N.length;ie++)f(Y,N[ie]);if($){let ie=$.subTree;if(P===ie||X0(ie.type)&&(ie.ssContent===P||ie.ssFallback===P)){const ye=$.vnode;T(Y,ye,ye.scopeId,ye.slotScopeIds,$.parent)}}},E=(Y,P,R,N,$,ie,ye,ve,k=0)=>{for(let V=k;V<Y.length;V++){const de=Y[V]=ve?$r(Y[V]):Gs(Y[V]);m(null,de,P,R,N,$,ie,ye,ve)}},S=(Y,P,R,N,$,ie,ye)=>{const ve=P.el=Y.el;let{patchFlag:k,dynamicChildren:V,dirs:de}=P;k|=Y.patchFlag&16;const D=Y.props||fn,L=P.props||fn;let J;if(R&&Sa(R,!1),(J=L.onVnodeBeforeUpdate)&&Os(J,R,P,Y),de&&wa(P,Y,R,"beforeUpdate"),R&&Sa(R,!0),(D.innerHTML&&L.innerHTML==null||D.textContent&&L.textContent==null)&&u(ve,""),V?M(Y.dynamicChildren,V,ve,R,N,_h(P,$),ie):ye||O(Y,P,ve,null,R,N,_h(P,$),ie,!1),k>0){if(k&16)A(ve,D,L,R,$);else if(k&2&&D.class!==L.class&&r(ve,"class",null,L.class,$),k&4&&r(ve,"style",D.style,L.style,$),k&8){const K=P.dynamicProps;for(let te=0;te<K.length;te++){const me=K[te],Ie=D[me],Pe=L[me];(Pe!==Ie||me==="value")&&r(ve,me,Ie,Pe,$,R)}}k&1&&Y.children!==P.children&&u(ve,P.children)}else!ye&&V==null&&A(ve,D,L,R,$);((J=L.onVnodeUpdated)||de)&&yi(()=>{J&&Os(J,R,P,Y),de&&wa(P,Y,R,"updated")},N)},M=(Y,P,R,N,$,ie,ye)=>{for(let ve=0;ve<P.length;ve++){const k=Y[ve],V=P[ve],de=k.el&&(k.type===At||!Ga(k,V)||k.shapeFlag&198)?d(k.el):R;m(k,V,de,null,N,$,ie,ye,!0)}},A=(Y,P,R,N,$)=>{if(P!==R){if(P!==fn)for(const ie in P)!Xl(ie)&&!(ie in R)&&r(Y,ie,P[ie],null,$,N);for(const ie in R){if(Xl(ie))continue;const ye=R[ie],ve=P[ie];ye!==ve&&ie!=="value"&&r(Y,ie,ve,ye,$,N)}"value"in R&&r(Y,"value",P.value,R.value,$)}},C=(Y,P,R,N,$,ie,ye,ve,k)=>{const V=P.el=Y?Y.el:o(""),de=P.anchor=Y?Y.anchor:o("");let{patchFlag:D,dynamicChildren:L,slotScopeIds:J}=P;J&&(ve=ve?ve.concat(J):J),Y==null?(n(V,R,N),n(de,R,N),E(P.children||[],R,de,$,ie,ye,ve,k)):D>0&&D&64&&L&&Y.dynamicChildren?(M(Y.dynamicChildren,L,R,$,ie,ye,ve),(P.key!=null||$&&P===$.subTree)&&_m(Y,P,!0)):O(Y,P,R,de,$,ie,ye,ve,k)},I=(Y,P,R,N,$,ie,ye,ve,k)=>{P.slotScopeIds=ve,Y==null?P.shapeFlag&512?$.ctx.activate(P,R,N,ye,k):H(P,R,N,$,ie,ye,k):W(Y,P,k)},H=(Y,P,R,N,$,ie,ye)=>{const ve=Y.component=CE(Y,N,$);if(Fd(Y)&&(ve.ctx.renderer=xe),PE(ve,!1,ye),ve.asyncDep){if($&&$.registerDep(ve,z,ye),!Y.el){const k=ve.subTree=we(ui);v(null,k,P,R),Y.placeholder=k.el}}else z(ve,Y,P,R,$,ie,ye)},W=(Y,P,R)=>{const N=P.component=Y.component;if(gE(Y,P,R))if(N.asyncDep&&!N.asyncResolved){q(N,P,R);return}else N.next=P,N.update();else P.el=Y.el,N.vnode=P},z=(Y,P,R,N,$,ie,ye)=>{const ve=()=>{if(Y.isMounted){let{next:D,bu:L,u:J,parent:K,vnode:te}=Y;{const Ye=G0(Y);if(Ye){D&&(D.el=te.el,q(Y,D,ye)),Ye.asyncDep.then(()=>{Y.isUnmounted||ve()});return}}let me=D,Ie;Sa(Y,!1),D?(D.el=te.el,q(Y,D,ye)):D=te,L&&ku(L),(Ie=D.props&&D.props.onVnodeBeforeUpdate)&&Os(Ie,K,D,te),Sa(Y,!0);const Pe=N_(Y),Ke=Y.subTree;Y.subTree=Pe,m(Ke,Pe,d(Ke.el),Q(Ke),Y,$,ie),D.el=Pe.el,me===null&&yE(Y,Pe.el),J&&yi(J,$),(Ie=D.props&&D.props.onVnodeUpdated)&&yi(()=>Os(Ie,K,D,te),$)}else{let D;const{el:L,props:J}=P,{bm:K,m:te,parent:me,root:Ie,type:Pe}=Y,Ke=Yo(P);Sa(Y,!1),K&&ku(K),!Ke&&(D=J&&J.onVnodeBeforeMount)&&Os(D,me,P),Sa(Y,!0);{Ie.ce&&Ie.ce._def.shadowRoot!==!1&&Ie.ce._injectChildStyle(Pe);const Ye=Y.subTree=N_(Y);m(null,Ye,R,N,Y,$,ie),P.el=Ye.el}if(te&&yi(te,$),!Ke&&(D=J&&J.onVnodeMounted)){const Ye=P;yi(()=>Os(D,me,Ye),$)}(P.shapeFlag&256||me&&Yo(me.vnode)&&me.vnode.shapeFlag&256)&&Y.a&&yi(Y.a,$),Y.isMounted=!0,P=R=N=null}};Y.scope.on();const k=Y.effect=new Yy(ve);Y.scope.off();const V=Y.update=k.run.bind(k),de=Y.job=k.runIfDirty.bind(k);de.i=Y,de.id=Y.uid,k.scheduler=()=>hm(de),Sa(Y,!0),V()},q=(Y,P,R)=>{P.component=Y;const N=Y.vnode.props;Y.vnode=P,Y.next=null,tE(Y,P.props,N,R),rE(Y,P.children,R),Tr(),E_(Y),Ar()},O=(Y,P,R,N,$,ie,ye,ve,k=!1)=>{const V=Y&&Y.children,de=Y?Y.shapeFlag:0,D=P.children,{patchFlag:L,shapeFlag:J}=P;if(L>0){if(L&128){le(V,D,R,N,$,ie,ye,ve,k);return}else if(L&256){re(V,D,R,N,$,ie,ye,ve,k);return}}J&8?(de&16&&X(V,$,ie),D!==V&&u(R,D)):de&16?J&16?le(V,D,R,N,$,ie,ye,ve,k):X(V,$,ie,!0):(de&8&&u(R,""),J&16&&E(D,R,N,$,ie,ye,ve,k))},re=(Y,P,R,N,$,ie,ye,ve,k)=>{Y=Y||Wo,P=P||Wo;const V=Y.length,de=P.length,D=Math.min(V,de);let L;for(L=0;L<D;L++){const J=P[L]=k?$r(P[L]):Gs(P[L]);m(Y[L],J,R,null,$,ie,ye,ve,k)}V>de?X(Y,$,ie,!0,!1,D):E(P,R,N,$,ie,ye,ve,k,D)},le=(Y,P,R,N,$,ie,ye,ve,k)=>{let V=0;const de=P.length;let D=Y.length-1,L=de-1;for(;V<=D&&V<=L;){const J=Y[V],K=P[V]=k?$r(P[V]):Gs(P[V]);if(Ga(J,K))m(J,K,R,null,$,ie,ye,ve,k);else break;V++}for(;V<=D&&V<=L;){const J=Y[D],K=P[L]=k?$r(P[L]):Gs(P[L]);if(Ga(J,K))m(J,K,R,null,$,ie,ye,ve,k);else break;D--,L--}if(V>D){if(V<=L){const J=L+1,K=J<de?P[J].el:N;for(;V<=L;)m(null,P[V]=k?$r(P[V]):Gs(P[V]),R,K,$,ie,ye,ve,k),V++}}else if(V>L)for(;V<=D;)ne(Y[V],$,ie,!0),V++;else{const J=V,K=V,te=new Map;for(V=K;V<=L;V++){const dt=P[V]=k?$r(P[V]):Gs(P[V]);dt.key!=null&&te.set(dt.key,V)}let me,Ie=0;const Pe=L-K+1;let Ke=!1,Ye=0;const De=new Array(Pe);for(V=0;V<Pe;V++)De[V]=0;for(V=J;V<=D;V++){const dt=Y[V];if(Ie>=Pe){ne(dt,$,ie,!0);continue}let at;if(dt.key!=null)at=te.get(dt.key);else for(me=K;me<=L;me++)if(De[me-K]===0&&Ga(dt,P[me])){at=me;break}at===void 0?ne(dt,$,ie,!0):(De[at-K]=V+1,at>=Ye?Ye=at:Ke=!0,m(dt,P[at],R,null,$,ie,ye,ve,k),Ie++)}const Xe=Ke?cE(De):Wo;for(me=Xe.length-1,V=Pe-1;V>=0;V--){const dt=K+V,at=P[dt],qe=P[dt+1],bt=dt+1<de?qe.el||qe.placeholder:N;De[V]===0?m(null,at,R,bt,$,ie,ye,ve,k):Ke&&(me<0||V!==Xe[me]?Z(at,R,bt,2):me--)}}},Z=(Y,P,R,N,$=null)=>{const{el:ie,type:ye,transition:ve,children:k,shapeFlag:V}=Y;if(V&6){Z(Y.component.subTree,P,R,N);return}if(V&128){Y.suspense.move(P,R,N);return}if(V&64){ye.move(Y,P,R,xe);return}if(ye===At){n(ie,P,R);for(let D=0;D<k.length;D++)Z(k[D],P,R,N);n(Y.anchor,P,R);return}if(ye===Ou){y(Y,P,R);return}if(N!==2&&V&1&&ve)if(N===0)ve.beforeEnter(ie),n(ie,P,R),yi(()=>ve.enter(ie),$);else{const{leave:D,delayLeave:L,afterLeave:J}=ve,K=()=>{Y.ctx.isUnmounted?s(ie):n(ie,P,R)},te=()=>{ie._isLeaving&&ie[gr](!0),D(ie,()=>{K(),J&&J()})};L?L(ie,K,te):te()}else n(ie,P,R)},ne=(Y,P,R,N=!1,$=!1)=>{const{type:ie,props:ye,ref:ve,children:k,dynamicChildren:V,shapeFlag:de,patchFlag:D,dirs:L,cacheIndex:J}=Y;if(D===-2&&($=!1),ve!=null&&(Tr(),Kl(ve,null,R,Y,!0),Ar()),J!=null&&(P.renderCache[J]=void 0),de&256){P.ctx.deactivate(Y);return}const K=de&1&&L,te=!Yo(Y);let me;if(te&&(me=ye&&ye.onVnodeBeforeUnmount)&&Os(me,P,Y),de&6)F(Y.component,R,N);else{if(de&128){Y.suspense.unmount(R,N);return}K&&wa(Y,null,P,"beforeUnmount"),de&64?Y.type.remove(Y,P,R,xe,N):V&&!V.hasOnce&&(ie!==At||D>0&&D&64)?X(V,P,R,!1,!0):(ie===At&&D&384||!$&&de&16)&&X(k,P,R),N&&j(Y)}(te&&(me=ye&&ye.onVnodeUnmounted)||K)&&yi(()=>{me&&Os(me,P,Y),K&&wa(Y,null,P,"unmounted")},R)},j=Y=>{const{type:P,el:R,anchor:N,transition:$}=Y;if(P===At){ee(R,N);return}if(P===Ou){g(Y);return}const ie=()=>{s(R),$&&!$.persisted&&$.afterLeave&&$.afterLeave()};if(Y.shapeFlag&1&&$&&!$.persisted){const{leave:ye,delayLeave:ve}=$,k=()=>ye(R,ie);ve?ve(Y.el,ie,k):k()}else ie()},ee=(Y,P)=>{let R;for(;Y!==P;)R=h(Y),s(Y),Y=R;s(P)},F=(Y,P,R)=>{const{bum:N,scope:$,job:ie,subTree:ye,um:ve,m:k,a:V}=Y;O_(k),O_(V),N&&ku(N),$.stop(),ie&&(ie.flags|=8,ne(ye,Y,P,R)),ve&&yi(ve,P),yi(()=>{Y.isUnmounted=!0},P)},X=(Y,P,R,N=!1,$=!1,ie=0)=>{for(let ye=ie;ye<Y.length;ye++)ne(Y[ye],P,R,N,$)},Q=Y=>{if(Y.shapeFlag&6)return Q(Y.component.subTree);if(Y.shapeFlag&128)return Y.suspense.next();const P=h(Y.anchor||Y.el),R=P&&P[_0];return R?h(R):P};let ue=!1;const ce=(Y,P,R)=>{Y==null?P._vnode&&ne(P._vnode,null,null,!0):m(P._vnode||null,Y,P,null,null,null,R),P._vnode=Y,ue||(ue=!0,E_(),f0(),ue=!1)},xe={p:m,um:ne,m:Z,r:j,mt:H,mc:E,pc:O,pbc:M,n:Q,o:i};return{render:ce,hydrate:void 0,createApp:JS(ce)}}function _h({type:i,props:e},t){return t==="svg"&&i==="foreignObject"||t==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Sa({effect:i,job:e},t){t?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function lE(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function _m(i,e,t=!1){const n=i.children,s=e.children;if(Rt(n)&&Rt(s))for(let r=0;r<n.length;r++){const a=n[r];let o=s[r];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=s[r]=$r(s[r]),o.el=a.el),!t&&o.patchFlag!==-2&&_m(a,o)),o.type===kc&&o.patchFlag!==-1&&(o.el=a.el),o.type===ui&&!o.el&&(o.el=a.el)}}function cE(i){const e=i.slice(),t=[0];let n,s,r,a,o;const l=i.length;for(n=0;n<l;n++){const c=i[n];if(c!==0){if(s=t[t.length-1],i[s]<c){e[n]=s,t.push(n);continue}for(r=0,a=t.length-1;r<a;)o=r+a>>1,i[t[o]]<c?r=o+1:a=o;c<i[t[r]]&&(r>0&&(e[n]=t[r-1]),t[r]=n)}}for(r=t.length,a=t[r-1];r-- >0;)t[r]=a,a=e[a];return t}function G0(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:G0(e)}function O_(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}const uE=Symbol.for("v-scx"),dE=()=>Ko(uE);function Wn(i,e,t){return H0(i,e,t)}function H0(i,e,t=fn){const{immediate:n,deep:s,flush:r,once:a}=t,o=Qn({},t),l=e&&n||!e&&r!=="post";let c;if(dc){if(r==="sync"){const f=dE();c=f.__watcherHandles||(f.__watcherHandles=[])}else if(!l){const f=()=>{};return f.stop=js,f.resume=js,f.pause=js,f}}const u=di;o.call=(f,p,m)=>Is(f,u,p,m);let d=!1;r==="post"?o.scheduler=f=>{yi(f,u&&u.suspense)}:r!=="sync"&&(d=!0,o.scheduler=(f,p)=>{p?f():hm(f)}),o.augmentJob=f=>{e&&(f.flags|=4),d&&(f.flags|=2,u&&(f.id=u.uid,f.i=u))};const h=ES(i,e,o);return dc&&(c?c.push(h):l&&h()),h}function hE(i,e,t){const n=this.proxy,s=Ln(i)?i.includes(".")?W0(n,i):()=>n[i]:i.bind(n,n);let r;Ot(e)?r=e:(r=e.handler,t=e);const a=Bc(this),o=H0(s,r.bind(n),t);return a(),o}function W0(i,e){const t=e.split(".");return()=>{let n=i;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const fE=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i[`${e}Modifiers`]||i[`${ps(e)}Modifiers`]||i[`${ha(e)}Modifiers`];function pE(i,e,...t){if(i.isUnmounted)return;const n=i.vnode.props||fn;let s=t;const r=e.startsWith("update:"),a=r&&fE(n,e.slice(7));a&&(a.trim&&(s=t.map(u=>Ln(u)?u.trim():u)),a.number&&(s=t.map(Ef)));let o,l=n[o=ch(e)]||n[o=ch(ps(e))];!l&&r&&(l=n[o=ch(ha(e))]),l&&Is(l,i,6,s);const c=n[o+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[o])return;i.emitted[o]=!0,Is(c,i,6,s)}}const mE=new WeakMap;function $0(i,e,t=!1){const n=t?mE:e.emitsCache,s=n.get(i);if(s!==void 0)return s;const r=i.emits;let a={},o=!1;if(!Ot(i)){const l=c=>{const u=$0(c,e,!0);u&&(o=!0,Qn(a,u))};!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!o?(vn(i)&&n.set(i,null),null):(Rt(r)?r.forEach(l=>a[l]=null):Qn(a,r),vn(i)&&n.set(i,a),a)}function zd(i,e){return!i||!Rd(e)?!1:(e=e.slice(2).replace(/Once$/,""),on(i,e[0].toLowerCase()+e.slice(1))||on(i,ha(e))||on(i,e))}function N_(i){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[r],slots:a,attrs:o,emit:l,render:c,renderCache:u,props:d,data:h,setupState:f,ctx:p,inheritAttrs:m}=i,_=td(i);let v,x;try{if(t.shapeFlag&4){const g=s||n,w=g;v=Gs(c.call(w,g,u,d,f,h,p)),x=o}else{const g=e;v=Gs(g.length>1?g(d,{attrs:o,slots:a,emit:l}):g(d,null)),x=e.props?o:_E(o)}}catch(g){Jl.length=0,Nd(g,i,1),v=we(ui)}let y=v;if(x&&m!==!1){const g=Object.keys(x),{shapeFlag:w}=y;g.length&&w&7&&(r&&g.some(nm)&&(x=vE(x,r)),y=ia(y,x,!1,!0))}return t.dirs&&(y=ia(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(t.dirs):t.dirs),t.transition&&lc(y,t.transition),v=y,td(_),v}const _E=i=>{let e;for(const t in i)(t==="class"||t==="style"||Rd(t))&&((e||(e={}))[t]=i[t]);return e},vE=(i,e)=>{const t={};for(const n in i)(!nm(n)||!(n.slice(9)in e))&&(t[n]=i[n]);return t};function gE(i,e,t){const{props:n,children:s,component:r}=i,{props:a,children:o,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?F_(n,a,c):!!a;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const h=u[d];if(a[h]!==n[h]&&!zd(c,h))return!0}}}else return(s||o)&&(!o||!o.$stable)?!0:n===a?!1:n?a?F_(n,a,c):!0:!!a;return!1}function F_(i,e,t){const n=Object.keys(e);if(n.length!==Object.keys(i).length)return!0;for(let s=0;s<n.length;s++){const r=n[s];if(e[r]!==i[r]&&!zd(t,r))return!0}return!1}function yE({vnode:i,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===i&&(n.el=i.el),n===i)(i=e.vnode).el=t,e=e.parent;else break}}const X0=i=>i.__isSuspense;function xE(i,e){e&&e.pendingBranch?Rt(i)?e.effects.push(...i):e.effects.push(i):AS(i)}const At=Symbol.for("v-fgt"),kc=Symbol.for("v-txt"),ui=Symbol.for("v-cmt"),Ou=Symbol.for("v-stc"),Jl=[];let qi=null;function oe(i=!1){Jl.push(qi=i?null:[])}function bE(){Jl.pop(),qi=Jl[Jl.length-1]||null}let cc=1;function sd(i,e=!1){cc+=i,i<0&&qi&&e&&(qi.hasOnce=!0)}function q0(i){return i.dynamicChildren=cc>0?qi||Wo:null,bE(),cc>0&&qi&&qi.push(i),i}function ge(i,e,t,n,s,r){return q0(B(i,e,t,n,s,r,!0))}function jt(i,e,t,n,s){return q0(we(i,e,t,n,s,!0))}function uc(i){return i?i.__v_isVNode===!0:!1}function Ga(i,e){return i.type===e.type&&i.key===e.key}const Y0=({key:i})=>i??null,Nu=({ref:i,ref_key:e,ref_for:t})=>(typeof i=="number"&&(i=""+i),i!=null?Ln(i)||ii(i)||Ot(i)?{i:ni,r:i,k:e,f:!!t}:i:null);function B(i,e=null,t=null,n=0,s=null,r=i===At?0:1,a=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&Y0(e),ref:e&&Nu(e),scopeId:m0,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:ni};return o?(vm(l,t),r&128&&i.normalize(l)):t&&(l.shapeFlag|=Ln(t)?8:16),cc>0&&!a&&qi&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&qi.push(l),l}const we=wE;function wE(i,e=null,t=null,n=0,s=null,r=!1){if((!i||i===HS)&&(i=ui),uc(i)){const o=ia(i,e,!0);return t&&vm(o,t),cc>0&&!r&&qi&&(o.shapeFlag&6?qi[qi.indexOf(i)]=o:qi.push(o)),o.patchFlag=-2,o}if(kE(i)&&(i=i.__vccOpts),e){e=SE(e);let{class:o,style:l}=e;o&&!Ln(o)&&(e.class=qt(o)),vn(l)&&(dm(l)&&!Rt(l)&&(l=Qn({},l)),e.style=fi(l))}const a=Ln(i)?1:X0(i)?128:v0(i)?64:vn(i)?4:Ot(i)?2:0;return B(i,e,t,n,s,a,r,!0)}function SE(i){return i?dm(i)||O0(i)?Qn({},i):i:null}function ia(i,e,t=!1,n=!1){const{props:s,ref:r,patchFlag:a,children:o,transition:l}=i,c=e?ME(s||{},e):s,u={__v_isVNode:!0,__v_skip:!0,type:i.type,props:c,key:c&&Y0(c),ref:e&&e.ref?t&&r?Rt(r)?r.concat(Nu(e)):[r,Nu(e)]:Nu(e):r,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:o,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==At?a===-1?16:a|16:a,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&ia(i.ssContent),ssFallback:i.ssFallback&&ia(i.ssFallback),placeholder:i.placeholder,el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&n&&lc(u,l.clone(u)),u}function Oe(i=" ",e=0){return we(kc,null,i,e)}function EE(i,e){const t=we(Ou,null,i);return t.staticCount=e,t}function Ve(i="",e=!1){return e?(oe(),jt(ui,null,i)):we(ui,null,i)}function Gs(i){return i==null||typeof i=="boolean"?we(ui):Rt(i)?we(At,null,i.slice()):uc(i)?$r(i):we(kc,null,String(i))}function $r(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:ia(i)}function vm(i,e){let t=0;const{shapeFlag:n}=i;if(e==null)e=null;else if(Rt(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),vm(i,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!O0(e)?e._ctx=ni:s===3&&ni&&(ni.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else Ot(e)?(e={default:e,_ctx:ni},t=32):(e=String(e),n&64?(t=16,e=[Oe(e)]):t=8);i.children=e,i.shapeFlag|=t}function ME(...i){const e={};for(let t=0;t<i.length;t++){const n=i[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=qt([e.class,n.class]));else if(s==="style")e.style=fi([e.style,n.style]);else if(Rd(s)){const r=e[s],a=n[s];a&&r!==a&&!(Rt(r)&&r.includes(a))&&(e[s]=r?[].concat(r,a):a)}else s!==""&&(e[s]=n[s])}return e}function Os(i,e,t,n=null){Is(i,e,7,[t,n])}const TE=D0();let AE=0;function CE(i,e,t){const n=i.type,s=(e?e.appContext:i.appContext)||TE,r={uid:AE++,vnode:i,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new qy(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:F0(n,s),emitsOptions:$0(n,s),emit:null,emitted:null,propsDefaults:fn,inheritAttrs:n.inheritAttrs,ctx:fn,data:fn,props:fn,attrs:fn,slots:fn,refs:fn,setupState:fn,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=pE.bind(null,r),i.ce&&i.ce(r),r}let di=null;const sa=()=>di||ni;let rd,Nf;{const i=kd(),e=(t,n)=>{let s;return(s=i[t])||(s=i[t]=[]),s.push(n),r=>{s.length>1?s.forEach(a=>a(r)):s[0](r)}};rd=e("__VUE_INSTANCE_SETTERS__",t=>di=t),Nf=e("__VUE_SSR_SETTERS__",t=>dc=t)}const Bc=i=>{const e=di;return rd(i),i.scope.on(),()=>{i.scope.off(),rd(e)}},U_=()=>{di&&di.scope.off(),rd(null)};function j0(i){return i.vnode.shapeFlag&4}let dc=!1;function PE(i,e=!1,t=!1){e&&Nf(e);const{props:n,children:s}=i.vnode,r=j0(i);eE(i,n,r,e),sE(i,s,t||e);const a=r?RE(i,e):void 0;return e&&Nf(!1),a}function RE(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,$S);const{setup:n}=t;if(n){Tr();const s=i.setupContext=n.length>1?IE(i):null,r=Bc(i),a=Ic(n,i,0,[i.props,s]),o=zy(a);if(Ar(),r(),(o||i.sp)&&!Yo(i)&&T0(i),o){if(a.then(U_,U_),e)return a.then(l=>{z_(i,l)}).catch(l=>{Nd(l,i,0)});i.asyncDep=a}else z_(i,a)}else K0(i)}function z_(i,e,t){Ot(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:vn(e)&&(i.setupState=u0(e)),K0(i)}function K0(i,e,t){const n=i.type;i.render||(i.render=n.render||js);{const s=Bc(i);Tr();try{XS(i)}finally{Ar(),s()}}}const LE={get(i,e){return ci(i,"get",""),i[e]}};function IE(i){const e=t=>{i.exposed=t||{}};return{attrs:new Proxy(i.attrs,LE),slots:i.slots,emit:i.emit,expose:e}}function Vd(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(u0(gS(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in Zl)return Zl[t](i)},has(e,t){return t in e||t in Zl}})):i.proxy}function DE(i,e=!0){return Ot(i)?i.displayName||i.name:i.name||e&&i.__name}function kE(i){return Ot(i)&&"__vccOpts"in i}const tt=(i,e)=>wS(i,e,dc);function gm(i,e,t){try{sd(-1);const n=arguments.length;return n===2?vn(e)&&!Rt(e)?uc(e)?we(i,null,[e]):we(i,e):we(i,null,e):(n>3?t=Array.prototype.slice.call(arguments,2):n===3&&uc(t)&&(t=[t]),we(i,e,t))}finally{sd(1)}}const BE="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ff;const V_=typeof window<"u"&&window.trustedTypes;if(V_)try{Ff=V_.createPolicy("vue",{createHTML:i=>i})}catch{}const Z0=Ff?i=>Ff.createHTML(i):i=>i,OE="http://www.w3.org/2000/svg",NE="http://www.w3.org/1998/Math/MathML",_r=typeof document<"u"?document:null,G_=_r&&_r.createElement("template"),FE={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,n)=>{const s=e==="svg"?_r.createElementNS(OE,i):e==="mathml"?_r.createElementNS(NE,i):t?_r.createElement(i,{is:t}):_r.createElement(i);return i==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:i=>_r.createTextNode(i),createComment:i=>_r.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>_r.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,n,s,r){const a=t?t.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===r||!(s=s.nextSibling)););else{G_.innerHTML=Z0(n==="svg"?`<svg>${i}</svg>`:n==="mathml"?`<math>${i}</math>`:i);const o=G_.content;if(n==="svg"||n==="mathml"){const l=o.firstChild;for(;l.firstChild;)o.appendChild(l.firstChild);o.removeChild(l)}e.insertBefore(o,t)}return[a?a.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Br="transition",Al="animation",hc=Symbol("_vtc"),J0={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},UE=Qn({},b0,J0),zE=i=>(i.displayName="Transition",i.props=UE,i),Q0=zE((i,{slots:e})=>gm(IS,VE(i),e)),Ea=(i,e=[])=>{Rt(i)?i.forEach(t=>t(...e)):i&&i(...e)},H_=i=>i?Rt(i)?i.some(e=>e.length>1):i.length>1:!1;function VE(i){const e={};for(const C in i)C in J0||(e[C]=i[C]);if(i.css===!1)return e;const{name:t="v",type:n,duration:s,enterFromClass:r=`${t}-enter-from`,enterActiveClass:a=`${t}-enter-active`,enterToClass:o=`${t}-enter-to`,appearFromClass:l=r,appearActiveClass:c=a,appearToClass:u=o,leaveFromClass:d=`${t}-leave-from`,leaveActiveClass:h=`${t}-leave-active`,leaveToClass:f=`${t}-leave-to`}=i,p=GE(s),m=p&&p[0],_=p&&p[1],{onBeforeEnter:v,onEnter:x,onEnterCancelled:y,onLeave:g,onLeaveCancelled:w,onBeforeAppear:b=v,onAppear:T=x,onAppearCancelled:E=y}=e,S=(C,I,H,W)=>{C._enterCancelled=W,Ma(C,I?u:o),Ma(C,I?c:a),H&&H()},M=(C,I)=>{C._isLeaving=!1,Ma(C,d),Ma(C,f),Ma(C,h),I&&I()},A=C=>(I,H)=>{const W=C?T:x,z=()=>S(I,C,H);Ea(W,[I,z]),W_(()=>{Ma(I,C?l:r),nr(I,C?u:o),H_(W)||$_(I,n,m,z)})};return Qn(e,{onBeforeEnter(C){Ea(v,[C]),nr(C,r),nr(C,a)},onBeforeAppear(C){Ea(b,[C]),nr(C,l),nr(C,c)},onEnter:A(!1),onAppear:A(!0),onLeave(C,I){C._isLeaving=!0;const H=()=>M(C,I);nr(C,d),C._enterCancelled?(nr(C,h),Y_(C)):(Y_(C),nr(C,h)),W_(()=>{C._isLeaving&&(Ma(C,d),nr(C,f),H_(g)||$_(C,n,_,H))}),Ea(g,[C,H])},onEnterCancelled(C){S(C,!1,void 0,!0),Ea(y,[C])},onAppearCancelled(C){S(C,!0,void 0,!0),Ea(E,[C])},onLeaveCancelled(C){M(C),Ea(w,[C])}})}function GE(i){if(i==null)return null;if(vn(i))return[vh(i.enter),vh(i.leave)];{const e=vh(i);return[e,e]}}function vh(i){return Ww(i)}function nr(i,e){e.split(/\s+/).forEach(t=>t&&i.classList.add(t)),(i[hc]||(i[hc]=new Set)).add(e)}function Ma(i,e){e.split(/\s+/).forEach(n=>n&&i.classList.remove(n));const t=i[hc];t&&(t.delete(e),t.size||(i[hc]=void 0))}function W_(i){requestAnimationFrame(()=>{requestAnimationFrame(i)})}let HE=0;function $_(i,e,t,n){const s=i._endId=++HE,r=()=>{s===i._endId&&n()};if(t!=null)return setTimeout(r,t);const{type:a,timeout:o,propCount:l}=WE(i,e);if(!a)return n();const c=a+"end";let u=0;const d=()=>{i.removeEventListener(c,h),r()},h=f=>{f.target===i&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},o+1),i.addEventListener(c,h)}function WE(i,e){const t=window.getComputedStyle(i),n=p=>(t[p]||"").split(", "),s=n(`${Br}Delay`),r=n(`${Br}Duration`),a=X_(s,r),o=n(`${Al}Delay`),l=n(`${Al}Duration`),c=X_(o,l);let u=null,d=0,h=0;e===Br?a>0&&(u=Br,d=a,h=r.length):e===Al?c>0&&(u=Al,d=c,h=l.length):(d=Math.max(a,c),u=d>0?a>c?Br:Al:null,h=u?u===Br?r.length:l.length:0);const f=u===Br&&/\b(?:transform|all)(?:,|$)/.test(n(`${Br}Property`).toString());return{type:u,timeout:d,propCount:h,hasTransform:f}}function X_(i,e){for(;i.length<e.length;)i=i.concat(i);return Math.max(...e.map((t,n)=>q_(t)+q_(i[n])))}function q_(i){return i==="auto"?0:Number(i.slice(0,-1).replace(",","."))*1e3}function Y_(i){return(i?i.ownerDocument:document).body.offsetHeight}function $E(i,e,t){const n=i[hc];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}const j_=Symbol("_vod"),XE=Symbol("_vsh"),qE=Symbol(""),YE=/(?:^|;)\s*display\s*:/;function jE(i,e,t){const n=i.style,s=Ln(t);let r=!1;if(t&&!s){if(e)if(Ln(e))for(const a of e.split(";")){const o=a.slice(0,a.indexOf(":")).trim();t[o]==null&&Fu(n,o,"")}else for(const a in e)t[a]==null&&Fu(n,a,"");for(const a in t)a==="display"&&(r=!0),Fu(n,a,t[a])}else if(s){if(e!==t){const a=n[qE];a&&(t+=";"+a),n.cssText=t,r=YE.test(t)}}else e&&i.removeAttribute("style");j_ in i&&(i[j_]=r?n.display:"",i[XE]&&(n.display="none"))}const K_=/\s*!important$/;function Fu(i,e,t){if(Rt(t))t.forEach(n=>Fu(i,e,n));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const n=KE(i,e);K_.test(t)?i.setProperty(ha(n),t.replace(K_,""),"important"):i[n]=t}}const Z_=["Webkit","Moz","ms"],gh={};function KE(i,e){const t=gh[e];if(t)return t;let n=ps(e);if(n!=="filter"&&n in i)return gh[e]=n;n=Dd(n);for(let s=0;s<Z_.length;s++){const r=Z_[s]+n;if(r in i)return gh[e]=r}return e}const J_="http://www.w3.org/1999/xlink";function Q_(i,e,t,n,s,r=Kw(e)){n&&e.startsWith("xlink:")?t==null?i.removeAttributeNS(J_,e.slice(6,e.length)):i.setAttributeNS(J_,e,t):t==null||r&&!Wy(t)?i.removeAttribute(e):i.setAttribute(e,r?"":Ir(t)?String(t):t)}function ev(i,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(i[e]=e==="innerHTML"?Z0(t):t);return}const r=i.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const o=r==="OPTION"?i.getAttribute("value")||"":i.value,l=t==null?i.type==="checkbox"?"on":"":String(t);(o!==l||!("_value"in i))&&(i.value=l),t==null&&i.removeAttribute(e),i._value=t;return}let a=!1;if(t===""||t==null){const o=typeof i[e];o==="boolean"?t=Wy(t):t==null&&o==="string"?(t="",a=!0):o==="number"&&(t=0,a=!0)}try{i[e]=t}catch{}a&&i.removeAttribute(s||e)}function Oo(i,e,t,n){i.addEventListener(e,t,n)}function ZE(i,e,t,n){i.removeEventListener(e,t,n)}const tv=Symbol("_vei");function JE(i,e,t,n,s=null){const r=i[tv]||(i[tv]={}),a=r[e];if(n&&a)a.value=n;else{const[o,l]=QE(e);if(n){const c=r[e]=n1(n,s);Oo(i,o,c,l)}else a&&(ZE(i,o,a,l),r[e]=void 0)}}const nv=/(?:Once|Passive|Capture)$/;function QE(i){let e;if(nv.test(i)){e={};let n;for(;n=i.match(nv);)i=i.slice(0,i.length-n[0].length),e[n[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):ha(i.slice(2)),e]}let yh=0;const e1=Promise.resolve(),t1=()=>yh||(e1.then(()=>yh=0),yh=Date.now());function n1(i,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;Is(i1(n,t.value),e,5,[n])};return t.value=i,t.attached=t1(),t}function i1(i,e){if(Rt(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const iv=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,s1=(i,e,t,n,s,r)=>{const a=s==="svg";e==="class"?$E(i,n,a):e==="style"?jE(i,t,n):Rd(e)?nm(e)||JE(i,e,t,n,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):r1(i,e,n,a))?(ev(i,e,n),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Q_(i,e,n,a,r,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!Ln(n))?ev(i,ps(e),n,r,e):(e==="true-value"?i._trueValue=n:e==="false-value"&&(i._falseValue=n),Q_(i,e,n,a))};function r1(i,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in i&&iv(e)&&Ot(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=i.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return iv(e)&&Ln(t)?!1:e in i}const sv=i=>{const e=i.props["onUpdate:modelValue"]||!1;return Rt(e)?t=>ku(e,t):e};function a1(i){i.target.composing=!0}function rv(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const xh=Symbol("_assign"),o1={created(i,{modifiers:{lazy:e,trim:t,number:n}},s){i[xh]=sv(s);const r=n||s.props&&s.props.type==="number";Oo(i,e?"change":"input",a=>{if(a.target.composing)return;let o=i.value;t&&(o=o.trim()),r&&(o=Ef(o)),i[xh](o)}),t&&Oo(i,"change",()=>{i.value=i.value.trim()}),e||(Oo(i,"compositionstart",a1),Oo(i,"compositionend",rv),Oo(i,"change",rv))},mounted(i,{value:e}){i.value=e??""},beforeUpdate(i,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:r}},a){if(i[xh]=sv(a),i.composing)return;const o=(r||i.type==="number")&&!/^0\d/.test(i.value)?Ef(i.value):i.value,l=e??"";o!==l&&(document.activeElement===i&&i.type!=="range"&&(n&&e===t||s&&i.value.trim()===l)||(i.value=l))}},l1=["ctrl","shift","alt","meta"],c1={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>l1.some(t=>i[`${t}Key`]&&!e.includes(t))},fc=(i,e)=>{const t=i._withMods||(i._withMods={}),n=e.join(".");return t[n]||(t[n]=(s,...r)=>{for(let a=0;a<e.length;a++){const o=c1[e[a]];if(o&&o(s,e))return}return i(s,...r)})},u1={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ad=(i,e)=>{const t=i._withKeys||(i._withKeys={}),n=e.join(".");return t[n]||(t[n]=s=>{if(!("key"in s))return;const r=ha(s.key);if(e.some(a=>a===r||u1[a]===r))return i(s)})},d1=Qn({patchProp:s1},FE);let av;function h1(){return av||(av=aE(d1))}const f1=(...i)=>{const e=h1().createApp(...i),{mount:t}=e;return e.mount=n=>{const s=m1(n);if(!s)return;const r=e._component;!Ot(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const a=t(s,!1,p1(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),a},e};function p1(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function m1(i){return Ln(i)?document.querySelector(i):i}/*!
  * shared v9.14.5
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */function _1(i,e){typeof console<"u"&&(console.warn("[intlify] "+i),e&&console.warn(e.stack))}const od=typeof window<"u",fa=(i,e=!1)=>e?Symbol.for(i):Symbol(i),v1=(i,e,t)=>g1({l:i,k:e,s:t}),g1=i=>JSON.stringify(i).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),kn=i=>typeof i=="number"&&isFinite(i),y1=i=>tx(i)==="[object Date]",ra=i=>tx(i)==="[object RegExp]",Gd=i=>kt(i)&&Object.keys(i).length===0,si=Object.assign,x1=Object.create,un=(i=null)=>x1(i);let ov;const wr=()=>ov||(ov=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:un());function lv(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;").replace(/=/g,"&#x3D;")}function cv(i){return i.replace(/&(?![a-zA-Z0-9#]{2,6};)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function b1(i){return i=i.replace(/(\w+)\s*=\s*"([^"]*)"/g,(n,s,r)=>`${s}="${cv(r)}"`),i=i.replace(/(\w+)\s*=\s*'([^']*)'/g,(n,s,r)=>`${s}='${cv(r)}'`),/\s*on\w+\s*=\s*["']?[^"'>]+["']?/gi.test(i)&&(i=i.replace(/(\s+)(on)(\w+\s*=)/gi,"$1&#111;n$3")),[/(\s+(?:href|src|action|formaction)\s*=\s*["']?)\s*javascript:/gi,/(style\s*=\s*["'][^"']*url\s*\(\s*)javascript:/gi].forEach(n=>{i=i.replace(n,"$1javascript&#58;")}),i}const w1=Object.prototype.hasOwnProperty;function Es(i,e){return w1.call(i,e)}const xn=Array.isArray,mn=i=>typeof i=="function",ut=i=>typeof i=="string",$t=i=>typeof i=="boolean",nn=i=>i!==null&&typeof i=="object",S1=i=>nn(i)&&mn(i.then)&&mn(i.catch),ex=Object.prototype.toString,tx=i=>ex.call(i),kt=i=>{if(!nn(i))return!1;const e=Object.getPrototypeOf(i);return e===null||e.constructor===Object},E1=i=>i==null?"":xn(i)||kt(i)&&i.toString===ex?JSON.stringify(i,null,2):String(i);function M1(i,e=""){return i.reduce((t,n,s)=>s===0?t+n:t+e+n,"")}function Hd(i){let e=i;return()=>++e}const Jc=i=>!nn(i)||xn(i);function Uu(i,e){if(Jc(i)||Jc(e))throw new Error("Invalid value");const t=[{src:i,des:e}];for(;t.length;){const{src:n,des:s}=t.pop();Object.keys(n).forEach(r=>{r!=="__proto__"&&(nn(n[r])&&!nn(s[r])&&(s[r]=Array.isArray(n[r])?[]:un()),Jc(s[r])||Jc(n[r])?s[r]=n[r]:t.push({src:n[r],des:s[r]}))})}}/*!
  * message-compiler v9.14.5
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */function T1(i,e,t){return{line:i,column:e,offset:t}}function ld(i,e,t){return{start:i,end:e}}const A1=/\{([0-9a-zA-Z]+)\}/g;function nx(i,...e){return e.length===1&&C1(e[0])&&(e=e[0]),(!e||!e.hasOwnProperty)&&(e={}),i.replace(A1,(t,n)=>e.hasOwnProperty(n)?e[n]:"")}const ix=Object.assign,uv=i=>typeof i=="string",C1=i=>i!==null&&typeof i=="object";function sx(i,e=""){return i.reduce((t,n,s)=>s===0?t+n:t+e+n,"")}const ym={USE_MODULO_SYNTAX:1,__EXTEND_POINT__:2},P1={[ym.USE_MODULO_SYNTAX]:"Use modulo before '{{0}}'."};function R1(i,e,...t){const n=nx(P1[i],...t||[]),s={message:String(n),code:i};return e&&(s.location=e),s}const Pt={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14,UNHANDLED_CODEGEN_NODE_TYPE:15,UNHANDLED_MINIFIER_NODE_TYPE:16,__EXTEND_POINT__:17},L1={[Pt.EXPECTED_TOKEN]:"Expected token: '{0}'",[Pt.INVALID_TOKEN_IN_PLACEHOLDER]:"Invalid token in placeholder: '{0}'",[Pt.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER]:"Unterminated single quote in placeholder",[Pt.UNKNOWN_ESCAPE_SEQUENCE]:"Unknown escape sequence: \\{0}",[Pt.INVALID_UNICODE_ESCAPE_SEQUENCE]:"Invalid unicode escape sequence: {0}",[Pt.UNBALANCED_CLOSING_BRACE]:"Unbalanced closing brace",[Pt.UNTERMINATED_CLOSING_BRACE]:"Unterminated closing brace",[Pt.EMPTY_PLACEHOLDER]:"Empty placeholder",[Pt.NOT_ALLOW_NEST_PLACEHOLDER]:"Not allowed nest placeholder",[Pt.INVALID_LINKED_FORMAT]:"Invalid linked format",[Pt.MUST_HAVE_MESSAGES_IN_PLURAL]:"Plural must have messages",[Pt.UNEXPECTED_EMPTY_LINKED_MODIFIER]:"Unexpected empty linked modifier",[Pt.UNEXPECTED_EMPTY_LINKED_KEY]:"Unexpected empty linked key",[Pt.UNEXPECTED_LEXICAL_ANALYSIS]:"Unexpected lexical analysis in token: '{0}'",[Pt.UNHANDLED_CODEGEN_NODE_TYPE]:"unhandled codegen node type: '{0}'",[Pt.UNHANDLED_MINIFIER_NODE_TYPE]:"unhandled mimifier node type: '{0}'"};function gl(i,e,t={}){const{domain:n,messages:s,args:r}=t,a=nx((s||L1)[i]||"",...r||[]),o=new SyntaxError(String(a));return o.code=i,e&&(o.location=e),o.domain=n,o}function I1(i){throw i}const ir=" ",D1="\r",gi=`
`,k1="\u2028",B1="\u2029";function O1(i){const e=i;let t=0,n=1,s=1,r=0;const a=T=>e[T]===D1&&e[T+1]===gi,o=T=>e[T]===gi,l=T=>e[T]===B1,c=T=>e[T]===k1,u=T=>a(T)||o(T)||l(T)||c(T),d=()=>t,h=()=>n,f=()=>s,p=()=>r,m=T=>a(T)||l(T)||c(T)?gi:e[T],_=()=>m(t),v=()=>m(t+r);function x(){return r=0,u(t)&&(n++,s=0),a(t)&&t++,t++,s++,e[t]}function y(){return a(t+r)&&r++,r++,e[t+r]}function g(){t=0,n=1,s=1,r=0}function w(T=0){r=T}function b(){const T=t+r;for(;T!==t;)x();r=0}return{index:d,line:h,column:f,peekOffset:p,charAt:m,currentChar:_,currentPeek:v,next:x,peek:y,reset:g,resetPeek:w,skipToPeek:b}}const Or=void 0,N1=".",dv="'",F1="tokenizer";function U1(i,e={}){const t=e.location!==!1,n=O1(i),s=()=>n.index(),r=()=>T1(n.line(),n.column(),n.index()),a=r(),o=s(),l={currentType:14,offset:o,startLoc:a,endLoc:a,lastType:14,lastOffset:o,lastStartLoc:a,lastEndLoc:a,braceNest:0,inLinked:!1,text:""},c=()=>l,{onError:u}=e;function d(k,V,de,...D){const L=c();if(V.column+=de,V.offset+=de,u){const J=t?ld(L.startLoc,V):null,K=gl(k,J,{domain:F1,args:D});u(K)}}function h(k,V,de){k.endLoc=r(),k.currentType=V;const D={type:V};return t&&(D.loc=ld(k.startLoc,k.endLoc)),de!=null&&(D.value=de),D}const f=k=>h(k,14);function p(k,V){return k.currentChar()===V?(k.next(),V):(d(Pt.EXPECTED_TOKEN,r(),0,V),"")}function m(k){let V="";for(;k.currentPeek()===ir||k.currentPeek()===gi;)V+=k.currentPeek(),k.peek();return V}function _(k){const V=m(k);return k.skipToPeek(),V}function v(k){if(k===Or)return!1;const V=k.charCodeAt(0);return V>=97&&V<=122||V>=65&&V<=90||V===95}function x(k){if(k===Or)return!1;const V=k.charCodeAt(0);return V>=48&&V<=57}function y(k,V){const{currentType:de}=V;if(de!==2)return!1;m(k);const D=v(k.currentPeek());return k.resetPeek(),D}function g(k,V){const{currentType:de}=V;if(de!==2)return!1;m(k);const D=k.currentPeek()==="-"?k.peek():k.currentPeek(),L=x(D);return k.resetPeek(),L}function w(k,V){const{currentType:de}=V;if(de!==2)return!1;m(k);const D=k.currentPeek()===dv;return k.resetPeek(),D}function b(k,V){const{currentType:de}=V;if(de!==8)return!1;m(k);const D=k.currentPeek()===".";return k.resetPeek(),D}function T(k,V){const{currentType:de}=V;if(de!==9)return!1;m(k);const D=v(k.currentPeek());return k.resetPeek(),D}function E(k,V){const{currentType:de}=V;if(!(de===8||de===12))return!1;m(k);const D=k.currentPeek()===":";return k.resetPeek(),D}function S(k,V){const{currentType:de}=V;if(de!==10)return!1;const D=()=>{const J=k.currentPeek();return J==="{"?v(k.peek()):J==="@"||J==="%"||J==="|"||J===":"||J==="."||J===ir||!J?!1:J===gi?(k.peek(),D()):C(k,!1)},L=D();return k.resetPeek(),L}function M(k){m(k);const V=k.currentPeek()==="|";return k.resetPeek(),V}function A(k){const V=m(k),de=k.currentPeek()==="%"&&k.peek()==="{";return k.resetPeek(),{isModulo:de,hasSpace:V.length>0}}function C(k,V=!0){const de=(L=!1,J="",K=!1)=>{const te=k.currentPeek();return te==="{"?J==="%"?!1:L:te==="@"||!te?J==="%"?!0:L:te==="%"?(k.peek(),de(L,"%",!0)):te==="|"?J==="%"||K?!0:!(J===ir||J===gi):te===ir?(k.peek(),de(!0,ir,K)):te===gi?(k.peek(),de(!0,gi,K)):!0},D=de();return V&&k.resetPeek(),D}function I(k,V){const de=k.currentChar();return de===Or?Or:V(de)?(k.next(),de):null}function H(k){const V=k.charCodeAt(0);return V>=97&&V<=122||V>=65&&V<=90||V>=48&&V<=57||V===95||V===36}function W(k){return I(k,H)}function z(k){const V=k.charCodeAt(0);return V>=97&&V<=122||V>=65&&V<=90||V>=48&&V<=57||V===95||V===36||V===45}function q(k){return I(k,z)}function O(k){const V=k.charCodeAt(0);return V>=48&&V<=57}function re(k){return I(k,O)}function le(k){const V=k.charCodeAt(0);return V>=48&&V<=57||V>=65&&V<=70||V>=97&&V<=102}function Z(k){return I(k,le)}function ne(k){let V="",de="";for(;V=re(k);)de+=V;return de}function j(k){_(k);const V=k.currentChar();return V!=="%"&&d(Pt.EXPECTED_TOKEN,r(),0,V),k.next(),"%"}function ee(k){let V="";for(;;){const de=k.currentChar();if(de==="{"||de==="}"||de==="@"||de==="|"||!de)break;if(de==="%")if(C(k))V+=de,k.next();else break;else if(de===ir||de===gi)if(C(k))V+=de,k.next();else{if(M(k))break;V+=de,k.next()}else V+=de,k.next()}return V}function F(k){_(k);let V="",de="";for(;V=q(k);)de+=V;return k.currentChar()===Or&&d(Pt.UNTERMINATED_CLOSING_BRACE,r(),0),de}function X(k){_(k);let V="";return k.currentChar()==="-"?(k.next(),V+=`-${ne(k)}`):V+=ne(k),k.currentChar()===Or&&d(Pt.UNTERMINATED_CLOSING_BRACE,r(),0),V}function Q(k){return k!==dv&&k!==gi}function ue(k){_(k),p(k,"'");let V="",de="";for(;V=I(k,Q);)V==="\\"?de+=ce(k):de+=V;const D=k.currentChar();return D===gi||D===Or?(d(Pt.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,r(),0),D===gi&&(k.next(),p(k,"'")),de):(p(k,"'"),de)}function ce(k){const V=k.currentChar();switch(V){case"\\":case"'":return k.next(),`\\${V}`;case"u":return xe(k,V,4);case"U":return xe(k,V,6);default:return d(Pt.UNKNOWN_ESCAPE_SEQUENCE,r(),0,V),""}}function xe(k,V,de){p(k,V);let D="";for(let L=0;L<de;L++){const J=Z(k);if(!J){d(Pt.INVALID_UNICODE_ESCAPE_SEQUENCE,r(),0,`\\${V}${D}${k.currentChar()}`);break}D+=J}return`\\${V}${D}`}function Me(k){return k!=="{"&&k!=="}"&&k!==ir&&k!==gi}function Y(k){_(k);let V="",de="";for(;V=I(k,Me);)de+=V;return de}function P(k){let V="",de="";for(;V=W(k);)de+=V;return de}function R(k){const V=de=>{const D=k.currentChar();return D==="{"||D==="%"||D==="@"||D==="|"||D==="("||D===")"||!D||D===ir?de:(de+=D,k.next(),V(de))};return V("")}function N(k){_(k);const V=p(k,"|");return _(k),V}function $(k,V){let de=null;switch(k.currentChar()){case"{":return V.braceNest>=1&&d(Pt.NOT_ALLOW_NEST_PLACEHOLDER,r(),0),k.next(),de=h(V,2,"{"),_(k),V.braceNest++,de;case"}":return V.braceNest>0&&V.currentType===2&&d(Pt.EMPTY_PLACEHOLDER,r(),0),k.next(),de=h(V,3,"}"),V.braceNest--,V.braceNest>0&&_(k),V.inLinked&&V.braceNest===0&&(V.inLinked=!1),de;case"@":return V.braceNest>0&&d(Pt.UNTERMINATED_CLOSING_BRACE,r(),0),de=ie(k,V)||f(V),V.braceNest=0,de;default:{let L=!0,J=!0,K=!0;if(M(k))return V.braceNest>0&&d(Pt.UNTERMINATED_CLOSING_BRACE,r(),0),de=h(V,1,N(k)),V.braceNest=0,V.inLinked=!1,de;if(V.braceNest>0&&(V.currentType===5||V.currentType===6||V.currentType===7))return d(Pt.UNTERMINATED_CLOSING_BRACE,r(),0),V.braceNest=0,ye(k,V);if(L=y(k,V))return de=h(V,5,F(k)),_(k),de;if(J=g(k,V))return de=h(V,6,X(k)),_(k),de;if(K=w(k,V))return de=h(V,7,ue(k)),_(k),de;if(!L&&!J&&!K)return de=h(V,13,Y(k)),d(Pt.INVALID_TOKEN_IN_PLACEHOLDER,r(),0,de.value),_(k),de;break}}return de}function ie(k,V){const{currentType:de}=V;let D=null;const L=k.currentChar();switch((de===8||de===9||de===12||de===10)&&(L===gi||L===ir)&&d(Pt.INVALID_LINKED_FORMAT,r(),0),L){case"@":return k.next(),D=h(V,8,"@"),V.inLinked=!0,D;case".":return _(k),k.next(),h(V,9,".");case":":return _(k),k.next(),h(V,10,":");default:return M(k)?(D=h(V,1,N(k)),V.braceNest=0,V.inLinked=!1,D):b(k,V)||E(k,V)?(_(k),ie(k,V)):T(k,V)?(_(k),h(V,12,P(k))):S(k,V)?(_(k),L==="{"?$(k,V)||D:h(V,11,R(k))):(de===8&&d(Pt.INVALID_LINKED_FORMAT,r(),0),V.braceNest=0,V.inLinked=!1,ye(k,V))}}function ye(k,V){let de={type:14};if(V.braceNest>0)return $(k,V)||f(V);if(V.inLinked)return ie(k,V)||f(V);switch(k.currentChar()){case"{":return $(k,V)||f(V);case"}":return d(Pt.UNBALANCED_CLOSING_BRACE,r(),0),k.next(),h(V,3,"}");case"@":return ie(k,V)||f(V);default:{if(M(k))return de=h(V,1,N(k)),V.braceNest=0,V.inLinked=!1,de;const{isModulo:L,hasSpace:J}=A(k);if(L)return J?h(V,0,ee(k)):h(V,4,j(k));if(C(k))return h(V,0,ee(k));break}}return de}function ve(){const{currentType:k,offset:V,startLoc:de,endLoc:D}=l;return l.lastType=k,l.lastOffset=V,l.lastStartLoc=de,l.lastEndLoc=D,l.offset=s(),l.startLoc=r(),n.currentChar()===Or?h(l,14):ye(n,l)}return{nextToken:ve,currentOffset:s,currentPosition:r,context:c}}const z1="parser",V1=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function G1(i,e,t){switch(i){case"\\\\":return"\\";case"\\'":return"'";default:{const n=parseInt(e||t,16);return n<=55295||n>=57344?String.fromCodePoint(n):""}}}function H1(i={}){const e=i.location!==!1,{onError:t,onWarn:n}=i;function s(y,g,w,b,...T){const E=y.currentPosition();if(E.offset+=b,E.column+=b,t){const S=e?ld(w,E):null,M=gl(g,S,{domain:z1,args:T});t(M)}}function r(y,g,w,b,...T){const E=y.currentPosition();if(E.offset+=b,E.column+=b,n){const S=e?ld(w,E):null;n(R1(g,S,T))}}function a(y,g,w){const b={type:y};return e&&(b.start=g,b.end=g,b.loc={start:w,end:w}),b}function o(y,g,w,b){e&&(y.end=g,y.loc&&(y.loc.end=w))}function l(y,g){const w=y.context(),b=a(3,w.offset,w.startLoc);return b.value=g,o(b,y.currentOffset(),y.currentPosition()),b}function c(y,g){const w=y.context(),{lastOffset:b,lastStartLoc:T}=w,E=a(5,b,T);return E.index=parseInt(g,10),y.nextToken(),o(E,y.currentOffset(),y.currentPosition()),E}function u(y,g,w){const b=y.context(),{lastOffset:T,lastStartLoc:E}=b,S=a(4,T,E);return S.key=g,w===!0&&(S.modulo=!0),y.nextToken(),o(S,y.currentOffset(),y.currentPosition()),S}function d(y,g){const w=y.context(),{lastOffset:b,lastStartLoc:T}=w,E=a(9,b,T);return E.value=g.replace(V1,G1),y.nextToken(),o(E,y.currentOffset(),y.currentPosition()),E}function h(y){const g=y.nextToken(),w=y.context(),{lastOffset:b,lastStartLoc:T}=w,E=a(8,b,T);return g.type!==12?(s(y,Pt.UNEXPECTED_EMPTY_LINKED_MODIFIER,w.lastStartLoc,0),E.value="",o(E,b,T),{nextConsumeToken:g,node:E}):(g.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,w.lastStartLoc,0,ms(g)),E.value=g.value||"",o(E,y.currentOffset(),y.currentPosition()),{node:E})}function f(y,g){const w=y.context(),b=a(7,w.offset,w.startLoc);return b.value=g,o(b,y.currentOffset(),y.currentPosition()),b}function p(y){const g=y.context(),w=a(6,g.offset,g.startLoc);let b=y.nextToken();if(b.type===9){const T=h(y);w.modifier=T.node,b=T.nextConsumeToken||y.nextToken()}switch(b.type!==10&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(b)),b=y.nextToken(),b.type===2&&(b=y.nextToken()),b.type){case 11:b.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(b)),w.key=f(y,b.value||"");break;case 5:b.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(b)),w.key=u(y,b.value||"");break;case 6:b.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(b)),w.key=c(y,b.value||"");break;case 7:b.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(b)),w.key=d(y,b.value||"");break;default:{s(y,Pt.UNEXPECTED_EMPTY_LINKED_KEY,g.lastStartLoc,0);const T=y.context(),E=a(7,T.offset,T.startLoc);return E.value="",o(E,T.offset,T.startLoc),w.key=E,o(w,T.offset,T.startLoc),{nextConsumeToken:b,node:w}}}return o(w,y.currentOffset(),y.currentPosition()),{node:w}}function m(y){const g=y.context(),w=g.currentType===1?y.currentOffset():g.offset,b=g.currentType===1?g.endLoc:g.startLoc,T=a(2,w,b);T.items=[];let E=null,S=null;do{const C=E||y.nextToken();switch(E=null,C.type){case 0:C.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(C)),T.items.push(l(y,C.value||""));break;case 6:C.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(C)),T.items.push(c(y,C.value||""));break;case 4:S=!0;break;case 5:C.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(C)),T.items.push(u(y,C.value||"",!!S)),S&&(r(y,ym.USE_MODULO_SYNTAX,g.lastStartLoc,0,ms(C)),S=null);break;case 7:C.value==null&&s(y,Pt.UNEXPECTED_LEXICAL_ANALYSIS,g.lastStartLoc,0,ms(C)),T.items.push(d(y,C.value||""));break;case 8:{const I=p(y);T.items.push(I.node),E=I.nextConsumeToken||null;break}}}while(g.currentType!==14&&g.currentType!==1);const M=g.currentType===1?g.lastOffset:y.currentOffset(),A=g.currentType===1?g.lastEndLoc:y.currentPosition();return o(T,M,A),T}function _(y,g,w,b){const T=y.context();let E=b.items.length===0;const S=a(1,g,w);S.cases=[],S.cases.push(b);do{const M=m(y);E||(E=M.items.length===0),S.cases.push(M)}while(T.currentType!==14);return E&&s(y,Pt.MUST_HAVE_MESSAGES_IN_PLURAL,w,0),o(S,y.currentOffset(),y.currentPosition()),S}function v(y){const g=y.context(),{offset:w,startLoc:b}=g,T=m(y);return g.currentType===14?T:_(y,w,b,T)}function x(y){const g=U1(y,ix({},i)),w=g.context(),b=a(0,w.offset,w.startLoc);return e&&b.loc&&(b.loc.source=y),b.body=v(g),i.onCacheKey&&(b.cacheKey=i.onCacheKey(y)),w.currentType!==14&&s(g,Pt.UNEXPECTED_LEXICAL_ANALYSIS,w.lastStartLoc,0,y[w.offset]||""),o(b,g.currentOffset(),g.currentPosition()),b}return{parse:x}}function ms(i){if(i.type===14)return"EOF";const e=(i.value||"").replace(/\r?\n/gu,"\\n");return e.length>10?e.slice(0,9)+"":e}function W1(i,e={}){const t={ast:i,helpers:new Set};return{context:()=>t,helper:r=>(t.helpers.add(r),r)}}function hv(i,e){for(let t=0;t<i.length;t++)xm(i[t],e)}function xm(i,e){switch(i.type){case 1:hv(i.cases,e),e.helper("plural");break;case 2:hv(i.items,e);break;case 6:{xm(i.key,e),e.helper("linked"),e.helper("type");break}case 5:e.helper("interpolate"),e.helper("list");break;case 4:e.helper("interpolate"),e.helper("named");break}}function $1(i,e={}){const t=W1(i);t.helper("normalize"),i.body&&xm(i.body,t);const n=t.context();i.helpers=Array.from(n.helpers)}function X1(i){const e=i.body;return e.type===2?fv(e):e.cases.forEach(t=>fv(t)),i}function fv(i){if(i.items.length===1){const e=i.items[0];(e.type===3||e.type===9)&&(i.static=e.value,delete e.value)}else{const e=[];for(let t=0;t<i.items.length;t++){const n=i.items[t];if(!(n.type===3||n.type===9)||n.value==null)break;e.push(n.value)}if(e.length===i.items.length){i.static=sx(e);for(let t=0;t<i.items.length;t++){const n=i.items[t];(n.type===3||n.type===9)&&delete n.value}}}}const q1="minifier";function No(i){switch(i.t=i.type,i.type){case 0:{const e=i;No(e.body),e.b=e.body,delete e.body;break}case 1:{const e=i,t=e.cases;for(let n=0;n<t.length;n++)No(t[n]);e.c=t,delete e.cases;break}case 2:{const e=i,t=e.items;for(let n=0;n<t.length;n++)No(t[n]);e.i=t,delete e.items,e.static&&(e.s=e.static,delete e.static);break}case 3:case 9:case 8:case 7:{const e=i;e.value&&(e.v=e.value,delete e.value);break}case 6:{const e=i;No(e.key),e.k=e.key,delete e.key,e.modifier&&(No(e.modifier),e.m=e.modifier,delete e.modifier);break}case 5:{const e=i;e.i=e.index,delete e.index;break}case 4:{const e=i;e.k=e.key,delete e.key;break}default:throw gl(Pt.UNHANDLED_MINIFIER_NODE_TYPE,null,{domain:q1,args:[i.type]})}delete i.type}const Y1="parser";function j1(i,e){const{filename:t,breakLineCode:n,needIndent:s}=e,r=e.location!==!1,a={filename:t,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:n,needIndent:s,indentLevel:0};r&&i.loc&&(a.source=i.loc.source);const o=()=>a;function l(m,_){a.code+=m}function c(m,_=!0){const v=_?n:"";l(s?v+"  ".repeat(m):v)}function u(m=!0){const _=++a.indentLevel;m&&c(_)}function d(m=!0){const _=--a.indentLevel;m&&c(_)}function h(){c(a.indentLevel)}return{context:o,push:l,indent:u,deindent:d,newline:h,helper:m=>`_${m}`,needIndent:()=>a.needIndent}}function K1(i,e){const{helper:t}=i;i.push(`${t("linked")}(`),il(i,e.key),e.modifier?(i.push(", "),il(i,e.modifier),i.push(", _type")):i.push(", undefined, _type"),i.push(")")}function Z1(i,e){const{helper:t,needIndent:n}=i;i.push(`${t("normalize")}([`),i.indent(n());const s=e.items.length;for(let r=0;r<s&&(il(i,e.items[r]),r!==s-1);r++)i.push(", ");i.deindent(n()),i.push("])")}function J1(i,e){const{helper:t,needIndent:n}=i;if(e.cases.length>1){i.push(`${t("plural")}([`),i.indent(n());const s=e.cases.length;for(let r=0;r<s&&(il(i,e.cases[r]),r!==s-1);r++)i.push(", ");i.deindent(n()),i.push("])")}}function Q1(i,e){e.body?il(i,e.body):i.push("null")}function il(i,e){const{helper:t}=i;switch(e.type){case 0:Q1(i,e);break;case 1:J1(i,e);break;case 2:Z1(i,e);break;case 6:K1(i,e);break;case 8:i.push(JSON.stringify(e.value),e);break;case 7:i.push(JSON.stringify(e.value),e);break;case 5:i.push(`${t("interpolate")}(${t("list")}(${e.index}))`,e);break;case 4:i.push(`${t("interpolate")}(${t("named")}(${JSON.stringify(e.key)}))`,e);break;case 9:i.push(JSON.stringify(e.value),e);break;case 3:i.push(JSON.stringify(e.value),e);break;default:throw gl(Pt.UNHANDLED_CODEGEN_NODE_TYPE,null,{domain:Y1,args:[e.type]})}}const eM=(i,e={})=>{const t=uv(e.mode)?e.mode:"normal",n=uv(e.filename)?e.filename:"message.intl";e.sourceMap;const s=e.breakLineCode!=null?e.breakLineCode:t==="arrow"?";":`
`,r=e.needIndent?e.needIndent:t!=="arrow",a=i.helpers||[],o=j1(i,{filename:n,breakLineCode:s,needIndent:r});o.push(t==="normal"?"function __msg__ (ctx) {":"(ctx) => {"),o.indent(r),a.length>0&&(o.push(`const { ${sx(a.map(u=>`${u}: _${u}`),", ")} } = ctx`),o.newline()),o.push("return "),il(o,i),o.deindent(r),o.push("}"),delete i.helpers;const{code:l,map:c}=o.context();return{ast:i,code:l,map:c?c.toJSON():void 0}};function tM(i,e={}){const t=ix({},e),n=!!t.jit,s=!!t.minify,r=t.optimize==null?!0:t.optimize,o=H1(t).parse(i);return n?(r&&X1(o),s&&No(o),{ast:o,code:""}):($1(o,t),eM(o,t))}/*!
  * core-base v9.14.5
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */function nM(){typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(wr().__INTLIFY_PROD_DEVTOOLS__=!1),typeof __INTLIFY_JIT_COMPILATION__!="boolean"&&(wr().__INTLIFY_JIT_COMPILATION__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(wr().__INTLIFY_DROP_MESSAGE_COMPILER__=!1)}function Ks(i){return nn(i)&&bm(i)===0&&(Es(i,"b")||Es(i,"body"))}const rx=["b","body"];function iM(i){return pa(i,rx)}const ax=["c","cases"];function sM(i){return pa(i,ax,[])}const ox=["s","static"];function rM(i){return pa(i,ox)}const lx=["i","items"];function aM(i){return pa(i,lx,[])}const cx=["t","type"];function bm(i){return pa(i,cx)}const ux=["v","value"];function Qc(i,e){const t=pa(i,ux);if(t!=null)return t;throw pc(e)}const dx=["m","modifier"];function oM(i){return pa(i,dx)}const hx=["k","key"];function lM(i){const e=pa(i,hx);if(e)return e;throw pc(6)}function pa(i,e,t){for(let n=0;n<e.length;n++){const s=e[n];if(Es(i,s)&&i[s]!=null)return i[s]}return t}const fx=[...rx,...ax,...ox,...lx,...hx,...dx,...ux,...cx];function pc(i){return new Error(`unhandled node type: ${i}`)}const ma=[];ma[0]={w:[0],i:[3,0],"[":[4],o:[7]};ma[1]={w:[1],".":[2],"[":[4],o:[7]};ma[2]={w:[2],i:[3,0],0:[3,0]};ma[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]};ma[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]};ma[5]={"'":[4,0],o:8,l:[5,0]};ma[6]={'"':[4,0],o:8,l:[6,0]};const cM=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function uM(i){return cM.test(i)}function dM(i){const e=i.charCodeAt(0),t=i.charCodeAt(i.length-1);return e===t&&(e===34||e===39)?i.slice(1,-1):i}function hM(i){if(i==null)return"o";switch(i.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return i;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function fM(i){const e=i.trim();return i.charAt(0)==="0"&&isNaN(parseInt(i))?!1:uM(e)?dM(e):"*"+e}function pM(i){const e=[];let t=-1,n=0,s=0,r,a,o,l,c,u,d;const h=[];h[0]=()=>{a===void 0?a=o:a+=o},h[1]=()=>{a!==void 0&&(e.push(a),a=void 0)},h[2]=()=>{h[0](),s++},h[3]=()=>{if(s>0)s--,n=4,h[0]();else{if(s=0,a===void 0||(a=fM(a),a===!1))return!1;h[1]()}};function f(){const p=i[t+1];if(n===5&&p==="'"||n===6&&p==='"')return t++,o="\\"+p,h[0](),!0}for(;n!==null;)if(t++,r=i[t],!(r==="\\"&&f())){if(l=hM(r),d=ma[n],c=d[l]||d.l||8,c===8||(n=c[0],c[1]!==void 0&&(u=h[c[1]],u&&(o=r,u()===!1))))return;if(n===7)return e}}const pv=new Map;function mM(i,e){return nn(i)?i[e]:null}function _M(i,e){if(!nn(i))return null;let t=pv.get(e);if(t||(t=pM(e),t&&pv.set(e,t)),!t)return null;const n=t.length;let s=i,r=0;for(;r<n;){const a=t[r];if(fx.includes(a)&&Ks(s))return null;const o=s[a];if(o===void 0||mn(s))return null;s=o,r++}return s}const vM=i=>i,gM=i=>"",yM="text",xM=i=>i.length===0?"":M1(i),bM=E1;function mv(i,e){return i=Math.abs(i),e===2?i?i>1?1:0:1:i?Math.min(i,2):0}function wM(i){const e=kn(i.pluralIndex)?i.pluralIndex:-1;return i.named&&(kn(i.named.count)||kn(i.named.n))?kn(i.named.count)?i.named.count:kn(i.named.n)?i.named.n:e:e}function SM(i,e){e.count||(e.count=i),e.n||(e.n=i)}function EM(i={}){const e=i.locale,t=wM(i),n=nn(i.pluralRules)&&ut(e)&&mn(i.pluralRules[e])?i.pluralRules[e]:mv,s=nn(i.pluralRules)&&ut(e)&&mn(i.pluralRules[e])?mv:void 0,r=v=>v[n(t,v.length,s)],a=i.list||[],o=v=>a[v],l=i.named||un();kn(i.pluralIndex)&&SM(t,l);const c=v=>l[v];function u(v){const x=mn(i.messages)?i.messages(v):nn(i.messages)?i.messages[v]:!1;return x||(i.parent?i.parent.message(v):gM)}const d=v=>i.modifiers?i.modifiers[v]:vM,h=kt(i.processor)&&mn(i.processor.normalize)?i.processor.normalize:xM,f=kt(i.processor)&&mn(i.processor.interpolate)?i.processor.interpolate:bM,p=kt(i.processor)&&ut(i.processor.type)?i.processor.type:yM,_={list:o,named:c,plural:r,linked:(v,...x)=>{const[y,g]=x;let w="text",b="";x.length===1?nn(y)?(b=y.modifier||b,w=y.type||w):ut(y)&&(b=y||b):x.length===2&&(ut(y)&&(b=y||b),ut(g)&&(w=g||w));const T=u(v)(_),E=w==="vnode"&&xn(T)&&b?T[0]:T;return b?d(b)(E,w):E},message:u,type:p,interpolate:f,normalize:h,values:si(un(),a,l)};return _}let mc=null;function MM(i){mc=i}function TM(i,e,t){mc&&mc.emit("i18n:init",{timestamp:Date.now(),i18n:i,version:e,meta:t})}const AM=CM("function:translate");function CM(i){return e=>mc&&mc.emit(i,e)}const PM=ym.__EXTEND_POINT__,Ta=Hd(PM),RM={FALLBACK_TO_TRANSLATE:Ta(),CANNOT_FORMAT_NUMBER:Ta(),FALLBACK_TO_NUMBER_FORMAT:Ta(),CANNOT_FORMAT_DATE:Ta(),FALLBACK_TO_DATE_FORMAT:Ta(),EXPERIMENTAL_CUSTOM_MESSAGE_COMPILER:Ta(),__EXTEND_POINT__:Ta()},px=Pt.__EXTEND_POINT__,Aa=Hd(px),Ms={INVALID_ARGUMENT:px,INVALID_DATE_ARGUMENT:Aa(),INVALID_ISO_DATE_ARGUMENT:Aa(),NOT_SUPPORT_NON_STRING_MESSAGE:Aa(),NOT_SUPPORT_LOCALE_PROMISE_VALUE:Aa(),NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:Aa(),NOT_SUPPORT_LOCALE_TYPE:Aa(),__EXTEND_POINT__:Aa()};function $s(i){return gl(i,null,void 0)}function wm(i,e){return e.locale!=null?_v(e.locale):_v(i.locale)}let bh;function _v(i){if(ut(i))return i;if(mn(i)){if(i.resolvedOnce&&bh!=null)return bh;if(i.constructor.name==="Function"){const e=i();if(S1(e))throw $s(Ms.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return bh=e}else throw $s(Ms.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}else throw $s(Ms.NOT_SUPPORT_LOCALE_TYPE)}function LM(i,e,t){return[...new Set([t,...xn(e)?e:nn(e)?Object.keys(e):ut(e)?[e]:[t]])]}function mx(i,e,t){const n=ut(t)?t:sl,s=i;s.__localeChainCache||(s.__localeChainCache=new Map);let r=s.__localeChainCache.get(n);if(!r){r=[];let a=[t];for(;xn(a);)a=vv(r,a,e);const o=xn(e)||!kt(e)?e:e.default?e.default:null;a=ut(o)?[o]:o,xn(a)&&vv(r,a,!1),s.__localeChainCache.set(n,r)}return r}function vv(i,e,t){let n=!0;for(let s=0;s<e.length&&$t(n);s++){const r=e[s];ut(r)&&(n=IM(i,e[s],t))}return n}function IM(i,e,t){let n;const s=e.split("-");do{const r=s.join("-");n=DM(i,r,t),s.splice(-1,1)}while(s.length&&n===!0);return n}function DM(i,e,t){let n=!1;if(!i.includes(e)&&(n=!0,e)){n=e[e.length-1]!=="!";const s=e.replace(/!/g,"");i.push(s),(xn(t)||kt(t))&&t[s]&&(n=t[s])}return n}const kM="9.14.5",Wd=-1,sl="en-US",gv="",yv=i=>`${i.charAt(0).toLocaleUpperCase()}${i.substr(1)}`;function BM(){return{upper:(i,e)=>e==="text"&&ut(i)?i.toUpperCase():e==="vnode"&&nn(i)&&"__v_isVNode"in i?i.children.toUpperCase():i,lower:(i,e)=>e==="text"&&ut(i)?i.toLowerCase():e==="vnode"&&nn(i)&&"__v_isVNode"in i?i.children.toLowerCase():i,capitalize:(i,e)=>e==="text"&&ut(i)?yv(i):e==="vnode"&&nn(i)&&"__v_isVNode"in i?yv(i.children):i}}let _x;function xv(i){_x=i}let vx;function OM(i){vx=i}let gx;function NM(i){gx=i}let yx=null;const FM=i=>{yx=i},UM=()=>yx;let xx=null;const bv=i=>{xx=i},zM=()=>xx;let wv=0;function VM(i={}){const e=mn(i.onWarn)?i.onWarn:_1,t=ut(i.version)?i.version:kM,n=ut(i.locale)||mn(i.locale)?i.locale:sl,s=mn(n)?sl:n,r=xn(i.fallbackLocale)||kt(i.fallbackLocale)||ut(i.fallbackLocale)||i.fallbackLocale===!1?i.fallbackLocale:s,a=kt(i.messages)?i.messages:wh(s),o=kt(i.datetimeFormats)?i.datetimeFormats:wh(s),l=kt(i.numberFormats)?i.numberFormats:wh(s),c=si(un(),i.modifiers,BM()),u=i.pluralRules||un(),d=mn(i.missing)?i.missing:null,h=$t(i.missingWarn)||ra(i.missingWarn)?i.missingWarn:!0,f=$t(i.fallbackWarn)||ra(i.fallbackWarn)?i.fallbackWarn:!0,p=!!i.fallbackFormat,m=!!i.unresolving,_=mn(i.postTranslation)?i.postTranslation:null,v=kt(i.processor)?i.processor:null,x=$t(i.warnHtmlMessage)?i.warnHtmlMessage:!0,y=!!i.escapeParameter,g=mn(i.messageCompiler)?i.messageCompiler:_x,w=mn(i.messageResolver)?i.messageResolver:vx||mM,b=mn(i.localeFallbacker)?i.localeFallbacker:gx||LM,T=nn(i.fallbackContext)?i.fallbackContext:void 0,E=i,S=nn(E.__datetimeFormatters)?E.__datetimeFormatters:new Map,M=nn(E.__numberFormatters)?E.__numberFormatters:new Map,A=nn(E.__meta)?E.__meta:{};wv++;const C={version:t,cid:wv,locale:n,fallbackLocale:r,messages:a,modifiers:c,pluralRules:u,missing:d,missingWarn:h,fallbackWarn:f,fallbackFormat:p,unresolving:m,postTranslation:_,processor:v,warnHtmlMessage:x,escapeParameter:y,messageCompiler:g,messageResolver:w,localeFallbacker:b,fallbackContext:T,onWarn:e,__meta:A};return C.datetimeFormats=o,C.numberFormats=l,C.__datetimeFormatters=S,C.__numberFormatters=M,__INTLIFY_PROD_DEVTOOLS__&&TM(C,t,A),C}const wh=i=>({[i]:un()});function Sm(i,e,t,n,s){const{missing:r,onWarn:a}=i;if(r!==null){const o=r(i,t,e,s);return ut(o)?o:e}else return e}function Cl(i,e,t){const n=i;n.__localeChainCache=new Map,i.localeFallbacker(i,t,e)}function GM(i,e){return i===e?!1:i.split("-")[0]===e.split("-")[0]}function HM(i,e){const t=e.indexOf(i);if(t===-1)return!1;for(let n=t+1;n<e.length;n++)if(GM(i,e[n]))return!0;return!1}function Sh(i){return t=>WM(t,i)}function WM(i,e){const t=iM(e);if(t==null)throw pc(0);if(bm(t)===1){const r=sM(t);return i.plural(r.reduce((a,o)=>[...a,Sv(i,o)],[]))}else return Sv(i,t)}function Sv(i,e){const t=rM(e);if(t!=null)return i.type==="text"?t:i.normalize([t]);{const n=aM(e).reduce((s,r)=>[...s,Uf(i,r)],[]);return i.normalize(n)}}function Uf(i,e){const t=bm(e);switch(t){case 3:return Qc(e,t);case 9:return Qc(e,t);case 4:{const n=e;if(Es(n,"k")&&n.k)return i.interpolate(i.named(n.k));if(Es(n,"key")&&n.key)return i.interpolate(i.named(n.key));throw pc(t)}case 5:{const n=e;if(Es(n,"i")&&kn(n.i))return i.interpolate(i.list(n.i));if(Es(n,"index")&&kn(n.index))return i.interpolate(i.list(n.index));throw pc(t)}case 6:{const n=e,s=oM(n),r=lM(n);return i.linked(Uf(i,r),s?Uf(i,s):void 0,i.type)}case 7:return Qc(e,t);case 8:return Qc(e,t);default:throw new Error(`unhandled node on format message part: ${t}`)}}const bx=i=>i;let Fo=un();function wx(i,e={}){let t=!1;const n=e.onError||I1;return e.onError=s=>{t=!0,n(s)},{...tM(i,e),detectError:t}}const $M=(i,e)=>{if(!ut(i))throw $s(Ms.NOT_SUPPORT_NON_STRING_MESSAGE);{$t(e.warnHtmlMessage)&&e.warnHtmlMessage;const n=(e.onCacheKey||bx)(i),s=Fo[n];if(s)return s;const{code:r,detectError:a}=wx(i,e),o=new Function(`return ${r}`)();return a?o:Fo[n]=o}};function XM(i,e){if(__INTLIFY_JIT_COMPILATION__&&!__INTLIFY_DROP_MESSAGE_COMPILER__&&ut(i)){$t(e.warnHtmlMessage)&&e.warnHtmlMessage;const n=(e.onCacheKey||bx)(i),s=Fo[n];if(s)return s;const{ast:r,detectError:a}=wx(i,{...e,location:!1,jit:!0}),o=Sh(r);return a?o:Fo[n]=o}else{const t=i.cacheKey;if(t){const n=Fo[t];return n||(Fo[t]=Sh(i))}else return Sh(i)}}const Ev=()=>"",cs=i=>mn(i);function Mv(i,...e){const{fallbackFormat:t,postTranslation:n,unresolving:s,messageCompiler:r,fallbackLocale:a,messages:o}=i,[l,c]=zf(...e),u=$t(c.missingWarn)?c.missingWarn:i.missingWarn,d=$t(c.fallbackWarn)?c.fallbackWarn:i.fallbackWarn,h=$t(c.escapeParameter)?c.escapeParameter:i.escapeParameter,f=!!c.resolvedMessage,p=ut(c.default)||$t(c.default)?$t(c.default)?r?l:()=>l:c.default:t?r?l:()=>l:"",m=t||p!=="",_=wm(i,c);h&&qM(c);let[v,x,y]=f?[l,_,o[_]||un()]:Sx(i,l,_,a,d,u),g=v,w=l;if(!f&&!(ut(g)||Ks(g)||cs(g))&&m&&(g=p,w=g),!f&&(!(ut(g)||Ks(g)||cs(g))||!ut(x)))return s?Wd:l;let b=!1;const T=()=>{b=!0},E=cs(g)?g:Ex(i,l,x,g,w,T);if(b)return g;const S=KM(i,x,y,c),M=EM(S),A=YM(i,E,M);let C=n?n(A,l):A;if(h&&ut(C)&&(C=b1(C)),__INTLIFY_PROD_DEVTOOLS__){const I={timestamp:Date.now(),key:ut(l)?l:cs(g)?g.key:"",locale:x||(cs(g)?g.locale:""),format:ut(g)?g:cs(g)?g.source:"",message:C};I.meta=si({},i.__meta,UM()||{}),AM(I)}return C}function qM(i){xn(i.list)?i.list=i.list.map(e=>ut(e)?lv(e):e):nn(i.named)&&Object.keys(i.named).forEach(e=>{ut(i.named[e])&&(i.named[e]=lv(i.named[e]))})}function Sx(i,e,t,n,s,r){const{messages:a,onWarn:o,messageResolver:l,localeFallbacker:c}=i,u=c(i,n,t);let d=un(),h,f=null;const p="translate";for(let m=0;m<u.length&&(h=u[m],d=a[h]||un(),(f=l(d,e))===null&&(f=d[e]),!(ut(f)||Ks(f)||cs(f)));m++)if(!HM(h,u)){const _=Sm(i,e,h,r,p);_!==e&&(f=_)}return[f,h,d]}function Ex(i,e,t,n,s,r){const{messageCompiler:a,warnHtmlMessage:o}=i;if(cs(n)){const c=n;return c.locale=c.locale||t,c.key=c.key||e,c}if(a==null){const c=()=>n;return c.locale=t,c.key=e,c}const l=a(n,jM(i,t,s,n,o,r));return l.locale=t,l.key=e,l.source=n,l}function YM(i,e,t){return e(t)}function zf(...i){const[e,t,n]=i,s=un();if(!ut(e)&&!kn(e)&&!cs(e)&&!Ks(e))throw $s(Ms.INVALID_ARGUMENT);const r=kn(e)?String(e):(cs(e),e);return kn(t)?s.plural=t:ut(t)?s.default=t:kt(t)&&!Gd(t)?s.named=t:xn(t)&&(s.list=t),kn(n)?s.plural=n:ut(n)?s.default=n:kt(n)&&si(s,n),[r,s]}function jM(i,e,t,n,s,r){return{locale:e,key:t,warnHtmlMessage:s,onError:a=>{throw r&&r(a),a},onCacheKey:a=>v1(e,t,a)}}function KM(i,e,t,n){const{modifiers:s,pluralRules:r,messageResolver:a,fallbackLocale:o,fallbackWarn:l,missingWarn:c,fallbackContext:u}=i,h={locale:e,modifiers:s,pluralRules:r,messages:f=>{let p=a(t,f);if(p==null&&u){const[,,m]=Sx(u,f,e,o,l,c);p=a(m,f)}if(ut(p)||Ks(p)){let m=!1;const v=Ex(i,f,e,p,f,()=>{m=!0});return m?Ev:v}else return cs(p)?p:Ev}};return i.processor&&(h.processor=i.processor),n.list&&(h.list=n.list),n.named&&(h.named=n.named),kn(n.plural)&&(h.pluralIndex=n.plural),h}function Tv(i,...e){const{datetimeFormats:t,unresolving:n,fallbackLocale:s,onWarn:r,localeFallbacker:a}=i,{__datetimeFormatters:o}=i,[l,c,u,d]=Vf(...e),h=$t(u.missingWarn)?u.missingWarn:i.missingWarn;$t(u.fallbackWarn)?u.fallbackWarn:i.fallbackWarn;const f=!!u.part,p=wm(i,u),m=a(i,s,p);if(!ut(l)||l==="")return new Intl.DateTimeFormat(p,d).format(c);let _={},v,x=null;const y="datetime format";for(let b=0;b<m.length&&(v=m[b],_=t[v]||{},x=_[l],!kt(x));b++)Sm(i,l,v,h,y);if(!kt(x)||!ut(v))return n?Wd:l;let g=`${v}__${l}`;Gd(d)||(g=`${g}__${JSON.stringify(d)}`);let w=o.get(g);return w||(w=new Intl.DateTimeFormat(v,si({},x,d)),o.set(g,w)),f?w.formatToParts(c):w.format(c)}const Mx=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function Vf(...i){const[e,t,n,s]=i,r=un();let a=un(),o;if(ut(e)){const l=e.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!l)throw $s(Ms.INVALID_ISO_DATE_ARGUMENT);const c=l[3]?l[3].trim().startsWith("T")?`${l[1].trim()}${l[3].trim()}`:`${l[1].trim()}T${l[3].trim()}`:l[1].trim();o=new Date(c);try{o.toISOString()}catch{throw $s(Ms.INVALID_ISO_DATE_ARGUMENT)}}else if(y1(e)){if(isNaN(e.getTime()))throw $s(Ms.INVALID_DATE_ARGUMENT);o=e}else if(kn(e))o=e;else throw $s(Ms.INVALID_ARGUMENT);return ut(t)?r.key=t:kt(t)&&Object.keys(t).forEach(l=>{Mx.includes(l)?a[l]=t[l]:r[l]=t[l]}),ut(n)?r.locale=n:kt(n)&&(a=n),kt(s)&&(a=s),[r.key||"",o,r,a]}function Av(i,e,t){const n=i;for(const s in t){const r=`${e}__${s}`;n.__datetimeFormatters.has(r)&&n.__datetimeFormatters.delete(r)}}function Cv(i,...e){const{numberFormats:t,unresolving:n,fallbackLocale:s,onWarn:r,localeFallbacker:a}=i,{__numberFormatters:o}=i,[l,c,u,d]=Gf(...e),h=$t(u.missingWarn)?u.missingWarn:i.missingWarn;$t(u.fallbackWarn)?u.fallbackWarn:i.fallbackWarn;const f=!!u.part,p=wm(i,u),m=a(i,s,p);if(!ut(l)||l==="")return new Intl.NumberFormat(p,d).format(c);let _={},v,x=null;const y="number format";for(let b=0;b<m.length&&(v=m[b],_=t[v]||{},x=_[l],!kt(x));b++)Sm(i,l,v,h,y);if(!kt(x)||!ut(v))return n?Wd:l;let g=`${v}__${l}`;Gd(d)||(g=`${g}__${JSON.stringify(d)}`);let w=o.get(g);return w||(w=new Intl.NumberFormat(v,si({},x,d)),o.set(g,w)),f?w.formatToParts(c):w.format(c)}const Tx=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function Gf(...i){const[e,t,n,s]=i,r=un();let a=un();if(!kn(e))throw $s(Ms.INVALID_ARGUMENT);const o=e;return ut(t)?r.key=t:kt(t)&&Object.keys(t).forEach(l=>{Tx.includes(l)?a[l]=t[l]:r[l]=t[l]}),ut(n)?r.locale=n:kt(n)&&(a=n),kt(s)&&(a=s),[r.key||"",o,r,a]}function Pv(i,e,t){const n=i;for(const s in t){const r=`${e}__${s}`;n.__numberFormatters.has(r)&&n.__numberFormatters.delete(r)}}nM();function ZM(){return Ax().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Ax(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const JM=typeof Proxy=="function",QM="devtools-plugin:setup",eT="plugin:settings:set";let mo,Hf;function tT(){var i;return mo!==void 0||(typeof window<"u"&&window.performance?(mo=!0,Hf=window.performance):typeof globalThis<"u"&&(!((i=globalThis.perf_hooks)===null||i===void 0)&&i.performance)?(mo=!0,Hf=globalThis.perf_hooks.performance):mo=!1),mo}function nT(){return tT()?Hf.now():Date.now()}class iT{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const n={};if(e.settings)for(const a in e.settings){const o=e.settings[a];n[a]=o.defaultValue}const s=`__vue-devtools-plugin-settings__${e.id}`;let r=Object.assign({},n);try{const a=localStorage.getItem(s),o=JSON.parse(a);Object.assign(r,o)}catch{}this.fallbacks={getSettings(){return r},setSettings(a){try{localStorage.setItem(s,JSON.stringify(a))}catch{}r=a},now(){return nT()}},t&&t.on(eT,(a,o)=>{a===this.plugin.id&&this.fallbacks.setSettings(o)}),this.proxiedOn=new Proxy({},{get:(a,o)=>this.target?this.target.on[o]:(...l)=>{this.onQueue.push({method:o,args:l})}}),this.proxiedTarget=new Proxy({},{get:(a,o)=>this.target?this.target[o]:o==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(o)?(...l)=>(this.targetQueue.push({method:o,args:l,resolve:()=>{}}),this.fallbacks[o](...l)):(...l)=>new Promise(c=>{this.targetQueue.push({method:o,args:l,resolve:c})})})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function sT(i,e){const t=i,n=Ax(),s=ZM(),r=JM&&t.enableEarlyProxy;if(s&&(n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!r))s.emit(QM,i,e);else{const a=r?new iT(t,s):null;(n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:t,setupFn:e,proxy:a}),a&&e(a.proxiedTarget)}}/*!
  * vue-i18n v9.14.5
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */const rT="9.14.5";function aT(){typeof __VUE_I18N_FULL_INSTALL__!="boolean"&&(wr().__VUE_I18N_FULL_INSTALL__=!0),typeof __VUE_I18N_LEGACY_API__!="boolean"&&(wr().__VUE_I18N_LEGACY_API__=!0),typeof __INTLIFY_JIT_COMPILATION__!="boolean"&&(wr().__INTLIFY_JIT_COMPILATION__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(wr().__INTLIFY_DROP_MESSAGE_COMPILER__=!1),typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(wr().__INTLIFY_PROD_DEVTOOLS__=!1)}const oT=RM.__EXTEND_POINT__,sr=Hd(oT);sr(),sr(),sr(),sr(),sr(),sr(),sr(),sr(),sr();const Cx=Ms.__EXTEND_POINT__,Ti=Hd(Cx),qn={UNEXPECTED_RETURN_TYPE:Cx,INVALID_ARGUMENT:Ti(),MUST_BE_CALL_SETUP_TOP:Ti(),NOT_INSTALLED:Ti(),NOT_AVAILABLE_IN_LEGACY_MODE:Ti(),REQUIRED_VALUE:Ti(),INVALID_VALUE:Ti(),CANNOT_SETUP_VUE_DEVTOOLS_PLUGIN:Ti(),NOT_INSTALLED_WITH_PROVIDE:Ti(),UNEXPECTED_ERROR:Ti(),NOT_COMPATIBLE_LEGACY_VUE_I18N:Ti(),BRIDGE_SUPPORT_VUE_2_ONLY:Ti(),MUST_DEFINE_I18N_OPTION_IN_ALLOW_COMPOSITION:Ti(),NOT_AVAILABLE_COMPOSITION_IN_LEGACY:Ti(),__EXTEND_POINT__:Ti()};function Jn(i,...e){return gl(i,null,void 0)}const Wf=fa("__translateVNode"),$f=fa("__datetimeParts"),Xf=fa("__numberParts"),Px=fa("__setPluralRules"),Rx=fa("__injectWithOption"),qf=fa("__dispose");function _c(i){if(!nn(i)||Ks(i))return i;for(const e in i)if(Es(i,e))if(!e.includes("."))nn(i[e])&&_c(i[e]);else{const t=e.split("."),n=t.length-1;let s=i,r=!1;for(let a=0;a<n;a++){if(t[a]==="__proto__")throw new Error(`unsafe key: ${t[a]}`);if(t[a]in s||(s[t[a]]=un()),!nn(s[t[a]])){r=!0;break}s=s[t[a]]}if(r||(Ks(s)?fx.includes(t[n])||delete i[e]:(s[t[n]]=i[e],delete i[e])),!Ks(s)){const a=s[t[n]];nn(a)&&_c(a)}}return i}function $d(i,e){const{messages:t,__i18n:n,messageResolver:s,flatJson:r}=e,a=kt(t)?t:xn(n)?un():{[i]:un()};if(xn(n)&&n.forEach(o=>{if("locale"in o&&"resource"in o){const{locale:l,resource:c}=o;l?(a[l]=a[l]||un(),Uu(c,a[l])):Uu(c,a)}else ut(o)&&Uu(JSON.parse(o),a)}),s==null&&r)for(const o in a)Es(a,o)&&_c(a[o]);return a}function Lx(i){return i.type}function Ix(i,e,t){let n=nn(e.messages)?e.messages:un();"__i18nGlobal"in t&&(n=$d(i.locale.value,{messages:n,__i18n:t.__i18nGlobal}));const s=Object.keys(n);s.length&&s.forEach(r=>{i.mergeLocaleMessage(r,n[r])});{if(nn(e.datetimeFormats)){const r=Object.keys(e.datetimeFormats);r.length&&r.forEach(a=>{i.mergeDateTimeFormat(a,e.datetimeFormats[a])})}if(nn(e.numberFormats)){const r=Object.keys(e.numberFormats);r.length&&r.forEach(a=>{i.mergeNumberFormat(a,e.numberFormats[a])})}}}function Rv(i){return we(kc,null,i,0)}const Lv="__INTLIFY_META__",Iv=()=>[],lT=()=>!1;let Dv=0;function kv(i){return(e,t,n,s)=>i(t,n,sa()||void 0,s)}const cT=()=>{const i=sa();let e=null;return i&&(e=Lx(i)[Lv])?{[Lv]:e}:null};function Em(i={},e){const{__root:t,__injectWithOption:n}=i,s=t===void 0,r=i.flatJson,a=od?ze:l0,o=!!i.translateExistCompatible;let l=$t(i.inheritLocale)?i.inheritLocale:!0;const c=a(t&&l?t.locale.value:ut(i.locale)?i.locale:sl),u=a(t&&l?t.fallbackLocale.value:ut(i.fallbackLocale)||xn(i.fallbackLocale)||kt(i.fallbackLocale)||i.fallbackLocale===!1?i.fallbackLocale:c.value),d=a($d(c.value,i)),h=a(kt(i.datetimeFormats)?i.datetimeFormats:{[c.value]:{}}),f=a(kt(i.numberFormats)?i.numberFormats:{[c.value]:{}});let p=t?t.missingWarn:$t(i.missingWarn)||ra(i.missingWarn)?i.missingWarn:!0,m=t?t.fallbackWarn:$t(i.fallbackWarn)||ra(i.fallbackWarn)?i.fallbackWarn:!0,_=t?t.fallbackRoot:$t(i.fallbackRoot)?i.fallbackRoot:!0,v=!!i.fallbackFormat,x=mn(i.missing)?i.missing:null,y=mn(i.missing)?kv(i.missing):null,g=mn(i.postTranslation)?i.postTranslation:null,w=t?t.warnHtmlMessage:$t(i.warnHtmlMessage)?i.warnHtmlMessage:!0,b=!!i.escapeParameter;const T=t?t.modifiers:kt(i.modifiers)?i.modifiers:{};let E=i.pluralRules||t&&t.pluralRules,S;S=(()=>{s&&bv(null);const K={version:rT,locale:c.value,fallbackLocale:u.value,messages:d.value,modifiers:T,pluralRules:E,missing:y===null?void 0:y,missingWarn:p,fallbackWarn:m,fallbackFormat:v,unresolving:!0,postTranslation:g===null?void 0:g,warnHtmlMessage:w,escapeParameter:b,messageResolver:i.messageResolver,messageCompiler:i.messageCompiler,__meta:{framework:"vue"}};K.datetimeFormats=h.value,K.numberFormats=f.value,K.__datetimeFormatters=kt(S)?S.__datetimeFormatters:void 0,K.__numberFormatters=kt(S)?S.__numberFormatters:void 0;const te=VM(K);return s&&bv(te),te})(),Cl(S,c.value,u.value);function A(){return[c.value,u.value,d.value,h.value,f.value]}const C=tt({get:()=>c.value,set:K=>{c.value=K,S.locale=c.value}}),I=tt({get:()=>u.value,set:K=>{u.value=K,S.fallbackLocale=u.value,Cl(S,c.value,K)}}),H=tt(()=>d.value),W=tt(()=>h.value),z=tt(()=>f.value);function q(){return mn(g)?g:null}function O(K){g=K,S.postTranslation=K}function re(){return x}function le(K){K!==null&&(y=kv(K)),x=K,S.missing=y}const Z=(K,te,me,Ie,Pe,Ke)=>{A();let Ye;try{__INTLIFY_PROD_DEVTOOLS__,s||(S.fallbackContext=t?zM():void 0),Ye=K(S)}finally{__INTLIFY_PROD_DEVTOOLS__,s||(S.fallbackContext=void 0)}if(me!=="translate exists"&&kn(Ye)&&Ye===Wd||me==="translate exists"&&!Ye){const[De,Xe]=te();return t&&_?Ie(t):Pe(De)}else{if(Ke(Ye))return Ye;throw Jn(qn.UNEXPECTED_RETURN_TYPE)}};function ne(...K){return Z(te=>Reflect.apply(Mv,null,[te,...K]),()=>zf(...K),"translate",te=>Reflect.apply(te.t,te,[...K]),te=>te,te=>ut(te))}function j(...K){const[te,me,Ie]=K;if(Ie&&!nn(Ie))throw Jn(qn.INVALID_ARGUMENT);return ne(te,me,si({resolvedMessage:!0},Ie||{}))}function ee(...K){return Z(te=>Reflect.apply(Tv,null,[te,...K]),()=>Vf(...K),"datetime format",te=>Reflect.apply(te.d,te,[...K]),()=>gv,te=>ut(te))}function F(...K){return Z(te=>Reflect.apply(Cv,null,[te,...K]),()=>Gf(...K),"number format",te=>Reflect.apply(te.n,te,[...K]),()=>gv,te=>ut(te))}function X(K){return K.map(te=>ut(te)||kn(te)||$t(te)?Rv(String(te)):te)}const ue={normalize:X,interpolate:K=>K,type:"vnode"};function ce(...K){return Z(te=>{let me;const Ie=te;try{Ie.processor=ue,me=Reflect.apply(Mv,null,[Ie,...K])}finally{Ie.processor=null}return me},()=>zf(...K),"translate",te=>te[Wf](...K),te=>[Rv(te)],te=>xn(te))}function xe(...K){return Z(te=>Reflect.apply(Cv,null,[te,...K]),()=>Gf(...K),"number format",te=>te[Xf](...K),Iv,te=>ut(te)||xn(te))}function Me(...K){return Z(te=>Reflect.apply(Tv,null,[te,...K]),()=>Vf(...K),"datetime format",te=>te[$f](...K),Iv,te=>ut(te)||xn(te))}function Y(K){E=K,S.pluralRules=E}function P(K,te){return Z(()=>{if(!K)return!1;const me=ut(te)?te:c.value,Ie=$(me),Pe=S.messageResolver(Ie,K);return o?Pe!=null:Ks(Pe)||cs(Pe)||ut(Pe)},()=>[K],"translate exists",me=>Reflect.apply(me.te,me,[K,te]),lT,me=>$t(me))}function R(K){let te=null;const me=mx(S,u.value,c.value);for(let Ie=0;Ie<me.length;Ie++){const Pe=d.value[me[Ie]]||{},Ke=S.messageResolver(Pe,K);if(Ke!=null){te=Ke;break}}return te}function N(K){const te=R(K);return te??(t?t.tm(K)||{}:{})}function $(K){return d.value[K]||{}}function ie(K,te){if(r){const me={[K]:te};for(const Ie in me)Es(me,Ie)&&_c(me[Ie]);te=me[K]}d.value[K]=te,S.messages=d.value}function ye(K,te){d.value[K]=d.value[K]||{};const me={[K]:te};if(r)for(const Ie in me)Es(me,Ie)&&_c(me[Ie]);te=me[K],Uu(te,d.value[K]),S.messages=d.value}function ve(K){return h.value[K]||{}}function k(K,te){h.value[K]=te,S.datetimeFormats=h.value,Av(S,K,te)}function V(K,te){h.value[K]=si(h.value[K]||{},te),S.datetimeFormats=h.value,Av(S,K,te)}function de(K){return f.value[K]||{}}function D(K,te){f.value[K]=te,S.numberFormats=f.value,Pv(S,K,te)}function L(K,te){f.value[K]=si(f.value[K]||{},te),S.numberFormats=f.value,Pv(S,K,te)}Dv++,t&&od&&(Wn(t.locale,K=>{l&&(c.value=K,S.locale=K,Cl(S,c.value,u.value))}),Wn(t.fallbackLocale,K=>{l&&(u.value=K,S.fallbackLocale=K,Cl(S,c.value,u.value))}));const J={id:Dv,locale:C,fallbackLocale:I,get inheritLocale(){return l},set inheritLocale(K){l=K,K&&t&&(c.value=t.locale.value,u.value=t.fallbackLocale.value,Cl(S,c.value,u.value))},get availableLocales(){return Object.keys(d.value).sort()},messages:H,get modifiers(){return T},get pluralRules(){return E||{}},get isGlobal(){return s},get missingWarn(){return p},set missingWarn(K){p=K,S.missingWarn=p},get fallbackWarn(){return m},set fallbackWarn(K){m=K,S.fallbackWarn=m},get fallbackRoot(){return _},set fallbackRoot(K){_=K},get fallbackFormat(){return v},set fallbackFormat(K){v=K,S.fallbackFormat=v},get warnHtmlMessage(){return w},set warnHtmlMessage(K){w=K,S.warnHtmlMessage=K},get escapeParameter(){return b},set escapeParameter(K){b=K,S.escapeParameter=K},t:ne,getLocaleMessage:$,setLocaleMessage:ie,mergeLocaleMessage:ye,getPostTranslationHandler:q,setPostTranslationHandler:O,getMissingHandler:re,setMissingHandler:le,[Px]:Y};return J.datetimeFormats=W,J.numberFormats=z,J.rt=j,J.te=P,J.tm=N,J.d=ee,J.n=F,J.getDateTimeFormat=ve,J.setDateTimeFormat=k,J.mergeDateTimeFormat=V,J.getNumberFormat=de,J.setNumberFormat=D,J.mergeNumberFormat=L,J[Rx]=n,J[Wf]=ce,J[$f]=Me,J[Xf]=xe,J}function uT(i){const e=ut(i.locale)?i.locale:sl,t=ut(i.fallbackLocale)||xn(i.fallbackLocale)||kt(i.fallbackLocale)||i.fallbackLocale===!1?i.fallbackLocale:e,n=mn(i.missing)?i.missing:void 0,s=$t(i.silentTranslationWarn)||ra(i.silentTranslationWarn)?!i.silentTranslationWarn:!0,r=$t(i.silentFallbackWarn)||ra(i.silentFallbackWarn)?!i.silentFallbackWarn:!0,a=$t(i.fallbackRoot)?i.fallbackRoot:!0,o=!!i.formatFallbackMessages,l=kt(i.modifiers)?i.modifiers:{},c=i.pluralizationRules,u=mn(i.postTranslation)?i.postTranslation:void 0,d=ut(i.warnHtmlInMessage)?i.warnHtmlInMessage!=="off":!0,h=!!i.escapeParameterHtml,f=$t(i.sync)?i.sync:!0;let p=i.messages;if(kt(i.sharedMessages)){const b=i.sharedMessages;p=Object.keys(b).reduce((E,S)=>{const M=E[S]||(E[S]={});return si(M,b[S]),E},p||{})}const{__i18n:m,__root:_,__injectWithOption:v}=i,x=i.datetimeFormats,y=i.numberFormats,g=i.flatJson,w=i.translateExistCompatible;return{locale:e,fallbackLocale:t,messages:p,flatJson:g,datetimeFormats:x,numberFormats:y,missing:n,missingWarn:s,fallbackWarn:r,fallbackRoot:a,fallbackFormat:o,modifiers:l,pluralRules:c,postTranslation:u,warnHtmlMessage:d,escapeParameter:h,messageResolver:i.messageResolver,inheritLocale:f,translateExistCompatible:w,__i18n:m,__root:_,__injectWithOption:v}}function Yf(i={},e){{const t=Em(uT(i)),{__extender:n}=i,s={id:t.id,get locale(){return t.locale.value},set locale(r){t.locale.value=r},get fallbackLocale(){return t.fallbackLocale.value},set fallbackLocale(r){t.fallbackLocale.value=r},get messages(){return t.messages.value},get datetimeFormats(){return t.datetimeFormats.value},get numberFormats(){return t.numberFormats.value},get availableLocales(){return t.availableLocales},get formatter(){return{interpolate(){return[]}}},set formatter(r){},get missing(){return t.getMissingHandler()},set missing(r){t.setMissingHandler(r)},get silentTranslationWarn(){return $t(t.missingWarn)?!t.missingWarn:t.missingWarn},set silentTranslationWarn(r){t.missingWarn=$t(r)?!r:r},get silentFallbackWarn(){return $t(t.fallbackWarn)?!t.fallbackWarn:t.fallbackWarn},set silentFallbackWarn(r){t.fallbackWarn=$t(r)?!r:r},get modifiers(){return t.modifiers},get formatFallbackMessages(){return t.fallbackFormat},set formatFallbackMessages(r){t.fallbackFormat=r},get postTranslation(){return t.getPostTranslationHandler()},set postTranslation(r){t.setPostTranslationHandler(r)},get sync(){return t.inheritLocale},set sync(r){t.inheritLocale=r},get warnHtmlInMessage(){return t.warnHtmlMessage?"warn":"off"},set warnHtmlInMessage(r){t.warnHtmlMessage=r!=="off"},get escapeParameterHtml(){return t.escapeParameter},set escapeParameterHtml(r){t.escapeParameter=r},get preserveDirectiveContent(){return!0},set preserveDirectiveContent(r){},get pluralizationRules(){return t.pluralRules||{}},__composer:t,t(...r){const[a,o,l]=r,c={};let u=null,d=null;if(!ut(a))throw Jn(qn.INVALID_ARGUMENT);const h=a;return ut(o)?c.locale=o:xn(o)?u=o:kt(o)&&(d=o),xn(l)?u=l:kt(l)&&(d=l),Reflect.apply(t.t,t,[h,u||d||{},c])},rt(...r){return Reflect.apply(t.rt,t,[...r])},tc(...r){const[a,o,l]=r,c={plural:1};let u=null,d=null;if(!ut(a))throw Jn(qn.INVALID_ARGUMENT);const h=a;return ut(o)?c.locale=o:kn(o)?c.plural=o:xn(o)?u=o:kt(o)&&(d=o),ut(l)?c.locale=l:xn(l)?u=l:kt(l)&&(d=l),Reflect.apply(t.t,t,[h,u||d||{},c])},te(r,a){return t.te(r,a)},tm(r){return t.tm(r)},getLocaleMessage(r){return t.getLocaleMessage(r)},setLocaleMessage(r,a){t.setLocaleMessage(r,a)},mergeLocaleMessage(r,a){t.mergeLocaleMessage(r,a)},d(...r){return Reflect.apply(t.d,t,[...r])},getDateTimeFormat(r){return t.getDateTimeFormat(r)},setDateTimeFormat(r,a){t.setDateTimeFormat(r,a)},mergeDateTimeFormat(r,a){t.mergeDateTimeFormat(r,a)},n(...r){return Reflect.apply(t.n,t,[...r])},getNumberFormat(r){return t.getNumberFormat(r)},setNumberFormat(r,a){t.setNumberFormat(r,a)},mergeNumberFormat(r,a){t.mergeNumberFormat(r,a)},getChoiceIndex(r,a){return-1}};return s.__extender=n,s}}const Mm={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:i=>i==="parent"||i==="global",default:"parent"},i18n:{type:Object}};function dT({slots:i},e){return e.length===1&&e[0]==="default"?(i.default?i.default():[]).reduce((n,s)=>[...n,...s.type===At?s.children:[s]],[]):e.reduce((t,n)=>{const s=i[n];return s&&(t[n]=s()),t},un())}function Dx(i){return At}const hT=fm({name:"i18n-t",props:si({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:i=>kn(i)||!isNaN(i)}},Mm),setup(i,e){const{slots:t,attrs:n}=e,s=i.i18n||wn({useScope:i.scope,__useComponent:!0});return()=>{const r=Object.keys(t).filter(d=>d!=="_"),a=un();i.locale&&(a.locale=i.locale),i.plural!==void 0&&(a.plural=ut(i.plural)?+i.plural:i.plural);const o=dT(e,r),l=s[Wf](i.keypath,o,a),c=si(un(),n),u=ut(i.tag)||nn(i.tag)?i.tag:Dx();return gm(u,c,l)}}}),Bv=hT;function fT(i){return xn(i)&&!ut(i[0])}function kx(i,e,t,n){const{slots:s,attrs:r}=e;return()=>{const a={part:!0};let o=un();i.locale&&(a.locale=i.locale),ut(i.format)?a.key=i.format:nn(i.format)&&(ut(i.format.key)&&(a.key=i.format.key),o=Object.keys(i.format).reduce((h,f)=>t.includes(f)?si(un(),h,{[f]:i.format[f]}):h,un()));const l=n(i.value,a,o);let c=[a.key];xn(l)?c=l.map((h,f)=>{const p=s[h.type],m=p?p({[h.type]:h.value,index:f,parts:l}):[h.value];return fT(m)&&(m[0].key=`${h.type}-${f}`),m}):ut(l)&&(c=[l]);const u=si(un(),r),d=ut(i.tag)||nn(i.tag)?i.tag:Dx();return gm(d,u,c)}}const pT=fm({name:"i18n-n",props:si({value:{type:Number,required:!0},format:{type:[String,Object]}},Mm),setup(i,e){const t=i.i18n||wn({useScope:i.scope,__useComponent:!0});return kx(i,e,Tx,(...n)=>t[Xf](...n))}}),Ov=pT,mT=fm({name:"i18n-d",props:si({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},Mm),setup(i,e){const t=i.i18n||wn({useScope:i.scope,__useComponent:!0});return kx(i,e,Mx,(...n)=>t[$f](...n))}}),Nv=mT;function _T(i,e){const t=i;if(i.mode==="composition")return t.__getInstance(e)||i.global;{const n=t.__getInstance(e);return n!=null?n.__composer:i.global.__composer}}function vT(i){const e=a=>{const{instance:o,modifiers:l,value:c}=a;if(!o||!o.$)throw Jn(qn.UNEXPECTED_ERROR);const u=_T(i,o.$),d=Fv(c);return[Reflect.apply(u.t,u,[...Uv(d)]),u]};return{created:(a,o)=>{const[l,c]=e(o);od&&i.global===c&&(a.__i18nWatcher=Wn(c.locale,()=>{o.instance&&o.instance.$forceUpdate()})),a.__composer=c,a.textContent=l},unmounted:a=>{od&&a.__i18nWatcher&&(a.__i18nWatcher(),a.__i18nWatcher=void 0,delete a.__i18nWatcher),a.__composer&&(a.__composer=void 0,delete a.__composer)},beforeUpdate:(a,{value:o})=>{if(a.__composer){const l=a.__composer,c=Fv(o);a.textContent=Reflect.apply(l.t,l,[...Uv(c)])}},getSSRProps:a=>{const[o]=e(a);return{textContent:o}}}}function Fv(i){if(ut(i))return{path:i};if(kt(i)){if(!("path"in i))throw Jn(qn.REQUIRED_VALUE,"path");return i}else throw Jn(qn.INVALID_VALUE)}function Uv(i){const{path:e,locale:t,args:n,choice:s,plural:r}=i,a={},o=n||{};return ut(t)&&(a.locale=t),kn(s)&&(a.plural=s),kn(r)&&(a.plural=r),[e,o,a]}function gT(i,e,...t){const n=kt(t[0])?t[0]:{},s=!!n.useI18nComponentName;($t(n.globalInstall)?n.globalInstall:!0)&&([s?"i18n":Bv.name,"I18nT"].forEach(a=>i.component(a,Bv)),[Ov.name,"I18nN"].forEach(a=>i.component(a,Ov)),[Nv.name,"I18nD"].forEach(a=>i.component(a,Nv))),i.directive("t",vT(e))}function yT(i,e,t){return{beforeCreate(){const n=sa();if(!n)throw Jn(qn.UNEXPECTED_ERROR);const s=this.$options;if(s.i18n){const r=s.i18n;if(s.__i18n&&(r.__i18n=s.__i18n),r.__root=e,this===this.$root)this.$i18n=zv(i,r);else{r.__injectWithOption=!0,r.__extender=t.__vueI18nExtend,this.$i18n=Yf(r);const a=this.$i18n;a.__extender&&(a.__disposer=a.__extender(this.$i18n))}}else if(s.__i18n)if(this===this.$root)this.$i18n=zv(i,s);else{this.$i18n=Yf({__i18n:s.__i18n,__injectWithOption:!0,__extender:t.__vueI18nExtend,__root:e});const r=this.$i18n;r.__extender&&(r.__disposer=r.__extender(this.$i18n))}else this.$i18n=i;s.__i18nGlobal&&Ix(e,s,s),this.$t=(...r)=>this.$i18n.t(...r),this.$rt=(...r)=>this.$i18n.rt(...r),this.$tc=(...r)=>this.$i18n.tc(...r),this.$te=(r,a)=>this.$i18n.te(r,a),this.$d=(...r)=>this.$i18n.d(...r),this.$n=(...r)=>this.$i18n.n(...r),this.$tm=r=>this.$i18n.tm(r),t.__setInstance(n,this.$i18n)},mounted(){},unmounted(){const n=sa();if(!n)throw Jn(qn.UNEXPECTED_ERROR);const s=this.$i18n;delete this.$t,delete this.$rt,delete this.$tc,delete this.$te,delete this.$d,delete this.$n,delete this.$tm,s.__disposer&&(s.__disposer(),delete s.__disposer,delete s.__extender),t.__deleteInstance(n),delete this.$i18n}}}function zv(i,e){i.locale=e.locale||i.locale,i.fallbackLocale=e.fallbackLocale||i.fallbackLocale,i.missing=e.missing||i.missing,i.silentTranslationWarn=e.silentTranslationWarn||i.silentFallbackWarn,i.silentFallbackWarn=e.silentFallbackWarn||i.silentFallbackWarn,i.formatFallbackMessages=e.formatFallbackMessages||i.formatFallbackMessages,i.postTranslation=e.postTranslation||i.postTranslation,i.warnHtmlInMessage=e.warnHtmlInMessage||i.warnHtmlInMessage,i.escapeParameterHtml=e.escapeParameterHtml||i.escapeParameterHtml,i.sync=e.sync||i.sync,i.__composer[Px](e.pluralizationRules||i.pluralizationRules);const t=$d(i.locale,{messages:e.messages,__i18n:e.__i18n});return Object.keys(t).forEach(n=>i.mergeLocaleMessage(n,t[n])),e.datetimeFormats&&Object.keys(e.datetimeFormats).forEach(n=>i.mergeDateTimeFormat(n,e.datetimeFormats[n])),e.numberFormats&&Object.keys(e.numberFormats).forEach(n=>i.mergeNumberFormat(n,e.numberFormats[n])),i}const xT=fa("global-vue-i18n");function bT(i={},e){const t=__VUE_I18N_LEGACY_API__&&$t(i.legacy)?i.legacy:__VUE_I18N_LEGACY_API__,n=$t(i.globalInjection)?i.globalInjection:!0,s=__VUE_I18N_LEGACY_API__&&t?!!i.allowComposition:!0,r=new Map,[a,o]=wT(i,t),l=fa("");function c(h){return r.get(h)||null}function u(h,f){r.set(h,f)}function d(h){r.delete(h)}{const h={get mode(){return __VUE_I18N_LEGACY_API__&&t?"legacy":"composition"},get allowComposition(){return s},async install(f,...p){if(f.__VUE_I18N_SYMBOL__=l,f.provide(f.__VUE_I18N_SYMBOL__,h),kt(p[0])){const v=p[0];h.__composerExtend=v.__composerExtend,h.__vueI18nExtend=v.__vueI18nExtend}let m=null;!t&&n&&(m=LT(f,h.global)),__VUE_I18N_FULL_INSTALL__&&gT(f,h,...p),__VUE_I18N_LEGACY_API__&&t&&f.mixin(yT(o,o.__composer,h));const _=f.unmount;f.unmount=()=>{m&&m(),h.dispose(),_()}},get global(){return o},dispose(){a.stop()},__instances:r,__getInstance:c,__setInstance:u,__deleteInstance:d};return h}}function wn(i={}){const e=sa();if(e==null)throw Jn(qn.MUST_BE_CALL_SETUP_TOP);if(!e.isCE&&e.appContext.app!=null&&!e.appContext.app.__VUE_I18N_SYMBOL__)throw Jn(qn.NOT_INSTALLED);const t=ST(e),n=MT(t),s=Lx(e),r=ET(i,s);if(__VUE_I18N_LEGACY_API__&&t.mode==="legacy"&&!i.__useComponent){if(!t.allowComposition)throw Jn(qn.NOT_AVAILABLE_IN_LEGACY_MODE);return PT(e,r,n,i)}if(r==="global")return Ix(n,i,s),n;if(r==="parent"){let l=TT(t,e,i.__useComponent);return l==null&&(l=n),l}const a=t;let o=a.__getInstance(e);if(o==null){const l=si({},i);"__i18n"in s&&(l.__i18n=s.__i18n),n&&(l.__root=n),o=Em(l),a.__composerExtend&&(o[qf]=a.__composerExtend(o)),CT(a,e,o),a.__setInstance(e,o)}return o}function wT(i,e,t){const n=Zw();{const s=__VUE_I18N_LEGACY_API__&&e?n.run(()=>Yf(i)):n.run(()=>Em(i));if(s==null)throw Jn(qn.UNEXPECTED_ERROR);return[n,s]}}function ST(i){{const e=Ko(i.isCE?xT:i.appContext.app.__VUE_I18N_SYMBOL__);if(!e)throw Jn(i.isCE?qn.NOT_INSTALLED_WITH_PROVIDE:qn.UNEXPECTED_ERROR);return e}}function ET(i,e){return Gd(i)?"__i18n"in e?"local":"global":i.useScope?i.useScope:"local"}function MT(i){return i.mode==="composition"?i.global:i.global.__composer}function TT(i,e,t=!1){let n=null;const s=e.root;let r=AT(e,t);for(;r!=null;){const a=i;if(i.mode==="composition")n=a.__getInstance(r);else if(__VUE_I18N_LEGACY_API__){const o=a.__getInstance(r);o!=null&&(n=o.__composer,t&&n&&!n[Rx]&&(n=null))}if(n!=null||s===r)break;r=r.parent}return n}function AT(i,e=!1){return i==null?null:e&&i.vnode.ctx||i.parent}function CT(i,e,t){In(()=>{},e),Ds(()=>{const n=t;i.__deleteInstance(e);const s=n[qf];s&&(s(),delete n[qf])},e)}function PT(i,e,t,n={}){const s=e==="local",r=l0(null);if(s&&i.proxy&&!(i.proxy.$options.i18n||i.proxy.$options.__i18n))throw Jn(qn.MUST_DEFINE_I18N_OPTION_IN_ALLOW_COMPOSITION);const a=$t(n.inheritLocale)?n.inheritLocale:!ut(n.locale),o=ze(!s||a?t.locale.value:ut(n.locale)?n.locale:sl),l=ze(!s||a?t.fallbackLocale.value:ut(n.fallbackLocale)||xn(n.fallbackLocale)||kt(n.fallbackLocale)||n.fallbackLocale===!1?n.fallbackLocale:o.value),c=ze($d(o.value,n)),u=ze(kt(n.datetimeFormats)?n.datetimeFormats:{[o.value]:{}}),d=ze(kt(n.numberFormats)?n.numberFormats:{[o.value]:{}}),h=s?t.missingWarn:$t(n.missingWarn)||ra(n.missingWarn)?n.missingWarn:!0,f=s?t.fallbackWarn:$t(n.fallbackWarn)||ra(n.fallbackWarn)?n.fallbackWarn:!0,p=s?t.fallbackRoot:$t(n.fallbackRoot)?n.fallbackRoot:!0,m=!!n.fallbackFormat,_=mn(n.missing)?n.missing:null,v=mn(n.postTranslation)?n.postTranslation:null,x=s?t.warnHtmlMessage:$t(n.warnHtmlMessage)?n.warnHtmlMessage:!0,y=!!n.escapeParameter,g=s?t.modifiers:kt(n.modifiers)?n.modifiers:{},w=n.pluralRules||s&&t.pluralRules;function b(){return[o.value,l.value,c.value,u.value,d.value]}const T=tt({get:()=>r.value?r.value.locale.value:o.value,set:R=>{r.value&&(r.value.locale.value=R),o.value=R}}),E=tt({get:()=>r.value?r.value.fallbackLocale.value:l.value,set:R=>{r.value&&(r.value.fallbackLocale.value=R),l.value=R}}),S=tt(()=>r.value?r.value.messages.value:c.value),M=tt(()=>u.value),A=tt(()=>d.value);function C(){return r.value?r.value.getPostTranslationHandler():v}function I(R){r.value&&r.value.setPostTranslationHandler(R)}function H(){return r.value?r.value.getMissingHandler():_}function W(R){r.value&&r.value.setMissingHandler(R)}function z(R){return b(),R()}function q(...R){return r.value?z(()=>Reflect.apply(r.value.t,null,[...R])):z(()=>"")}function O(...R){return r.value?Reflect.apply(r.value.rt,null,[...R]):""}function re(...R){return r.value?z(()=>Reflect.apply(r.value.d,null,[...R])):z(()=>"")}function le(...R){return r.value?z(()=>Reflect.apply(r.value.n,null,[...R])):z(()=>"")}function Z(R){return r.value?r.value.tm(R):{}}function ne(R,N){return r.value?r.value.te(R,N):!1}function j(R){return r.value?r.value.getLocaleMessage(R):{}}function ee(R,N){r.value&&(r.value.setLocaleMessage(R,N),c.value[R]=N)}function F(R,N){r.value&&r.value.mergeLocaleMessage(R,N)}function X(R){return r.value?r.value.getDateTimeFormat(R):{}}function Q(R,N){r.value&&(r.value.setDateTimeFormat(R,N),u.value[R]=N)}function ue(R,N){r.value&&r.value.mergeDateTimeFormat(R,N)}function ce(R){return r.value?r.value.getNumberFormat(R):{}}function xe(R,N){r.value&&(r.value.setNumberFormat(R,N),d.value[R]=N)}function Me(R,N){r.value&&r.value.mergeNumberFormat(R,N)}const Y={get id(){return r.value?r.value.id:-1},locale:T,fallbackLocale:E,messages:S,datetimeFormats:M,numberFormats:A,get inheritLocale(){return r.value?r.value.inheritLocale:a},set inheritLocale(R){r.value&&(r.value.inheritLocale=R)},get availableLocales(){return r.value?r.value.availableLocales:Object.keys(c.value)},get modifiers(){return r.value?r.value.modifiers:g},get pluralRules(){return r.value?r.value.pluralRules:w},get isGlobal(){return r.value?r.value.isGlobal:!1},get missingWarn(){return r.value?r.value.missingWarn:h},set missingWarn(R){r.value&&(r.value.missingWarn=R)},get fallbackWarn(){return r.value?r.value.fallbackWarn:f},set fallbackWarn(R){r.value&&(r.value.missingWarn=R)},get fallbackRoot(){return r.value?r.value.fallbackRoot:p},set fallbackRoot(R){r.value&&(r.value.fallbackRoot=R)},get fallbackFormat(){return r.value?r.value.fallbackFormat:m},set fallbackFormat(R){r.value&&(r.value.fallbackFormat=R)},get warnHtmlMessage(){return r.value?r.value.warnHtmlMessage:x},set warnHtmlMessage(R){r.value&&(r.value.warnHtmlMessage=R)},get escapeParameter(){return r.value?r.value.escapeParameter:y},set escapeParameter(R){r.value&&(r.value.escapeParameter=R)},t:q,getPostTranslationHandler:C,setPostTranslationHandler:I,getMissingHandler:H,setMissingHandler:W,rt:O,d:re,n:le,tm:Z,te:ne,getLocaleMessage:j,setLocaleMessage:ee,mergeLocaleMessage:F,getDateTimeFormat:X,setDateTimeFormat:Q,mergeDateTimeFormat:ue,getNumberFormat:ce,setNumberFormat:xe,mergeNumberFormat:Me};function P(R){R.locale.value=o.value,R.fallbackLocale.value=l.value,Object.keys(c.value).forEach(N=>{R.mergeLocaleMessage(N,c.value[N])}),Object.keys(u.value).forEach(N=>{R.mergeDateTimeFormat(N,u.value[N])}),Object.keys(d.value).forEach(N=>{R.mergeNumberFormat(N,d.value[N])}),R.escapeParameter=y,R.fallbackFormat=m,R.fallbackRoot=p,R.fallbackWarn=f,R.missingWarn=h,R.warnHtmlMessage=x}return C0(()=>{if(i.proxy==null||i.proxy.$i18n==null)throw Jn(qn.NOT_AVAILABLE_COMPOSITION_IN_LEGACY);const R=r.value=i.proxy.$i18n.__composer;e==="global"?(o.value=R.locale.value,l.value=R.fallbackLocale.value,c.value=R.messages.value,u.value=R.datetimeFormats.value,d.value=R.numberFormats.value):s&&P(R)}),Y}const RT=["locale","fallbackLocale","availableLocales"],Vv=["t","rt","d","n","tm","te"];function LT(i,e){const t=Object.create(null);return RT.forEach(s=>{const r=Object.getOwnPropertyDescriptor(e,s);if(!r)throw Jn(qn.UNEXPECTED_ERROR);const a=ii(r.value)?{get(){return r.value.value},set(o){r.value.value=o}}:{get(){return r.get&&r.get()}};Object.defineProperty(t,s,a)}),i.config.globalProperties.$i18n=t,Vv.forEach(s=>{const r=Object.getOwnPropertyDescriptor(e,s);if(!r||!r.value)throw Jn(qn.UNEXPECTED_ERROR);Object.defineProperty(i.config.globalProperties,`$${s}`,r)}),()=>{delete i.config.globalProperties.$i18n,Vv.forEach(s=>{delete i.config.globalProperties[`$${s}`]})}}aT();__INTLIFY_JIT_COMPILATION__?xv(XM):xv($M);OM(_M);NM(mx);if(__INTLIFY_PROD_DEVTOOLS__){const i=wr();i.__INTLIFY__=!0,MM(i.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__)}/*!
 * vuex v4.0.2
 * (c) 2021 Evan You
 * @license MIT
 */var Bx="store";function es(i){return i===void 0&&(i=null),Ko(i!==null?i:Bx)}function yl(i,e){Object.keys(i).forEach(function(t){return e(i[t],t)})}function IT(i){return i!==null&&typeof i=="object"}function DT(i){return i&&typeof i.then=="function"}function kT(i,e){return function(){return i(e)}}function Ox(i,e,t){return e.indexOf(i)<0&&(t&&t.prepend?e.unshift(i):e.push(i)),function(){var n=e.indexOf(i);n>-1&&e.splice(n,1)}}function Nx(i,e){i._actions=Object.create(null),i._mutations=Object.create(null),i._wrappedGetters=Object.create(null),i._modulesNamespaceMap=Object.create(null);var t=i.state;Xd(i,t,[],i._modules.root,!0),Tm(i,t,e)}function Tm(i,e,t){var n=i._state;i.getters={},i._makeLocalGettersCache=Object.create(null);var s=i._wrappedGetters,r={};yl(s,function(a,o){r[o]=kT(a,i),Object.defineProperty(i.getters,o,{get:function(){return r[o]()},enumerable:!0})}),i._state=Od({data:e}),i.strict&&UT(i),n&&t&&i._withCommit(function(){n.data=null})}function Xd(i,e,t,n,s){var r=!t.length,a=i._modules.getNamespace(t);if(n.namespaced&&(i._modulesNamespaceMap[a],i._modulesNamespaceMap[a]=n),!r&&!s){var o=Am(e,t.slice(0,-1)),l=t[t.length-1];i._withCommit(function(){o[l]=n.state})}var c=n.context=BT(i,a,t);n.forEachMutation(function(u,d){var h=a+d;OT(i,h,u,c)}),n.forEachAction(function(u,d){var h=u.root?d:a+d,f=u.handler||u;NT(i,h,f,c)}),n.forEachGetter(function(u,d){var h=a+d;FT(i,h,u,c)}),n.forEachChild(function(u,d){Xd(i,e,t.concat(d),u,s)})}function BT(i,e,t){var n=e==="",s={dispatch:n?i.dispatch:function(r,a,o){var l=cd(r,a,o),c=l.payload,u=l.options,d=l.type;return(!u||!u.root)&&(d=e+d),i.dispatch(d,c)},commit:n?i.commit:function(r,a,o){var l=cd(r,a,o),c=l.payload,u=l.options,d=l.type;(!u||!u.root)&&(d=e+d),i.commit(d,c,u)}};return Object.defineProperties(s,{getters:{get:n?function(){return i.getters}:function(){return Fx(i,e)}},state:{get:function(){return Am(i.state,t)}}}),s}function Fx(i,e){if(!i._makeLocalGettersCache[e]){var t={},n=e.length;Object.keys(i.getters).forEach(function(s){if(s.slice(0,n)===e){var r=s.slice(n);Object.defineProperty(t,r,{get:function(){return i.getters[s]},enumerable:!0})}}),i._makeLocalGettersCache[e]=t}return i._makeLocalGettersCache[e]}function OT(i,e,t,n){var s=i._mutations[e]||(i._mutations[e]=[]);s.push(function(a){t.call(i,n.state,a)})}function NT(i,e,t,n){var s=i._actions[e]||(i._actions[e]=[]);s.push(function(a){var o=t.call(i,{dispatch:n.dispatch,commit:n.commit,getters:n.getters,state:n.state,rootGetters:i.getters,rootState:i.state},a);return DT(o)||(o=Promise.resolve(o)),i._devtoolHook?o.catch(function(l){throw i._devtoolHook.emit("vuex:error",l),l}):o})}function FT(i,e,t,n){i._wrappedGetters[e]||(i._wrappedGetters[e]=function(r){return t(n.state,n.getters,r.state,r.getters)})}function UT(i){Wn(function(){return i._state.data},function(){},{deep:!0,flush:"sync"})}function Am(i,e){return e.reduce(function(t,n){return t[n]},i)}function cd(i,e,t){return IT(i)&&i.type&&(t=e,e=i,i=i.type),{type:i,payload:e,options:t}}var zT="vuex bindings",Gv="vuex:mutations",Eh="vuex:actions",_o="vuex",VT=0;function GT(i,e){sT({id:"org.vuejs.vuex",app:i,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[zT]},function(t){t.addTimelineLayer({id:Gv,label:"Vuex Mutations",color:Hv}),t.addTimelineLayer({id:Eh,label:"Vuex Actions",color:Hv}),t.addInspector({id:_o,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),t.on.getInspectorTree(function(n){if(n.app===i&&n.inspectorId===_o)if(n.filter){var s=[];Gx(s,e._modules.root,n.filter,""),n.rootNodes=s}else n.rootNodes=[Vx(e._modules.root,"")]}),t.on.getInspectorState(function(n){if(n.app===i&&n.inspectorId===_o){var s=n.nodeId;Fx(e,s),n.state=$T(qT(e._modules,s),s==="root"?e.getters:e._makeLocalGettersCache,s)}}),t.on.editInspectorState(function(n){if(n.app===i&&n.inspectorId===_o){var s=n.nodeId,r=n.path;s!=="root"&&(r=s.split("/").filter(Boolean).concat(r)),e._withCommit(function(){n.set(e._state.data,r,n.state.value)})}}),e.subscribe(function(n,s){var r={};n.payload&&(r.payload=n.payload),r.state=s,t.notifyComponentUpdate(),t.sendInspectorTree(_o),t.sendInspectorState(_o),t.addTimelineEvent({layerId:Gv,event:{time:Date.now(),title:n.type,data:r}})}),e.subscribeAction({before:function(n,s){var r={};n.payload&&(r.payload=n.payload),n._id=VT++,n._time=Date.now(),r.state=s,t.addTimelineEvent({layerId:Eh,event:{time:n._time,title:n.type,groupId:n._id,subtitle:"start",data:r}})},after:function(n,s){var r={},a=Date.now()-n._time;r.duration={_custom:{type:"duration",display:a+"ms",tooltip:"Action duration",value:a}},n.payload&&(r.payload=n.payload),r.state=s,t.addTimelineEvent({layerId:Eh,event:{time:Date.now(),title:n.type,groupId:n._id,subtitle:"end",data:r}})}})})}var Hv=8702998,HT=6710886,WT=16777215,Ux={label:"namespaced",textColor:WT,backgroundColor:HT};function zx(i){return i&&i!=="root"?i.split("/").slice(-2,-1)[0]:"Root"}function Vx(i,e){return{id:e||"root",label:zx(e),tags:i.namespaced?[Ux]:[],children:Object.keys(i._children).map(function(t){return Vx(i._children[t],e+t+"/")})}}function Gx(i,e,t,n){n.includes(t)&&i.push({id:n||"root",label:n.endsWith("/")?n.slice(0,n.length-1):n||"Root",tags:e.namespaced?[Ux]:[]}),Object.keys(e._children).forEach(function(s){Gx(i,e._children[s],t,n+s+"/")})}function $T(i,e,t){e=t==="root"?e:e[t];var n=Object.keys(e),s={state:Object.keys(i.state).map(function(a){return{key:a,editable:!0,value:i.state[a]}})};if(n.length){var r=XT(e);s.getters=Object.keys(r).map(function(a){return{key:a.endsWith("/")?zx(a):a,editable:!1,value:jf(function(){return r[a]})}})}return s}function XT(i){var e={};return Object.keys(i).forEach(function(t){var n=t.split("/");if(n.length>1){var s=e,r=n.pop();n.forEach(function(a){s[a]||(s[a]={_custom:{value:{},display:a,tooltip:"Module",abstract:!0}}),s=s[a]._custom.value}),s[r]=jf(function(){return i[t]})}else e[t]=jf(function(){return i[t]})}),e}function qT(i,e){var t=e.split("/").filter(function(n){return n});return t.reduce(function(n,s,r){var a=n[s];if(!a)throw new Error('Missing module "'+s+'" for path "'+e+'".');return r===t.length-1?a:a._children},e==="root"?i:i.root._children)}function jf(i){try{return i()}catch(e){return e}}var ks=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var n=e.state;this.state=(typeof n=="function"?n():n)||{}},Hx={namespaced:{configurable:!0}};Hx.namespaced.get=function(){return!!this._rawModule.namespaced};ks.prototype.addChild=function(e,t){this._children[e]=t};ks.prototype.removeChild=function(e){delete this._children[e]};ks.prototype.getChild=function(e){return this._children[e]};ks.prototype.hasChild=function(e){return e in this._children};ks.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)};ks.prototype.forEachChild=function(e){yl(this._children,e)};ks.prototype.forEachGetter=function(e){this._rawModule.getters&&yl(this._rawModule.getters,e)};ks.prototype.forEachAction=function(e){this._rawModule.actions&&yl(this._rawModule.actions,e)};ks.prototype.forEachMutation=function(e){this._rawModule.mutations&&yl(this._rawModule.mutations,e)};Object.defineProperties(ks.prototype,Hx);var co=function(e){this.register([],e,!1)};co.prototype.get=function(e){return e.reduce(function(t,n){return t.getChild(n)},this.root)};co.prototype.getNamespace=function(e){var t=this.root;return e.reduce(function(n,s){return t=t.getChild(s),n+(t.namespaced?s+"/":"")},"")};co.prototype.update=function(e){Wx([],this.root,e)};co.prototype.register=function(e,t,n){var s=this;n===void 0&&(n=!0);var r=new ks(t,n);if(e.length===0)this.root=r;else{var a=this.get(e.slice(0,-1));a.addChild(e[e.length-1],r)}t.modules&&yl(t.modules,function(o,l){s.register(e.concat(l),o,n)})};co.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1],s=t.getChild(n);s&&s.runtime&&t.removeChild(n)};co.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1];return t?t.hasChild(n):!1};function Wx(i,e,t){if(e.update(t),t.modules)for(var n in t.modules){if(!e.getChild(n))return;Wx(i.concat(n),e.getChild(n),t.modules[n])}}function YT(i){return new Ui(i)}var Ui=function(e){var t=this;e===void 0&&(e={});var n=e.plugins;n===void 0&&(n=[]);var s=e.strict;s===void 0&&(s=!1);var r=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new co(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._devtools=r;var a=this,o=this,l=o.dispatch,c=o.commit;this.dispatch=function(h,f){return l.call(a,h,f)},this.commit=function(h,f,p){return c.call(a,h,f,p)},this.strict=s;var u=this._modules.root.state;Xd(this,u,[],this._modules.root),Tm(this,u),n.forEach(function(d){return d(t)})},Cm={state:{configurable:!0}};Ui.prototype.install=function(e,t){e.provide(t||Bx,this),e.config.globalProperties.$store=this;var n=this._devtools!==void 0?this._devtools:!1;n&&GT(e,this)};Cm.state.get=function(){return this._state.data};Cm.state.set=function(i){};Ui.prototype.commit=function(e,t,n){var s=this,r=cd(e,t,n),a=r.type,o=r.payload,l={type:a,payload:o},c=this._mutations[a];c&&(this._withCommit(function(){c.forEach(function(d){d(o)})}),this._subscribers.slice().forEach(function(u){return u(l,s.state)}))};Ui.prototype.dispatch=function(e,t){var n=this,s=cd(e,t),r=s.type,a=s.payload,o={type:r,payload:a},l=this._actions[r];if(l){try{this._actionSubscribers.slice().filter(function(u){return u.before}).forEach(function(u){return u.before(o,n.state)})}catch{}var c=l.length>1?Promise.all(l.map(function(u){return u(a)})):l[0](a);return new Promise(function(u,d){c.then(function(h){try{n._actionSubscribers.filter(function(f){return f.after}).forEach(function(f){return f.after(o,n.state)})}catch{}u(h)},function(h){try{n._actionSubscribers.filter(function(f){return f.error}).forEach(function(f){return f.error(o,n.state,h)})}catch{}d(h)})})}};Ui.prototype.subscribe=function(e,t){return Ox(e,this._subscribers,t)};Ui.prototype.subscribeAction=function(e,t){var n=typeof e=="function"?{before:e}:e;return Ox(n,this._actionSubscribers,t)};Ui.prototype.watch=function(e,t,n){var s=this;return Wn(function(){return e(s.state,s.getters)},t,Object.assign({},n))};Ui.prototype.replaceState=function(e){var t=this;this._withCommit(function(){t._state.data=e})};Ui.prototype.registerModule=function(e,t,n){n===void 0&&(n={}),typeof e=="string"&&(e=[e]),this._modules.register(e,t),Xd(this,this.state,e,this._modules.get(e),n.preserveState),Tm(this,this.state)};Ui.prototype.unregisterModule=function(e){var t=this;typeof e=="string"&&(e=[e]),this._modules.unregister(e),this._withCommit(function(){var n=Am(t.state,e.slice(0,-1));delete n[e[e.length-1]]}),Nx(this)};Ui.prototype.hasModule=function(e){return typeof e=="string"&&(e=[e]),this._modules.isRegistered(e)};Ui.prototype.hotUpdate=function(e){this._modules.update(e),Nx(this,!0)};Ui.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t};Object.defineProperties(Ui.prototype,Cm);const Ht=(i,e)=>{const t=i.__vccOpts||i;for(const[n,s]of e)t[n]=s;return t},jT=["disabled","type"],KT={key:1,class:"button__icon button__icon_left"},ZT={key:2,class:"button__text"},JT={key:3,class:"button__icon button__icon_right"},QT={__name:"Button",props:{variant:{type:String,default:"primary",validator:i=>["primary","secondary","outline","ghost","danger"].includes(i)},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},type:{type:String,default:"button",validator:i=>["button","submit","reset"].includes(i)},text:{type:String,default:""},iconLeft:{type:String,default:""},iconRight:{type:String,default:""}},emits:["click"],setup(i,{emit:e}){const t=i,n=e,s=tt(()=>["button",`button._${t.variant}`,`button._${t.size}`,{"button._disabled":t.disabled||t.loading,"button._loading":t.loading,"button._full-width":t.fullWidth}]),r=tt(()=>`button__spinner._${t.size}`),a=o=>{!t.disabled&&!t.loading&&n("click",o)};return(o,l)=>(oe(),ge("button",{class:qt(s.value),disabled:i.disabled||i.loading,type:i.type,onClick:a},[i.loading?(oe(),ge("span",{key:0,class:qt(["button__spinner",r.value])},[...l[0]||(l[0]=[B("svg",{class:"spinner",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[B("circle",{class:"spinner__circle",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none","stroke-linecap":"round","stroke-dasharray":"31.416","stroke-dashoffset":"31.416"},[B("animate",{attributeName:"stroke-dasharray",dur:"2s",values:"0 31.416;15.708 15.708;0 31.416;0 31.416",repeatCount:"indefinite"}),B("animate",{attributeName:"stroke-dashoffset",dur:"2s",values:"0;-15.708;-31.416;-31.416",repeatCount:"indefinite"})])],-1)])],2)):Ve("",!0),i.iconLeft?(oe(),ge("span",KT,[Hn(o.$slots,"icon-left",{},()=>[Oe(se(i.iconLeft),1)])])):Ve("",!0),o.$slots.default||i.text?(oe(),ge("span",ZT,[Hn(o.$slots,"default",{},()=>[Oe(se(i.text),1)])])):Ve("",!0),i.iconRight?(oe(),ge("span",JT,[Hn(o.$slots,"icon-right",{},()=>[Oe(se(i.iconRight),1)])])):Ve("",!0)],10,jT))}},wt=Ht(QT,[["__scopeId","data-v-ab684280"]]),eA=["for"],tA={key:0,class:"input__required"},nA={class:"input__container"},iA={key:0,class:"input__icon input__icon_left"},sA=["id","type","value","placeholder","disabled","readonly","required","maxlength","min","max","step","autocomplete"],rA={key:1,class:"input__icon input__icon_right"},aA={key:1,class:"input__message"},oA={key:0,class:"input__error"},lA={key:1,class:"input__hint"},cA={__name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text",validator:i=>["text","email","password","number","tel","url","search"].includes(i)},label:{type:String,default:""},placeholder:{type:String,default:""},hint:{type:String,default:""},error:{type:String,default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},maxlength:{type:Number,default:null},min:{type:Number,default:null},max:{type:Number,default:null},step:{type:Number,default:null},autocomplete:{type:String,default:"off"},iconLeft:{type:String,default:""},iconRight:{type:String,default:""},clearable:{type:Boolean,default:!1},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)}},emits:["update:modelValue","blur","focus","clear"],setup(i,{emit:e}){const t=i,n=e,s=Dc(),r=ze(!1),a=tt(()=>["input-wrapper",{"input-wrapper._error":!!t.error,"input-wrapper._disabled":t.disabled,"input-wrapper._focused":r.value}]),o=tt(()=>["input",`input._${t.size}`,{"input._has-icon-left":!!t.iconLeft||!!$slots["icon-left"],"input._has-icon-right":!!t.iconRight||!!$slots["icon-right"]||t.clearable}]),l=tt(()=>t.clearable&&t.modelValue&&!t.disabled&&!t.readonly),c=f=>{n("update:modelValue",f.target.value)},u=f=>{r.value=!1,n("blur",f)},d=f=>{r.value=!0,n("focus",f)},h=()=>{n("update:modelValue",""),n("clear")};return(f,p)=>(oe(),ge("div",{class:qt(["input-wrapper",a.value])},[i.label?(oe(),ge("label",{key:0,for:Ii(s),class:"input__label"},[Oe(se(i.label)+" ",1),i.required?(oe(),ge("span",tA,"*")):Ve("",!0)],8,eA)):Ve("",!0),B("div",nA,[i.iconLeft?(oe(),ge("span",iA,[Hn(f.$slots,"icon-left",{},()=>[Oe(se(i.iconLeft),1)])])):Ve("",!0),B("input",{id:Ii(s),type:i.type,value:i.modelValue,placeholder:i.placeholder,disabled:i.disabled,readonly:i.readonly,required:i.required,maxlength:i.maxlength,min:i.min,max:i.max,step:i.step,autocomplete:i.autocomplete,class:qt(["input",o.value]),onInput:c,onBlur:u,onFocus:d},null,42,sA),i.iconRight||l.value?(oe(),ge("span",rA,[l.value?(oe(),ge("button",{key:0,type:"button",class:"input__clear",onClick:h,"aria-label":"Clear input"},"  ")):Hn(f.$slots,"icon-right",{key:1},()=>[Oe(se(i.iconRight),1)])])):Ve("",!0)]),i.error||i.hint?(oe(),ge("div",aA,[i.error?(oe(),ge("span",oA,se(i.error),1)):i.hint?(oe(),ge("span",lA,se(i.hint),1)):Ve("",!0)])):Ve("",!0)],2))}},as=Ht(cA,[["__scopeId","data-v-3199bb90"]]),uA={key:0,class:"modal__close"},dA={key:1,class:"modal__header"},hA={key:0,class:"modal__title"},fA={class:"modal__content"},pA={key:2,class:"modal__footer"},mA={__name:"Modal",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:""},size:{type:String,default:"md",validator:i=>["sm","md","lg","xl","fullscreen"].includes(i)},position:{type:String,default:"center",validator:i=>["center","top","bottom"].includes(i)},showCloseButton:{type:Boolean,default:!0},closeOnOverlay:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},preventScroll:{type:Boolean,default:!0}},emits:["update:modelValue","close"],setup(i,{emit:e}){const t=i,n=e,s=tt(()=>({"modal-overlay._blur":t.size!=="fullscreen"})),r=tt(()=>["modal",`modal._${t.size}`,`modal._${t.position}`]),a=tt(()=>({})),o=()=>{n("update:modelValue",!1),n("close")},l=()=>{t.closeOnOverlay&&o()},c=u=>{u.key==="Escape"&&t.modelValue&&t.closeOnEsc&&o()};return Wn(()=>t.modelValue,u=>{u&&t.preventScroll?document.body.style.overflow="hidden":document.body.style.overflow=""}),In(()=>{document.addEventListener("keydown",c)}),Ds(()=>{document.removeEventListener("keydown",c),document.body.style.overflow=""}),(u,d)=>(oe(),jt(y0,{to:"body"},[we(Q0,{name:"modal"},{default:Le(()=>[i.modelValue?(oe(),ge("div",{key:0,class:qt(["modal-overlay",s.value]),onClick:fc(l,["self"])},[B("div",{class:qt(["modal",r.value]),style:fi(a.value),onClick:d[0]||(d[0]=fc(()=>{},["stop"]))},[i.showCloseButton?(oe(),ge("div",uA,[B("button",{type:"button",class:"modal__close-btn",onClick:o,"aria-label":"Close modal"},[...d[1]||(d[1]=[B("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[B("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])])):Ve("",!0),u.$slots.header||i.title?(oe(),ge("div",dA,[Hn(u.$slots,"header",{},()=>[i.title?(oe(),ge("h3",hA,se(i.title),1)):Ve("",!0)],!0)])):Ve("",!0),B("div",fA,[Hn(u.$slots,"default",{},void 0,!0)]),u.$slots.footer?(oe(),ge("div",pA,[Hn(u.$slots,"footer",{},void 0,!0)])):Ve("",!0)],6)],2)):Ve("",!0)]),_:3})]))}},Pr=Ht(mA,[["__scopeId","data-v-65b438f6"]]),_A={class:"game-header"},vA={class:"game-header__left"},gA={class:"game-header__title"},yA={class:"game-header__right"},xA={class:"game-header__profile"},bA={class:"profile-compact"},wA={class:"profile-compact__info"},SA={class:"profile-compact__coins"},EA={class:"profile-compact__coins-amount"},MA={class:"profile-modal__content"},TA={class:"profile-modal__section"},AA={class:"profile-modal__section-title"},CA={class:"profile-modal__avatar-grid"},PA=["onClick"],RA={class:"profile-modal__section"},LA={class:"profile-modal__section-title"},IA={class:"profile-modal__name-group"},DA={class:"profile-modal__section"},kA={__name:"GameHeader",emits:["settings-click"],setup(i){const e=es(),{t}=wn(),n=tt(()=>e.getters.currentScene),s=()=>{e.dispatch("navigateToScene","mainMenu")},r=ze(!1),a=ze(""),o=ze(!1),l=tt(()=>e.getters["player/displayName"]),c=tt(()=>e.state.player.avatar),u=tt(()=>e.getters["player/formattedCoins"]),d=tt(()=>Array.from({length:10},(b,T)=>T+1)),h=tt(()=>g(c.value)),f=tt(()=>w(c.value)),p=async()=>{a.value=l.value,r.value=!0,await Cr();const b=document.querySelector(".profile-modal__name-input input");b&&(b.focus(),b.select())},m=()=>{a.value.trim()&&e.dispatch("player/setName",a.value.trim()),a.value=""},_=()=>{a.value=""},v=b=>{e.dispatch("player/setAvatar",b)},x=()=>{r.value=!1,a.value=""},y=async()=>{o.value=!0;try{(await e.dispatch("player/watchAdForCoins")).success}finally{o.value=!1}},g=b=>{const T=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43"],E=T[(b-1)%T.length];return{backgroundColor:E,background:`linear-gradient(135deg, ${E} 0%, ${E}dd 100%)`}},w=b=>{const T=["","","","","","","","","",""];return T[(b-1)%T.length]};return(b,T)=>(oe(),ge("header",_A,[B("div",vA,[n.value!=="mainMenu"?(oe(),jt(wt,{key:0,variant:"ghost",size:"sm",onClick:s,class:"game-header__back-btn"},{"icon-left":Le(()=>[...T[4]||(T[4]=[Oe("",-1)])]),default:Le(()=>[Oe(" "+se(b.$t("common.back")),1)]),_:1})):Ve("",!0),B("h1",gA,se(b.$t("mainMenu.title")),1)]),B("div",yA,[we(wt,{variant:"ghost",size:"sm",onClick:T[0]||(T[0]=E=>b.$emit("settings-click")),class:"game-header__settings-btn"},{"icon-left":Le(()=>[...T[5]||(T[5]=[Oe("",-1)])]),_:1}),B("div",xA,[B("div",bA,[B("div",{class:"profile-compact__avatar",style:fi(h.value),onClick:T[1]||(T[1]=E=>r.value=!0)},se(f.value),5),B("div",wA,[B("div",{class:"profile-compact__name",onClick:p},se(l.value),1),B("div",SA,[T[6]||(T[6]=B("span",{class:"profile-compact__coins-icon"},"",-1)),B("span",EA,se(u.value),1)])])])])]),we(Pr,{modelValue:r.value,"onUpdate:modelValue":T[3]||(T[3]=E=>r.value=E),title:b.$t("player.profile"),size:"md",onClose:x},{default:Le(()=>[B("div",MA,[B("div",TA,[B("h4",AA,se(b.$t("player.changeAvatar")),1),B("div",CA,[(oe(!0),ge(At,null,Zt(d.value,E=>(oe(),ge("div",{key:E,onClick:S=>v(E),class:qt(["profile-modal__avatar-option",{"profile-modal__avatar-option--selected":E===c.value}])},[B("div",{class:"profile-modal__avatar-preview",style:fi(g(E))},se(w(E)),5)],10,PA))),128))])]),B("div",RA,[B("h4",LA,se(b.$t("player.changeName")),1),B("div",IA,[we(as,{modelValue:a.value,"onUpdate:modelValue":T[2]||(T[2]=E=>a.value=E),placeholder:b.$t("player.enterName"),maxlength:20,onKeyup:[ad(m,["enter"]),ad(_,["escape"])],class:"profile-modal__name-input"},null,8,["modelValue","placeholder"]),we(wt,{variant:"primary",onClick:m},{default:Le(()=>[Oe(se(b.$t("common.save")),1)]),_:1})])]),B("div",DA,[we(wt,{variant:"primary","full-width":"",loading:o.value,disabled:o.value,onClick:y},{"icon-left":Le(()=>[...T[7]||(T[7]=[Oe("",-1)])]),default:Le(()=>[Oe(" "+se(b.$t("player.watchAd"))+" (+50 "+se(b.$t("player.coins"))+") ",1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["modelValue","title"])]))}},BA=Ht(kA,[["__scopeId","data-v-8e08caa9"]]);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Pm="180",Zo={ROTATE:0,DOLLY:1,PAN:2},Uo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},OA=0,Wv=1,NA=2,$x=1,Rm=2,mr=3,aa=0,Di=1,ws=2,Jr=0,Jo=1,$v=2,Xv=3,qv=4,FA=5,Ha=100,UA=101,zA=102,VA=103,GA=104,HA=200,WA=201,$A=202,XA=203,Kf=204,Zf=205,qA=206,YA=207,jA=208,KA=209,ZA=210,JA=211,QA=212,eC=213,tC=214,Jf=0,Qf=1,ep=2,rl=3,tp=4,np=5,ip=6,sp=7,qd=0,nC=1,iC=2,Qr=0,sC=1,rC=2,aC=3,oC=4,lC=5,cC=6,uC=7,Xx=300,al=301,ol=302,rp=303,ap=304,Yd=306,op=1e3,Xa=1001,lp=1002,wi=1003,dC=1004,eu=1005,Xs=1006,Mh=1007,qa=1008,Zs=1009,qx=1010,Yx=1011,vc=1012,Lm=1013,no=1014,Sr=1015,Oc=1016,Im=1017,Dm=1018,gc=1020,jx=35902,Kx=35899,Zx=1021,Jx=1022,Ts=1023,yc=1026,xc=1027,Qx=1028,km=1029,eb=1030,Bm=1031,Om=1033,zu=33776,Vu=33777,Gu=33778,Hu=33779,cp=35840,up=35841,dp=35842,hp=35843,fp=36196,pp=37492,mp=37496,_p=37808,vp=37809,gp=37810,yp=37811,xp=37812,bp=37813,wp=37814,Sp=37815,Ep=37816,Mp=37817,Tp=37818,Ap=37819,Cp=37820,Pp=37821,Rp=36492,Lp=36494,Ip=36495,Dp=36283,kp=36284,Bp=36285,Op=36286,hC=3200,fC=3201,jd=0,pC=1,Xr="",ls="srgb",ll="srgb-linear",ud="linear",ln="srgb",vo=7680,Yv=519,mC=512,_C=513,vC=514,tb=515,gC=516,yC=517,xC=518,bC=519,jv=35044,Kv="300 es",qs=2e3,dd=2001;class uo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const s=n[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}const ai=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Wu=Math.PI/180,hd=180/Math.PI;function Nc(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ai[i&255]+ai[i>>8&255]+ai[i>>16&255]+ai[i>>24&255]+"-"+ai[e&255]+ai[e>>8&255]+"-"+ai[e>>16&15|64]+ai[e>>24&255]+"-"+ai[t&63|128]+ai[t>>8&255]+"-"+ai[t>>16&255]+ai[t>>24&255]+ai[n&255]+ai[n>>8&255]+ai[n>>16&255]+ai[n>>24&255]).toLowerCase()}function Xt(i,e,t){return Math.max(e,Math.min(t,i))}function wC(i,e){return(i%e+e)%e}function Th(i,e,t){return(1-t)*i+t*e}function Pl(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Ai(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const SC={DEG2RAD:Wu};class Lt{constructor(e=0,t=0){Lt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Xt(this.x,e.x,t.x),this.y=Xt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Xt(this.x,e,t),this.y=Xt(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Xt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Xt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*s+e.x,this.y=r*s+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}let io=class{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,a,o){let l=n[s+0],c=n[s+1],u=n[s+2],d=n[s+3];const h=r[a+0],f=r[a+1],p=r[a+2],m=r[a+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(o===1){e[t+0]=h,e[t+1]=f,e[t+2]=p,e[t+3]=m;return}if(d!==m||l!==h||c!==f||u!==p){let _=1-o;const v=l*h+c*f+u*p+d*m,x=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){const w=Math.sqrt(y),b=Math.atan2(w,v*x);_=Math.sin(_*b)/w,o=Math.sin(o*b)/w}const g=o*x;if(l=l*_+h*g,c=c*_+f*g,u=u*_+p*g,d=d*_+m*g,_===1-o){const w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,s,r,a){const o=n[s],l=n[s+1],c=n[s+2],u=n[s+3],d=r[a],h=r[a+1],f=r[a+2],p=r[a+3];return e[t]=o*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-o*f,e[t+2]=c*p+u*f+o*h-l*d,e[t+3]=u*p-o*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(n/2),u=o(s/2),d=o(r/2),h=l(n/2),f=l(s/2),p=l(r/2);switch(a){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],a=t[1],o=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=n+o+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(r-c)*f,this._z=(a-s)*f}else if(n>o&&n>d){const f=2*Math.sqrt(1+n-o-d);this._w=(u-l)/f,this._x=.25*f,this._y=(s+a)/f,this._z=(r+c)/f}else if(o>d){const f=2*Math.sqrt(1+o-n-d);this._w=(r-c)/f,this._x=(s+a)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-n-o);this._w=(a-s)/f,this._x=(r+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Xt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,a=e._w,o=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+a*o+s*c-r*l,this._y=s*u+a*l+r*o-n*c,this._z=r*u+a*c+n*l-s*o,this._w=a*u-n*o-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,a=this._w;let o=a*e._w+n*e._x+s*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=s,this._z=r,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*a+t*this._w,this._x=f*n+t*this._x,this._y=f*s+t*this._y,this._z=f*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=a*d+this._w*h,this._x=n*d+this._x*h,this._y=s*d+this._y*h,this._z=r*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class fe{constructor(e=0,t=0,n=0){fe.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Zv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Zv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*s-o*n),u=2*(o*t-r*s),d=2*(r*n-a*t);return this.x=t+l*c+a*d-o*u,this.y=n+l*u+o*c-r*d,this.z=s+l*d+r*u-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Xt(this.x,e.x,t.x),this.y=Xt(this.y,e.y,t.y),this.z=Xt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Xt(this.x,e,t),this.y=Xt(this.y,e,t),this.z=Xt(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Xt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,a=t.x,o=t.y,l=t.z;return this.x=s*l-r*o,this.y=r*a-n*l,this.z=n*o-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ah.copy(this).projectOnVector(e),this.sub(Ah)}reflect(e){return this.sub(Ah.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Xt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ah=new fe,Zv=new io;class Ut{constructor(e,t,n,s,r,a,o,l,c){Ut.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,o,l,c)}set(e,t,n,s,r,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=o,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[3],l=n[6],c=n[1],u=n[4],d=n[7],h=n[2],f=n[5],p=n[8],m=s[0],_=s[3],v=s[6],x=s[1],y=s[4],g=s[7],w=s[2],b=s[5],T=s[8];return r[0]=a*m+o*x+l*w,r[3]=a*_+o*y+l*b,r[6]=a*v+o*g+l*T,r[1]=c*m+u*x+d*w,r[4]=c*_+u*y+d*b,r[7]=c*v+u*g+d*T,r[2]=h*m+f*x+p*w,r[5]=h*_+f*y+p*b,r[8]=h*v+f*g+p*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-n*r*u+n*o*l+s*r*c-s*a*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],d=u*a-o*c,h=o*l-u*r,f=c*r-a*l,p=t*d+n*h+s*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=d*m,e[1]=(s*c-u*n)*m,e[2]=(o*n-s*a)*m,e[3]=h*m,e[4]=(u*t-s*l)*m,e[5]=(s*r-o*t)*m,e[6]=f*m,e[7]=(n*l-c*t)*m,e[8]=(a*t-n*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,a,o){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*a+c*o)+a+e,-s*c,s*l,-s*(-c*a+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Ch.makeScale(e,t)),this}rotate(e){return this.premultiply(Ch.makeRotation(-e)),this}translate(e,t){return this.premultiply(Ch.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Ch=new Ut;function nb(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function bc(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function EC(){const i=bc("canvas");return i.style.display="block",i}const Jv={};function wc(i){i in Jv||(Jv[i]=!0,console.warn(i))}function MC(i,e,t){return new Promise(function(n,s){function r(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:s();break;case i.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:n()}}setTimeout(r,t)})}const Qv=new Ut().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),eg=new Ut().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function TC(){const i={enabled:!0,workingColorSpace:ll,spaces:{},convert:function(s,r,a){return this.enabled===!1||r===a||!r||!a||(this.spaces[r].transfer===ln&&(s.r=Er(s.r),s.g=Er(s.g),s.b=Er(s.b)),this.spaces[r].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===ln&&(s.r=Qo(s.r),s.g=Qo(s.g),s.b=Qo(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Xr?ud:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,a){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return wc("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return wc("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(s,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[ll]:{primaries:e,whitePoint:n,transfer:ud,toXYZ:Qv,fromXYZ:eg,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:ls},outputColorSpaceConfig:{drawingBufferColorSpace:ls}},[ls]:{primaries:e,whitePoint:n,transfer:ln,toXYZ:Qv,fromXYZ:eg,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:ls}}}),i}const tn=TC();function Er(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Qo(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let go;class AC{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{go===void 0&&(go=bc("canvas")),go.width=e.width,go.height=e.height;const s=go.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),n=go}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=bc("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=Er(r[a]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Er(t[n]/255)*255):t[n]=Er(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let CC=0;class Nm{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:CC++}),this.uuid=Nc(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(Ph(s[a].image)):r.push(Ph(s[a]))}else r=Ph(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function Ph(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?AC.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let PC=0;const Rh=new fe;class pi extends uo{constructor(e=pi.DEFAULT_IMAGE,t=pi.DEFAULT_MAPPING,n=Xa,s=Xa,r=Xs,a=qa,o=Ts,l=Zs,c=pi.DEFAULT_ANISOTROPY,u=Xr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:PC++}),this.uuid=Nc(),this.name="",this.source=new Nm(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new Lt(0,0),this.repeat=new Lt(1,1),this.center=new Lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ut,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Rh).x}get height(){return this.source.getSize(Rh).y}get depth(){return this.source.getSize(Rh).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}s&&n&&s.isVector2&&n.isVector2||s&&n&&s.isVector3&&n.isVector3||s&&n&&s.isMatrix3&&n.isMatrix3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Xx)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case op:e.x=e.x-Math.floor(e.x);break;case Xa:e.x=e.x<0?0:1;break;case lp:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case op:e.y=e.y-Math.floor(e.y);break;case Xa:e.y=e.y<0?0:1;break;case lp:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}pi.DEFAULT_IMAGE=null;pi.DEFAULT_MAPPING=Xx;pi.DEFAULT_ANISOTROPY=1;class Cn{constructor(e=0,t=0,n=0,s=1){Cn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*s+a[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],m=l[2],_=l[6],v=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-m)<.01&&Math.abs(p-_)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+m)<.1&&Math.abs(p+_)<.1&&Math.abs(c+f+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(c+1)/2,g=(f+1)/2,w=(v+1)/2,b=(u+h)/4,T=(d+m)/4,E=(p+_)/4;return y>g&&y>w?y<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(y),s=b/n,r=T/n):g>w?g<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(g),n=b/s,r=E/s):w<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(w),n=T/r,s=E/r),this.set(n,s,r,t),this}let x=Math.sqrt((_-p)*(_-p)+(d-m)*(d-m)+(h-u)*(h-u));return Math.abs(x)<.001&&(x=1),this.x=(_-p)/x,this.y=(d-m)/x,this.z=(h-u)/x,this.w=Math.acos((c+f+v-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Xt(this.x,e.x,t.x),this.y=Xt(this.y,e.y,t.y),this.z=Xt(this.z,e.z,t.z),this.w=Xt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Xt(this.x,e,t),this.y=Xt(this.y,e,t),this.z=Xt(this.z,e,t),this.w=Xt(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Xt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RC extends uo{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Xs,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Cn(0,0,e,t),this.scissorTest=!1,this.viewport=new Cn(0,0,e,t);const s={width:e,height:t,depth:n.depth},r=new pi(s);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Xs,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=n,this.textures[s].isArrayTexture=this.textures[s].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const s=Object.assign({},e.textures[t].image);this.textures[t].source=new Nm(s)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class so extends RC{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class ib extends pi{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=wi,this.minFilter=wi,this.wrapR=Xa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class LC extends pi{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=wi,this.minFilter=wi,this.wrapR=Xa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class kr{constructor(e=new fe(1/0,1/0,1/0),t=new fe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(_s.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(_s.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=_s.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,_s):_s.fromBufferAttribute(r,a),_s.applyMatrix4(e.matrixWorld),this.expandByPoint(_s);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),tu.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),tu.copy(n.boundingBox)),tu.applyMatrix4(e.matrixWorld),this.union(tu)}const s=e.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,_s),_s.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Rl),nu.subVectors(this.max,Rl),yo.subVectors(e.a,Rl),xo.subVectors(e.b,Rl),bo.subVectors(e.c,Rl),Nr.subVectors(xo,yo),Fr.subVectors(bo,xo),Ca.subVectors(yo,bo);let t=[0,-Nr.z,Nr.y,0,-Fr.z,Fr.y,0,-Ca.z,Ca.y,Nr.z,0,-Nr.x,Fr.z,0,-Fr.x,Ca.z,0,-Ca.x,-Nr.y,Nr.x,0,-Fr.y,Fr.x,0,-Ca.y,Ca.x,0];return!Lh(t,yo,xo,bo,nu)||(t=[1,0,0,0,1,0,0,0,1],!Lh(t,yo,xo,bo,nu))?!1:(iu.crossVectors(Nr,Fr),t=[iu.x,iu.y,iu.z],Lh(t,yo,xo,bo,nu))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_s).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_s).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(rr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const rr=[new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe],_s=new fe,tu=new kr,yo=new fe,xo=new fe,bo=new fe,Nr=new fe,Fr=new fe,Ca=new fe,Rl=new fe,nu=new fe,iu=new fe,Pa=new fe;function Lh(i,e,t,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){Pa.fromArray(i,r);const o=s.x*Math.abs(Pa.x)+s.y*Math.abs(Pa.y)+s.z*Math.abs(Pa.z),l=e.dot(Pa),c=t.dot(Pa),u=n.dot(Pa);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const IC=new kr,Ll=new fe,Ih=new fe;class Kd{constructor(e=new fe,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):IC.setFromPoints(e).getCenter(n);let s=0;for(let r=0,a=e.length;r<a;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ll.subVectors(e,this.center);const t=Ll.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(Ll,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Ih.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ll.copy(e.center).add(Ih)),this.expandByPoint(Ll.copy(e.center).sub(Ih))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ar=new fe,Dh=new fe,su=new fe,Ur=new fe,kh=new fe,ru=new fe,Bh=new fe;let Zd=class{constructor(e=new fe,t=new fe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ar)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ar.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ar.copy(this.origin).addScaledVector(this.direction,t),ar.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Dh.copy(e).add(t).multiplyScalar(.5),su.copy(t).sub(e).normalize(),Ur.copy(this.origin).sub(Dh);const r=e.distanceTo(t)*.5,a=-this.direction.dot(su),o=Ur.dot(this.direction),l=-Ur.dot(su),c=Ur.lengthSq(),u=Math.abs(1-a*a);let d,h,f,p;if(u>0)if(d=a*l-o,h=a*o-l,p=r*u,d>=0)if(h>=-p)if(h<=p){const m=1/u;d*=m,h*=m,f=d*(d+a*h+2*o)+h*(a*d+h+2*l)+c}else h=r,d=Math.max(0,-(a*h+o)),f=-d*d+h*(h+2*l)+c;else h=-r,d=Math.max(0,-(a*h+o)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-a*r+o)),h=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-r,-l),r),f=h*(h+2*l)+c):(d=Math.max(0,-(a*r+o)),h=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+h*(h+2*l)+c);else h=a>0?-r:r,d=Math.max(0,-(a*h+o)),f=-d*d+h*(h+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(Dh).addScaledVector(su,h),f}intersectSphere(e,t){ar.subVectors(e.center,this.origin);const n=ar.dot(this.direction),s=ar.dot(ar)-n*n,r=e.radius*e.radius;if(s>r)return null;const a=Math.sqrt(r-s),o=n-a,l=n+a;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,s=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,s=(e.min.x-h.x)*c),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||r>s||((r>n||isNaN(n))&&(n=r),(a<s||isNaN(s))&&(s=a),d>=0?(o=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(o=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),n>l||o>s)||((o>n||n!==n)&&(n=o),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,ar)!==null}intersectTriangle(e,t,n,s,r){kh.subVectors(t,e),ru.subVectors(n,e),Bh.crossVectors(kh,ru);let a=this.direction.dot(Bh),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Ur.subVectors(this.origin,e);const l=o*this.direction.dot(ru.crossVectors(Ur,ru));if(l<0)return null;const c=o*this.direction.dot(kh.cross(Ur));if(c<0||l+c>a)return null;const u=-o*Ur.dot(Bh);return u<0?null:this.at(u/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Tn{constructor(e,t,n,s,r,a,o,l,c,u,d,h,f,p,m,_){Tn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,a,o,l,c,u,d,h,f,p,m,_)}set(e,t,n,s,r,a,o,l,c,u,d,h,f,p,m,_){const v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=s,v[1]=r,v[5]=a,v[9]=o,v[13]=l,v[2]=c,v[6]=u,v[10]=d,v[14]=h,v[3]=f,v[7]=p,v[11]=m,v[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Tn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/wo.setFromMatrixColumn(e,0).length(),r=1/wo.setFromMatrixColumn(e,1).length(),a=1/wo.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const h=a*u,f=a*d,p=o*u,m=o*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-m*c,t[9]=-o*l,t[2]=m-h*c,t[6]=p+f*c,t[10]=a*l}else if(e.order==="YXZ"){const h=l*u,f=l*d,p=c*u,m=c*d;t[0]=h+m*o,t[4]=p*o-f,t[8]=a*c,t[1]=a*d,t[5]=a*u,t[9]=-o,t[2]=f*o-p,t[6]=m+h*o,t[10]=a*l}else if(e.order==="ZXY"){const h=l*u,f=l*d,p=c*u,m=c*d;t[0]=h-m*o,t[4]=-a*d,t[8]=p+f*o,t[1]=f+p*o,t[5]=a*u,t[9]=m-h*o,t[2]=-a*c,t[6]=o,t[10]=a*l}else if(e.order==="ZYX"){const h=a*u,f=a*d,p=o*u,m=o*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+m,t[1]=l*d,t[5]=m*c+h,t[9]=f*c-p,t[2]=-c,t[6]=o*l,t[10]=a*l}else if(e.order==="YZX"){const h=a*l,f=a*c,p=o*l,m=o*c;t[0]=l*u,t[4]=m-h*d,t[8]=p*d+f,t[1]=d,t[5]=a*u,t[9]=-o*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-m*d}else if(e.order==="XZY"){const h=a*l,f=a*c,p=o*l,m=o*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+m,t[5]=a*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=o*u,t[10]=m*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(DC,e,kC)}lookAt(e,t,n){const s=this.elements;return Vi.subVectors(e,t),Vi.lengthSq()===0&&(Vi.z=1),Vi.normalize(),zr.crossVectors(n,Vi),zr.lengthSq()===0&&(Math.abs(n.z)===1?Vi.x+=1e-4:Vi.z+=1e-4,Vi.normalize(),zr.crossVectors(n,Vi)),zr.normalize(),au.crossVectors(Vi,zr),s[0]=zr.x,s[4]=au.x,s[8]=Vi.x,s[1]=zr.y,s[5]=au.y,s[9]=Vi.y,s[2]=zr.z,s[6]=au.z,s[10]=Vi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,a=n[0],o=n[4],l=n[8],c=n[12],u=n[1],d=n[5],h=n[9],f=n[13],p=n[2],m=n[6],_=n[10],v=n[14],x=n[3],y=n[7],g=n[11],w=n[15],b=s[0],T=s[4],E=s[8],S=s[12],M=s[1],A=s[5],C=s[9],I=s[13],H=s[2],W=s[6],z=s[10],q=s[14],O=s[3],re=s[7],le=s[11],Z=s[15];return r[0]=a*b+o*M+l*H+c*O,r[4]=a*T+o*A+l*W+c*re,r[8]=a*E+o*C+l*z+c*le,r[12]=a*S+o*I+l*q+c*Z,r[1]=u*b+d*M+h*H+f*O,r[5]=u*T+d*A+h*W+f*re,r[9]=u*E+d*C+h*z+f*le,r[13]=u*S+d*I+h*q+f*Z,r[2]=p*b+m*M+_*H+v*O,r[6]=p*T+m*A+_*W+v*re,r[10]=p*E+m*C+_*z+v*le,r[14]=p*S+m*I+_*q+v*Z,r[3]=x*b+y*M+g*H+w*O,r[7]=x*T+y*A+g*W+w*re,r[11]=x*E+y*C+g*z+w*le,r[15]=x*S+y*I+g*q+w*Z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14],p=e[3],m=e[7],_=e[11],v=e[15];return p*(+r*l*d-s*c*d-r*o*h+n*c*h+s*o*f-n*l*f)+m*(+t*l*f-t*c*h+r*a*h-s*a*f+s*c*u-r*l*u)+_*(+t*c*d-t*o*f-r*a*d+n*a*f+r*o*u-n*c*u)+v*(-s*o*u-t*l*d+t*o*h+s*a*d-n*a*h+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],m=e[13],_=e[14],v=e[15],x=d*_*c-m*h*c+m*l*f-o*_*f-d*l*v+o*h*v,y=p*h*c-u*_*c-p*l*f+a*_*f+u*l*v-a*h*v,g=u*m*c-p*d*c+p*o*f-a*m*f-u*o*v+a*d*v,w=p*d*l-u*m*l-p*o*h+a*m*h+u*o*_-a*d*_,b=t*x+n*y+s*g+r*w;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/b;return e[0]=x*T,e[1]=(m*h*r-d*_*r-m*s*f+n*_*f+d*s*v-n*h*v)*T,e[2]=(o*_*r-m*l*r+m*s*c-n*_*c-o*s*v+n*l*v)*T,e[3]=(d*l*r-o*h*r-d*s*c+n*h*c+o*s*f-n*l*f)*T,e[4]=y*T,e[5]=(u*_*r-p*h*r+p*s*f-t*_*f-u*s*v+t*h*v)*T,e[6]=(p*l*r-a*_*r-p*s*c+t*_*c+a*s*v-t*l*v)*T,e[7]=(a*h*r-u*l*r+u*s*c-t*h*c-a*s*f+t*l*f)*T,e[8]=g*T,e[9]=(p*d*r-u*m*r-p*n*f+t*m*f+u*n*v-t*d*v)*T,e[10]=(a*m*r-p*o*r+p*n*c-t*m*c-a*n*v+t*o*v)*T,e[11]=(u*o*r-a*d*r-u*n*c+t*d*c+a*n*f-t*o*f)*T,e[12]=w*T,e[13]=(u*m*s-p*d*s+p*n*h-t*m*h-u*n*_+t*d*_)*T,e[14]=(p*o*s-a*m*s-p*n*l+t*m*l+a*n*_-t*o*_)*T,e[15]=(a*d*s-u*o*s+u*n*l-t*d*l-a*n*h+t*o*h)*T,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,a=e.x,o=e.y,l=e.z,c=r*a,u=r*o;return this.set(c*a+n,c*o-s*l,c*l+s*o,0,c*o+s*l,u*o+n,u*l-s*a,0,c*l-s*o,u*l+s*a,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,a){return this.set(1,n,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,a=t._y,o=t._z,l=t._w,c=r+r,u=a+a,d=o+o,h=r*c,f=r*u,p=r*d,m=a*u,_=a*d,v=o*d,x=l*c,y=l*u,g=l*d,w=n.x,b=n.y,T=n.z;return s[0]=(1-(m+v))*w,s[1]=(f+g)*w,s[2]=(p-y)*w,s[3]=0,s[4]=(f-g)*b,s[5]=(1-(h+v))*b,s[6]=(_+x)*b,s[7]=0,s[8]=(p+y)*T,s[9]=(_-x)*T,s[10]=(1-(h+m))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=wo.set(s[0],s[1],s[2]).length();const a=wo.set(s[4],s[5],s[6]).length(),o=wo.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],vs.copy(this);const c=1/r,u=1/a,d=1/o;return vs.elements[0]*=c,vs.elements[1]*=c,vs.elements[2]*=c,vs.elements[4]*=u,vs.elements[5]*=u,vs.elements[6]*=u,vs.elements[8]*=d,vs.elements[9]*=d,vs.elements[10]*=d,t.setFromRotationMatrix(vs),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,s,r,a,o=qs,l=!1){const c=this.elements,u=2*r/(t-e),d=2*r/(n-s),h=(t+e)/(t-e),f=(n+s)/(n-s);let p,m;if(l)p=r/(a-r),m=a*r/(a-r);else if(o===qs)p=-(a+r)/(a-r),m=-2*a*r/(a-r);else if(o===dd)p=-a/(a-r),m=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=d,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,s,r,a,o=qs,l=!1){const c=this.elements,u=2/(t-e),d=2/(n-s),h=-(t+e)/(t-e),f=-(n+s)/(n-s);let p,m;if(l)p=1/(a-r),m=a/(a-r);else if(o===qs)p=-2/(a-r),m=-(a+r)/(a-r);else if(o===dd)p=-1/(a-r),m=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=0,c[12]=h,c[1]=0,c[5]=d,c[9]=0,c[13]=f,c[2]=0,c[6]=0,c[10]=p,c[14]=m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const wo=new fe,vs=new Tn,DC=new fe(0,0,0),kC=new fe(1,1,1),zr=new fe,au=new fe,Vi=new fe,tg=new Tn,ng=new io;class Zi{constructor(e=0,t=0,n=0,s=Zi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],l=s[1],c=s[5],u=s[9],d=s[2],h=s[6],f=s[10];switch(t){case"XYZ":this._y=Math.asin(Xt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Xt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Xt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Xt(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Xt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Xt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return tg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(tg,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ng.setFromEuler(this),this.setFromQuaternion(ng,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Zi.DEFAULT_ORDER="XYZ";class Fm{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let BC=0;const ig=new fe,So=new io,or=new Tn,ou=new fe,Il=new fe,OC=new fe,NC=new io,sg=new fe(1,0,0),rg=new fe(0,1,0),ag=new fe(0,0,1),og={type:"added"},FC={type:"removed"},Eo={type:"childadded",child:null},Oh={type:"childremoved",child:null};class Rn extends uo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:BC++}),this.uuid=Nc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Rn.DEFAULT_UP.clone();const e=new fe,t=new Zi,n=new io,s=new fe(1,1,1);function r(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Tn},normalMatrix:{value:new Ut}}),this.matrix=new Tn,this.matrixWorld=new Tn,this.matrixAutoUpdate=Rn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Rn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Fm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return So.setFromAxisAngle(e,t),this.quaternion.multiply(So),this}rotateOnWorldAxis(e,t){return So.setFromAxisAngle(e,t),this.quaternion.premultiply(So),this}rotateX(e){return this.rotateOnAxis(sg,e)}rotateY(e){return this.rotateOnAxis(rg,e)}rotateZ(e){return this.rotateOnAxis(ag,e)}translateOnAxis(e,t){return ig.copy(e).applyQuaternion(this.quaternion),this.position.add(ig.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(sg,e)}translateY(e){return this.translateOnAxis(rg,e)}translateZ(e){return this.translateOnAxis(ag,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(or.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ou.copy(e):ou.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Il.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?or.lookAt(Il,ou,this.up):or.lookAt(ou,Il,this.up),this.quaternion.setFromRotationMatrix(or),s&&(or.extractRotation(s.matrixWorld),So.setFromRotationMatrix(or),this.quaternion.premultiply(So.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(og),Eo.child=e,this.dispatchEvent(Eo),Eo.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(FC),Oh.child=e,this.dispatchEvent(Oh),Oh.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),or.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),or.multiply(e.parent.matrixWorld)),e.applyMatrix4(or),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(og),Eo.child=e,this.dispatchEvent(Eo),Eo.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Il,e,OC),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Il,NC,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(r(e.materials,this.material[l]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(r(e.animations,l))}}if(t){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),d=a(e.shapes),h=a(e.skeletons),f=a(e.animations),p=a(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),d.length>0&&(n.shapes=d),h.length>0&&(n.skeletons=h),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=s,n;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}Rn.DEFAULT_UP=new fe(0,1,0);Rn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Rn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const gs=new fe,lr=new fe,Nh=new fe,cr=new fe,Mo=new fe,To=new fe,lg=new fe,Fh=new fe,Uh=new fe,zh=new fe,Vh=new Cn,Gh=new Cn,Hh=new Cn;class Ss{constructor(e=new fe,t=new fe,n=new fe){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),gs.subVectors(e,t),s.cross(gs);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){gs.subVectors(s,t),lr.subVectors(n,t),Nh.subVectors(e,t);const a=gs.dot(gs),o=gs.dot(lr),l=gs.dot(Nh),c=lr.dot(lr),u=lr.dot(Nh),d=a*c-o*o;if(d===0)return r.set(0,0,0),null;const h=1/d,f=(c*l-o*u)*h,p=(a*u-o*l)*h;return r.set(1-f-p,p,f)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,cr)===null?!1:cr.x>=0&&cr.y>=0&&cr.x+cr.y<=1}static getInterpolation(e,t,n,s,r,a,o,l){return this.getBarycoord(e,t,n,s,cr)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,cr.x),l.addScaledVector(a,cr.y),l.addScaledVector(o,cr.z),l)}static getInterpolatedAttribute(e,t,n,s,r,a){return Vh.setScalar(0),Gh.setScalar(0),Hh.setScalar(0),Vh.fromBufferAttribute(e,t),Gh.fromBufferAttribute(e,n),Hh.fromBufferAttribute(e,s),a.setScalar(0),a.addScaledVector(Vh,r.x),a.addScaledVector(Gh,r.y),a.addScaledVector(Hh,r.z),a}static isFrontFacing(e,t,n,s){return gs.subVectors(n,t),lr.subVectors(e,t),gs.cross(lr).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return gs.subVectors(this.c,this.b),lr.subVectors(this.a,this.b),gs.cross(lr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ss.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ss.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,s,r){return Ss.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Ss.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ss.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let a,o;Mo.subVectors(s,n),To.subVectors(r,n),Fh.subVectors(e,n);const l=Mo.dot(Fh),c=To.dot(Fh);if(l<=0&&c<=0)return t.copy(n);Uh.subVectors(e,s);const u=Mo.dot(Uh),d=To.dot(Uh);if(u>=0&&d<=u)return t.copy(s);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return a=l/(l-u),t.copy(n).addScaledVector(Mo,a);zh.subVectors(e,r);const f=Mo.dot(zh),p=To.dot(zh);if(p>=0&&f<=p)return t.copy(r);const m=f*c-l*p;if(m<=0&&c>=0&&p<=0)return o=c/(c-p),t.copy(n).addScaledVector(To,o);const _=u*p-f*d;if(_<=0&&d-u>=0&&f-p>=0)return lg.subVectors(r,s),o=(d-u)/(d-u+(f-p)),t.copy(s).addScaledVector(lg,o);const v=1/(_+m+h);return a=m*v,o=h*v,t.copy(n).addScaledVector(Mo,a).addScaledVector(To,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const sb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vr={h:0,s:0,l:0},lu={h:0,s:0,l:0};function Wh(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class Mt{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ls){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,tn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,s=tn.workingColorSpace){return this.r=e,this.g=t,this.b=n,tn.colorSpaceToWorking(this,s),this}setHSL(e,t,n,s=tn.workingColorSpace){if(e=wC(e,1),t=Xt(t,0,1),n=Xt(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=Wh(a,r,e+1/3),this.g=Wh(a,r,e),this.b=Wh(a,r,e-1/3)}return tn.colorSpaceToWorking(this,s),this}setStyle(e,t=ls){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ls){const n=sb[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Er(e.r),this.g=Er(e.g),this.b=Er(e.b),this}copyLinearToSRGB(e){return this.r=Qo(e.r),this.g=Qo(e.g),this.b=Qo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ls){return tn.workingToColorSpace(oi.copy(this),e),Math.round(Xt(oi.r*255,0,255))*65536+Math.round(Xt(oi.g*255,0,255))*256+Math.round(Xt(oi.b*255,0,255))}getHexString(e=ls){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=tn.workingColorSpace){tn.workingToColorSpace(oi.copy(this),t);const n=oi.r,s=oi.g,r=oi.b,a=Math.max(n,s,r),o=Math.min(n,s,r);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const d=a-o;switch(c=u<=.5?d/(a+o):d/(2-a-o),a){case n:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-n)/d+2;break;case r:l=(n-s)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=tn.workingColorSpace){return tn.workingToColorSpace(oi.copy(this),t),e.r=oi.r,e.g=oi.g,e.b=oi.b,e}getStyle(e=ls){tn.workingToColorSpace(oi.copy(this),e);const t=oi.r,n=oi.g,s=oi.b;return e!==ls?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(e,t,n){return this.getHSL(Vr),this.setHSL(Vr.h+e,Vr.s+t,Vr.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Vr),e.getHSL(lu);const n=Th(Vr.h,lu.h,t),s=Th(Vr.s,lu.s,t),r=Th(Vr.l,lu.l,t);return this.setHSL(n,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*s,this.g=r[1]*t+r[4]*n+r[7]*s,this.b=r[2]*t+r[5]*n+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const oi=new Mt;Mt.NAMES=sb;let UC=0,_a=class extends uo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:UC++}),this.uuid=Nc(),this.name="",this.type="Material",this.blending=Jo,this.side=aa,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Kf,this.blendDst=Zf,this.blendEquation=Ha,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Mt(0,0,0),this.blendAlpha=0,this.depthFunc=rl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Yv,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=vo,this.stencilZFail=vo,this.stencilZPass=vo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Jo&&(n.blending=this.blending),this.side!==aa&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Kf&&(n.blendSrc=this.blendSrc),this.blendDst!==Zf&&(n.blendDst=this.blendDst),this.blendEquation!==Ha&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==rl&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Yv&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==vo&&(n.stencilFail=this.stencilFail),this.stencilZFail!==vo&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==vo&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const a=[];for(const o in r){const l=r[o];delete l.metadata,a.push(l)}return a}if(t){const r=s(e.textures),a=s(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};class xl extends _a{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Zi,this.combine=qd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Nn=new fe,cu=new Lt;let zC=0;class Rs{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:zC++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=jv,this.updateRanges=[],this.gpuType=Sr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)cu.fromBufferAttribute(this,t),cu.applyMatrix3(e),this.setXY(t,cu.x,cu.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Nn.fromBufferAttribute(this,t),Nn.applyMatrix3(e),this.setXYZ(t,Nn.x,Nn.y,Nn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Nn.fromBufferAttribute(this,t),Nn.applyMatrix4(e),this.setXYZ(t,Nn.x,Nn.y,Nn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Nn.fromBufferAttribute(this,t),Nn.applyNormalMatrix(e),this.setXYZ(t,Nn.x,Nn.y,Nn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Nn.fromBufferAttribute(this,t),Nn.transformDirection(e),this.setXYZ(t,Nn.x,Nn.y,Nn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Pl(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Ai(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Pl(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ai(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Pl(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ai(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Pl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ai(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Pl(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ai(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Ai(t,this.array),n=Ai(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Ai(t,this.array),n=Ai(n,this.array),s=Ai(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Ai(t,this.array),n=Ai(n,this.array),s=Ai(s,this.array),r=Ai(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==jv&&(e.usage=this.usage),e}}class rb extends Rs{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class ab extends Rs{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Ls extends Rs{constructor(e,t,n){super(new Float32Array(e),t,n)}}let VC=0;const is=new Tn,$h=new Rn,Ao=new fe,Gi=new kr,Dl=new kr,Kn=new fe;class Bs extends uo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:VC++}),this.uuid=Nc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(nb(e)?ab:rb)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Ut().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return is.makeRotationFromQuaternion(e),this.applyMatrix4(is),this}rotateX(e){return is.makeRotationX(e),this.applyMatrix4(is),this}rotateY(e){return is.makeRotationY(e),this.applyMatrix4(is),this}rotateZ(e){return is.makeRotationZ(e),this.applyMatrix4(is),this}translate(e,t,n){return is.makeTranslation(e,t,n),this.applyMatrix4(is),this}scale(e,t,n){return is.makeScale(e,t,n),this.applyMatrix4(is),this}lookAt(e){return $h.lookAt(e),$h.updateMatrix(),this.applyMatrix4($h.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ao).negate(),this.translate(Ao.x,Ao.y,Ao.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let s=0,r=e.length;s<r;s++){const a=e[s];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Ls(n,3))}else{const n=Math.min(e.length,t.count);for(let s=0;s<n;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new kr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new fe(-1/0,-1/0,-1/0),new fe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];Gi.setFromBufferAttribute(r),this.morphTargetsRelative?(Kn.addVectors(this.boundingBox.min,Gi.min),this.boundingBox.expandByPoint(Kn),Kn.addVectors(this.boundingBox.max,Gi.max),this.boundingBox.expandByPoint(Kn)):(this.boundingBox.expandByPoint(Gi.min),this.boundingBox.expandByPoint(Gi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Kd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new fe,1/0);return}if(e){const n=this.boundingSphere.center;if(Gi.setFromBufferAttribute(e),t)for(let r=0,a=t.length;r<a;r++){const o=t[r];Dl.setFromBufferAttribute(o),this.morphTargetsRelative?(Kn.addVectors(Gi.min,Dl.min),Gi.expandByPoint(Kn),Kn.addVectors(Gi.max,Dl.max),Gi.expandByPoint(Kn)):(Gi.expandByPoint(Dl.min),Gi.expandByPoint(Dl.max))}Gi.getCenter(n);let s=0;for(let r=0,a=e.count;r<a;r++)Kn.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(Kn));if(t)for(let r=0,a=t.length;r<a;r++){const o=t[r],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Kn.fromBufferAttribute(o,c),l&&(Ao.fromBufferAttribute(e,c),Kn.add(Ao)),s=Math.max(s,n.distanceToSquared(Kn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Rs(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let E=0;E<n.count;E++)o[E]=new fe,l[E]=new fe;const c=new fe,u=new fe,d=new fe,h=new Lt,f=new Lt,p=new Lt,m=new fe,_=new fe;function v(E,S,M){c.fromBufferAttribute(n,E),u.fromBufferAttribute(n,S),d.fromBufferAttribute(n,M),h.fromBufferAttribute(r,E),f.fromBufferAttribute(r,S),p.fromBufferAttribute(r,M),u.sub(c),d.sub(c),f.sub(h),p.sub(h);const A=1/(f.x*p.y-p.x*f.y);isFinite(A)&&(m.copy(u).multiplyScalar(p.y).addScaledVector(d,-f.y).multiplyScalar(A),_.copy(d).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(A),o[E].add(m),o[S].add(m),o[M].add(m),l[E].add(_),l[S].add(_),l[M].add(_))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let E=0,S=x.length;E<S;++E){const M=x[E],A=M.start,C=M.count;for(let I=A,H=A+C;I<H;I+=3)v(e.getX(I+0),e.getX(I+1),e.getX(I+2))}const y=new fe,g=new fe,w=new fe,b=new fe;function T(E){w.fromBufferAttribute(s,E),b.copy(w);const S=o[E];y.copy(S),y.sub(w.multiplyScalar(w.dot(S))).normalize(),g.crossVectors(b,S);const A=g.dot(l[E])<0?-1:1;a.setXYZW(E,y.x,y.y,y.z,A)}for(let E=0,S=x.length;E<S;++E){const M=x[E],A=M.start,C=M.count;for(let I=A,H=A+C;I<H;I+=3)T(e.getX(I+0)),T(e.getX(I+1)),T(e.getX(I+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Rs(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,f=n.count;h<f;h++)n.setXYZ(h,0,0,0);const s=new fe,r=new fe,a=new fe,o=new fe,l=new fe,c=new fe,u=new fe,d=new fe;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),m=e.getX(h+1),_=e.getX(h+2);s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m),a.fromBufferAttribute(t,_),u.subVectors(a,r),d.subVectors(s,r),u.cross(d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,_),o.add(u),l.add(u),c.add(u),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(_,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)s.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),a.fromBufferAttribute(t,h+2),u.subVectors(a,r),d.subVectors(s,r),u.cross(d),n.setXYZ(h+0,u.x,u.y,u.z),n.setXYZ(h+1,u.x,u.y,u.z),n.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Kn.fromBufferAttribute(e,t),Kn.normalize(),e.setXYZ(t,Kn.x,Kn.y,Kn.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,d=o.normalized,h=new c.constructor(l.length*u);let f=0,p=0;for(let m=0,_=l.length;m<_;m++){o.isInterleavedBufferAttribute?f=l[m]*o.data.stride+o.offset:f=l[m]*u;for(let v=0;v<u;v++)h[p++]=c[f++]}return new Rs(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Bs,n=this.index.array,s=this.attributes;for(const o in s){const l=s[o],c=e(l,n);t.setAttribute(o,c)}const r=this.morphAttributes;for(const o in r){const l=[],c=r[o];for(let u=0,d=c.length;u<d;u++){const h=c[u],f=e(h,n);l.push(f)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){const f=c[d];u.push(f.toJSON(e.data))}u.length>0&&(s[l]=u,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const s=e.attributes;for(const c in s){const u=s[c];this.setAttribute(c,u.clone(t))}const r=e.morphAttributes;for(const c in r){const u=[],d=r[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const cg=new Tn,Ra=new Zd,uu=new Kd,ug=new fe,du=new fe,hu=new fe,fu=new fe,Xh=new fe,pu=new fe,dg=new fe,mu=new fe;class yn extends Rn{constructor(e=new Bs,t=new xl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(r&&o){pu.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const u=o[l],d=r[l];u!==0&&(Xh.fromBufferAttribute(d,e),a?pu.addScaledVector(Xh,u):pu.addScaledVector(Xh.sub(t),u))}t.add(pu)}return t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),uu.copy(n.boundingSphere),uu.applyMatrix4(r),Ra.copy(e.ray).recast(e.near),!(uu.containsPoint(Ra.origin)===!1&&(Ra.intersectSphere(uu,ug)===null||Ra.origin.distanceToSquared(ug)>(e.far-e.near)**2))&&(cg.copy(r).invert(),Ra.copy(e.ray).applyMatrix4(cg),!(n.boundingBox!==null&&Ra.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Ra)))}_computeIntersections(e,t,n){let s;const r=this.geometry,a=this.material,o=r.index,l=r.attributes.position,c=r.attributes.uv,u=r.attributes.uv1,d=r.attributes.normal,h=r.groups,f=r.drawRange;if(o!==null)if(Array.isArray(a))for(let p=0,m=h.length;p<m;p++){const _=h[p],v=a[_.materialIndex],x=Math.max(_.start,f.start),y=Math.min(o.count,Math.min(_.start+_.count,f.start+f.count));for(let g=x,w=y;g<w;g+=3){const b=o.getX(g),T=o.getX(g+1),E=o.getX(g+2);s=_u(this,v,e,n,c,u,d,b,T,E),s&&(s.faceIndex=Math.floor(g/3),s.face.materialIndex=_.materialIndex,t.push(s))}}else{const p=Math.max(0,f.start),m=Math.min(o.count,f.start+f.count);for(let _=p,v=m;_<v;_+=3){const x=o.getX(_),y=o.getX(_+1),g=o.getX(_+2);s=_u(this,a,e,n,c,u,d,x,y,g),s&&(s.faceIndex=Math.floor(_/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(a))for(let p=0,m=h.length;p<m;p++){const _=h[p],v=a[_.materialIndex],x=Math.max(_.start,f.start),y=Math.min(l.count,Math.min(_.start+_.count,f.start+f.count));for(let g=x,w=y;g<w;g+=3){const b=g,T=g+1,E=g+2;s=_u(this,v,e,n,c,u,d,b,T,E),s&&(s.faceIndex=Math.floor(g/3),s.face.materialIndex=_.materialIndex,t.push(s))}}else{const p=Math.max(0,f.start),m=Math.min(l.count,f.start+f.count);for(let _=p,v=m;_<v;_+=3){const x=_,y=_+1,g=_+2;s=_u(this,a,e,n,c,u,d,x,y,g),s&&(s.faceIndex=Math.floor(_/3),t.push(s))}}}}function GC(i,e,t,n,s,r,a,o){let l;if(e.side===Di?l=n.intersectTriangle(a,r,s,!0,o):l=n.intersectTriangle(s,r,a,e.side===aa,o),l===null)return null;mu.copy(o),mu.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(mu);return c<t.near||c>t.far?null:{distance:c,point:mu.clone(),object:i}}function _u(i,e,t,n,s,r,a,o,l,c){i.getVertexPosition(o,du),i.getVertexPosition(l,hu),i.getVertexPosition(c,fu);const u=GC(i,e,t,n,du,hu,fu,dg);if(u){const d=new fe;Ss.getBarycoord(dg,du,hu,fu,d),s&&(u.uv=Ss.getInterpolatedAttribute(s,o,l,c,d,new Lt)),r&&(u.uv1=Ss.getInterpolatedAttribute(r,o,l,c,d,new Lt)),a&&(u.normal=Ss.getInterpolatedAttribute(a,o,l,c,d,new fe),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a:o,b:l,c,normal:new fe,materialIndex:0};Ss.getNormal(du,hu,fu,h.normal),u.face=h,u.barycoord=d}return u}class ji extends Bs{constructor(e=1,t=1,n=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};const o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const l=[],c=[],u=[],d=[];let h=0,f=0;p("z","y","x",-1,-1,n,t,e,a,r,0),p("z","y","x",1,-1,n,t,-e,a,r,1),p("x","z","y",1,1,e,n,t,s,a,2),p("x","z","y",1,-1,e,n,-t,s,a,3),p("x","y","z",1,-1,e,t,n,s,r,4),p("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new Ls(c,3)),this.setAttribute("normal",new Ls(u,3)),this.setAttribute("uv",new Ls(d,2));function p(m,_,v,x,y,g,w,b,T,E,S){const M=g/T,A=w/E,C=g/2,I=w/2,H=b/2,W=T+1,z=E+1;let q=0,O=0;const re=new fe;for(let le=0;le<z;le++){const Z=le*A-I;for(let ne=0;ne<W;ne++){const j=ne*M-C;re[m]=j*x,re[_]=Z*y,re[v]=H,c.push(re.x,re.y,re.z),re[m]=0,re[_]=0,re[v]=b>0?1:-1,u.push(re.x,re.y,re.z),d.push(ne/T),d.push(1-le/E),q+=1}}for(let le=0;le<E;le++)for(let Z=0;Z<T;Z++){const ne=h+Z+W*le,j=h+Z+W*(le+1),ee=h+(Z+1)+W*(le+1),F=h+(Z+1)+W*le;l.push(ne,j,F),l.push(j,ee,F),O+=6}o.addGroup(f,O,S),f+=O,h+=q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ji(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cl(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function vi(i){const e={};for(let t=0;t<i.length;t++){const n=cl(i[t]);for(const s in n)e[s]=n[s]}return e}function HC(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function ob(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:tn.workingColorSpace}const WC={clone:cl,merge:vi};var $C=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,XC=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class oa extends _a{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=$C,this.fragmentShader=XC,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cl(e.uniforms),this.uniformsGroups=HC(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class lb extends Rn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Tn,this.projectionMatrix=new Tn,this.projectionMatrixInverse=new Tn,this.coordinateSystem=qs,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Gr=new fe,hg=new Lt,fg=new Lt;class An extends lb{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=hd*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Wu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return hd*2*Math.atan(Math.tan(Wu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Gr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Gr.x,Gr.y).multiplyScalar(-e/Gr.z),Gr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Gr.x,Gr.y).multiplyScalar(-e/Gr.z)}getViewSize(e,t){return this.getViewBounds(e,hg,fg),t.subVectors(fg,hg)}setViewOffset(e,t,n,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Wu*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;r+=a.offsetX*s/l,t-=a.offsetY*n/c,s*=a.width/l,n*=a.height/c}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Co=-90,Po=1;class qC extends Rn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new An(Co,Po,e,t);s.layers=this.layers,this.add(s);const r=new An(Co,Po,e,t);r.layers=this.layers,this.add(r);const a=new An(Co,Po,e,t);a.layers=this.layers,this.add(a);const o=new An(Co,Po,e,t);o.layers=this.layers,this.add(o);const l=new An(Co,Po,e,t);l.layers=this.layers,this.add(l);const c=new An(Co,Po,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,s,r,a,o,l]=t;for(const c of t)this.remove(c);if(e===qs)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===dd)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,l,c,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(t,r),e.setRenderTarget(n,1,s),e.render(t,a),e.setRenderTarget(n,2,s),e.render(t,o),e.setRenderTarget(n,3,s),e.render(t,l),e.setRenderTarget(n,4,s),e.render(t,c),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,s),e.render(t,u),e.setRenderTarget(d,h,f),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class cb extends pi{constructor(e=[],t=al,n,s,r,a,o,l,c,u){super(e,t,n,s,r,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class YC extends so{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new cb(s),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new ji(5,5,5),r=new oa({name:"CubemapFromEquirect",uniforms:cl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Di,blending:Jr});r.uniforms.tEquirect.value=t;const a=new yn(s,r),o=t.minFilter;return t.minFilter===qa&&(t.minFilter=Xs),new qC(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,s=!0){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,s);e.setRenderTarget(r)}}class Zn extends Rn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const jC={type:"move"};class qh{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Zn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Zn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new fe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new fe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Zn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new fe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new fe),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const m of e.hand.values()){const _=t.getJointPose(m,n),v=this._getHandJoint(c,m);_!==null&&(v.matrix.fromArray(_.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=_.radius),v.visible=_!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(jC)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Zn;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Um{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Mt(e),this.near=t,this.far=n}clone(){return new Um(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Qs extends Rn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Zi,this.environmentIntensity=1,this.environmentRotation=new Zi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const Yh=new fe,KC=new fe,ZC=new Ut;let xs=class{constructor(e=new fe(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=Yh.subVectors(n,t).cross(KC.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Yh),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||ZC.getNormalMatrix(e),s=this.coplanarPoint(Yh).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const La=new Kd,JC=new Lt(.5,.5),vu=new fe;class zm{constructor(e=new xs,t=new xs,n=new xs,s=new xs,r=new xs,a=new xs){this.planes=[e,t,n,s,r,a]}set(e,t,n,s,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=qs,n=!1){const s=this.planes,r=e.elements,a=r[0],o=r[1],l=r[2],c=r[3],u=r[4],d=r[5],h=r[6],f=r[7],p=r[8],m=r[9],_=r[10],v=r[11],x=r[12],y=r[13],g=r[14],w=r[15];if(s[0].setComponents(c-a,f-u,v-p,w-x).normalize(),s[1].setComponents(c+a,f+u,v+p,w+x).normalize(),s[2].setComponents(c+o,f+d,v+m,w+y).normalize(),s[3].setComponents(c-o,f-d,v-m,w-y).normalize(),n)s[4].setComponents(l,h,_,g).normalize(),s[5].setComponents(c-l,f-h,v-_,w-g).normalize();else if(s[4].setComponents(c-l,f-h,v-_,w-g).normalize(),t===qs)s[5].setComponents(c+l,f+h,v+_,w+g).normalize();else if(t===dd)s[5].setComponents(l,h,_,g).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),La.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),La.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(La)}intersectsSprite(e){La.center.set(0,0,0);const t=JC.distanceTo(e.center);return La.radius=.7071067811865476+t,La.applyMatrix4(e.matrixWorld),this.intersectsSphere(La)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(vu.x=s.normal.x>0?e.max.x:e.min.x,vu.y=s.normal.y>0?e.max.y:e.min.y,vu.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(vu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class ub extends _a{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Mt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const fd=new fe,pd=new fe,pg=new Tn,kl=new Zd,gu=new Kd,jh=new fe,mg=new fe;class QC extends Rn{constructor(e=new Bs,t=new ub){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,r=t.count;s<r;s++)fd.fromBufferAttribute(t,s-1),pd.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=fd.distanceTo(pd);e.setAttribute("lineDistance",new Ls(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),gu.copy(n.boundingSphere),gu.applyMatrix4(s),gu.radius+=r,e.ray.intersectsSphere(gu)===!1)return;pg.copy(s).invert(),kl.copy(e.ray).applyMatrix4(pg);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=n.index,h=n.attributes.position;if(u!==null){const f=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);for(let m=f,_=p-1;m<_;m+=c){const v=u.getX(m),x=u.getX(m+1),y=yu(this,e,kl,l,v,x,m);y&&t.push(y)}if(this.isLineLoop){const m=u.getX(p-1),_=u.getX(f),v=yu(this,e,kl,l,m,_,p-1);v&&t.push(v)}}else{const f=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let m=f,_=p-1;m<_;m+=c){const v=yu(this,e,kl,l,m,m+1,m);v&&t.push(v)}if(this.isLineLoop){const m=yu(this,e,kl,l,p-1,f,p-1);m&&t.push(m)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}}function yu(i,e,t,n,s,r,a){const o=i.geometry.attributes.position;if(fd.fromBufferAttribute(o,s),pd.fromBufferAttribute(o,r),t.distanceSqToSegment(fd,pd,jh,mg)>n)return;jh.applyMatrix4(i.matrixWorld);const c=e.ray.origin.distanceTo(jh);if(!(c<e.near||c>e.far))return{distance:c,point:mg.clone().applyMatrix4(i.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:i}}class eP extends pi{constructor(e,t,n,s,r,a,o,l,c){super(e,t,n,s,r,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class db extends pi{constructor(e,t,n=no,s,r,a,o=wi,l=wi,c,u=yc,d=1){if(u!==yc&&u!==xc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const h={width:e,height:t,depth:d};super(h,s,r,a,o,l,u,n,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Nm(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class hb extends pi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class ul extends Bs{constructor(e=1,t=1,n=1,s=32,r=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const u=[],d=[],h=[],f=[];let p=0;const m=[],_=n/2;let v=0;x(),a===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new Ls(d,3)),this.setAttribute("normal",new Ls(h,3)),this.setAttribute("uv",new Ls(f,2));function x(){const g=new fe,w=new fe;let b=0;const T=(t-e)/n;for(let E=0;E<=r;E++){const S=[],M=E/r,A=M*(t-e)+e;for(let C=0;C<=s;C++){const I=C/s,H=I*l+o,W=Math.sin(H),z=Math.cos(H);w.x=A*W,w.y=-M*n+_,w.z=A*z,d.push(w.x,w.y,w.z),g.set(W,T,z).normalize(),h.push(g.x,g.y,g.z),f.push(I,1-M),S.push(p++)}m.push(S)}for(let E=0;E<s;E++)for(let S=0;S<r;S++){const M=m[S][E],A=m[S+1][E],C=m[S+1][E+1],I=m[S][E+1];(e>0||S!==0)&&(u.push(M,A,I),b+=3),(t>0||S!==r-1)&&(u.push(A,C,I),b+=3)}c.addGroup(v,b,0),v+=b}function y(g){const w=p,b=new Lt,T=new fe;let E=0;const S=g===!0?e:t,M=g===!0?1:-1;for(let C=1;C<=s;C++)d.push(0,_*M,0),h.push(0,M,0),f.push(.5,.5),p++;const A=p;for(let C=0;C<=s;C++){const H=C/s*l+o,W=Math.cos(H),z=Math.sin(H);T.x=S*z,T.y=_*M,T.z=S*W,d.push(T.x,T.y,T.z),h.push(0,M,0),b.x=W*.5+.5,b.y=z*.5*M+.5,f.push(b.x,b.y),p++}for(let C=0;C<s;C++){const I=w+C,H=A+C;g===!0?u.push(H,H+1,I):u.push(H+1,H,I),E+=3}c.addGroup(v,E,g===!0?1:2),v+=E}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ul(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class va extends Bs{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,a=t/2,o=Math.floor(n),l=Math.floor(s),c=o+1,u=l+1,d=e/o,h=t/l,f=[],p=[],m=[],_=[];for(let v=0;v<u;v++){const x=v*h-a;for(let y=0;y<c;y++){const g=y*d-r;p.push(g,-x,0),m.push(0,0,1),_.push(y/o),_.push(1-v/l)}}for(let v=0;v<l;v++)for(let x=0;x<o;x++){const y=x+c*v,g=x+c*(v+1),w=x+1+c*(v+1),b=x+1+c*v;f.push(y,g,b),f.push(g,w,b)}this.setIndex(f),this.setAttribute("position",new Ls(p,3)),this.setAttribute("normal",new Ls(m,3)),this.setAttribute("uv",new Ls(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new va(e.width,e.height,e.widthSegments,e.heightSegments)}}class xu extends _a{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Mt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jd,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Zi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tP extends _a{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Mt(16777215),this.specular=new Mt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jd,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Zi,this.combine=qd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class md extends _a{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jd,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Zi,this.combine=qd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nP extends _a{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hC,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class iP extends _a{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Kh={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class sP{constructor(e,t,n){const s=this;let r=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.abortController=new AbortController,this.itemStart=function(u){o++,r===!1&&s.onStart!==void 0&&s.onStart(u,a,o),r=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,o),a===o&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){const f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const rP=new sP;class Vm{constructor(e){this.manager=e!==void 0?e:rP,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,r){n.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Vm.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ro=new WeakMap;class aP extends Vm{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Kh.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0);else{let d=Ro.get(a);d===void 0&&(d=[],Ro.set(a,d)),d.push({onLoad:t,onError:s})}return a}const o=bc("img");function l(){u(),t&&t(this);const d=Ro.get(this)||[];for(let h=0;h<d.length;h++){const f=d[h];f.onLoad&&f.onLoad(this)}Ro.delete(this),r.manager.itemEnd(e)}function c(d){u(),s&&s(d),Kh.remove(`image:${e}`);const h=Ro.get(this)||[];for(let f=0;f<h.length;f++){const p=h[f];p.onError&&p.onError(d)}Ro.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Kh.add(`image:${e}`,o),r.manager.itemStart(e),o.src=e,o}}class fb extends Vm{constructor(e){super(e)}load(e,t,n,s){const r=new pi,a=new aP(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){r.image=o,r.needsUpdate=!0,t!==void 0&&t(r)},n,s),r}}class Jd extends Rn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Mt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class oP extends Jd{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Rn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Mt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Zh=new Tn,_g=new fe,vg=new fe;class pb{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Lt(512,512),this.mapType=Zs,this.map=null,this.mapPass=null,this.matrix=new Tn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zm,this._frameExtents=new Lt(1,1),this._viewportCount=1,this._viewports=[new Cn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_g.setFromMatrixPosition(e.matrixWorld),t.position.copy(_g),vg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(vg),t.updateMatrixWorld(),Zh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zh,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Zh)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class lP extends pb{constructor(){super(new An(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=hd*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;(n!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Qd extends Jd{constructor(e,t,n=0,s=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Rn.DEFAULT_UP),this.updateMatrix(),this.target=new Rn,this.distance=n,this.angle=s,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new lP}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class mb extends lb{constructor(e=-1,t=1,n=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,a=r+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class cP extends pb{constructor(){super(new mb(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Bn extends Jd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Rn.DEFAULT_UP),this.updateMatrix(),this.target=new Rn,this.shadow=new cP}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class bl extends Jd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class uP extends An{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}const gg=new Tn;class Gm{constructor(e,t,n=0,s=1/0){this.ray=new Zd(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new Fm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return gg.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(gg),this}intersectObject(e,t=!0,n=[]){return Np(e,this,n,t),n.sort(yg),n}intersectObjects(e,t=!0,n=[]){for(let s=0,r=e.length;s<r;s++)Np(e[s],this,n,t);return n.sort(yg),n}}function yg(i,e){return i.distance-e.distance}function Np(i,e,t,n){let s=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(s=!1),s===!0&&n===!0){const r=i.children;for(let a=0,o=r.length;a<o;a++)Np(r[a],e,t,!0)}}class xg{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Xt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Xt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class dP extends uo{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function bg(i,e,t,n){const s=hP(n);switch(t){case Zx:return i*e;case Qx:return i*e/s.components*s.byteLength;case km:return i*e/s.components*s.byteLength;case eb:return i*e*2/s.components*s.byteLength;case Bm:return i*e*2/s.components*s.byteLength;case Jx:return i*e*3/s.components*s.byteLength;case Ts:return i*e*4/s.components*s.byteLength;case Om:return i*e*4/s.components*s.byteLength;case zu:case Vu:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case Gu:case Hu:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case up:case hp:return Math.max(i,16)*Math.max(e,8)/4;case cp:case dp:return Math.max(i,8)*Math.max(e,8)/2;case fp:case pp:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case mp:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case _p:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case vp:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case gp:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case yp:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case xp:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case bp:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case wp:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Sp:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case Ep:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case Mp:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Tp:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Ap:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Cp:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case Pp:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Rp:case Lp:case Ip:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Dp:case kp:return Math.ceil(i/4)*Math.ceil(e/4)*8;case Bp:case Op:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function hP(i){switch(i){case Zs:case qx:return{byteLength:1,components:1};case vc:case Yx:case Oc:return{byteLength:2,components:1};case Im:case Dm:return{byteLength:2,components:4};case no:case Lm:case Sr:return{byteLength:4,components:1};case jx:case Kx:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Pm}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Pm);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function _b(){let i=null,e=!1,t=null,n=null;function s(r,a){t(r,a),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function fP(i){const e=new WeakMap;function t(o,l){const c=o.array,u=o.usage,d=c.byteLength,h=i.createBuffer();i.bindBuffer(l,h),i.bufferData(l,c,u),o.onUploadCallback();let f;if(c instanceof Float32Array)f=i.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)f=i.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?f=i.HALF_FLOAT:f=i.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=i.SHORT;else if(c instanceof Uint32Array)f=i.UNSIGNED_INT;else if(c instanceof Int32Array)f=i.INT;else if(c instanceof Int8Array)f=i.BYTE;else if(c instanceof Uint8Array)f=i.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:h,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:d}}function n(o,l,c){const u=l.array,d=l.updateRanges;if(i.bindBuffer(c,o),d.length===0)i.bufferSubData(c,0,u);else{d.sort((f,p)=>f.start-p.start);let h=0;for(let f=1;f<d.length;f++){const p=d[h],m=d[f];m.start<=p.start+p.count+1?p.count=Math.max(p.count,m.start+m.count-p.start):(++h,d[h]=m)}d.length=h+1;for(let f=0,p=d.length;f<p;f++){const m=d[f];i.bufferSubData(c,m.start*u.BYTES_PER_ELEMENT,u,m.start,m.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function r(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(i.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,t(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,o,l),c.version=o.version}}return{get:s,remove:r,update:a}}var pP=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,mP=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,_P=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,vP=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,gP=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,yP=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,xP=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,bP=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,wP=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,SP=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,EP=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,MP=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,TP=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,AP=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,CP=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,PP=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,RP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,LP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,IP=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,DP=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,kP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,BP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,OP=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,NP=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,FP=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,UP=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,zP=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,VP=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,GP=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,HP=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,WP="gl_FragColor = linearToOutputTexel( gl_FragColor );",$P=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,XP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,qP=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,YP=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,jP=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,KP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,ZP=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,JP=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,QP=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,eR=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,tR=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,nR=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,iR=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,sR=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,rR=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,aR=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,oR=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,cR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,uR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,dR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,hR=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,fR=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,pR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,mR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,_R=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,vR=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,gR=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,yR=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,xR=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,bR=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,wR=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,SR=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ER=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,MR=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,TR=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,AR=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,CR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,PR=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,RR=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,LR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,IR=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,DR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,BR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,OR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,NR=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,FR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,UR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,zR=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,VR=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,GR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,HR=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,WR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,$R=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,XR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,qR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,YR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,jR=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,KR=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,ZR=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,JR=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,QR=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,eL=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,tL=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,nL=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,iL=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,sL=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,rL=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,aL=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,oL=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,lL=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,cL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,dL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,hL=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const fL=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,pL=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,_L=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,gL=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yL=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,xL=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,bL=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,wL=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,SL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,EL=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ML=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,TL=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,AL=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,CL=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PL=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,RL=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,LL=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,IL=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DL=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,kL=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,BL=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,OL=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NL=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,FL=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UL=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zL=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VL=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,GL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,HL=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WL=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,$L=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,XL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Gt={alphahash_fragment:pP,alphahash_pars_fragment:mP,alphamap_fragment:_P,alphamap_pars_fragment:vP,alphatest_fragment:gP,alphatest_pars_fragment:yP,aomap_fragment:xP,aomap_pars_fragment:bP,batching_pars_vertex:wP,batching_vertex:SP,begin_vertex:EP,beginnormal_vertex:MP,bsdfs:TP,iridescence_fragment:AP,bumpmap_pars_fragment:CP,clipping_planes_fragment:PP,clipping_planes_pars_fragment:RP,clipping_planes_pars_vertex:LP,clipping_planes_vertex:IP,color_fragment:DP,color_pars_fragment:kP,color_pars_vertex:BP,color_vertex:OP,common:NP,cube_uv_reflection_fragment:FP,defaultnormal_vertex:UP,displacementmap_pars_vertex:zP,displacementmap_vertex:VP,emissivemap_fragment:GP,emissivemap_pars_fragment:HP,colorspace_fragment:WP,colorspace_pars_fragment:$P,envmap_fragment:XP,envmap_common_pars_fragment:qP,envmap_pars_fragment:YP,envmap_pars_vertex:jP,envmap_physical_pars_fragment:aR,envmap_vertex:KP,fog_vertex:ZP,fog_pars_vertex:JP,fog_fragment:QP,fog_pars_fragment:eR,gradientmap_pars_fragment:tR,lightmap_pars_fragment:nR,lights_lambert_fragment:iR,lights_lambert_pars_fragment:sR,lights_pars_begin:rR,lights_toon_fragment:oR,lights_toon_pars_fragment:lR,lights_phong_fragment:cR,lights_phong_pars_fragment:uR,lights_physical_fragment:dR,lights_physical_pars_fragment:hR,lights_fragment_begin:fR,lights_fragment_maps:pR,lights_fragment_end:mR,logdepthbuf_fragment:_R,logdepthbuf_pars_fragment:vR,logdepthbuf_pars_vertex:gR,logdepthbuf_vertex:yR,map_fragment:xR,map_pars_fragment:bR,map_particle_fragment:wR,map_particle_pars_fragment:SR,metalnessmap_fragment:ER,metalnessmap_pars_fragment:MR,morphinstance_vertex:TR,morphcolor_vertex:AR,morphnormal_vertex:CR,morphtarget_pars_vertex:PR,morphtarget_vertex:RR,normal_fragment_begin:LR,normal_fragment_maps:IR,normal_pars_fragment:DR,normal_pars_vertex:kR,normal_vertex:BR,normalmap_pars_fragment:OR,clearcoat_normal_fragment_begin:NR,clearcoat_normal_fragment_maps:FR,clearcoat_pars_fragment:UR,iridescence_pars_fragment:zR,opaque_fragment:VR,packing:GR,premultiplied_alpha_fragment:HR,project_vertex:WR,dithering_fragment:$R,dithering_pars_fragment:XR,roughnessmap_fragment:qR,roughnessmap_pars_fragment:YR,shadowmap_pars_fragment:jR,shadowmap_pars_vertex:KR,shadowmap_vertex:ZR,shadowmask_pars_fragment:JR,skinbase_vertex:QR,skinning_pars_vertex:eL,skinning_vertex:tL,skinnormal_vertex:nL,specularmap_fragment:iL,specularmap_pars_fragment:sL,tonemapping_fragment:rL,tonemapping_pars_fragment:aL,transmission_fragment:oL,transmission_pars_fragment:lL,uv_pars_fragment:cL,uv_pars_vertex:uL,uv_vertex:dL,worldpos_vertex:hL,background_vert:fL,background_frag:pL,backgroundCube_vert:mL,backgroundCube_frag:_L,cube_vert:vL,cube_frag:gL,depth_vert:yL,depth_frag:xL,distanceRGBA_vert:bL,distanceRGBA_frag:wL,equirect_vert:SL,equirect_frag:EL,linedashed_vert:ML,linedashed_frag:TL,meshbasic_vert:AL,meshbasic_frag:CL,meshlambert_vert:PL,meshlambert_frag:RL,meshmatcap_vert:LL,meshmatcap_frag:IL,meshnormal_vert:DL,meshnormal_frag:kL,meshphong_vert:BL,meshphong_frag:OL,meshphysical_vert:NL,meshphysical_frag:FL,meshtoon_vert:UL,meshtoon_frag:zL,points_vert:VL,points_frag:GL,shadow_vert:HL,shadow_frag:WL,sprite_vert:$L,sprite_frag:XL},ot={common:{diffuse:{value:new Mt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ut}},envmap:{envMap:{value:null},envMapRotation:{value:new Ut},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ut}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ut}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ut},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ut},normalScale:{value:new Lt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ut},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ut}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ut}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ut}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Mt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Mt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0},uvTransform:{value:new Ut}},sprite:{diffuse:{value:new Mt(16777215)},opacity:{value:1},center:{value:new Lt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}}},Hs={basic:{uniforms:vi([ot.common,ot.specularmap,ot.envmap,ot.aomap,ot.lightmap,ot.fog]),vertexShader:Gt.meshbasic_vert,fragmentShader:Gt.meshbasic_frag},lambert:{uniforms:vi([ot.common,ot.specularmap,ot.envmap,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.fog,ot.lights,{emissive:{value:new Mt(0)}}]),vertexShader:Gt.meshlambert_vert,fragmentShader:Gt.meshlambert_frag},phong:{uniforms:vi([ot.common,ot.specularmap,ot.envmap,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.fog,ot.lights,{emissive:{value:new Mt(0)},specular:{value:new Mt(1118481)},shininess:{value:30}}]),vertexShader:Gt.meshphong_vert,fragmentShader:Gt.meshphong_frag},standard:{uniforms:vi([ot.common,ot.envmap,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.roughnessmap,ot.metalnessmap,ot.fog,ot.lights,{emissive:{value:new Mt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Gt.meshphysical_vert,fragmentShader:Gt.meshphysical_frag},toon:{uniforms:vi([ot.common,ot.aomap,ot.lightmap,ot.emissivemap,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.gradientmap,ot.fog,ot.lights,{emissive:{value:new Mt(0)}}]),vertexShader:Gt.meshtoon_vert,fragmentShader:Gt.meshtoon_frag},matcap:{uniforms:vi([ot.common,ot.bumpmap,ot.normalmap,ot.displacementmap,ot.fog,{matcap:{value:null}}]),vertexShader:Gt.meshmatcap_vert,fragmentShader:Gt.meshmatcap_frag},points:{uniforms:vi([ot.points,ot.fog]),vertexShader:Gt.points_vert,fragmentShader:Gt.points_frag},dashed:{uniforms:vi([ot.common,ot.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Gt.linedashed_vert,fragmentShader:Gt.linedashed_frag},depth:{uniforms:vi([ot.common,ot.displacementmap]),vertexShader:Gt.depth_vert,fragmentShader:Gt.depth_frag},normal:{uniforms:vi([ot.common,ot.bumpmap,ot.normalmap,ot.displacementmap,{opacity:{value:1}}]),vertexShader:Gt.meshnormal_vert,fragmentShader:Gt.meshnormal_frag},sprite:{uniforms:vi([ot.sprite,ot.fog]),vertexShader:Gt.sprite_vert,fragmentShader:Gt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ut},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Gt.background_vert,fragmentShader:Gt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ut}},vertexShader:Gt.backgroundCube_vert,fragmentShader:Gt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Gt.cube_vert,fragmentShader:Gt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Gt.equirect_vert,fragmentShader:Gt.equirect_frag},distanceRGBA:{uniforms:vi([ot.common,ot.displacementmap,{referencePosition:{value:new fe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Gt.distanceRGBA_vert,fragmentShader:Gt.distanceRGBA_frag},shadow:{uniforms:vi([ot.lights,ot.fog,{color:{value:new Mt(0)},opacity:{value:1}}]),vertexShader:Gt.shadow_vert,fragmentShader:Gt.shadow_frag}};Hs.physical={uniforms:vi([Hs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ut},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ut},clearcoatNormalScale:{value:new Lt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ut},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ut},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ut},sheen:{value:0},sheenColor:{value:new Mt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ut},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ut},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ut},transmissionSamplerSize:{value:new Lt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ut},attenuationDistance:{value:0},attenuationColor:{value:new Mt(0)},specularColor:{value:new Mt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ut},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ut},anisotropyVector:{value:new Lt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ut}}]),vertexShader:Gt.meshphysical_vert,fragmentShader:Gt.meshphysical_frag};const bu={r:0,b:0,g:0},Ia=new Zi,qL=new Tn;function YL(i,e,t,n,s,r,a){const o=new Mt(0);let l=r===!0?0:1,c,u,d=null,h=0,f=null;function p(y){let g=y.isScene===!0?y.background:null;return g&&g.isTexture&&(g=(y.backgroundBlurriness>0?t:e).get(g)),g}function m(y){let g=!1;const w=p(y);w===null?v(o,l):w&&w.isColor&&(v(w,1),g=!0);const b=i.xr.getEnvironmentBlendMode();b==="additive"?n.buffers.color.setClear(0,0,0,1,a):b==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(i.autoClear||g)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function _(y,g){const w=p(g);w&&(w.isCubeTexture||w.mapping===Yd)?(u===void 0&&(u=new yn(new ji(1,1,1),new oa({name:"BackgroundCubeMaterial",uniforms:cl(Hs.backgroundCube.uniforms),vertexShader:Hs.backgroundCube.vertexShader,fragmentShader:Hs.backgroundCube.fragmentShader,side:Di,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(b,T,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),Ia.copy(g.backgroundRotation),Ia.x*=-1,Ia.y*=-1,Ia.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Ia.y*=-1,Ia.z*=-1),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(qL.makeRotationFromEuler(Ia)),u.material.toneMapped=tn.getTransfer(w.colorSpace)!==ln,(d!==w||h!==w.version||f!==i.toneMapping)&&(u.material.needsUpdate=!0,d=w,h=w.version,f=i.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new yn(new va(2,2),new oa({name:"BackgroundMaterial",uniforms:cl(Hs.background.uniforms),vertexShader:Hs.background.vertexShader,fragmentShader:Hs.background.fragmentShader,side:aa,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=tn.getTransfer(w.colorSpace)!==ln,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(d!==w||h!==w.version||f!==i.toneMapping)&&(c.material.needsUpdate=!0,d=w,h=w.version,f=i.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null))}function v(y,g){y.getRGB(bu,ob(i)),n.buffers.color.setClear(bu.r,bu.g,bu.b,g,a)}function x(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(y,g=1){o.set(y),l=g,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,v(o,l)},render:m,addToRenderList:_,dispose:x}}function jL(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},s=h(null);let r=s,a=!1;function o(M,A,C,I,H){let W=!1;const z=d(I,C,A);r!==z&&(r=z,c(r.object)),W=f(M,I,C,H),W&&p(M,I,C,H),H!==null&&e.update(H,i.ELEMENT_ARRAY_BUFFER),(W||a)&&(a=!1,g(M,A,C,I),H!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(H).buffer))}function l(){return i.createVertexArray()}function c(M){return i.bindVertexArray(M)}function u(M){return i.deleteVertexArray(M)}function d(M,A,C){const I=C.wireframe===!0;let H=n[M.id];H===void 0&&(H={},n[M.id]=H);let W=H[A.id];W===void 0&&(W={},H[A.id]=W);let z=W[I];return z===void 0&&(z=h(l()),W[I]=z),z}function h(M){const A=[],C=[],I=[];for(let H=0;H<t;H++)A[H]=0,C[H]=0,I[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:A,enabledAttributes:C,attributeDivisors:I,object:M,attributes:{},index:null}}function f(M,A,C,I){const H=r.attributes,W=A.attributes;let z=0;const q=C.getAttributes();for(const O in q)if(q[O].location>=0){const le=H[O];let Z=W[O];if(Z===void 0&&(O==="instanceMatrix"&&M.instanceMatrix&&(Z=M.instanceMatrix),O==="instanceColor"&&M.instanceColor&&(Z=M.instanceColor)),le===void 0||le.attribute!==Z||Z&&le.data!==Z.data)return!0;z++}return r.attributesNum!==z||r.index!==I}function p(M,A,C,I){const H={},W=A.attributes;let z=0;const q=C.getAttributes();for(const O in q)if(q[O].location>=0){let le=W[O];le===void 0&&(O==="instanceMatrix"&&M.instanceMatrix&&(le=M.instanceMatrix),O==="instanceColor"&&M.instanceColor&&(le=M.instanceColor));const Z={};Z.attribute=le,le&&le.data&&(Z.data=le.data),H[O]=Z,z++}r.attributes=H,r.attributesNum=z,r.index=I}function m(){const M=r.newAttributes;for(let A=0,C=M.length;A<C;A++)M[A]=0}function _(M){v(M,0)}function v(M,A){const C=r.newAttributes,I=r.enabledAttributes,H=r.attributeDivisors;C[M]=1,I[M]===0&&(i.enableVertexAttribArray(M),I[M]=1),H[M]!==A&&(i.vertexAttribDivisor(M,A),H[M]=A)}function x(){const M=r.newAttributes,A=r.enabledAttributes;for(let C=0,I=A.length;C<I;C++)A[C]!==M[C]&&(i.disableVertexAttribArray(C),A[C]=0)}function y(M,A,C,I,H,W,z){z===!0?i.vertexAttribIPointer(M,A,C,H,W):i.vertexAttribPointer(M,A,C,I,H,W)}function g(M,A,C,I){m();const H=I.attributes,W=C.getAttributes(),z=A.defaultAttributeValues;for(const q in W){const O=W[q];if(O.location>=0){let re=H[q];if(re===void 0&&(q==="instanceMatrix"&&M.instanceMatrix&&(re=M.instanceMatrix),q==="instanceColor"&&M.instanceColor&&(re=M.instanceColor)),re!==void 0){const le=re.normalized,Z=re.itemSize,ne=e.get(re);if(ne===void 0)continue;const j=ne.buffer,ee=ne.type,F=ne.bytesPerElement,X=ee===i.INT||ee===i.UNSIGNED_INT||re.gpuType===Lm;if(re.isInterleavedBufferAttribute){const Q=re.data,ue=Q.stride,ce=re.offset;if(Q.isInstancedInterleavedBuffer){for(let xe=0;xe<O.locationSize;xe++)v(O.location+xe,Q.meshPerAttribute);M.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let xe=0;xe<O.locationSize;xe++)_(O.location+xe);i.bindBuffer(i.ARRAY_BUFFER,j);for(let xe=0;xe<O.locationSize;xe++)y(O.location+xe,Z/O.locationSize,ee,le,ue*F,(ce+Z/O.locationSize*xe)*F,X)}else{if(re.isInstancedBufferAttribute){for(let Q=0;Q<O.locationSize;Q++)v(O.location+Q,re.meshPerAttribute);M.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=re.meshPerAttribute*re.count)}else for(let Q=0;Q<O.locationSize;Q++)_(O.location+Q);i.bindBuffer(i.ARRAY_BUFFER,j);for(let Q=0;Q<O.locationSize;Q++)y(O.location+Q,Z/O.locationSize,ee,le,Z*F,Z/O.locationSize*Q*F,X)}}else if(z!==void 0){const le=z[q];if(le!==void 0)switch(le.length){case 2:i.vertexAttrib2fv(O.location,le);break;case 3:i.vertexAttrib3fv(O.location,le);break;case 4:i.vertexAttrib4fv(O.location,le);break;default:i.vertexAttrib1fv(O.location,le)}}}}x()}function w(){E();for(const M in n){const A=n[M];for(const C in A){const I=A[C];for(const H in I)u(I[H].object),delete I[H];delete A[C]}delete n[M]}}function b(M){if(n[M.id]===void 0)return;const A=n[M.id];for(const C in A){const I=A[C];for(const H in I)u(I[H].object),delete I[H];delete A[C]}delete n[M.id]}function T(M){for(const A in n){const C=n[A];if(C[M.id]===void 0)continue;const I=C[M.id];for(const H in I)u(I[H].object),delete I[H];delete C[M.id]}}function E(){S(),a=!0,r!==s&&(r=s,c(r.object))}function S(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:o,reset:E,resetDefaultState:S,dispose:w,releaseStatesOfGeometry:b,releaseStatesOfProgram:T,initAttributes:m,enableAttribute:_,disableUnusedAttributes:x}}function KL(i,e,t){let n;function s(c){n=c}function r(c,u){i.drawArrays(n,c,u),t.update(u,n,1)}function a(c,u,d){d!==0&&(i.drawArraysInstanced(n,c,u,d),t.update(u,n,d))}function o(c,u,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,u,0,d);let f=0;for(let p=0;p<d;p++)f+=u[p];t.update(f,n,1)}function l(c,u,d,h){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<c.length;p++)a(c[p],u[p],h[p]);else{f.multiDrawArraysInstancedWEBGL(n,c,0,u,0,h,0,d);let p=0;for(let m=0;m<d;m++)p+=u[m]*h[m];t.update(p,n,1)}}this.setMode=s,this.render=r,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function ZL(i,e,t,n){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const T=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function a(T){return!(T!==Ts&&n.convert(T)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(T){const E=T===Oc&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(T!==Zs&&n.convert(T)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&T!==Sr&&!E)}function l(T){if(T==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return T==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const d=t.logarithmicDepthBuffer===!0,h=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),f=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),p=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=i.getParameter(i.MAX_TEXTURE_SIZE),_=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),v=i.getParameter(i.MAX_VERTEX_ATTRIBS),x=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),y=i.getParameter(i.MAX_VARYING_VECTORS),g=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),w=p>0,b=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:d,reversedDepthBuffer:h,maxTextures:f,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:_,maxAttributes:v,maxVertexUniforms:x,maxVaryings:y,maxFragmentUniforms:g,vertexTextures:w,maxSamples:b}}function JL(i){const e=this;let t=null,n=0,s=!1,r=!1;const a=new xs,o=new Ut,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=d.length!==0||h||n!==0||s;return s=h,n=d.length,f},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const p=d.clippingPlanes,m=d.clipIntersection,_=d.clipShadows,v=i.get(d);if(!s||p===null||p.length===0||r&&!_)r?u(null):c();else{const x=r?0:n,y=x*4;let g=v.clippingState||null;l.value=g,g=u(p,h,y,f);for(let w=0;w!==y;++w)g[w]=t[w];v.clippingState=g,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(d,h,f,p){const m=d!==null?d.length:0;let _=null;if(m!==0){if(_=l.value,p!==!0||_===null){const v=f+m*4,x=h.matrixWorldInverse;o.getNormalMatrix(x),(_===null||_.length<v)&&(_=new Float32Array(v));for(let y=0,g=f;y!==m;++y,g+=4)a.copy(d[y]).applyMatrix4(x,o),a.normal.toArray(_,g),_[g+3]=a.constant}l.value=_,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,_}}function QL(i){let e=new WeakMap;function t(a,o){return o===rp?a.mapping=al:o===ap&&(a.mapping=ol),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===rp||o===ap)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new YC(l.height);return c.fromEquirectangularTexture(i,a),e.set(a,c),a.addEventListener("dispose",s),t(c.texture,a.mapping)}else return null}}return a}function s(a){const o=a.target;o.removeEventListener("dispose",s);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}const zo=4,wg=[.125,.215,.35,.446,.526,.582],Wa=20,Jh=new mb,Sg=new Mt;let Qh=null,ef=0,tf=0,nf=!1;const Ua=(1+Math.sqrt(5))/2,Lo=1/Ua,Eg=[new fe(-Ua,Lo,0),new fe(Ua,Lo,0),new fe(-Lo,0,Ua),new fe(Lo,0,Ua),new fe(0,Ua,-Lo),new fe(0,Ua,Lo),new fe(-1,1,-1),new fe(1,1,-1),new fe(-1,1,1),new fe(1,1,1)],eI=new fe;class Mg{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100,r={}){const{size:a=256,position:o=eI}=r;Qh=this._renderer.getRenderTarget(),ef=this._renderer.getActiveCubeFace(),tf=this._renderer.getActiveMipmapLevel(),nf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,s,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Cg(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Ag(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Qh,ef,tf),this._renderer.xr.enabled=nf,e.scissorTest=!1,wu(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===al||e.mapping===ol?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Qh=this._renderer.getRenderTarget(),ef=this._renderer.getActiveCubeFace(),tf=this._renderer.getActiveMipmapLevel(),nf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Xs,minFilter:Xs,generateMipmaps:!1,type:Oc,format:Ts,colorSpace:ll,depthBuffer:!1},s=Tg(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Tg(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=tI(r)),this._blurMaterial=nI(r,e,t)}return s}_compileMaterial(e){const t=new yn(this._lodPlanes[0],e);this._renderer.compile(t,Jh)}_sceneToCubeUV(e,t,n,s,r){const l=new An(90,1,t,n),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],d=this._renderer,h=d.autoClear,f=d.toneMapping;d.getClearColor(Sg),d.toneMapping=Qr,d.autoClear=!1,d.state.buffers.depth.getReversed()&&(d.setRenderTarget(s),d.clearDepth(),d.setRenderTarget(null));const m=new xl({name:"PMREM.Background",side:Di,depthWrite:!1,depthTest:!1}),_=new yn(new ji,m);let v=!1;const x=e.background;x?x.isColor&&(m.color.copy(x),e.background=null,v=!0):(m.color.copy(Sg),v=!0);for(let y=0;y<6;y++){const g=y%3;g===0?(l.up.set(0,c[y],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x+u[y],r.y,r.z)):g===1?(l.up.set(0,0,c[y]),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y+u[y],r.z)):(l.up.set(0,c[y],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y,r.z+u[y]));const w=this._cubeSize;wu(s,g*w,y>2?w:0,w,w),d.setRenderTarget(s),v&&d.render(_,l),d.render(e,l)}_.geometry.dispose(),_.material.dispose(),d.toneMapping=f,d.autoClear=h,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===al||e.mapping===ol;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=Cg()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Ag());const r=s?this._cubemapMaterial:this._equirectMaterial,a=new yn(this._lodPlanes[0],r),o=r.uniforms;o.envMap.value=e;const l=this._cubeSize;wu(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,Jh)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=Eg[(s-r-1)%Eg.length];this._blur(e,r-1,r,a,o)}t.autoClear=n}_blur(e,t,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,s,"latitudinal",r),this._halfBlur(a,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new yn(this._lodPlanes[s],c),h=c.uniforms,f=this._sizeLods[n]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*Wa-1),m=r/p,_=isFinite(r)?1+Math.floor(u*m):Wa;_>Wa&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${Wa}`);const v=[];let x=0;for(let T=0;T<Wa;++T){const E=T/m,S=Math.exp(-E*E/2);v.push(S),T===0?x+=S:T<_&&(x+=2*S)}for(let T=0;T<v.length;T++)v[T]=v[T]/x;h.envMap.value=e.texture,h.samples.value=_,h.weights.value=v,h.latitudinal.value=a==="latitudinal",o&&(h.poleAxis.value=o);const{_lodMax:y}=this;h.dTheta.value=p,h.mipInt.value=y-n;const g=this._sizeLods[s],w=3*g*(s>y-zo?s-y+zo:0),b=4*(this._cubeSize-g);wu(t,w,b,3*g,2*g),l.setRenderTarget(t),l.render(d,Jh)}}function tI(i){const e=[],t=[],n=[];let s=i;const r=i-zo+1+wg.length;for(let a=0;a<r;a++){const o=Math.pow(2,s);t.push(o);let l=1/o;a>i-zo?l=wg[a-i+zo-1]:a===0&&(l=0),n.push(l);const c=1/(o-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,m=3,_=2,v=1,x=new Float32Array(m*p*f),y=new Float32Array(_*p*f),g=new Float32Array(v*p*f);for(let b=0;b<f;b++){const T=b%3*2/3-1,E=b>2?0:-1,S=[T,E,0,T+2/3,E,0,T+2/3,E+1,0,T,E,0,T+2/3,E+1,0,T,E+1,0];x.set(S,m*p*b),y.set(h,_*p*b);const M=[b,b,b,b,b,b];g.set(M,v*p*b)}const w=new Bs;w.setAttribute("position",new Rs(x,m)),w.setAttribute("uv",new Rs(y,_)),w.setAttribute("faceIndex",new Rs(g,v)),e.push(w),s>zo&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function Tg(i,e,t){const n=new so(i,e,t);return n.texture.mapping=Yd,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function wu(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function nI(i,e,t){const n=new Float32Array(Wa),s=new fe(0,1,0);return new oa({name:"SphericalGaussianBlur",defines:{n:Wa,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Hm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Jr,depthTest:!1,depthWrite:!1})}function Ag(){return new oa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Hm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Jr,depthTest:!1,depthWrite:!1})}function Cg(){return new oa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Hm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Jr,depthTest:!1,depthWrite:!1})}function Hm(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function iI(i){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const l=o.mapping,c=l===rp||l===ap,u=l===al||l===ol;if(c||u){let d=e.get(o);const h=d!==void 0?d.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==h)return t===null&&(t=new Mg(i)),d=c?t.fromEquirectangular(o,d):t.fromCubemap(o,d),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),d.texture;if(d!==void 0)return d.texture;{const f=o.image;return c&&f&&f.height>0||u&&f&&s(f)?(t===null&&(t=new Mg(i)),d=c?t.fromEquirectangular(o):t.fromCubemap(o),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),o.addEventListener("dispose",r),d.texture):null}}}return o}function s(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function r(o){const l=o.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function sI(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const s=t(n);return s===null&&wc("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function rI(i,e,t,n){const s={},r=new WeakMap;function a(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",a),delete s[h.id];const f=r.get(h);f&&(e.remove(f),r.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function o(d,h){return s[h.id]===!0||(h.addEventListener("dispose",a),s[h.id]=!0,t.memory.geometries++),h}function l(d){const h=d.attributes;for(const f in h)e.update(h[f],i.ARRAY_BUFFER)}function c(d){const h=[],f=d.index,p=d.attributes.position;let m=0;if(f!==null){const x=f.array;m=f.version;for(let y=0,g=x.length;y<g;y+=3){const w=x[y+0],b=x[y+1],T=x[y+2];h.push(w,b,b,T,T,w)}}else if(p!==void 0){const x=p.array;m=p.version;for(let y=0,g=x.length/3-1;y<g;y+=3){const w=y+0,b=y+1,T=y+2;h.push(w,b,b,T,T,w)}}else return;const _=new(nb(h)?ab:rb)(h,1);_.version=m;const v=r.get(d);v&&e.remove(v),r.set(d,_)}function u(d){const h=r.get(d);if(h){const f=d.index;f!==null&&h.version<f.version&&c(d)}else c(d);return r.get(d)}return{get:o,update:l,getWireframeAttribute:u}}function aI(i,e,t){let n;function s(h){n=h}let r,a;function o(h){r=h.type,a=h.bytesPerElement}function l(h,f){i.drawElements(n,f,r,h*a),t.update(f,n,1)}function c(h,f,p){p!==0&&(i.drawElementsInstanced(n,f,r,h*a,p),t.update(f,n,p))}function u(h,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,f,0,r,h,0,p);let _=0;for(let v=0;v<p;v++)_+=f[v];t.update(_,n,1)}function d(h,f,p,m){if(p===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let v=0;v<h.length;v++)c(h[v]/a,f[v],m[v]);else{_.multiDrawElementsInstancedWEBGL(n,f,0,r,h,0,m,0,p);let v=0;for(let x=0;x<p;x++)v+=f[x]*m[x];t.update(v,n,1)}}this.setMode=s,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function oI(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,o){switch(t.calls++,a){case i.TRIANGLES:t.triangles+=o*(r/3);break;case i.LINES:t.lines+=o*(r/2);break;case i.LINE_STRIP:t.lines+=o*(r-1);break;case i.LINE_LOOP:t.lines+=o*r;break;case i.POINTS:t.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function lI(i,e,t){const n=new WeakMap,s=new Cn;function r(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,d=u!==void 0?u.length:0;let h=n.get(o);if(h===void 0||h.count!==d){let S=function(){T.dispose(),n.delete(o),o.removeEventListener("dispose",S)};h!==void 0&&h.texture.dispose();const f=o.morphAttributes.position!==void 0,p=o.morphAttributes.normal!==void 0,m=o.morphAttributes.color!==void 0,_=o.morphAttributes.position||[],v=o.morphAttributes.normal||[],x=o.morphAttributes.color||[];let y=0;f===!0&&(y=1),p===!0&&(y=2),m===!0&&(y=3);let g=o.attributes.position.count*y,w=1;g>e.maxTextureSize&&(w=Math.ceil(g/e.maxTextureSize),g=e.maxTextureSize);const b=new Float32Array(g*w*4*d),T=new ib(b,g,w,d);T.type=Sr,T.needsUpdate=!0;const E=y*4;for(let M=0;M<d;M++){const A=_[M],C=v[M],I=x[M],H=g*w*4*M;for(let W=0;W<A.count;W++){const z=W*E;f===!0&&(s.fromBufferAttribute(A,W),b[H+z+0]=s.x,b[H+z+1]=s.y,b[H+z+2]=s.z,b[H+z+3]=0),p===!0&&(s.fromBufferAttribute(C,W),b[H+z+4]=s.x,b[H+z+5]=s.y,b[H+z+6]=s.z,b[H+z+7]=0),m===!0&&(s.fromBufferAttribute(I,W),b[H+z+8]=s.x,b[H+z+9]=s.y,b[H+z+10]=s.z,b[H+z+11]=I.itemSize===4?s.w:1)}}h={count:d,texture:T,size:new Lt(g,w)},n.set(o,h),o.addEventListener("dispose",S)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let f=0;for(let m=0;m<c.length;m++)f+=c[m];const p=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(i,"morphTargetBaseInfluence",p),l.getUniforms().setValue(i,"morphTargetInfluences",c)}l.getUniforms().setValue(i,"morphTargetsTexture",h.texture,t),l.getUniforms().setValue(i,"morphTargetsTextureSize",h.size)}return{update:r}}function cI(i,e,t,n){let s=new WeakMap;function r(l){const c=n.render.frame,u=l.geometry,d=e.get(l,u);if(s.get(d)!==c&&(e.update(d),s.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),s.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const h=l.skeleton;s.get(h)!==c&&(h.update(),s.set(h,c))}return d}function a(){s=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:a}}const vb=new pi,Pg=new db(1,1),gb=new ib,yb=new LC,xb=new cb,Rg=[],Lg=[],Ig=new Float32Array(16),Dg=new Float32Array(9),kg=new Float32Array(4);function wl(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=Rg[s];if(r===void 0&&(r=new Float32Array(s),Rg[s]=r),e!==0){n.toArray(r,0);for(let a=1,o=0;a!==e;++a)o+=t,i[a].toArray(r,o)}return r}function Yn(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function jn(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function eh(i,e){let t=Lg[e];t===void 0&&(t=new Int32Array(e),Lg[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function uI(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function dI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yn(t,e))return;i.uniform2fv(this.addr,e),jn(t,e)}}function hI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Yn(t,e))return;i.uniform3fv(this.addr,e),jn(t,e)}}function fI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yn(t,e))return;i.uniform4fv(this.addr,e),jn(t,e)}}function pI(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Yn(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),jn(t,e)}else{if(Yn(t,n))return;kg.set(n),i.uniformMatrix2fv(this.addr,!1,kg),jn(t,n)}}function mI(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Yn(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),jn(t,e)}else{if(Yn(t,n))return;Dg.set(n),i.uniformMatrix3fv(this.addr,!1,Dg),jn(t,n)}}function _I(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Yn(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),jn(t,e)}else{if(Yn(t,n))return;Ig.set(n),i.uniformMatrix4fv(this.addr,!1,Ig),jn(t,n)}}function vI(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function gI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yn(t,e))return;i.uniform2iv(this.addr,e),jn(t,e)}}function yI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Yn(t,e))return;i.uniform3iv(this.addr,e),jn(t,e)}}function xI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yn(t,e))return;i.uniform4iv(this.addr,e),jn(t,e)}}function bI(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function wI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yn(t,e))return;i.uniform2uiv(this.addr,e),jn(t,e)}}function SI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Yn(t,e))return;i.uniform3uiv(this.addr,e),jn(t,e)}}function EI(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yn(t,e))return;i.uniform4uiv(this.addr,e),jn(t,e)}}function MI(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s);let r;this.type===i.SAMPLER_2D_SHADOW?(Pg.compareFunction=tb,r=Pg):r=vb,t.setTexture2D(e||r,s)}function TI(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||yb,s)}function AI(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||xb,s)}function CI(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||gb,s)}function PI(i){switch(i){case 5126:return uI;case 35664:return dI;case 35665:return hI;case 35666:return fI;case 35674:return pI;case 35675:return mI;case 35676:return _I;case 5124:case 35670:return vI;case 35667:case 35671:return gI;case 35668:case 35672:return yI;case 35669:case 35673:return xI;case 5125:return bI;case 36294:return wI;case 36295:return SI;case 36296:return EI;case 35678:case 36198:case 36298:case 36306:case 35682:return MI;case 35679:case 36299:case 36307:return TI;case 35680:case 36300:case 36308:case 36293:return AI;case 36289:case 36303:case 36311:case 36292:return CI}}function RI(i,e){i.uniform1fv(this.addr,e)}function LI(i,e){const t=wl(e,this.size,2);i.uniform2fv(this.addr,t)}function II(i,e){const t=wl(e,this.size,3);i.uniform3fv(this.addr,t)}function DI(i,e){const t=wl(e,this.size,4);i.uniform4fv(this.addr,t)}function kI(i,e){const t=wl(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function BI(i,e){const t=wl(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function OI(i,e){const t=wl(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function NI(i,e){i.uniform1iv(this.addr,e)}function FI(i,e){i.uniform2iv(this.addr,e)}function UI(i,e){i.uniform3iv(this.addr,e)}function zI(i,e){i.uniform4iv(this.addr,e)}function VI(i,e){i.uniform1uiv(this.addr,e)}function GI(i,e){i.uniform2uiv(this.addr,e)}function HI(i,e){i.uniform3uiv(this.addr,e)}function WI(i,e){i.uniform4uiv(this.addr,e)}function $I(i,e,t){const n=this.cache,s=e.length,r=eh(t,s);Yn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let a=0;a!==s;++a)t.setTexture2D(e[a]||vb,r[a])}function XI(i,e,t){const n=this.cache,s=e.length,r=eh(t,s);Yn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let a=0;a!==s;++a)t.setTexture3D(e[a]||yb,r[a])}function qI(i,e,t){const n=this.cache,s=e.length,r=eh(t,s);Yn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let a=0;a!==s;++a)t.setTextureCube(e[a]||xb,r[a])}function YI(i,e,t){const n=this.cache,s=e.length,r=eh(t,s);Yn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let a=0;a!==s;++a)t.setTexture2DArray(e[a]||gb,r[a])}function jI(i){switch(i){case 5126:return RI;case 35664:return LI;case 35665:return II;case 35666:return DI;case 35674:return kI;case 35675:return BI;case 35676:return OI;case 5124:case 35670:return NI;case 35667:case 35671:return FI;case 35668:case 35672:return UI;case 35669:case 35673:return zI;case 5125:return VI;case 36294:return GI;case 36295:return HI;case 36296:return WI;case 35678:case 36198:case 36298:case 36306:case 35682:return $I;case 35679:case 36299:case 36307:return XI;case 35680:case 36300:case 36308:case 36293:return qI;case 36289:case 36303:case 36311:case 36292:return YI}}class KI{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=PI(t.type)}}class ZI{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=jI(t.type)}}class JI{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,a=s.length;r!==a;++r){const o=s[r];o.setValue(e,t[o.id],n)}}}const sf=/(\w+)(\])?(\[|\.)?/g;function Bg(i,e){i.seq.push(e),i.map[e.id]=e}function QI(i,e,t){const n=i.name,s=n.length;for(sf.lastIndex=0;;){const r=sf.exec(n),a=sf.lastIndex;let o=r[1];const l=r[2]==="]",c=r[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===s){Bg(t,c===void 0?new KI(o,i,e):new ZI(o,i,e));break}else{let d=t.map[o];d===void 0&&(d=new JI(o),Bg(t,d)),t=d}}}class $u{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),a=e.getUniformLocation(t,r.name);QI(r,a,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,a=t.length;r!==a;++r){const o=t[r],l=n[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const a=e[s];a.id in t&&n.push(a)}return n}}function Og(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const e2=37297;let t2=0;function n2(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let a=s;a<r;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}const Ng=new Ut;function i2(i){tn._getMatrix(Ng,tn.workingColorSpace,i);const e=`mat3( ${Ng.elements.map(t=>t.toFixed(4))} )`;switch(tn.getTransfer(i)){case ud:return[e,"LinearTransferOETF"];case ln:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function Fg(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=(i.getShaderInfoLog(e)||"").trim();if(n&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+r+`

`+n2(i.getShaderSource(e),o)}else return r}function s2(i,e){const t=i2(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function r2(i,e){let t;switch(e){case sC:t="Linear";break;case rC:t="Reinhard";break;case aC:t="Cineon";break;case oC:t="ACESFilmic";break;case cC:t="AgX";break;case uC:t="Neutral";break;case lC:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Su=new fe;function a2(){tn.getLuminanceCoefficients(Su);const i=Su.x.toFixed(4),e=Su.y.toFixed(4),t=Su.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function o2(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Gl).join(`
`)}function l2(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function c2(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),a=r.name;let o=1;r.type===i.FLOAT_MAT2&&(o=2),r.type===i.FLOAT_MAT3&&(o=3),r.type===i.FLOAT_MAT4&&(o=4),t[a]={type:r.type,location:i.getAttribLocation(e,a),locationSize:o}}return t}function Gl(i){return i!==""}function Ug(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function zg(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const u2=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fp(i){return i.replace(u2,h2)}const d2=new Map;function h2(i,e){let t=Gt[e];if(t===void 0){const n=d2.get(e);if(n!==void 0)t=Gt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Fp(t)}const f2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Vg(i){return i.replace(f2,p2)}function p2(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function Gg(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function m2(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===$x?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===Rm?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===mr&&(e="SHADOWMAP_TYPE_VSM"),e}function _2(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case al:case ol:e="ENVMAP_TYPE_CUBE";break;case Yd:e="ENVMAP_TYPE_CUBE_UV";break}return e}function v2(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case ol:e="ENVMAP_MODE_REFRACTION";break}return e}function g2(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case qd:e="ENVMAP_BLENDING_MULTIPLY";break;case nC:e="ENVMAP_BLENDING_MIX";break;case iC:e="ENVMAP_BLENDING_ADD";break}return e}function y2(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function x2(i,e,t,n){const s=i.getContext(),r=t.defines;let a=t.vertexShader,o=t.fragmentShader;const l=m2(t),c=_2(t),u=v2(t),d=g2(t),h=y2(t),f=o2(t),p=l2(r),m=s.createProgram();let _,v,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(Gl).join(`
`),_.length>0&&(_+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(Gl).join(`
`),v.length>0&&(v+=`
`)):(_=[Gg(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Gl).join(`
`),v=[Gg(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Qr?"#define TONE_MAPPING":"",t.toneMapping!==Qr?Gt.tonemapping_pars_fragment:"",t.toneMapping!==Qr?r2("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Gt.colorspace_pars_fragment,s2("linearToOutputTexel",t.outputColorSpace),a2(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Gl).join(`
`)),a=Fp(a),a=Ug(a,t),a=zg(a,t),o=Fp(o),o=Ug(o,t),o=zg(o,t),a=Vg(a),o=Vg(o),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,_=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,v=["#define varying in",t.glslVersion===Kv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Kv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const y=x+_+a,g=x+v+o,w=Og(s,s.VERTEX_SHADER,y),b=Og(s,s.FRAGMENT_SHADER,g);s.attachShader(m,w),s.attachShader(m,b),t.index0AttributeName!==void 0?s.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m);function T(A){if(i.debug.checkShaderErrors){const C=s.getProgramInfoLog(m)||"",I=s.getShaderInfoLog(w)||"",H=s.getShaderInfoLog(b)||"",W=C.trim(),z=I.trim(),q=H.trim();let O=!0,re=!0;if(s.getProgramParameter(m,s.LINK_STATUS)===!1)if(O=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,m,w,b);else{const le=Fg(s,w,"vertex"),Z=Fg(s,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,s.VALIDATE_STATUS)+`

Material Name: `+A.name+`
Material Type: `+A.type+`

Program Info Log: `+W+`
`+le+`
`+Z)}else W!==""?console.warn("THREE.WebGLProgram: Program Info Log:",W):(z===""||q==="")&&(re=!1);re&&(A.diagnostics={runnable:O,programLog:W,vertexShader:{log:z,prefix:_},fragmentShader:{log:q,prefix:v}})}s.deleteShader(w),s.deleteShader(b),E=new $u(s,m),S=c2(s,m)}let E;this.getUniforms=function(){return E===void 0&&T(this),E};let S;this.getAttributes=function(){return S===void 0&&T(this),S};let M=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return M===!1&&(M=s.getProgramParameter(m,e2)),M},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=t2++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=b,this}let b2=0;class w2{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new S2(e),t.set(e,n)),n}}class S2{constructor(e){this.id=b2++,this.code=e,this.usedTimes=0}}function E2(i,e,t,n,s,r,a){const o=new Fm,l=new w2,c=new Set,u=[],d=s.logarithmicDepthBuffer,h=s.vertexTextures;let f=s.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(S){return c.add(S),S===0?"uv":`uv${S}`}function _(S,M,A,C,I){const H=C.fog,W=I.geometry,z=S.isMeshStandardMaterial?C.environment:null,q=(S.isMeshStandardMaterial?t:e).get(S.envMap||z),O=q&&q.mapping===Yd?q.image.height:null,re=p[S.type];S.precision!==null&&(f=s.getMaxPrecision(S.precision),f!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",f,"instead."));const le=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,Z=le!==void 0?le.length:0;let ne=0;W.morphAttributes.position!==void 0&&(ne=1),W.morphAttributes.normal!==void 0&&(ne=2),W.morphAttributes.color!==void 0&&(ne=3);let j,ee,F,X;if(re){const Ct=Hs[re];j=Ct.vertexShader,ee=Ct.fragmentShader}else j=S.vertexShader,ee=S.fragmentShader,l.update(S),F=l.getVertexShaderID(S),X=l.getFragmentShaderID(S);const Q=i.getRenderTarget(),ue=i.state.buffers.depth.getReversed(),ce=I.isInstancedMesh===!0,xe=I.isBatchedMesh===!0,Me=!!S.map,Y=!!S.matcap,P=!!q,R=!!S.aoMap,N=!!S.lightMap,$=!!S.bumpMap,ie=!!S.normalMap,ye=!!S.displacementMap,ve=!!S.emissiveMap,k=!!S.metalnessMap,V=!!S.roughnessMap,de=S.anisotropy>0,D=S.clearcoat>0,L=S.dispersion>0,J=S.iridescence>0,K=S.sheen>0,te=S.transmission>0,me=de&&!!S.anisotropyMap,Ie=D&&!!S.clearcoatMap,Pe=D&&!!S.clearcoatNormalMap,Ke=D&&!!S.clearcoatRoughnessMap,Ye=J&&!!S.iridescenceMap,De=J&&!!S.iridescenceThicknessMap,Xe=K&&!!S.sheenColorMap,dt=K&&!!S.sheenRoughnessMap,at=!!S.specularMap,qe=!!S.specularColorMap,bt=!!S.specularIntensityMap,pe=te&&!!S.transmissionMap,Ne=te&&!!S.thicknessMap,Ge=!!S.gradientMap,st=!!S.alphaMap,Fe=S.alphaTest>0,Re=!!S.alphaHash,pt=!!S.extensions;let Tt=Qr;S.toneMapped&&(Q===null||Q.isXRRenderTarget===!0)&&(Tt=i.toneMapping);const Jt={shaderID:re,shaderType:S.type,shaderName:S.name,vertexShader:j,fragmentShader:ee,defines:S.defines,customVertexShaderID:F,customFragmentShaderID:X,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:f,batching:xe,batchingColor:xe&&I._colorsTexture!==null,instancing:ce,instancingColor:ce&&I.instanceColor!==null,instancingMorph:ce&&I.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:Q===null?i.outputColorSpace:Q.isXRRenderTarget===!0?Q.texture.colorSpace:ll,alphaToCoverage:!!S.alphaToCoverage,map:Me,matcap:Y,envMap:P,envMapMode:P&&q.mapping,envMapCubeUVHeight:O,aoMap:R,lightMap:N,bumpMap:$,normalMap:ie,displacementMap:h&&ye,emissiveMap:ve,normalMapObjectSpace:ie&&S.normalMapType===pC,normalMapTangentSpace:ie&&S.normalMapType===jd,metalnessMap:k,roughnessMap:V,anisotropy:de,anisotropyMap:me,clearcoat:D,clearcoatMap:Ie,clearcoatNormalMap:Pe,clearcoatRoughnessMap:Ke,dispersion:L,iridescence:J,iridescenceMap:Ye,iridescenceThicknessMap:De,sheen:K,sheenColorMap:Xe,sheenRoughnessMap:dt,specularMap:at,specularColorMap:qe,specularIntensityMap:bt,transmission:te,transmissionMap:pe,thicknessMap:Ne,gradientMap:Ge,opaque:S.transparent===!1&&S.blending===Jo&&S.alphaToCoverage===!1,alphaMap:st,alphaTest:Fe,alphaHash:Re,combine:S.combine,mapUv:Me&&m(S.map.channel),aoMapUv:R&&m(S.aoMap.channel),lightMapUv:N&&m(S.lightMap.channel),bumpMapUv:$&&m(S.bumpMap.channel),normalMapUv:ie&&m(S.normalMap.channel),displacementMapUv:ye&&m(S.displacementMap.channel),emissiveMapUv:ve&&m(S.emissiveMap.channel),metalnessMapUv:k&&m(S.metalnessMap.channel),roughnessMapUv:V&&m(S.roughnessMap.channel),anisotropyMapUv:me&&m(S.anisotropyMap.channel),clearcoatMapUv:Ie&&m(S.clearcoatMap.channel),clearcoatNormalMapUv:Pe&&m(S.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ke&&m(S.clearcoatRoughnessMap.channel),iridescenceMapUv:Ye&&m(S.iridescenceMap.channel),iridescenceThicknessMapUv:De&&m(S.iridescenceThicknessMap.channel),sheenColorMapUv:Xe&&m(S.sheenColorMap.channel),sheenRoughnessMapUv:dt&&m(S.sheenRoughnessMap.channel),specularMapUv:at&&m(S.specularMap.channel),specularColorMapUv:qe&&m(S.specularColorMap.channel),specularIntensityMapUv:bt&&m(S.specularIntensityMap.channel),transmissionMapUv:pe&&m(S.transmissionMap.channel),thicknessMapUv:Ne&&m(S.thicknessMap.channel),alphaMapUv:st&&m(S.alphaMap.channel),vertexTangents:!!W.attributes.tangent&&(ie||de),vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,pointsUvs:I.isPoints===!0&&!!W.attributes.uv&&(Me||st),fog:!!H,useFog:S.fog===!0,fogExp2:!!H&&H.isFogExp2,flatShading:S.flatShading===!0&&S.wireframe===!1,sizeAttenuation:S.sizeAttenuation===!0,logarithmicDepthBuffer:d,reversedDepthBuffer:ue,skinning:I.isSkinnedMesh===!0,morphTargets:W.morphAttributes.position!==void 0,morphNormals:W.morphAttributes.normal!==void 0,morphColors:W.morphAttributes.color!==void 0,morphTargetsCount:Z,morphTextureStride:ne,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numLightProbes:M.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:S.dithering,shadowMapEnabled:i.shadowMap.enabled&&A.length>0,shadowMapType:i.shadowMap.type,toneMapping:Tt,decodeVideoTexture:Me&&S.map.isVideoTexture===!0&&tn.getTransfer(S.map.colorSpace)===ln,decodeVideoTextureEmissive:ve&&S.emissiveMap.isVideoTexture===!0&&tn.getTransfer(S.emissiveMap.colorSpace)===ln,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===ws,flipSided:S.side===Di,useDepthPacking:S.depthPacking>=0,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionClipCullDistance:pt&&S.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(pt&&S.extensions.multiDraw===!0||xe)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:S.customProgramCacheKey()};return Jt.vertexUv1s=c.has(1),Jt.vertexUv2s=c.has(2),Jt.vertexUv3s=c.has(3),c.clear(),Jt}function v(S){const M=[];if(S.shaderID?M.push(S.shaderID):(M.push(S.customVertexShaderID),M.push(S.customFragmentShaderID)),S.defines!==void 0)for(const A in S.defines)M.push(A),M.push(S.defines[A]);return S.isRawShaderMaterial===!1&&(x(M,S),y(M,S),M.push(i.outputColorSpace)),M.push(S.customProgramCacheKey),M.join()}function x(S,M){S.push(M.precision),S.push(M.outputColorSpace),S.push(M.envMapMode),S.push(M.envMapCubeUVHeight),S.push(M.mapUv),S.push(M.alphaMapUv),S.push(M.lightMapUv),S.push(M.aoMapUv),S.push(M.bumpMapUv),S.push(M.normalMapUv),S.push(M.displacementMapUv),S.push(M.emissiveMapUv),S.push(M.metalnessMapUv),S.push(M.roughnessMapUv),S.push(M.anisotropyMapUv),S.push(M.clearcoatMapUv),S.push(M.clearcoatNormalMapUv),S.push(M.clearcoatRoughnessMapUv),S.push(M.iridescenceMapUv),S.push(M.iridescenceThicknessMapUv),S.push(M.sheenColorMapUv),S.push(M.sheenRoughnessMapUv),S.push(M.specularMapUv),S.push(M.specularColorMapUv),S.push(M.specularIntensityMapUv),S.push(M.transmissionMapUv),S.push(M.thicknessMapUv),S.push(M.combine),S.push(M.fogExp2),S.push(M.sizeAttenuation),S.push(M.morphTargetsCount),S.push(M.morphAttributeCount),S.push(M.numDirLights),S.push(M.numPointLights),S.push(M.numSpotLights),S.push(M.numSpotLightMaps),S.push(M.numHemiLights),S.push(M.numRectAreaLights),S.push(M.numDirLightShadows),S.push(M.numPointLightShadows),S.push(M.numSpotLightShadows),S.push(M.numSpotLightShadowsWithMaps),S.push(M.numLightProbes),S.push(M.shadowMapType),S.push(M.toneMapping),S.push(M.numClippingPlanes),S.push(M.numClipIntersection),S.push(M.depthPacking)}function y(S,M){o.disableAll(),M.supportsVertexTextures&&o.enable(0),M.instancing&&o.enable(1),M.instancingColor&&o.enable(2),M.instancingMorph&&o.enable(3),M.matcap&&o.enable(4),M.envMap&&o.enable(5),M.normalMapObjectSpace&&o.enable(6),M.normalMapTangentSpace&&o.enable(7),M.clearcoat&&o.enable(8),M.iridescence&&o.enable(9),M.alphaTest&&o.enable(10),M.vertexColors&&o.enable(11),M.vertexAlphas&&o.enable(12),M.vertexUv1s&&o.enable(13),M.vertexUv2s&&o.enable(14),M.vertexUv3s&&o.enable(15),M.vertexTangents&&o.enable(16),M.anisotropy&&o.enable(17),M.alphaHash&&o.enable(18),M.batching&&o.enable(19),M.dispersion&&o.enable(20),M.batchingColor&&o.enable(21),M.gradientMap&&o.enable(22),S.push(o.mask),o.disableAll(),M.fog&&o.enable(0),M.useFog&&o.enable(1),M.flatShading&&o.enable(2),M.logarithmicDepthBuffer&&o.enable(3),M.reversedDepthBuffer&&o.enable(4),M.skinning&&o.enable(5),M.morphTargets&&o.enable(6),M.morphNormals&&o.enable(7),M.morphColors&&o.enable(8),M.premultipliedAlpha&&o.enable(9),M.shadowMapEnabled&&o.enable(10),M.doubleSided&&o.enable(11),M.flipSided&&o.enable(12),M.useDepthPacking&&o.enable(13),M.dithering&&o.enable(14),M.transmission&&o.enable(15),M.sheen&&o.enable(16),M.opaque&&o.enable(17),M.pointsUvs&&o.enable(18),M.decodeVideoTexture&&o.enable(19),M.decodeVideoTextureEmissive&&o.enable(20),M.alphaToCoverage&&o.enable(21),S.push(o.mask)}function g(S){const M=p[S.type];let A;if(M){const C=Hs[M];A=WC.clone(C.uniforms)}else A=S.uniforms;return A}function w(S,M){let A;for(let C=0,I=u.length;C<I;C++){const H=u[C];if(H.cacheKey===M){A=H,++A.usedTimes;break}}return A===void 0&&(A=new x2(i,M,S,r),u.push(A)),A}function b(S){if(--S.usedTimes===0){const M=u.indexOf(S);u[M]=u[u.length-1],u.pop(),S.destroy()}}function T(S){l.remove(S)}function E(){l.dispose()}return{getParameters:_,getProgramCacheKey:v,getUniforms:g,acquireProgram:w,releaseProgram:b,releaseShaderCache:T,programs:u,dispose:E}}function M2(){let i=new WeakMap;function e(a){return i.has(a)}function t(a){let o=i.get(a);return o===void 0&&(o={},i.set(a,o)),o}function n(a){i.delete(a)}function s(a,o,l){i.get(a)[o]=l}function r(){i=new WeakMap}return{has:e,get:t,remove:n,update:s,dispose:r}}function T2(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function Hg(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Wg(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function a(d,h,f,p,m,_){let v=i[e];return v===void 0?(v={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:m,group:_},i[e]=v):(v.id=d.id,v.object=d,v.geometry=h,v.material=f,v.groupOrder=p,v.renderOrder=d.renderOrder,v.z=m,v.group=_),e++,v}function o(d,h,f,p,m,_){const v=a(d,h,f,p,m,_);f.transmission>0?n.push(v):f.transparent===!0?s.push(v):t.push(v)}function l(d,h,f,p,m,_){const v=a(d,h,f,p,m,_);f.transmission>0?n.unshift(v):f.transparent===!0?s.unshift(v):t.unshift(v)}function c(d,h){t.length>1&&t.sort(d||T2),n.length>1&&n.sort(h||Hg),s.length>1&&s.sort(h||Hg)}function u(){for(let d=e,h=i.length;d<h;d++){const f=i[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:o,unshift:l,finish:u,sort:c}}function A2(){let i=new WeakMap;function e(n,s){const r=i.get(n);let a;return r===void 0?(a=new Wg,i.set(n,[a])):s>=r.length?(a=new Wg,r.push(a)):a=r[s],a}function t(){i=new WeakMap}return{get:e,dispose:t}}function C2(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new fe,color:new Mt};break;case"SpotLight":t={position:new fe,direction:new fe,color:new Mt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new fe,color:new Mt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new fe,skyColor:new Mt,groundColor:new Mt};break;case"RectAreaLight":t={color:new Mt,position:new fe,halfWidth:new fe,halfHeight:new fe};break}return i[e.id]=t,t}}}function P2(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let R2=0;function L2(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function I2(i){const e=new C2,t=P2(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new fe);const s=new fe,r=new Tn,a=new Tn;function o(c){let u=0,d=0,h=0;for(let S=0;S<9;S++)n.probe[S].set(0,0,0);let f=0,p=0,m=0,_=0,v=0,x=0,y=0,g=0,w=0,b=0,T=0;c.sort(L2);for(let S=0,M=c.length;S<M;S++){const A=c[S],C=A.color,I=A.intensity,H=A.distance,W=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)u+=C.r*I,d+=C.g*I,h+=C.b*I;else if(A.isLightProbe){for(let z=0;z<9;z++)n.probe[z].addScaledVector(A.sh.coefficients[z],I);T++}else if(A.isDirectionalLight){const z=e.get(A);if(z.color.copy(A.color).multiplyScalar(A.intensity),A.castShadow){const q=A.shadow,O=t.get(A);O.shadowIntensity=q.intensity,O.shadowBias=q.bias,O.shadowNormalBias=q.normalBias,O.shadowRadius=q.radius,O.shadowMapSize=q.mapSize,n.directionalShadow[f]=O,n.directionalShadowMap[f]=W,n.directionalShadowMatrix[f]=A.shadow.matrix,x++}n.directional[f]=z,f++}else if(A.isSpotLight){const z=e.get(A);z.position.setFromMatrixPosition(A.matrixWorld),z.color.copy(C).multiplyScalar(I),z.distance=H,z.coneCos=Math.cos(A.angle),z.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),z.decay=A.decay,n.spot[m]=z;const q=A.shadow;if(A.map&&(n.spotLightMap[w]=A.map,w++,q.updateMatrices(A),A.castShadow&&b++),n.spotLightMatrix[m]=q.matrix,A.castShadow){const O=t.get(A);O.shadowIntensity=q.intensity,O.shadowBias=q.bias,O.shadowNormalBias=q.normalBias,O.shadowRadius=q.radius,O.shadowMapSize=q.mapSize,n.spotShadow[m]=O,n.spotShadowMap[m]=W,g++}m++}else if(A.isRectAreaLight){const z=e.get(A);z.color.copy(C).multiplyScalar(I),z.halfWidth.set(A.width*.5,0,0),z.halfHeight.set(0,A.height*.5,0),n.rectArea[_]=z,_++}else if(A.isPointLight){const z=e.get(A);if(z.color.copy(A.color).multiplyScalar(A.intensity),z.distance=A.distance,z.decay=A.decay,A.castShadow){const q=A.shadow,O=t.get(A);O.shadowIntensity=q.intensity,O.shadowBias=q.bias,O.shadowNormalBias=q.normalBias,O.shadowRadius=q.radius,O.shadowMapSize=q.mapSize,O.shadowCameraNear=q.camera.near,O.shadowCameraFar=q.camera.far,n.pointShadow[p]=O,n.pointShadowMap[p]=W,n.pointShadowMatrix[p]=A.shadow.matrix,y++}n.point[p]=z,p++}else if(A.isHemisphereLight){const z=e.get(A);z.skyColor.copy(A.color).multiplyScalar(I),z.groundColor.copy(A.groundColor).multiplyScalar(I),n.hemi[v]=z,v++}}_>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ot.LTC_FLOAT_1,n.rectAreaLTC2=ot.LTC_FLOAT_2):(n.rectAreaLTC1=ot.LTC_HALF_1,n.rectAreaLTC2=ot.LTC_HALF_2)),n.ambient[0]=u,n.ambient[1]=d,n.ambient[2]=h;const E=n.hash;(E.directionalLength!==f||E.pointLength!==p||E.spotLength!==m||E.rectAreaLength!==_||E.hemiLength!==v||E.numDirectionalShadows!==x||E.numPointShadows!==y||E.numSpotShadows!==g||E.numSpotMaps!==w||E.numLightProbes!==T)&&(n.directional.length=f,n.spot.length=m,n.rectArea.length=_,n.point.length=p,n.hemi.length=v,n.directionalShadow.length=x,n.directionalShadowMap.length=x,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=g,n.spotShadowMap.length=g,n.directionalShadowMatrix.length=x,n.pointShadowMatrix.length=y,n.spotLightMatrix.length=g+w-b,n.spotLightMap.length=w,n.numSpotLightShadowsWithMaps=b,n.numLightProbes=T,E.directionalLength=f,E.pointLength=p,E.spotLength=m,E.rectAreaLength=_,E.hemiLength=v,E.numDirectionalShadows=x,E.numPointShadows=y,E.numSpotShadows=g,E.numSpotMaps=w,E.numLightProbes=T,n.version=R2++)}function l(c,u){let d=0,h=0,f=0,p=0,m=0;const _=u.matrixWorldInverse;for(let v=0,x=c.length;v<x;v++){const y=c[v];if(y.isDirectionalLight){const g=n.directional[d];g.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),g.direction.sub(s),g.direction.transformDirection(_),d++}else if(y.isSpotLight){const g=n.spot[f];g.position.setFromMatrixPosition(y.matrixWorld),g.position.applyMatrix4(_),g.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),g.direction.sub(s),g.direction.transformDirection(_),f++}else if(y.isRectAreaLight){const g=n.rectArea[p];g.position.setFromMatrixPosition(y.matrixWorld),g.position.applyMatrix4(_),a.identity(),r.copy(y.matrixWorld),r.premultiply(_),a.extractRotation(r),g.halfWidth.set(y.width*.5,0,0),g.halfHeight.set(0,y.height*.5,0),g.halfWidth.applyMatrix4(a),g.halfHeight.applyMatrix4(a),p++}else if(y.isPointLight){const g=n.point[h];g.position.setFromMatrixPosition(y.matrixWorld),g.position.applyMatrix4(_),h++}else if(y.isHemisphereLight){const g=n.hemi[m];g.direction.setFromMatrixPosition(y.matrixWorld),g.direction.transformDirection(_),m++}}}return{setup:o,setupView:l,state:n}}function $g(i){const e=new I2(i),t=[],n=[];function s(u){c.camera=u,t.length=0,n.length=0}function r(u){t.push(u)}function a(u){n.push(u)}function o(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:o,setupLightsView:l,pushLight:r,pushShadow:a}}function D2(i){let e=new WeakMap;function t(s,r=0){const a=e.get(s);let o;return a===void 0?(o=new $g(i),e.set(s,[o])):r>=a.length?(o=new $g(i),a.push(o)):o=a[r],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const k2=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,B2=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function O2(i,e,t){let n=new zm;const s=new Lt,r=new Lt,a=new Cn,o=new nP({depthPacking:fC}),l=new iP,c={},u=t.maxTextureSize,d={[aa]:Di,[Di]:aa,[ws]:ws},h=new oa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Lt},radius:{value:4}},vertexShader:k2,fragmentShader:B2}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new Bs;p.setAttribute("position",new Rs(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new yn(p,h),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$x;let v=this.type;this.render=function(b,T,E){if(_.enabled===!1||_.autoUpdate===!1&&_.needsUpdate===!1||b.length===0)return;const S=i.getRenderTarget(),M=i.getActiveCubeFace(),A=i.getActiveMipmapLevel(),C=i.state;C.setBlending(Jr),C.buffers.depth.getReversed()===!0?C.buffers.color.setClear(0,0,0,0):C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);const I=v!==mr&&this.type===mr,H=v===mr&&this.type!==mr;for(let W=0,z=b.length;W<z;W++){const q=b[W],O=q.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",q,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;s.copy(O.mapSize);const re=O.getFrameExtents();if(s.multiply(re),r.copy(O.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(r.x=Math.floor(u/re.x),s.x=r.x*re.x,O.mapSize.x=r.x),s.y>u&&(r.y=Math.floor(u/re.y),s.y=r.y*re.y,O.mapSize.y=r.y)),O.map===null||I===!0||H===!0){const Z=this.type!==mr?{minFilter:wi,magFilter:wi}:{};O.map!==null&&O.map.dispose(),O.map=new so(s.x,s.y,Z),O.map.texture.name=q.name+".shadowMap",O.camera.updateProjectionMatrix()}i.setRenderTarget(O.map),i.clear();const le=O.getViewportCount();for(let Z=0;Z<le;Z++){const ne=O.getViewport(Z);a.set(r.x*ne.x,r.y*ne.y,r.x*ne.z,r.y*ne.w),C.viewport(a),O.updateMatrices(q,Z),n=O.getFrustum(),g(T,E,O.camera,q,this.type)}O.isPointLightShadow!==!0&&this.type===mr&&x(O,E),O.needsUpdate=!1}v=this.type,_.needsUpdate=!1,i.setRenderTarget(S,M,A)};function x(b,T){const E=e.update(m);h.defines.VSM_SAMPLES!==b.blurSamples&&(h.defines.VSM_SAMPLES=b.blurSamples,f.defines.VSM_SAMPLES=b.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),b.mapPass===null&&(b.mapPass=new so(s.x,s.y)),h.uniforms.shadow_pass.value=b.map.texture,h.uniforms.resolution.value=b.mapSize,h.uniforms.radius.value=b.radius,i.setRenderTarget(b.mapPass),i.clear(),i.renderBufferDirect(T,null,E,h,m,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,i.setRenderTarget(b.map),i.clear(),i.renderBufferDirect(T,null,E,f,m,null)}function y(b,T,E,S){let M=null;const A=E.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(A!==void 0)M=A;else if(M=E.isPointLight===!0?l:o,i.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0||T.alphaToCoverage===!0){const C=M.uuid,I=T.uuid;let H=c[C];H===void 0&&(H={},c[C]=H);let W=H[I];W===void 0&&(W=M.clone(),H[I]=W,T.addEventListener("dispose",w)),M=W}if(M.visible=T.visible,M.wireframe=T.wireframe,S===mr?M.side=T.shadowSide!==null?T.shadowSide:T.side:M.side=T.shadowSide!==null?T.shadowSide:d[T.side],M.alphaMap=T.alphaMap,M.alphaTest=T.alphaToCoverage===!0?.5:T.alphaTest,M.map=T.map,M.clipShadows=T.clipShadows,M.clippingPlanes=T.clippingPlanes,M.clipIntersection=T.clipIntersection,M.displacementMap=T.displacementMap,M.displacementScale=T.displacementScale,M.displacementBias=T.displacementBias,M.wireframeLinewidth=T.wireframeLinewidth,M.linewidth=T.linewidth,E.isPointLight===!0&&M.isMeshDistanceMaterial===!0){const C=i.properties.get(M);C.light=E}return M}function g(b,T,E,S,M){if(b.visible===!1)return;if(b.layers.test(T.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&M===mr)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,b.matrixWorld);const I=e.update(b),H=b.material;if(Array.isArray(H)){const W=I.groups;for(let z=0,q=W.length;z<q;z++){const O=W[z],re=H[O.materialIndex];if(re&&re.visible){const le=y(b,re,S,M);b.onBeforeShadow(i,b,T,E,I,le,O),i.renderBufferDirect(E,null,I,le,b,O),b.onAfterShadow(i,b,T,E,I,le,O)}}}else if(H.visible){const W=y(b,H,S,M);b.onBeforeShadow(i,b,T,E,I,W,null),i.renderBufferDirect(E,null,I,W,b,null),b.onAfterShadow(i,b,T,E,I,W,null)}}const C=b.children;for(let I=0,H=C.length;I<H;I++)g(C[I],T,E,S,M)}function w(b){b.target.removeEventListener("dispose",w);for(const E in c){const S=c[E],M=b.target.uuid;M in S&&(S[M].dispose(),delete S[M])}}}const N2={[Jf]:Qf,[ep]:ip,[tp]:sp,[rl]:np,[Qf]:Jf,[ip]:ep,[sp]:tp,[np]:rl};function F2(i,e){function t(){let pe=!1;const Ne=new Cn;let Ge=null;const st=new Cn(0,0,0,0);return{setMask:function(Fe){Ge!==Fe&&!pe&&(i.colorMask(Fe,Fe,Fe,Fe),Ge=Fe)},setLocked:function(Fe){pe=Fe},setClear:function(Fe,Re,pt,Tt,Jt){Jt===!0&&(Fe*=Tt,Re*=Tt,pt*=Tt),Ne.set(Fe,Re,pt,Tt),st.equals(Ne)===!1&&(i.clearColor(Fe,Re,pt,Tt),st.copy(Ne))},reset:function(){pe=!1,Ge=null,st.set(-1,0,0,0)}}}function n(){let pe=!1,Ne=!1,Ge=null,st=null,Fe=null;return{setReversed:function(Re){if(Ne!==Re){const pt=e.get("EXT_clip_control");Re?pt.clipControlEXT(pt.LOWER_LEFT_EXT,pt.ZERO_TO_ONE_EXT):pt.clipControlEXT(pt.LOWER_LEFT_EXT,pt.NEGATIVE_ONE_TO_ONE_EXT),Ne=Re;const Tt=Fe;Fe=null,this.setClear(Tt)}},getReversed:function(){return Ne},setTest:function(Re){Re?Q(i.DEPTH_TEST):ue(i.DEPTH_TEST)},setMask:function(Re){Ge!==Re&&!pe&&(i.depthMask(Re),Ge=Re)},setFunc:function(Re){if(Ne&&(Re=N2[Re]),st!==Re){switch(Re){case Jf:i.depthFunc(i.NEVER);break;case Qf:i.depthFunc(i.ALWAYS);break;case ep:i.depthFunc(i.LESS);break;case rl:i.depthFunc(i.LEQUAL);break;case tp:i.depthFunc(i.EQUAL);break;case np:i.depthFunc(i.GEQUAL);break;case ip:i.depthFunc(i.GREATER);break;case sp:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}st=Re}},setLocked:function(Re){pe=Re},setClear:function(Re){Fe!==Re&&(Ne&&(Re=1-Re),i.clearDepth(Re),Fe=Re)},reset:function(){pe=!1,Ge=null,st=null,Fe=null,Ne=!1}}}function s(){let pe=!1,Ne=null,Ge=null,st=null,Fe=null,Re=null,pt=null,Tt=null,Jt=null;return{setTest:function(Ct){pe||(Ct?Q(i.STENCIL_TEST):ue(i.STENCIL_TEST))},setMask:function(Ct){Ne!==Ct&&!pe&&(i.stencilMask(Ct),Ne=Ct)},setFunc:function(Ct,Ae,Ce){(Ge!==Ct||st!==Ae||Fe!==Ce)&&(i.stencilFunc(Ct,Ae,Ce),Ge=Ct,st=Ae,Fe=Ce)},setOp:function(Ct,Ae,Ce){(Re!==Ct||pt!==Ae||Tt!==Ce)&&(i.stencilOp(Ct,Ae,Ce),Re=Ct,pt=Ae,Tt=Ce)},setLocked:function(Ct){pe=Ct},setClear:function(Ct){Jt!==Ct&&(i.clearStencil(Ct),Jt=Ct)},reset:function(){pe=!1,Ne=null,Ge=null,st=null,Fe=null,Re=null,pt=null,Tt=null,Jt=null}}}const r=new t,a=new n,o=new s,l=new WeakMap,c=new WeakMap;let u={},d={},h=new WeakMap,f=[],p=null,m=!1,_=null,v=null,x=null,y=null,g=null,w=null,b=null,T=new Mt(0,0,0),E=0,S=!1,M=null,A=null,C=null,I=null,H=null;const W=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let z=!1,q=0;const O=i.getParameter(i.VERSION);O.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(O)[1]),z=q>=1):O.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),z=q>=2);let re=null,le={};const Z=i.getParameter(i.SCISSOR_BOX),ne=i.getParameter(i.VIEWPORT),j=new Cn().fromArray(Z),ee=new Cn().fromArray(ne);function F(pe,Ne,Ge,st){const Fe=new Uint8Array(4),Re=i.createTexture();i.bindTexture(pe,Re),i.texParameteri(pe,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(pe,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let pt=0;pt<Ge;pt++)pe===i.TEXTURE_3D||pe===i.TEXTURE_2D_ARRAY?i.texImage3D(Ne,0,i.RGBA,1,1,st,0,i.RGBA,i.UNSIGNED_BYTE,Fe):i.texImage2D(Ne+pt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Fe);return Re}const X={};X[i.TEXTURE_2D]=F(i.TEXTURE_2D,i.TEXTURE_2D,1),X[i.TEXTURE_CUBE_MAP]=F(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),X[i.TEXTURE_2D_ARRAY]=F(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),X[i.TEXTURE_3D]=F(i.TEXTURE_3D,i.TEXTURE_3D,1,1),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Q(i.DEPTH_TEST),a.setFunc(rl),$(!1),ie(Wv),Q(i.CULL_FACE),R(Jr);function Q(pe){u[pe]!==!0&&(i.enable(pe),u[pe]=!0)}function ue(pe){u[pe]!==!1&&(i.disable(pe),u[pe]=!1)}function ce(pe,Ne){return d[pe]!==Ne?(i.bindFramebuffer(pe,Ne),d[pe]=Ne,pe===i.DRAW_FRAMEBUFFER&&(d[i.FRAMEBUFFER]=Ne),pe===i.FRAMEBUFFER&&(d[i.DRAW_FRAMEBUFFER]=Ne),!0):!1}function xe(pe,Ne){let Ge=f,st=!1;if(pe){Ge=h.get(Ne),Ge===void 0&&(Ge=[],h.set(Ne,Ge));const Fe=pe.textures;if(Ge.length!==Fe.length||Ge[0]!==i.COLOR_ATTACHMENT0){for(let Re=0,pt=Fe.length;Re<pt;Re++)Ge[Re]=i.COLOR_ATTACHMENT0+Re;Ge.length=Fe.length,st=!0}}else Ge[0]!==i.BACK&&(Ge[0]=i.BACK,st=!0);st&&i.drawBuffers(Ge)}function Me(pe){return p!==pe?(i.useProgram(pe),p=pe,!0):!1}const Y={[Ha]:i.FUNC_ADD,[UA]:i.FUNC_SUBTRACT,[zA]:i.FUNC_REVERSE_SUBTRACT};Y[VA]=i.MIN,Y[GA]=i.MAX;const P={[HA]:i.ZERO,[WA]:i.ONE,[$A]:i.SRC_COLOR,[Kf]:i.SRC_ALPHA,[ZA]:i.SRC_ALPHA_SATURATE,[jA]:i.DST_COLOR,[qA]:i.DST_ALPHA,[XA]:i.ONE_MINUS_SRC_COLOR,[Zf]:i.ONE_MINUS_SRC_ALPHA,[KA]:i.ONE_MINUS_DST_COLOR,[YA]:i.ONE_MINUS_DST_ALPHA,[JA]:i.CONSTANT_COLOR,[QA]:i.ONE_MINUS_CONSTANT_COLOR,[eC]:i.CONSTANT_ALPHA,[tC]:i.ONE_MINUS_CONSTANT_ALPHA};function R(pe,Ne,Ge,st,Fe,Re,pt,Tt,Jt,Ct){if(pe===Jr){m===!0&&(ue(i.BLEND),m=!1);return}if(m===!1&&(Q(i.BLEND),m=!0),pe!==FA){if(pe!==_||Ct!==S){if((v!==Ha||g!==Ha)&&(i.blendEquation(i.FUNC_ADD),v=Ha,g=Ha),Ct)switch(pe){case Jo:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case $v:i.blendFunc(i.ONE,i.ONE);break;case Xv:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case qv:i.blendFuncSeparate(i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ZERO,i.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe);break}else switch(pe){case Jo:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case $v:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE,i.ONE,i.ONE);break;case Xv:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case qv:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",pe);break}x=null,y=null,w=null,b=null,T.set(0,0,0),E=0,_=pe,S=Ct}return}Fe=Fe||Ne,Re=Re||Ge,pt=pt||st,(Ne!==v||Fe!==g)&&(i.blendEquationSeparate(Y[Ne],Y[Fe]),v=Ne,g=Fe),(Ge!==x||st!==y||Re!==w||pt!==b)&&(i.blendFuncSeparate(P[Ge],P[st],P[Re],P[pt]),x=Ge,y=st,w=Re,b=pt),(Tt.equals(T)===!1||Jt!==E)&&(i.blendColor(Tt.r,Tt.g,Tt.b,Jt),T.copy(Tt),E=Jt),_=pe,S=!1}function N(pe,Ne){pe.side===ws?ue(i.CULL_FACE):Q(i.CULL_FACE);let Ge=pe.side===Di;Ne&&(Ge=!Ge),$(Ge),pe.blending===Jo&&pe.transparent===!1?R(Jr):R(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.blendColor,pe.blendAlpha,pe.premultipliedAlpha),a.setFunc(pe.depthFunc),a.setTest(pe.depthTest),a.setMask(pe.depthWrite),r.setMask(pe.colorWrite);const st=pe.stencilWrite;o.setTest(st),st&&(o.setMask(pe.stencilWriteMask),o.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),o.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),ve(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),pe.alphaToCoverage===!0?Q(i.SAMPLE_ALPHA_TO_COVERAGE):ue(i.SAMPLE_ALPHA_TO_COVERAGE)}function $(pe){M!==pe&&(pe?i.frontFace(i.CW):i.frontFace(i.CCW),M=pe)}function ie(pe){pe!==OA?(Q(i.CULL_FACE),pe!==A&&(pe===Wv?i.cullFace(i.BACK):pe===NA?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):ue(i.CULL_FACE),A=pe}function ye(pe){pe!==C&&(z&&i.lineWidth(pe),C=pe)}function ve(pe,Ne,Ge){pe?(Q(i.POLYGON_OFFSET_FILL),(I!==Ne||H!==Ge)&&(i.polygonOffset(Ne,Ge),I=Ne,H=Ge)):ue(i.POLYGON_OFFSET_FILL)}function k(pe){pe?Q(i.SCISSOR_TEST):ue(i.SCISSOR_TEST)}function V(pe){pe===void 0&&(pe=i.TEXTURE0+W-1),re!==pe&&(i.activeTexture(pe),re=pe)}function de(pe,Ne,Ge){Ge===void 0&&(re===null?Ge=i.TEXTURE0+W-1:Ge=re);let st=le[Ge];st===void 0&&(st={type:void 0,texture:void 0},le[Ge]=st),(st.type!==pe||st.texture!==Ne)&&(re!==Ge&&(i.activeTexture(Ge),re=Ge),i.bindTexture(pe,Ne||X[pe]),st.type=pe,st.texture=Ne)}function D(){const pe=le[re];pe!==void 0&&pe.type!==void 0&&(i.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)}function L(){try{i.compressedTexImage2D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function J(){try{i.compressedTexImage3D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function K(){try{i.texSubImage2D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function te(){try{i.texSubImage3D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function me(){try{i.compressedTexSubImage2D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Ie(){try{i.compressedTexSubImage3D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Pe(){try{i.texStorage2D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Ke(){try{i.texStorage3D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Ye(){try{i.texImage2D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function De(){try{i.texImage3D(...arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}}function Xe(pe){j.equals(pe)===!1&&(i.scissor(pe.x,pe.y,pe.z,pe.w),j.copy(pe))}function dt(pe){ee.equals(pe)===!1&&(i.viewport(pe.x,pe.y,pe.z,pe.w),ee.copy(pe))}function at(pe,Ne){let Ge=c.get(Ne);Ge===void 0&&(Ge=new WeakMap,c.set(Ne,Ge));let st=Ge.get(pe);st===void 0&&(st=i.getUniformBlockIndex(Ne,pe.name),Ge.set(pe,st))}function qe(pe,Ne){const st=c.get(Ne).get(pe);l.get(Ne)!==st&&(i.uniformBlockBinding(Ne,st,pe.__bindingPointIndex),l.set(Ne,st))}function bt(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),a.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),u={},re=null,le={},d={},h=new WeakMap,f=[],p=null,m=!1,_=null,v=null,x=null,y=null,g=null,w=null,b=null,T=new Mt(0,0,0),E=0,S=!1,M=null,A=null,C=null,I=null,H=null,j.set(0,0,i.canvas.width,i.canvas.height),ee.set(0,0,i.canvas.width,i.canvas.height),r.reset(),a.reset(),o.reset()}return{buffers:{color:r,depth:a,stencil:o},enable:Q,disable:ue,bindFramebuffer:ce,drawBuffers:xe,useProgram:Me,setBlending:R,setMaterial:N,setFlipSided:$,setCullFace:ie,setLineWidth:ye,setPolygonOffset:ve,setScissorTest:k,activeTexture:V,bindTexture:de,unbindTexture:D,compressedTexImage2D:L,compressedTexImage3D:J,texImage2D:Ye,texImage3D:De,updateUBOMapping:at,uniformBlockBinding:qe,texStorage2D:Pe,texStorage3D:Ke,texSubImage2D:K,texSubImage3D:te,compressedTexSubImage2D:me,compressedTexSubImage3D:Ie,scissor:Xe,viewport:dt,reset:bt}}function U2(i,e,t,n,s,r,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Lt,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(D,L){return f?new OffscreenCanvas(D,L):bc("canvas")}function m(D,L,J){let K=1;const te=de(D);if((te.width>J||te.height>J)&&(K=J/Math.max(te.width,te.height)),K<1)if(typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&D instanceof ImageBitmap||typeof VideoFrame<"u"&&D instanceof VideoFrame){const me=Math.floor(K*te.width),Ie=Math.floor(K*te.height);d===void 0&&(d=p(me,Ie));const Pe=L?p(me,Ie):d;return Pe.width=me,Pe.height=Ie,Pe.getContext("2d").drawImage(D,0,0,me,Ie),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+te.width+"x"+te.height+") to ("+me+"x"+Ie+")."),Pe}else return"data"in D&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+te.width+"x"+te.height+")."),D;return D}function _(D){return D.generateMipmaps}function v(D){i.generateMipmap(D)}function x(D){return D.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:D.isWebGL3DRenderTarget?i.TEXTURE_3D:D.isWebGLArrayRenderTarget||D.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function y(D,L,J,K,te=!1){if(D!==null){if(i[D]!==void 0)return i[D];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+D+"'")}let me=L;if(L===i.RED&&(J===i.FLOAT&&(me=i.R32F),J===i.HALF_FLOAT&&(me=i.R16F),J===i.UNSIGNED_BYTE&&(me=i.R8)),L===i.RED_INTEGER&&(J===i.UNSIGNED_BYTE&&(me=i.R8UI),J===i.UNSIGNED_SHORT&&(me=i.R16UI),J===i.UNSIGNED_INT&&(me=i.R32UI),J===i.BYTE&&(me=i.R8I),J===i.SHORT&&(me=i.R16I),J===i.INT&&(me=i.R32I)),L===i.RG&&(J===i.FLOAT&&(me=i.RG32F),J===i.HALF_FLOAT&&(me=i.RG16F),J===i.UNSIGNED_BYTE&&(me=i.RG8)),L===i.RG_INTEGER&&(J===i.UNSIGNED_BYTE&&(me=i.RG8UI),J===i.UNSIGNED_SHORT&&(me=i.RG16UI),J===i.UNSIGNED_INT&&(me=i.RG32UI),J===i.BYTE&&(me=i.RG8I),J===i.SHORT&&(me=i.RG16I),J===i.INT&&(me=i.RG32I)),L===i.RGB_INTEGER&&(J===i.UNSIGNED_BYTE&&(me=i.RGB8UI),J===i.UNSIGNED_SHORT&&(me=i.RGB16UI),J===i.UNSIGNED_INT&&(me=i.RGB32UI),J===i.BYTE&&(me=i.RGB8I),J===i.SHORT&&(me=i.RGB16I),J===i.INT&&(me=i.RGB32I)),L===i.RGBA_INTEGER&&(J===i.UNSIGNED_BYTE&&(me=i.RGBA8UI),J===i.UNSIGNED_SHORT&&(me=i.RGBA16UI),J===i.UNSIGNED_INT&&(me=i.RGBA32UI),J===i.BYTE&&(me=i.RGBA8I),J===i.SHORT&&(me=i.RGBA16I),J===i.INT&&(me=i.RGBA32I)),L===i.RGB&&(J===i.UNSIGNED_INT_5_9_9_9_REV&&(me=i.RGB9_E5),J===i.UNSIGNED_INT_10F_11F_11F_REV&&(me=i.R11F_G11F_B10F)),L===i.RGBA){const Ie=te?ud:tn.getTransfer(K);J===i.FLOAT&&(me=i.RGBA32F),J===i.HALF_FLOAT&&(me=i.RGBA16F),J===i.UNSIGNED_BYTE&&(me=Ie===ln?i.SRGB8_ALPHA8:i.RGBA8),J===i.UNSIGNED_SHORT_4_4_4_4&&(me=i.RGBA4),J===i.UNSIGNED_SHORT_5_5_5_1&&(me=i.RGB5_A1)}return(me===i.R16F||me===i.R32F||me===i.RG16F||me===i.RG32F||me===i.RGBA16F||me===i.RGBA32F)&&e.get("EXT_color_buffer_float"),me}function g(D,L){let J;return D?L===null||L===no||L===gc?J=i.DEPTH24_STENCIL8:L===Sr?J=i.DEPTH32F_STENCIL8:L===vc&&(J=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):L===null||L===no||L===gc?J=i.DEPTH_COMPONENT24:L===Sr?J=i.DEPTH_COMPONENT32F:L===vc&&(J=i.DEPTH_COMPONENT16),J}function w(D,L){return _(D)===!0||D.isFramebufferTexture&&D.minFilter!==wi&&D.minFilter!==Xs?Math.log2(Math.max(L.width,L.height))+1:D.mipmaps!==void 0&&D.mipmaps.length>0?D.mipmaps.length:D.isCompressedTexture&&Array.isArray(D.image)?L.mipmaps.length:1}function b(D){const L=D.target;L.removeEventListener("dispose",b),E(L),L.isVideoTexture&&u.delete(L)}function T(D){const L=D.target;L.removeEventListener("dispose",T),M(L)}function E(D){const L=n.get(D);if(L.__webglInit===void 0)return;const J=D.source,K=h.get(J);if(K){const te=K[L.__cacheKey];te.usedTimes--,te.usedTimes===0&&S(D),Object.keys(K).length===0&&h.delete(J)}n.remove(D)}function S(D){const L=n.get(D);i.deleteTexture(L.__webglTexture);const J=D.source,K=h.get(J);delete K[L.__cacheKey],a.memory.textures--}function M(D){const L=n.get(D);if(D.depthTexture&&(D.depthTexture.dispose(),n.remove(D.depthTexture)),D.isWebGLCubeRenderTarget)for(let K=0;K<6;K++){if(Array.isArray(L.__webglFramebuffer[K]))for(let te=0;te<L.__webglFramebuffer[K].length;te++)i.deleteFramebuffer(L.__webglFramebuffer[K][te]);else i.deleteFramebuffer(L.__webglFramebuffer[K]);L.__webglDepthbuffer&&i.deleteRenderbuffer(L.__webglDepthbuffer[K])}else{if(Array.isArray(L.__webglFramebuffer))for(let K=0;K<L.__webglFramebuffer.length;K++)i.deleteFramebuffer(L.__webglFramebuffer[K]);else i.deleteFramebuffer(L.__webglFramebuffer);if(L.__webglDepthbuffer&&i.deleteRenderbuffer(L.__webglDepthbuffer),L.__webglMultisampledFramebuffer&&i.deleteFramebuffer(L.__webglMultisampledFramebuffer),L.__webglColorRenderbuffer)for(let K=0;K<L.__webglColorRenderbuffer.length;K++)L.__webglColorRenderbuffer[K]&&i.deleteRenderbuffer(L.__webglColorRenderbuffer[K]);L.__webglDepthRenderbuffer&&i.deleteRenderbuffer(L.__webglDepthRenderbuffer)}const J=D.textures;for(let K=0,te=J.length;K<te;K++){const me=n.get(J[K]);me.__webglTexture&&(i.deleteTexture(me.__webglTexture),a.memory.textures--),n.remove(J[K])}n.remove(D)}let A=0;function C(){A=0}function I(){const D=A;return D>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+D+" texture units while this GPU supports only "+s.maxTextures),A+=1,D}function H(D){const L=[];return L.push(D.wrapS),L.push(D.wrapT),L.push(D.wrapR||0),L.push(D.magFilter),L.push(D.minFilter),L.push(D.anisotropy),L.push(D.internalFormat),L.push(D.format),L.push(D.type),L.push(D.generateMipmaps),L.push(D.premultiplyAlpha),L.push(D.flipY),L.push(D.unpackAlignment),L.push(D.colorSpace),L.join()}function W(D,L){const J=n.get(D);if(D.isVideoTexture&&k(D),D.isRenderTargetTexture===!1&&D.isExternalTexture!==!0&&D.version>0&&J.__version!==D.version){const K=D.image;if(K===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(K.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{X(J,D,L);return}}else D.isExternalTexture&&(J.__webglTexture=D.sourceTexture?D.sourceTexture:null);t.bindTexture(i.TEXTURE_2D,J.__webglTexture,i.TEXTURE0+L)}function z(D,L){const J=n.get(D);if(D.isRenderTargetTexture===!1&&D.version>0&&J.__version!==D.version){X(J,D,L);return}t.bindTexture(i.TEXTURE_2D_ARRAY,J.__webglTexture,i.TEXTURE0+L)}function q(D,L){const J=n.get(D);if(D.isRenderTargetTexture===!1&&D.version>0&&J.__version!==D.version){X(J,D,L);return}t.bindTexture(i.TEXTURE_3D,J.__webglTexture,i.TEXTURE0+L)}function O(D,L){const J=n.get(D);if(D.version>0&&J.__version!==D.version){Q(J,D,L);return}t.bindTexture(i.TEXTURE_CUBE_MAP,J.__webglTexture,i.TEXTURE0+L)}const re={[op]:i.REPEAT,[Xa]:i.CLAMP_TO_EDGE,[lp]:i.MIRRORED_REPEAT},le={[wi]:i.NEAREST,[dC]:i.NEAREST_MIPMAP_NEAREST,[eu]:i.NEAREST_MIPMAP_LINEAR,[Xs]:i.LINEAR,[Mh]:i.LINEAR_MIPMAP_NEAREST,[qa]:i.LINEAR_MIPMAP_LINEAR},Z={[mC]:i.NEVER,[bC]:i.ALWAYS,[_C]:i.LESS,[tb]:i.LEQUAL,[vC]:i.EQUAL,[xC]:i.GEQUAL,[gC]:i.GREATER,[yC]:i.NOTEQUAL};function ne(D,L){if(L.type===Sr&&e.has("OES_texture_float_linear")===!1&&(L.magFilter===Xs||L.magFilter===Mh||L.magFilter===eu||L.magFilter===qa||L.minFilter===Xs||L.minFilter===Mh||L.minFilter===eu||L.minFilter===qa)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(D,i.TEXTURE_WRAP_S,re[L.wrapS]),i.texParameteri(D,i.TEXTURE_WRAP_T,re[L.wrapT]),(D===i.TEXTURE_3D||D===i.TEXTURE_2D_ARRAY)&&i.texParameteri(D,i.TEXTURE_WRAP_R,re[L.wrapR]),i.texParameteri(D,i.TEXTURE_MAG_FILTER,le[L.magFilter]),i.texParameteri(D,i.TEXTURE_MIN_FILTER,le[L.minFilter]),L.compareFunction&&(i.texParameteri(D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(D,i.TEXTURE_COMPARE_FUNC,Z[L.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(L.magFilter===wi||L.minFilter!==eu&&L.minFilter!==qa||L.type===Sr&&e.has("OES_texture_float_linear")===!1)return;if(L.anisotropy>1||n.get(L).__currentAnisotropy){const J=e.get("EXT_texture_filter_anisotropic");i.texParameterf(D,J.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.anisotropy,s.getMaxAnisotropy())),n.get(L).__currentAnisotropy=L.anisotropy}}}function j(D,L){let J=!1;D.__webglInit===void 0&&(D.__webglInit=!0,L.addEventListener("dispose",b));const K=L.source;let te=h.get(K);te===void 0&&(te={},h.set(K,te));const me=H(L);if(me!==D.__cacheKey){te[me]===void 0&&(te[me]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,J=!0),te[me].usedTimes++;const Ie=te[D.__cacheKey];Ie!==void 0&&(te[D.__cacheKey].usedTimes--,Ie.usedTimes===0&&S(L)),D.__cacheKey=me,D.__webglTexture=te[me].texture}return J}function ee(D,L,J){return Math.floor(Math.floor(D/J)/L)}function F(D,L,J,K){const me=D.updateRanges;if(me.length===0)t.texSubImage2D(i.TEXTURE_2D,0,0,0,L.width,L.height,J,K,L.data);else{me.sort((De,Xe)=>De.start-Xe.start);let Ie=0;for(let De=1;De<me.length;De++){const Xe=me[Ie],dt=me[De],at=Xe.start+Xe.count,qe=ee(dt.start,L.width,4),bt=ee(Xe.start,L.width,4);dt.start<=at+1&&qe===bt&&ee(dt.start+dt.count-1,L.width,4)===qe?Xe.count=Math.max(Xe.count,dt.start+dt.count-Xe.start):(++Ie,me[Ie]=dt)}me.length=Ie+1;const Pe=i.getParameter(i.UNPACK_ROW_LENGTH),Ke=i.getParameter(i.UNPACK_SKIP_PIXELS),Ye=i.getParameter(i.UNPACK_SKIP_ROWS);i.pixelStorei(i.UNPACK_ROW_LENGTH,L.width);for(let De=0,Xe=me.length;De<Xe;De++){const dt=me[De],at=Math.floor(dt.start/4),qe=Math.ceil(dt.count/4),bt=at%L.width,pe=Math.floor(at/L.width),Ne=qe,Ge=1;i.pixelStorei(i.UNPACK_SKIP_PIXELS,bt),i.pixelStorei(i.UNPACK_SKIP_ROWS,pe),t.texSubImage2D(i.TEXTURE_2D,0,bt,pe,Ne,Ge,J,K,L.data)}D.clearUpdateRanges(),i.pixelStorei(i.UNPACK_ROW_LENGTH,Pe),i.pixelStorei(i.UNPACK_SKIP_PIXELS,Ke),i.pixelStorei(i.UNPACK_SKIP_ROWS,Ye)}}function X(D,L,J){let K=i.TEXTURE_2D;(L.isDataArrayTexture||L.isCompressedArrayTexture)&&(K=i.TEXTURE_2D_ARRAY),L.isData3DTexture&&(K=i.TEXTURE_3D);const te=j(D,L),me=L.source;t.bindTexture(K,D.__webglTexture,i.TEXTURE0+J);const Ie=n.get(me);if(me.version!==Ie.__version||te===!0){t.activeTexture(i.TEXTURE0+J);const Pe=tn.getPrimaries(tn.workingColorSpace),Ke=L.colorSpace===Xr?null:tn.getPrimaries(L.colorSpace),Ye=L.colorSpace===Xr||Pe===Ke?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,L.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,L.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ye);let De=m(L.image,!1,s.maxTextureSize);De=V(L,De);const Xe=r.convert(L.format,L.colorSpace),dt=r.convert(L.type);let at=y(L.internalFormat,Xe,dt,L.colorSpace,L.isVideoTexture);ne(K,L);let qe;const bt=L.mipmaps,pe=L.isVideoTexture!==!0,Ne=Ie.__version===void 0||te===!0,Ge=me.dataReady,st=w(L,De);if(L.isDepthTexture)at=g(L.format===xc,L.type),Ne&&(pe?t.texStorage2D(i.TEXTURE_2D,1,at,De.width,De.height):t.texImage2D(i.TEXTURE_2D,0,at,De.width,De.height,0,Xe,dt,null));else if(L.isDataTexture)if(bt.length>0){pe&&Ne&&t.texStorage2D(i.TEXTURE_2D,st,at,bt[0].width,bt[0].height);for(let Fe=0,Re=bt.length;Fe<Re;Fe++)qe=bt[Fe],pe?Ge&&t.texSubImage2D(i.TEXTURE_2D,Fe,0,0,qe.width,qe.height,Xe,dt,qe.data):t.texImage2D(i.TEXTURE_2D,Fe,at,qe.width,qe.height,0,Xe,dt,qe.data);L.generateMipmaps=!1}else pe?(Ne&&t.texStorage2D(i.TEXTURE_2D,st,at,De.width,De.height),Ge&&F(L,De,Xe,dt)):t.texImage2D(i.TEXTURE_2D,0,at,De.width,De.height,0,Xe,dt,De.data);else if(L.isCompressedTexture)if(L.isCompressedArrayTexture){pe&&Ne&&t.texStorage3D(i.TEXTURE_2D_ARRAY,st,at,bt[0].width,bt[0].height,De.depth);for(let Fe=0,Re=bt.length;Fe<Re;Fe++)if(qe=bt[Fe],L.format!==Ts)if(Xe!==null)if(pe){if(Ge)if(L.layerUpdates.size>0){const pt=bg(qe.width,qe.height,L.format,L.type);for(const Tt of L.layerUpdates){const Jt=qe.data.subarray(Tt*pt/qe.data.BYTES_PER_ELEMENT,(Tt+1)*pt/qe.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Fe,0,0,Tt,qe.width,qe.height,1,Xe,Jt)}L.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Fe,0,0,0,qe.width,qe.height,De.depth,Xe,qe.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Fe,at,qe.width,qe.height,De.depth,0,qe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else pe?Ge&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,Fe,0,0,0,qe.width,qe.height,De.depth,Xe,dt,qe.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Fe,at,qe.width,qe.height,De.depth,0,Xe,dt,qe.data)}else{pe&&Ne&&t.texStorage2D(i.TEXTURE_2D,st,at,bt[0].width,bt[0].height);for(let Fe=0,Re=bt.length;Fe<Re;Fe++)qe=bt[Fe],L.format!==Ts?Xe!==null?pe?Ge&&t.compressedTexSubImage2D(i.TEXTURE_2D,Fe,0,0,qe.width,qe.height,Xe,qe.data):t.compressedTexImage2D(i.TEXTURE_2D,Fe,at,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):pe?Ge&&t.texSubImage2D(i.TEXTURE_2D,Fe,0,0,qe.width,qe.height,Xe,dt,qe.data):t.texImage2D(i.TEXTURE_2D,Fe,at,qe.width,qe.height,0,Xe,dt,qe.data)}else if(L.isDataArrayTexture)if(pe){if(Ne&&t.texStorage3D(i.TEXTURE_2D_ARRAY,st,at,De.width,De.height,De.depth),Ge)if(L.layerUpdates.size>0){const Fe=bg(De.width,De.height,L.format,L.type);for(const Re of L.layerUpdates){const pt=De.data.subarray(Re*Fe/De.data.BYTES_PER_ELEMENT,(Re+1)*Fe/De.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,Re,De.width,De.height,1,Xe,dt,pt)}L.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,De.width,De.height,De.depth,Xe,dt,De.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,at,De.width,De.height,De.depth,0,Xe,dt,De.data);else if(L.isData3DTexture)pe?(Ne&&t.texStorage3D(i.TEXTURE_3D,st,at,De.width,De.height,De.depth),Ge&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,De.width,De.height,De.depth,Xe,dt,De.data)):t.texImage3D(i.TEXTURE_3D,0,at,De.width,De.height,De.depth,0,Xe,dt,De.data);else if(L.isFramebufferTexture){if(Ne)if(pe)t.texStorage2D(i.TEXTURE_2D,st,at,De.width,De.height);else{let Fe=De.width,Re=De.height;for(let pt=0;pt<st;pt++)t.texImage2D(i.TEXTURE_2D,pt,at,Fe,Re,0,Xe,dt,null),Fe>>=1,Re>>=1}}else if(bt.length>0){if(pe&&Ne){const Fe=de(bt[0]);t.texStorage2D(i.TEXTURE_2D,st,at,Fe.width,Fe.height)}for(let Fe=0,Re=bt.length;Fe<Re;Fe++)qe=bt[Fe],pe?Ge&&t.texSubImage2D(i.TEXTURE_2D,Fe,0,0,Xe,dt,qe):t.texImage2D(i.TEXTURE_2D,Fe,at,Xe,dt,qe);L.generateMipmaps=!1}else if(pe){if(Ne){const Fe=de(De);t.texStorage2D(i.TEXTURE_2D,st,at,Fe.width,Fe.height)}Ge&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Xe,dt,De)}else t.texImage2D(i.TEXTURE_2D,0,at,Xe,dt,De);_(L)&&v(K),Ie.__version=me.version,L.onUpdate&&L.onUpdate(L)}D.__version=L.version}function Q(D,L,J){if(L.image.length!==6)return;const K=j(D,L),te=L.source;t.bindTexture(i.TEXTURE_CUBE_MAP,D.__webglTexture,i.TEXTURE0+J);const me=n.get(te);if(te.version!==me.__version||K===!0){t.activeTexture(i.TEXTURE0+J);const Ie=tn.getPrimaries(tn.workingColorSpace),Pe=L.colorSpace===Xr?null:tn.getPrimaries(L.colorSpace),Ke=L.colorSpace===Xr||Ie===Pe?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,L.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,L.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ke);const Ye=L.isCompressedTexture||L.image[0].isCompressedTexture,De=L.image[0]&&L.image[0].isDataTexture,Xe=[];for(let Re=0;Re<6;Re++)!Ye&&!De?Xe[Re]=m(L.image[Re],!0,s.maxCubemapSize):Xe[Re]=De?L.image[Re].image:L.image[Re],Xe[Re]=V(L,Xe[Re]);const dt=Xe[0],at=r.convert(L.format,L.colorSpace),qe=r.convert(L.type),bt=y(L.internalFormat,at,qe,L.colorSpace),pe=L.isVideoTexture!==!0,Ne=me.__version===void 0||K===!0,Ge=te.dataReady;let st=w(L,dt);ne(i.TEXTURE_CUBE_MAP,L);let Fe;if(Ye){pe&&Ne&&t.texStorage2D(i.TEXTURE_CUBE_MAP,st,bt,dt.width,dt.height);for(let Re=0;Re<6;Re++){Fe=Xe[Re].mipmaps;for(let pt=0;pt<Fe.length;pt++){const Tt=Fe[pt];L.format!==Ts?at!==null?pe?Ge&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt,0,0,Tt.width,Tt.height,at,Tt.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt,bt,Tt.width,Tt.height,0,Tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):pe?Ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt,0,0,Tt.width,Tt.height,at,qe,Tt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt,bt,Tt.width,Tt.height,0,at,qe,Tt.data)}}}else{if(Fe=L.mipmaps,pe&&Ne){Fe.length>0&&st++;const Re=de(Xe[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,st,bt,Re.width,Re.height)}for(let Re=0;Re<6;Re++)if(De){pe?Ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,0,0,Xe[Re].width,Xe[Re].height,at,qe,Xe[Re].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,bt,Xe[Re].width,Xe[Re].height,0,at,qe,Xe[Re].data);for(let pt=0;pt<Fe.length;pt++){const Jt=Fe[pt].image[Re].image;pe?Ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt+1,0,0,Jt.width,Jt.height,at,qe,Jt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt+1,bt,Jt.width,Jt.height,0,at,qe,Jt.data)}}else{pe?Ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,0,0,at,qe,Xe[Re]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,bt,at,qe,Xe[Re]);for(let pt=0;pt<Fe.length;pt++){const Tt=Fe[pt];pe?Ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt+1,0,0,at,qe,Tt.image[Re]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,pt+1,bt,at,qe,Tt.image[Re])}}}_(L)&&v(i.TEXTURE_CUBE_MAP),me.__version=te.version,L.onUpdate&&L.onUpdate(L)}D.__version=L.version}function ue(D,L,J,K,te,me){const Ie=r.convert(J.format,J.colorSpace),Pe=r.convert(J.type),Ke=y(J.internalFormat,Ie,Pe,J.colorSpace),Ye=n.get(L),De=n.get(J);if(De.__renderTarget=L,!Ye.__hasExternalTextures){const Xe=Math.max(1,L.width>>me),dt=Math.max(1,L.height>>me);te===i.TEXTURE_3D||te===i.TEXTURE_2D_ARRAY?t.texImage3D(te,me,Ke,Xe,dt,L.depth,0,Ie,Pe,null):t.texImage2D(te,me,Ke,Xe,dt,0,Ie,Pe,null)}t.bindFramebuffer(i.FRAMEBUFFER,D),ve(L)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,K,te,De.__webglTexture,0,ye(L)):(te===i.TEXTURE_2D||te>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&te<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,K,te,De.__webglTexture,me),t.bindFramebuffer(i.FRAMEBUFFER,null)}function ce(D,L,J){if(i.bindRenderbuffer(i.RENDERBUFFER,D),L.depthBuffer){const K=L.depthTexture,te=K&&K.isDepthTexture?K.type:null,me=g(L.stencilBuffer,te),Ie=L.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Pe=ye(L);ve(L)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Pe,me,L.width,L.height):J?i.renderbufferStorageMultisample(i.RENDERBUFFER,Pe,me,L.width,L.height):i.renderbufferStorage(i.RENDERBUFFER,me,L.width,L.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Ie,i.RENDERBUFFER,D)}else{const K=L.textures;for(let te=0;te<K.length;te++){const me=K[te],Ie=r.convert(me.format,me.colorSpace),Pe=r.convert(me.type),Ke=y(me.internalFormat,Ie,Pe,me.colorSpace),Ye=ye(L);J&&ve(L)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ye,Ke,L.width,L.height):ve(L)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ye,Ke,L.width,L.height):i.renderbufferStorage(i.RENDERBUFFER,Ke,L.width,L.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function xe(D,L){if(L&&L.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,D),!(L.depthTexture&&L.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const K=n.get(L.depthTexture);K.__renderTarget=L,(!K.__webglTexture||L.depthTexture.image.width!==L.width||L.depthTexture.image.height!==L.height)&&(L.depthTexture.image.width=L.width,L.depthTexture.image.height=L.height,L.depthTexture.needsUpdate=!0),W(L.depthTexture,0);const te=K.__webglTexture,me=ye(L);if(L.depthTexture.format===yc)ve(L)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,te,0,me):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,te,0);else if(L.depthTexture.format===xc)ve(L)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,te,0,me):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,te,0);else throw new Error("Unknown depthTexture format")}function Me(D){const L=n.get(D),J=D.isWebGLCubeRenderTarget===!0;if(L.__boundDepthTexture!==D.depthTexture){const K=D.depthTexture;if(L.__depthDisposeCallback&&L.__depthDisposeCallback(),K){const te=()=>{delete L.__boundDepthTexture,delete L.__depthDisposeCallback,K.removeEventListener("dispose",te)};K.addEventListener("dispose",te),L.__depthDisposeCallback=te}L.__boundDepthTexture=K}if(D.depthTexture&&!L.__autoAllocateDepthBuffer){if(J)throw new Error("target.depthTexture not supported in Cube render targets");const K=D.texture.mipmaps;K&&K.length>0?xe(L.__webglFramebuffer[0],D):xe(L.__webglFramebuffer,D)}else if(J){L.__webglDepthbuffer=[];for(let K=0;K<6;K++)if(t.bindFramebuffer(i.FRAMEBUFFER,L.__webglFramebuffer[K]),L.__webglDepthbuffer[K]===void 0)L.__webglDepthbuffer[K]=i.createRenderbuffer(),ce(L.__webglDepthbuffer[K],D,!1);else{const te=D.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,me=L.__webglDepthbuffer[K];i.bindRenderbuffer(i.RENDERBUFFER,me),i.framebufferRenderbuffer(i.FRAMEBUFFER,te,i.RENDERBUFFER,me)}}else{const K=D.texture.mipmaps;if(K&&K.length>0?t.bindFramebuffer(i.FRAMEBUFFER,L.__webglFramebuffer[0]):t.bindFramebuffer(i.FRAMEBUFFER,L.__webglFramebuffer),L.__webglDepthbuffer===void 0)L.__webglDepthbuffer=i.createRenderbuffer(),ce(L.__webglDepthbuffer,D,!1);else{const te=D.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,me=L.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,me),i.framebufferRenderbuffer(i.FRAMEBUFFER,te,i.RENDERBUFFER,me)}}t.bindFramebuffer(i.FRAMEBUFFER,null)}function Y(D,L,J){const K=n.get(D);L!==void 0&&ue(K.__webglFramebuffer,D,D.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),J!==void 0&&Me(D)}function P(D){const L=D.texture,J=n.get(D),K=n.get(L);D.addEventListener("dispose",T);const te=D.textures,me=D.isWebGLCubeRenderTarget===!0,Ie=te.length>1;if(Ie||(K.__webglTexture===void 0&&(K.__webglTexture=i.createTexture()),K.__version=L.version,a.memory.textures++),me){J.__webglFramebuffer=[];for(let Pe=0;Pe<6;Pe++)if(L.mipmaps&&L.mipmaps.length>0){J.__webglFramebuffer[Pe]=[];for(let Ke=0;Ke<L.mipmaps.length;Ke++)J.__webglFramebuffer[Pe][Ke]=i.createFramebuffer()}else J.__webglFramebuffer[Pe]=i.createFramebuffer()}else{if(L.mipmaps&&L.mipmaps.length>0){J.__webglFramebuffer=[];for(let Pe=0;Pe<L.mipmaps.length;Pe++)J.__webglFramebuffer[Pe]=i.createFramebuffer()}else J.__webglFramebuffer=i.createFramebuffer();if(Ie)for(let Pe=0,Ke=te.length;Pe<Ke;Pe++){const Ye=n.get(te[Pe]);Ye.__webglTexture===void 0&&(Ye.__webglTexture=i.createTexture(),a.memory.textures++)}if(D.samples>0&&ve(D)===!1){J.__webglMultisampledFramebuffer=i.createFramebuffer(),J.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,J.__webglMultisampledFramebuffer);for(let Pe=0;Pe<te.length;Pe++){const Ke=te[Pe];J.__webglColorRenderbuffer[Pe]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,J.__webglColorRenderbuffer[Pe]);const Ye=r.convert(Ke.format,Ke.colorSpace),De=r.convert(Ke.type),Xe=y(Ke.internalFormat,Ye,De,Ke.colorSpace,D.isXRRenderTarget===!0),dt=ye(D);i.renderbufferStorageMultisample(i.RENDERBUFFER,dt,Xe,D.width,D.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Pe,i.RENDERBUFFER,J.__webglColorRenderbuffer[Pe])}i.bindRenderbuffer(i.RENDERBUFFER,null),D.depthBuffer&&(J.__webglDepthRenderbuffer=i.createRenderbuffer(),ce(J.__webglDepthRenderbuffer,D,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(me){t.bindTexture(i.TEXTURE_CUBE_MAP,K.__webglTexture),ne(i.TEXTURE_CUBE_MAP,L);for(let Pe=0;Pe<6;Pe++)if(L.mipmaps&&L.mipmaps.length>0)for(let Ke=0;Ke<L.mipmaps.length;Ke++)ue(J.__webglFramebuffer[Pe][Ke],D,L,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Ke);else ue(J.__webglFramebuffer[Pe],D,L,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0);_(L)&&v(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ie){for(let Pe=0,Ke=te.length;Pe<Ke;Pe++){const Ye=te[Pe],De=n.get(Ye);let Xe=i.TEXTURE_2D;(D.isWebGL3DRenderTarget||D.isWebGLArrayRenderTarget)&&(Xe=D.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Xe,De.__webglTexture),ne(Xe,Ye),ue(J.__webglFramebuffer,D,Ye,i.COLOR_ATTACHMENT0+Pe,Xe,0),_(Ye)&&v(Xe)}t.unbindTexture()}else{let Pe=i.TEXTURE_2D;if((D.isWebGL3DRenderTarget||D.isWebGLArrayRenderTarget)&&(Pe=D.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Pe,K.__webglTexture),ne(Pe,L),L.mipmaps&&L.mipmaps.length>0)for(let Ke=0;Ke<L.mipmaps.length;Ke++)ue(J.__webglFramebuffer[Ke],D,L,i.COLOR_ATTACHMENT0,Pe,Ke);else ue(J.__webglFramebuffer,D,L,i.COLOR_ATTACHMENT0,Pe,0);_(L)&&v(Pe),t.unbindTexture()}D.depthBuffer&&Me(D)}function R(D){const L=D.textures;for(let J=0,K=L.length;J<K;J++){const te=L[J];if(_(te)){const me=x(D),Ie=n.get(te).__webglTexture;t.bindTexture(me,Ie),v(me),t.unbindTexture()}}}const N=[],$=[];function ie(D){if(D.samples>0){if(ve(D)===!1){const L=D.textures,J=D.width,K=D.height;let te=i.COLOR_BUFFER_BIT;const me=D.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ie=n.get(D),Pe=L.length>1;if(Pe)for(let Ye=0;Ye<L.length;Ye++)t.bindFramebuffer(i.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ye,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Ie.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ye,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer);const Ke=D.texture.mipmaps;Ke&&Ke.length>0?t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ie.__webglFramebuffer[0]):t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ie.__webglFramebuffer);for(let Ye=0;Ye<L.length;Ye++){if(D.resolveDepthBuffer&&(D.depthBuffer&&(te|=i.DEPTH_BUFFER_BIT),D.stencilBuffer&&D.resolveStencilBuffer&&(te|=i.STENCIL_BUFFER_BIT)),Pe){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Ie.__webglColorRenderbuffer[Ye]);const De=n.get(L[Ye]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,De,0)}i.blitFramebuffer(0,0,J,K,0,0,J,K,te,i.NEAREST),l===!0&&(N.length=0,$.length=0,N.push(i.COLOR_ATTACHMENT0+Ye),D.depthBuffer&&D.resolveDepthBuffer===!1&&(N.push(me),$.push(me),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,$)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,N))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Pe)for(let Ye=0;Ye<L.length;Ye++){t.bindFramebuffer(i.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ye,i.RENDERBUFFER,Ie.__webglColorRenderbuffer[Ye]);const De=n.get(L[Ye]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Ie.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ye,i.TEXTURE_2D,De,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer)}else if(D.depthBuffer&&D.resolveDepthBuffer===!1&&l){const L=D.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[L])}}}function ye(D){return Math.min(s.maxSamples,D.samples)}function ve(D){const L=n.get(D);return D.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&L.__useRenderToTexture!==!1}function k(D){const L=a.render.frame;u.get(D)!==L&&(u.set(D,L),D.update())}function V(D,L){const J=D.colorSpace,K=D.format,te=D.type;return D.isCompressedTexture===!0||D.isVideoTexture===!0||J!==ll&&J!==Xr&&(tn.getTransfer(J)===ln?(K!==Ts||te!==Zs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",J)),L}function de(D){return typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement?(c.width=D.naturalWidth||D.width,c.height=D.naturalHeight||D.height):typeof VideoFrame<"u"&&D instanceof VideoFrame?(c.width=D.displayWidth,c.height=D.displayHeight):(c.width=D.width,c.height=D.height),c}this.allocateTextureUnit=I,this.resetTextureUnits=C,this.setTexture2D=W,this.setTexture2DArray=z,this.setTexture3D=q,this.setTextureCube=O,this.rebindTextures=Y,this.setupRenderTarget=P,this.updateRenderTargetMipmap=R,this.updateMultisampleRenderTarget=ie,this.setupDepthRenderbuffer=Me,this.setupFrameBufferTexture=ue,this.useMultisampledRTT=ve}function z2(i,e){function t(n,s=Xr){let r;const a=tn.getTransfer(s);if(n===Zs)return i.UNSIGNED_BYTE;if(n===Im)return i.UNSIGNED_SHORT_4_4_4_4;if(n===Dm)return i.UNSIGNED_SHORT_5_5_5_1;if(n===jx)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===Kx)return i.UNSIGNED_INT_10F_11F_11F_REV;if(n===qx)return i.BYTE;if(n===Yx)return i.SHORT;if(n===vc)return i.UNSIGNED_SHORT;if(n===Lm)return i.INT;if(n===no)return i.UNSIGNED_INT;if(n===Sr)return i.FLOAT;if(n===Oc)return i.HALF_FLOAT;if(n===Zx)return i.ALPHA;if(n===Jx)return i.RGB;if(n===Ts)return i.RGBA;if(n===yc)return i.DEPTH_COMPONENT;if(n===xc)return i.DEPTH_STENCIL;if(n===Qx)return i.RED;if(n===km)return i.RED_INTEGER;if(n===eb)return i.RG;if(n===Bm)return i.RG_INTEGER;if(n===Om)return i.RGBA_INTEGER;if(n===zu||n===Vu||n===Gu||n===Hu)if(a===ln)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(n===zu)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Vu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Gu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Hu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(n===zu)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Vu)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Gu)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Hu)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===cp||n===up||n===dp||n===hp)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(n===cp)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===up)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===dp)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===hp)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===fp||n===pp||n===mp)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(n===fp||n===pp)return a===ln?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===mp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===_p||n===vp||n===gp||n===yp||n===xp||n===bp||n===wp||n===Sp||n===Ep||n===Mp||n===Tp||n===Ap||n===Cp||n===Pp)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(n===_p)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===vp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===gp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===yp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===xp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===bp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===wp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Sp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Ep)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Mp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Tp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Ap)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Cp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Pp)return a===ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Rp||n===Lp||n===Ip)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(n===Rp)return a===ln?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Lp)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Ip)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Dp||n===kp||n===Bp||n===Op)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(n===Dp)return r.COMPRESSED_RED_RGTC1_EXT;if(n===kp)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Bp)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Op)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===gc?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const V2=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,G2=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class H2{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new hb(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new oa({vertexShader:V2,fragmentShader:G2,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new yn(new va(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class W2 extends uo{constructor(e,t){super();const n=this;let s=null,r=1,a=null,o="local-floor",l=1,c=null,u=null,d=null,h=null,f=null,p=null;const m=typeof XRWebGLBinding<"u",_=new H2,v={},x=t.getContextAttributes();let y=null,g=null;const w=[],b=[],T=new Lt;let E=null;const S=new An;S.viewport=new Cn;const M=new An;M.viewport=new Cn;const A=[S,M],C=new uP;let I=null,H=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(X){let Q=w[X];return Q===void 0&&(Q=new qh,w[X]=Q),Q.getTargetRaySpace()},this.getControllerGrip=function(X){let Q=w[X];return Q===void 0&&(Q=new qh,w[X]=Q),Q.getGripSpace()},this.getHand=function(X){let Q=w[X];return Q===void 0&&(Q=new qh,w[X]=Q),Q.getHandSpace()};function W(X){const Q=b.indexOf(X.inputSource);if(Q===-1)return;const ue=w[Q];ue!==void 0&&(ue.update(X.inputSource,X.frame,c||a),ue.dispatchEvent({type:X.type,data:X.inputSource}))}function z(){s.removeEventListener("select",W),s.removeEventListener("selectstart",W),s.removeEventListener("selectend",W),s.removeEventListener("squeeze",W),s.removeEventListener("squeezestart",W),s.removeEventListener("squeezeend",W),s.removeEventListener("end",z),s.removeEventListener("inputsourceschange",q);for(let X=0;X<w.length;X++){const Q=b[X];Q!==null&&(b[X]=null,w[X].disconnect(Q))}I=null,H=null,_.reset();for(const X in v)delete v[X];e.setRenderTarget(y),f=null,h=null,d=null,s=null,g=null,F.stop(),n.isPresenting=!1,e.setPixelRatio(E),e.setSize(T.width,T.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(X){r=X,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(X){o=X,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(X){c=X},this.getBaseLayer=function(){return h!==null?h:f},this.getBinding=function(){return d===null&&m&&(d=new XRWebGLBinding(s,t)),d},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(X){if(s=X,s!==null){if(y=e.getRenderTarget(),s.addEventListener("select",W),s.addEventListener("selectstart",W),s.addEventListener("selectend",W),s.addEventListener("squeeze",W),s.addEventListener("squeezestart",W),s.addEventListener("squeezeend",W),s.addEventListener("end",z),s.addEventListener("inputsourceschange",q),x.xrCompatible!==!0&&await t.makeXRCompatible(),E=e.getPixelRatio(),e.getSize(T),m&&"createProjectionLayer"in XRWebGLBinding.prototype){let ue=null,ce=null,xe=null;x.depth&&(xe=x.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ue=x.stencil?xc:yc,ce=x.stencil?gc:no);const Me={colorFormat:t.RGBA8,depthFormat:xe,scaleFactor:r};d=this.getBinding(),h=d.createProjectionLayer(Me),s.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),g=new so(h.textureWidth,h.textureHeight,{format:Ts,type:Zs,depthTexture:new db(h.textureWidth,h.textureHeight,ce,void 0,void 0,void 0,void 0,void 0,void 0,ue),stencilBuffer:x.stencil,colorSpace:e.outputColorSpace,samples:x.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1,resolveStencilBuffer:h.ignoreDepthValues===!1})}else{const ue={antialias:x.antialias,alpha:!0,depth:x.depth,stencil:x.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(s,t,ue),s.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),g=new so(f.framebufferWidth,f.framebufferHeight,{format:Ts,type:Zs,colorSpace:e.outputColorSpace,stencilBuffer:x.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}g.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await s.requestReferenceSpace(o),F.setContext(s),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};function q(X){for(let Q=0;Q<X.removed.length;Q++){const ue=X.removed[Q],ce=b.indexOf(ue);ce>=0&&(b[ce]=null,w[ce].disconnect(ue))}for(let Q=0;Q<X.added.length;Q++){const ue=X.added[Q];let ce=b.indexOf(ue);if(ce===-1){for(let Me=0;Me<w.length;Me++)if(Me>=b.length){b.push(ue),ce=Me;break}else if(b[Me]===null){b[Me]=ue,ce=Me;break}if(ce===-1)break}const xe=w[ce];xe&&xe.connect(ue)}}const O=new fe,re=new fe;function le(X,Q,ue){O.setFromMatrixPosition(Q.matrixWorld),re.setFromMatrixPosition(ue.matrixWorld);const ce=O.distanceTo(re),xe=Q.projectionMatrix.elements,Me=ue.projectionMatrix.elements,Y=xe[14]/(xe[10]-1),P=xe[14]/(xe[10]+1),R=(xe[9]+1)/xe[5],N=(xe[9]-1)/xe[5],$=(xe[8]-1)/xe[0],ie=(Me[8]+1)/Me[0],ye=Y*$,ve=Y*ie,k=ce/(-$+ie),V=k*-$;if(Q.matrixWorld.decompose(X.position,X.quaternion,X.scale),X.translateX(V),X.translateZ(k),X.matrixWorld.compose(X.position,X.quaternion,X.scale),X.matrixWorldInverse.copy(X.matrixWorld).invert(),xe[10]===-1)X.projectionMatrix.copy(Q.projectionMatrix),X.projectionMatrixInverse.copy(Q.projectionMatrixInverse);else{const de=Y+k,D=P+k,L=ye-V,J=ve+(ce-V),K=R*P/D*de,te=N*P/D*de;X.projectionMatrix.makePerspective(L,J,K,te,de,D),X.projectionMatrixInverse.copy(X.projectionMatrix).invert()}}function Z(X,Q){Q===null?X.matrixWorld.copy(X.matrix):X.matrixWorld.multiplyMatrices(Q.matrixWorld,X.matrix),X.matrixWorldInverse.copy(X.matrixWorld).invert()}this.updateCamera=function(X){if(s===null)return;let Q=X.near,ue=X.far;_.texture!==null&&(_.depthNear>0&&(Q=_.depthNear),_.depthFar>0&&(ue=_.depthFar)),C.near=M.near=S.near=Q,C.far=M.far=S.far=ue,(I!==C.near||H!==C.far)&&(s.updateRenderState({depthNear:C.near,depthFar:C.far}),I=C.near,H=C.far),C.layers.mask=X.layers.mask|6,S.layers.mask=C.layers.mask&3,M.layers.mask=C.layers.mask&5;const ce=X.parent,xe=C.cameras;Z(C,ce);for(let Me=0;Me<xe.length;Me++)Z(xe[Me],ce);xe.length===2?le(C,S,M):C.projectionMatrix.copy(S.projectionMatrix),ne(X,C,ce)};function ne(X,Q,ue){ue===null?X.matrix.copy(Q.matrixWorld):(X.matrix.copy(ue.matrixWorld),X.matrix.invert(),X.matrix.multiply(Q.matrixWorld)),X.matrix.decompose(X.position,X.quaternion,X.scale),X.updateMatrixWorld(!0),X.projectionMatrix.copy(Q.projectionMatrix),X.projectionMatrixInverse.copy(Q.projectionMatrixInverse),X.isPerspectiveCamera&&(X.fov=hd*2*Math.atan(1/X.projectionMatrix.elements[5]),X.zoom=1)}this.getCamera=function(){return C},this.getFoveation=function(){if(!(h===null&&f===null))return l},this.setFoveation=function(X){l=X,h!==null&&(h.fixedFoveation=X),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=X)},this.hasDepthSensing=function(){return _.texture!==null},this.getDepthSensingMesh=function(){return _.getMesh(C)},this.getCameraTexture=function(X){return v[X]};let j=null;function ee(X,Q){if(u=Q.getViewerPose(c||a),p=Q,u!==null){const ue=u.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let ce=!1;ue.length!==C.cameras.length&&(C.cameras.length=0,ce=!0);for(let P=0;P<ue.length;P++){const R=ue[P];let N=null;if(f!==null)N=f.getViewport(R);else{const ie=d.getViewSubImage(h,R);N=ie.viewport,P===0&&(e.setRenderTargetTextures(g,ie.colorTexture,ie.depthStencilTexture),e.setRenderTarget(g))}let $=A[P];$===void 0&&($=new An,$.layers.enable(P),$.viewport=new Cn,A[P]=$),$.matrix.fromArray(R.transform.matrix),$.matrix.decompose($.position,$.quaternion,$.scale),$.projectionMatrix.fromArray(R.projectionMatrix),$.projectionMatrixInverse.copy($.projectionMatrix).invert(),$.viewport.set(N.x,N.y,N.width,N.height),P===0&&(C.matrix.copy($.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),ce===!0&&C.cameras.push($)}const xe=s.enabledFeatures;if(xe&&xe.includes("depth-sensing")&&s.depthUsage=="gpu-optimized"&&m){d=n.getBinding();const P=d.getDepthInformation(ue[0]);P&&P.isValid&&P.texture&&_.init(P,s.renderState)}if(xe&&xe.includes("camera-access")&&m){e.state.unbindTexture(),d=n.getBinding();for(let P=0;P<ue.length;P++){const R=ue[P].camera;if(R){let N=v[R];N||(N=new hb,v[R]=N);const $=d.getCameraImage(R);N.sourceTexture=$}}}}for(let ue=0;ue<w.length;ue++){const ce=b[ue],xe=w[ue];ce!==null&&xe!==void 0&&xe.update(ce,Q,c||a)}j&&j(X,Q),Q.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Q}),p=null}const F=new _b;F.setAnimationLoop(ee),this.setAnimationLoop=function(X){j=X},this.dispose=function(){}}}const Da=new Zi,$2=new Tn;function X2(i,e){function t(_,v){_.matrixAutoUpdate===!0&&_.updateMatrix(),v.value.copy(_.matrix)}function n(_,v){v.color.getRGB(_.fogColor.value,ob(i)),v.isFog?(_.fogNear.value=v.near,_.fogFar.value=v.far):v.isFogExp2&&(_.fogDensity.value=v.density)}function s(_,v,x,y,g){v.isMeshBasicMaterial||v.isMeshLambertMaterial?r(_,v):v.isMeshToonMaterial?(r(_,v),d(_,v)):v.isMeshPhongMaterial?(r(_,v),u(_,v)):v.isMeshStandardMaterial?(r(_,v),h(_,v),v.isMeshPhysicalMaterial&&f(_,v,g)):v.isMeshMatcapMaterial?(r(_,v),p(_,v)):v.isMeshDepthMaterial?r(_,v):v.isMeshDistanceMaterial?(r(_,v),m(_,v)):v.isMeshNormalMaterial?r(_,v):v.isLineBasicMaterial?(a(_,v),v.isLineDashedMaterial&&o(_,v)):v.isPointsMaterial?l(_,v,x,y):v.isSpriteMaterial?c(_,v):v.isShadowMaterial?(_.color.value.copy(v.color),_.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function r(_,v){_.opacity.value=v.opacity,v.color&&_.diffuse.value.copy(v.color),v.emissive&&_.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(_.map.value=v.map,t(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,t(v.alphaMap,_.alphaMapTransform)),v.bumpMap&&(_.bumpMap.value=v.bumpMap,t(v.bumpMap,_.bumpMapTransform),_.bumpScale.value=v.bumpScale,v.side===Di&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,t(v.normalMap,_.normalMapTransform),_.normalScale.value.copy(v.normalScale),v.side===Di&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,t(v.displacementMap,_.displacementMapTransform),_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,_.emissiveMapTransform)),v.specularMap&&(_.specularMap.value=v.specularMap,t(v.specularMap,_.specularMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);const x=e.get(v),y=x.envMap,g=x.envMapRotation;y&&(_.envMap.value=y,Da.copy(g),Da.x*=-1,Da.y*=-1,Da.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(Da.y*=-1,Da.z*=-1),_.envMapRotation.value.setFromMatrix4($2.makeRotationFromEuler(Da)),_.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=v.reflectivity,_.ior.value=v.ior,_.refractionRatio.value=v.refractionRatio),v.lightMap&&(_.lightMap.value=v.lightMap,_.lightMapIntensity.value=v.lightMapIntensity,t(v.lightMap,_.lightMapTransform)),v.aoMap&&(_.aoMap.value=v.aoMap,_.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,_.aoMapTransform))}function a(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,v.map&&(_.map.value=v.map,t(v.map,_.mapTransform))}function o(_,v){_.dashSize.value=v.dashSize,_.totalSize.value=v.dashSize+v.gapSize,_.scale.value=v.scale}function l(_,v,x,y){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.size.value=v.size*x,_.scale.value=y*.5,v.map&&(_.map.value=v.map,t(v.map,_.uvTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,t(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function c(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.rotation.value=v.rotation,v.map&&(_.map.value=v.map,t(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,t(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function u(_,v){_.specular.value.copy(v.specular),_.shininess.value=Math.max(v.shininess,1e-4)}function d(_,v){v.gradientMap&&(_.gradientMap.value=v.gradientMap)}function h(_,v){_.metalness.value=v.metalness,v.metalnessMap&&(_.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,_.metalnessMapTransform)),_.roughness.value=v.roughness,v.roughnessMap&&(_.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,_.roughnessMapTransform)),v.envMap&&(_.envMapIntensity.value=v.envMapIntensity)}function f(_,v,x){_.ior.value=v.ior,v.sheen>0&&(_.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),_.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(_.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,_.sheenColorMapTransform)),v.sheenRoughnessMap&&(_.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,_.sheenRoughnessMapTransform))),v.clearcoat>0&&(_.clearcoat.value=v.clearcoat,_.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(_.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,_.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(_.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===Di&&_.clearcoatNormalScale.value.negate())),v.dispersion>0&&(_.dispersion.value=v.dispersion),v.iridescence>0&&(_.iridescence.value=v.iridescence,_.iridescenceIOR.value=v.iridescenceIOR,_.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(_.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,_.iridescenceMapTransform)),v.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),v.transmission>0&&(_.transmission.value=v.transmission,_.transmissionSamplerMap.value=x.texture,_.transmissionSamplerSize.value.set(x.width,x.height),v.transmissionMap&&(_.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,_.transmissionMapTransform)),_.thickness.value=v.thickness,v.thicknessMap&&(_.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=v.attenuationDistance,_.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(_.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(_.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=v.specularIntensity,_.specularColor.value.copy(v.specularColor),v.specularColorMap&&(_.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,_.specularColorMapTransform)),v.specularIntensityMap&&(_.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,_.specularIntensityMapTransform))}function p(_,v){v.matcap&&(_.matcap.value=v.matcap)}function m(_,v){const x=e.get(v).light;_.referencePosition.value.setFromMatrixPosition(x.matrixWorld),_.nearDistance.value=x.shadow.camera.near,_.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function q2(i,e,t,n){let s={},r={},a=[];const o=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(x,y){const g=y.program;n.uniformBlockBinding(x,g)}function c(x,y){let g=s[x.id];g===void 0&&(p(x),g=u(x),s[x.id]=g,x.addEventListener("dispose",_));const w=y.program;n.updateUBOMapping(x,w);const b=e.render.frame;r[x.id]!==b&&(h(x),r[x.id]=b)}function u(x){const y=d();x.__bindingPointIndex=y;const g=i.createBuffer(),w=x.__size,b=x.usage;return i.bindBuffer(i.UNIFORM_BUFFER,g),i.bufferData(i.UNIFORM_BUFFER,w,b),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,y,g),g}function d(){for(let x=0;x<o;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(x){const y=s[x.id],g=x.uniforms,w=x.__cache;i.bindBuffer(i.UNIFORM_BUFFER,y);for(let b=0,T=g.length;b<T;b++){const E=Array.isArray(g[b])?g[b]:[g[b]];for(let S=0,M=E.length;S<M;S++){const A=E[S];if(f(A,b,S,w)===!0){const C=A.__offset,I=Array.isArray(A.value)?A.value:[A.value];let H=0;for(let W=0;W<I.length;W++){const z=I[W],q=m(z);typeof z=="number"||typeof z=="boolean"?(A.__data[0]=z,i.bufferSubData(i.UNIFORM_BUFFER,C+H,A.__data)):z.isMatrix3?(A.__data[0]=z.elements[0],A.__data[1]=z.elements[1],A.__data[2]=z.elements[2],A.__data[3]=0,A.__data[4]=z.elements[3],A.__data[5]=z.elements[4],A.__data[6]=z.elements[5],A.__data[7]=0,A.__data[8]=z.elements[6],A.__data[9]=z.elements[7],A.__data[10]=z.elements[8],A.__data[11]=0):(z.toArray(A.__data,H),H+=q.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,C,A.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function f(x,y,g,w){const b=x.value,T=y+"_"+g;if(w[T]===void 0)return typeof b=="number"||typeof b=="boolean"?w[T]=b:w[T]=b.clone(),!0;{const E=w[T];if(typeof b=="number"||typeof b=="boolean"){if(E!==b)return w[T]=b,!0}else if(E.equals(b)===!1)return E.copy(b),!0}return!1}function p(x){const y=x.uniforms;let g=0;const w=16;for(let T=0,E=y.length;T<E;T++){const S=Array.isArray(y[T])?y[T]:[y[T]];for(let M=0,A=S.length;M<A;M++){const C=S[M],I=Array.isArray(C.value)?C.value:[C.value];for(let H=0,W=I.length;H<W;H++){const z=I[H],q=m(z),O=g%w,re=O%q.boundary,le=O+re;g+=re,le!==0&&w-le<q.storage&&(g+=w-le),C.__data=new Float32Array(q.storage/Float32Array.BYTES_PER_ELEMENT),C.__offset=g,g+=q.storage}}}const b=g%w;return b>0&&(g+=w-b),x.__size=g,x.__cache={},this}function m(x){const y={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(y.boundary=4,y.storage=4):x.isVector2?(y.boundary=8,y.storage=8):x.isVector3||x.isColor?(y.boundary=16,y.storage=12):x.isVector4?(y.boundary=16,y.storage=16):x.isMatrix3?(y.boundary=48,y.storage=48):x.isMatrix4?(y.boundary=64,y.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),y}function _(x){const y=x.target;y.removeEventListener("dispose",_);const g=a.indexOf(y.__bindingPointIndex);a.splice(g,1),i.deleteBuffer(s[y.id]),delete s[y.id],delete r[y.id]}function v(){for(const x in s)i.deleteBuffer(s[x]);a=[],s={},r={}}return{bind:l,update:c,dispose:v}}class er{constructor(e={}){const{canvas:t=EC(),context:n=null,depth:s=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reversedDepthBuffer:h=!1}=e;this.isWebGLRenderer=!0;let f;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=n.getContextAttributes().alpha}else f=a;const p=new Uint32Array(4),m=new Int32Array(4);let _=null,v=null;const x=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Qr,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const g=this;let w=!1;this._outputColorSpace=ls;let b=0,T=0,E=null,S=-1,M=null;const A=new Cn,C=new Cn;let I=null;const H=new Mt(0);let W=0,z=t.width,q=t.height,O=1,re=null,le=null;const Z=new Cn(0,0,z,q),ne=new Cn(0,0,z,q);let j=!1;const ee=new zm;let F=!1,X=!1;const Q=new Tn,ue=new fe,ce=new Cn,xe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Me=!1;function Y(){return E===null?O:1}let P=n;function R(U,he){return t.getContext(U,he)}try{const U={alpha:!0,depth:s,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Pm}`),t.addEventListener("webglcontextlost",Ge,!1),t.addEventListener("webglcontextrestored",st,!1),t.addEventListener("webglcontextcreationerror",Fe,!1),P===null){const he="webgl2";if(P=R(he,U),P===null)throw R(he)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(U){throw console.error("THREE.WebGLRenderer: "+U.message),U}let N,$,ie,ye,ve,k,V,de,D,L,J,K,te,me,Ie,Pe,Ke,Ye,De,Xe,dt,at,qe,bt;function pe(){N=new sI(P),N.init(),at=new z2(P,N),$=new ZL(P,N,e,at),ie=new F2(P,N),$.reversedDepthBuffer&&h&&ie.buffers.depth.setReversed(!0),ye=new oI(P),ve=new M2,k=new U2(P,N,ie,ve,$,at,ye),V=new QL(g),de=new iI(g),D=new fP(P),qe=new jL(P,D),L=new rI(P,D,ye,qe),J=new cI(P,L,D,ye),De=new lI(P,$,k),Pe=new JL(ve),K=new E2(g,V,de,N,$,qe,Pe),te=new X2(g,ve),me=new A2,Ie=new D2(N),Ye=new YL(g,V,de,ie,J,f,l),Ke=new O2(g,J,$),bt=new q2(P,ye,$,ie),Xe=new KL(P,N,ye),dt=new aI(P,N,ye),ye.programs=K.programs,g.capabilities=$,g.extensions=N,g.properties=ve,g.renderLists=me,g.shadowMap=Ke,g.state=ie,g.info=ye}pe();const Ne=new W2(g,P);this.xr=Ne,this.getContext=function(){return P},this.getContextAttributes=function(){return P.getContextAttributes()},this.forceContextLoss=function(){const U=N.get("WEBGL_lose_context");U&&U.loseContext()},this.forceContextRestore=function(){const U=N.get("WEBGL_lose_context");U&&U.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(U){U!==void 0&&(O=U,this.setSize(z,q,!1))},this.getSize=function(U){return U.set(z,q)},this.setSize=function(U,he,Se=!0){if(Ne.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}z=U,q=he,t.width=Math.floor(U*O),t.height=Math.floor(he*O),Se===!0&&(t.style.width=U+"px",t.style.height=he+"px"),this.setViewport(0,0,U,he)},this.getDrawingBufferSize=function(U){return U.set(z*O,q*O).floor()},this.setDrawingBufferSize=function(U,he,Se){z=U,q=he,O=Se,t.width=Math.floor(U*Se),t.height=Math.floor(he*Se),this.setViewport(0,0,U,he)},this.getCurrentViewport=function(U){return U.copy(A)},this.getViewport=function(U){return U.copy(Z)},this.setViewport=function(U,he,Se,be){U.isVector4?Z.set(U.x,U.y,U.z,U.w):Z.set(U,he,Se,be),ie.viewport(A.copy(Z).multiplyScalar(O).round())},this.getScissor=function(U){return U.copy(ne)},this.setScissor=function(U,he,Se,be){U.isVector4?ne.set(U.x,U.y,U.z,U.w):ne.set(U,he,Se,be),ie.scissor(C.copy(ne).multiplyScalar(O).round())},this.getScissorTest=function(){return j},this.setScissorTest=function(U){ie.setScissorTest(j=U)},this.setOpaqueSort=function(U){re=U},this.setTransparentSort=function(U){le=U},this.getClearColor=function(U){return U.copy(Ye.getClearColor())},this.setClearColor=function(){Ye.setClearColor(...arguments)},this.getClearAlpha=function(){return Ye.getClearAlpha()},this.setClearAlpha=function(){Ye.setClearAlpha(...arguments)},this.clear=function(U=!0,he=!0,Se=!0){let be=0;if(U){let _e=!1;if(E!==null){const Te=E.texture.format;_e=Te===Om||Te===Bm||Te===km}if(_e){const Te=E.texture.type,je=Te===Zs||Te===no||Te===vc||Te===gc||Te===Im||Te===Dm,lt=Ye.getClearColor(),it=Ye.getClearAlpha(),gt=lt.r,vt=lt.g,et=lt.b;je?(p[0]=gt,p[1]=vt,p[2]=et,p[3]=it,P.clearBufferuiv(P.COLOR,0,p)):(m[0]=gt,m[1]=vt,m[2]=et,m[3]=it,P.clearBufferiv(P.COLOR,0,m))}else be|=P.COLOR_BUFFER_BIT}he&&(be|=P.DEPTH_BUFFER_BIT),Se&&(be|=P.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),P.clear(be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ge,!1),t.removeEventListener("webglcontextrestored",st,!1),t.removeEventListener("webglcontextcreationerror",Fe,!1),Ye.dispose(),me.dispose(),Ie.dispose(),ve.dispose(),V.dispose(),de.dispose(),J.dispose(),qe.dispose(),bt.dispose(),K.dispose(),Ne.dispose(),Ne.removeEventListener("sessionstart",Ce),Ne.removeEventListener("sessionend",Be),ke.stop()};function Ge(U){U.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function st(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const U=ye.autoReset,he=Ke.enabled,Se=Ke.autoUpdate,be=Ke.needsUpdate,_e=Ke.type;pe(),ye.autoReset=U,Ke.enabled=he,Ke.autoUpdate=Se,Ke.needsUpdate=be,Ke.type=_e}function Fe(U){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",U.statusMessage)}function Re(U){const he=U.target;he.removeEventListener("dispose",Re),pt(he)}function pt(U){Tt(U),ve.remove(U)}function Tt(U){const he=ve.get(U).programs;he!==void 0&&(he.forEach(function(Se){K.releaseProgram(Se)}),U.isShaderMaterial&&K.releaseShaderCache(U))}this.renderBufferDirect=function(U,he,Se,be,_e,Te){he===null&&(he=xe);const je=_e.isMesh&&_e.matrixWorld.determinant()<0,lt=Ze(U,he,Se,be,_e);ie.setMaterial(be,je);let it=Se.index,gt=1;if(be.wireframe===!0){if(it=L.getWireframeAttribute(Se),it===void 0)return;gt=2}const vt=Se.drawRange,et=Se.attributes.position;let Dt=vt.start*gt,St=(vt.start+vt.count)*gt;Te!==null&&(Dt=Math.max(Dt,Te.start*gt),St=Math.min(St,(Te.start+Te.count)*gt)),it!==null?(Dt=Math.max(Dt,0),St=Math.min(St,it.count)):et!=null&&(Dt=Math.max(Dt,0),St=Math.min(St,et.count));const Qt=St-Dt;if(Qt<0||Qt===1/0)return;qe.setup(_e,be,lt,Se,it);let zt,Bt=Xe;if(it!==null&&(zt=D.get(it),Bt=dt,Bt.setIndex(zt)),_e.isMesh)be.wireframe===!0?(ie.setLineWidth(be.wireframeLinewidth*Y()),Bt.setMode(P.LINES)):Bt.setMode(P.TRIANGLES);else if(_e.isLine){let ft=be.linewidth;ft===void 0&&(ft=1),ie.setLineWidth(ft*Y()),_e.isLineSegments?Bt.setMode(P.LINES):_e.isLineLoop?Bt.setMode(P.LINE_LOOP):Bt.setMode(P.LINE_STRIP)}else _e.isPoints?Bt.setMode(P.POINTS):_e.isSprite&&Bt.setMode(P.TRIANGLES);if(_e.isBatchedMesh)if(_e._multiDrawInstances!==null)wc("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Bt.renderMultiDrawInstances(_e._multiDrawStarts,_e._multiDrawCounts,_e._multiDrawCount,_e._multiDrawInstances);else if(N.get("WEBGL_multi_draw"))Bt.renderMultiDraw(_e._multiDrawStarts,_e._multiDrawCounts,_e._multiDrawCount);else{const ft=_e._multiDrawStarts,Yt=_e._multiDrawCounts,Nt=_e._multiDrawCount,yt=it?D.get(it).bytesPerElement:1,On=ve.get(be).currentProgram.getUniforms();for(let en=0;en<Nt;en++)On.setValue(P,"_gl_DrawID",en),Bt.render(ft[en]/yt,Yt[en])}else if(_e.isInstancedMesh)Bt.renderInstances(Dt,Qt,_e.count);else if(Se.isInstancedBufferGeometry){const ft=Se._maxInstanceCount!==void 0?Se._maxInstanceCount:1/0,Yt=Math.min(Se.instanceCount,ft);Bt.renderInstances(Dt,Qt,Yt)}else Bt.render(Dt,Qt)};function Jt(U,he,Se){U.transparent===!0&&U.side===ws&&U.forceSinglePass===!1?(U.side=Di,U.needsUpdate=!0,We(U,he,Se),U.side=aa,U.needsUpdate=!0,We(U,he,Se),U.side=ws):We(U,he,Se)}this.compile=function(U,he,Se=null){Se===null&&(Se=U),v=Ie.get(Se),v.init(he),y.push(v),Se.traverseVisible(function(_e){_e.isLight&&_e.layers.test(he.layers)&&(v.pushLight(_e),_e.castShadow&&v.pushShadow(_e))}),U!==Se&&U.traverseVisible(function(_e){_e.isLight&&_e.layers.test(he.layers)&&(v.pushLight(_e),_e.castShadow&&v.pushShadow(_e))}),v.setupLights();const be=new Set;return U.traverse(function(_e){if(!(_e.isMesh||_e.isPoints||_e.isLine||_e.isSprite))return;const Te=_e.material;if(Te)if(Array.isArray(Te))for(let je=0;je<Te.length;je++){const lt=Te[je];Jt(lt,Se,_e),be.add(lt)}else Jt(Te,Se,_e),be.add(Te)}),v=y.pop(),be},this.compileAsync=function(U,he,Se=null){const be=this.compile(U,he,Se);return new Promise(_e=>{function Te(){if(be.forEach(function(je){ve.get(je).currentProgram.isReady()&&be.delete(je)}),be.size===0){_e(U);return}setTimeout(Te,10)}N.get("KHR_parallel_shader_compile")!==null?Te():setTimeout(Te,10)})};let Ct=null;function Ae(U){Ct&&Ct(U)}function Ce(){ke.stop()}function Be(){ke.start()}const ke=new _b;ke.setAnimationLoop(Ae),typeof self<"u"&&ke.setContext(self),this.setAnimationLoop=function(U){Ct=U,Ne.setAnimationLoop(U),U===null?ke.stop():ke.start()},Ne.addEventListener("sessionstart",Ce),Ne.addEventListener("sessionend",Be),this.render=function(U,he){if(he!==void 0&&he.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;if(U.matrixWorldAutoUpdate===!0&&U.updateMatrixWorld(),he.parent===null&&he.matrixWorldAutoUpdate===!0&&he.updateMatrixWorld(),Ne.enabled===!0&&Ne.isPresenting===!0&&(Ne.cameraAutoUpdate===!0&&Ne.updateCamera(he),he=Ne.getCamera()),U.isScene===!0&&U.onBeforeRender(g,U,he,E),v=Ie.get(U,y.length),v.init(he),y.push(v),Q.multiplyMatrices(he.projectionMatrix,he.matrixWorldInverse),ee.setFromProjectionMatrix(Q,qs,he.reversedDepth),X=this.localClippingEnabled,F=Pe.init(this.clippingPlanes,X),_=me.get(U,x.length),_.init(),x.push(_),Ne.enabled===!0&&Ne.isPresenting===!0){const Te=g.xr.getDepthSensingMesh();Te!==null&&Et(Te,he,-1/0,g.sortObjects)}Et(U,he,0,g.sortObjects),_.finish(),g.sortObjects===!0&&_.sort(re,le),Me=Ne.enabled===!1||Ne.isPresenting===!1||Ne.hasDepthSensing()===!1,Me&&Ye.addToRenderList(_,U),this.info.render.frame++,F===!0&&Pe.beginShadows();const Se=v.state.shadowsArray;Ke.render(Se,U,he),F===!0&&Pe.endShadows(),this.info.autoReset===!0&&this.info.reset();const be=_.opaque,_e=_.transmissive;if(v.setupLights(),he.isArrayCamera){const Te=he.cameras;if(_e.length>0)for(let je=0,lt=Te.length;je<lt;je++){const it=Te[je];$e(be,_e,U,it)}Me&&Ye.render(U);for(let je=0,lt=Te.length;je<lt;je++){const it=Te[je];rt(_,U,it,it.viewport)}}else _e.length>0&&$e(be,_e,U,he),Me&&Ye.render(U),rt(_,U,he);E!==null&&T===0&&(k.updateMultisampleRenderTarget(E),k.updateRenderTargetMipmap(E)),U.isScene===!0&&U.onAfterRender(g,U,he),qe.resetDefaultState(),S=-1,M=null,y.pop(),y.length>0?(v=y[y.length-1],F===!0&&Pe.setGlobalState(g.clippingPlanes,v.state.camera)):v=null,x.pop(),x.length>0?_=x[x.length-1]:_=null};function Et(U,he,Se,be){if(U.visible===!1)return;if(U.layers.test(he.layers)){if(U.isGroup)Se=U.renderOrder;else if(U.isLOD)U.autoUpdate===!0&&U.update(he);else if(U.isLight)v.pushLight(U),U.castShadow&&v.pushShadow(U);else if(U.isSprite){if(!U.frustumCulled||ee.intersectsSprite(U)){be&&ce.setFromMatrixPosition(U.matrixWorld).applyMatrix4(Q);const je=J.update(U),lt=U.material;lt.visible&&_.push(U,je,lt,Se,ce.z,null)}}else if((U.isMesh||U.isLine||U.isPoints)&&(!U.frustumCulled||ee.intersectsObject(U))){const je=J.update(U),lt=U.material;if(be&&(U.boundingSphere!==void 0?(U.boundingSphere===null&&U.computeBoundingSphere(),ce.copy(U.boundingSphere.center)):(je.boundingSphere===null&&je.computeBoundingSphere(),ce.copy(je.boundingSphere.center)),ce.applyMatrix4(U.matrixWorld).applyMatrix4(Q)),Array.isArray(lt)){const it=je.groups;for(let gt=0,vt=it.length;gt<vt;gt++){const et=it[gt],Dt=lt[et.materialIndex];Dt&&Dt.visible&&_.push(U,je,Dt,Se,ce.z,et)}}else lt.visible&&_.push(U,je,lt,Se,ce.z,null)}}const Te=U.children;for(let je=0,lt=Te.length;je<lt;je++)Et(Te[je],he,Se,be)}function rt(U,he,Se,be){const _e=U.opaque,Te=U.transmissive,je=U.transparent;v.setupLightsView(Se),F===!0&&Pe.setGlobalState(g.clippingPlanes,Se),be&&ie.viewport(A.copy(be)),_e.length>0&&Je(_e,he,Se),Te.length>0&&Je(Te,he,Se),je.length>0&&Je(je,he,Se),ie.buffers.depth.setTest(!0),ie.buffers.depth.setMask(!0),ie.buffers.color.setMask(!0),ie.setPolygonOffset(!1)}function $e(U,he,Se,be){if((Se.isScene===!0?Se.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[be.id]===void 0&&(v.state.transmissionRenderTarget[be.id]=new so(1,1,{generateMipmaps:!0,type:N.has("EXT_color_buffer_half_float")||N.has("EXT_color_buffer_float")?Oc:Zs,minFilter:qa,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:tn.workingColorSpace}));const Te=v.state.transmissionRenderTarget[be.id],je=be.viewport||A;Te.setSize(je.z*g.transmissionResolutionScale,je.w*g.transmissionResolutionScale);const lt=g.getRenderTarget(),it=g.getActiveCubeFace(),gt=g.getActiveMipmapLevel();g.setRenderTarget(Te),g.getClearColor(H),W=g.getClearAlpha(),W<1&&g.setClearColor(16777215,.5),g.clear(),Me&&Ye.render(Se);const vt=g.toneMapping;g.toneMapping=Qr;const et=be.viewport;if(be.viewport!==void 0&&(be.viewport=void 0),v.setupLightsView(be),F===!0&&Pe.setGlobalState(g.clippingPlanes,be),Je(U,Se,be),k.updateMultisampleRenderTarget(Te),k.updateRenderTargetMipmap(Te),N.has("WEBGL_multisampled_render_to_texture")===!1){let Dt=!1;for(let St=0,Qt=he.length;St<Qt;St++){const zt=he[St],Bt=zt.object,ft=zt.geometry,Yt=zt.material,Nt=zt.group;if(Yt.side===ws&&Bt.layers.test(be.layers)){const yt=Yt.side;Yt.side=Di,Yt.needsUpdate=!0,Ee(Bt,Se,be,ft,Yt,Nt),Yt.side=yt,Yt.needsUpdate=!0,Dt=!0}}Dt===!0&&(k.updateMultisampleRenderTarget(Te),k.updateRenderTargetMipmap(Te))}g.setRenderTarget(lt,it,gt),g.setClearColor(H,W),et!==void 0&&(be.viewport=et),g.toneMapping=vt}function Je(U,he,Se){const be=he.isScene===!0?he.overrideMaterial:null;for(let _e=0,Te=U.length;_e<Te;_e++){const je=U[_e],lt=je.object,it=je.geometry,gt=je.group;let vt=je.material;vt.allowOverride===!0&&be!==null&&(vt=be),lt.layers.test(Se.layers)&&Ee(lt,he,Se,it,vt,gt)}}function Ee(U,he,Se,be,_e,Te){U.onBeforeRender(g,he,Se,be,_e,Te),U.modelViewMatrix.multiplyMatrices(Se.matrixWorldInverse,U.matrixWorld),U.normalMatrix.getNormalMatrix(U.modelViewMatrix),_e.onBeforeRender(g,he,Se,be,U,Te),_e.transparent===!0&&_e.side===ws&&_e.forceSinglePass===!1?(_e.side=Di,_e.needsUpdate=!0,g.renderBufferDirect(Se,he,be,_e,U,Te),_e.side=aa,_e.needsUpdate=!0,g.renderBufferDirect(Se,he,be,_e,U,Te),_e.side=ws):g.renderBufferDirect(Se,he,be,_e,U,Te),U.onAfterRender(g,he,Se,be,_e,Te)}function We(U,he,Se){he.isScene!==!0&&(he=xe);const be=ve.get(U),_e=v.state.lights,Te=v.state.shadowsArray,je=_e.state.version,lt=K.getParameters(U,_e.state,Te,he,Se),it=K.getProgramCacheKey(lt);let gt=be.programs;be.environment=U.isMeshStandardMaterial?he.environment:null,be.fog=he.fog,be.envMap=(U.isMeshStandardMaterial?de:V).get(U.envMap||be.environment),be.envMapRotation=be.environment!==null&&U.envMap===null?he.environmentRotation:U.envMapRotation,gt===void 0&&(U.addEventListener("dispose",Re),gt=new Map,be.programs=gt);let vt=gt.get(it);if(vt!==void 0){if(be.currentProgram===vt&&be.lightsStateVersion===je)return ht(U,lt),vt}else lt.uniforms=K.getUniforms(U),U.onBeforeCompile(lt,g),vt=K.acquireProgram(lt,it),gt.set(it,vt),be.uniforms=lt.uniforms;const et=be.uniforms;return(!U.isShaderMaterial&&!U.isRawShaderMaterial||U.clipping===!0)&&(et.clippingPlanes=Pe.uniform),ht(U,lt),be.needsLights=Qe(U),be.lightsStateVersion=je,be.needsLights&&(et.ambientLightColor.value=_e.state.ambient,et.lightProbe.value=_e.state.probe,et.directionalLights.value=_e.state.directional,et.directionalLightShadows.value=_e.state.directionalShadow,et.spotLights.value=_e.state.spot,et.spotLightShadows.value=_e.state.spotShadow,et.rectAreaLights.value=_e.state.rectArea,et.ltc_1.value=_e.state.rectAreaLTC1,et.ltc_2.value=_e.state.rectAreaLTC2,et.pointLights.value=_e.state.point,et.pointLightShadows.value=_e.state.pointShadow,et.hemisphereLights.value=_e.state.hemi,et.directionalShadowMap.value=_e.state.directionalShadowMap,et.directionalShadowMatrix.value=_e.state.directionalShadowMatrix,et.spotShadowMap.value=_e.state.spotShadowMap,et.spotLightMatrix.value=_e.state.spotLightMatrix,et.spotLightMap.value=_e.state.spotLightMap,et.pointShadowMap.value=_e.state.pointShadowMap,et.pointShadowMatrix.value=_e.state.pointShadowMatrix),be.currentProgram=vt,be.uniformsList=null,vt}function nt(U){if(U.uniformsList===null){const he=U.currentProgram.getUniforms();U.uniformsList=$u.seqWithValue(he.seq,U.uniforms)}return U.uniformsList}function ht(U,he){const Se=ve.get(U);Se.outputColorSpace=he.outputColorSpace,Se.batching=he.batching,Se.batchingColor=he.batchingColor,Se.instancing=he.instancing,Se.instancingColor=he.instancingColor,Se.instancingMorph=he.instancingMorph,Se.skinning=he.skinning,Se.morphTargets=he.morphTargets,Se.morphNormals=he.morphNormals,Se.morphColors=he.morphColors,Se.morphTargetsCount=he.morphTargetsCount,Se.numClippingPlanes=he.numClippingPlanes,Se.numIntersection=he.numClipIntersection,Se.vertexAlphas=he.vertexAlphas,Se.vertexTangents=he.vertexTangents,Se.toneMapping=he.toneMapping}function Ze(U,he,Se,be,_e){he.isScene!==!0&&(he=xe),k.resetTextureUnits();const Te=he.fog,je=be.isMeshStandardMaterial?he.environment:null,lt=E===null?g.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:ll,it=(be.isMeshStandardMaterial?de:V).get(be.envMap||je),gt=be.vertexColors===!0&&!!Se.attributes.color&&Se.attributes.color.itemSize===4,vt=!!Se.attributes.tangent&&(!!be.normalMap||be.anisotropy>0),et=!!Se.morphAttributes.position,Dt=!!Se.morphAttributes.normal,St=!!Se.morphAttributes.color;let Qt=Qr;be.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(Qt=g.toneMapping);const zt=Se.morphAttributes.position||Se.morphAttributes.normal||Se.morphAttributes.color,Bt=zt!==void 0?zt.length:0,ft=ve.get(be),Yt=v.state.lights;if(F===!0&&(X===!0||U!==M)){const Vt=U===M&&be.id===S;Pe.setState(be,U,Vt)}let Nt=!1;be.version===ft.__version?(ft.needsLights&&ft.lightsStateVersion!==Yt.state.version||ft.outputColorSpace!==lt||_e.isBatchedMesh&&ft.batching===!1||!_e.isBatchedMesh&&ft.batching===!0||_e.isBatchedMesh&&ft.batchingColor===!0&&_e.colorTexture===null||_e.isBatchedMesh&&ft.batchingColor===!1&&_e.colorTexture!==null||_e.isInstancedMesh&&ft.instancing===!1||!_e.isInstancedMesh&&ft.instancing===!0||_e.isSkinnedMesh&&ft.skinning===!1||!_e.isSkinnedMesh&&ft.skinning===!0||_e.isInstancedMesh&&ft.instancingColor===!0&&_e.instanceColor===null||_e.isInstancedMesh&&ft.instancingColor===!1&&_e.instanceColor!==null||_e.isInstancedMesh&&ft.instancingMorph===!0&&_e.morphTexture===null||_e.isInstancedMesh&&ft.instancingMorph===!1&&_e.morphTexture!==null||ft.envMap!==it||be.fog===!0&&ft.fog!==Te||ft.numClippingPlanes!==void 0&&(ft.numClippingPlanes!==Pe.numPlanes||ft.numIntersection!==Pe.numIntersection)||ft.vertexAlphas!==gt||ft.vertexTangents!==vt||ft.morphTargets!==et||ft.morphNormals!==Dt||ft.morphColors!==St||ft.toneMapping!==Qt||ft.morphTargetsCount!==Bt)&&(Nt=!0):(Nt=!0,ft.__version=be.version);let yt=ft.currentProgram;Nt===!0&&(yt=We(be,he,_e));let On=!1,en=!1,zi=!1;const sn=yt.getUniforms(),Si=ft.uniforms;if(ie.useProgram(yt.program)&&(On=!0,en=!0,zi=!0),be.id!==S&&(S=be.id,en=!0),On||M!==U){ie.buffers.depth.getReversed()&&U.reversedDepth!==!0&&(U._reversedDepth=!0,U.updateProjectionMatrix()),sn.setValue(P,"projectionMatrix",U.projectionMatrix),sn.setValue(P,"viewMatrix",U.matrixWorldInverse);const Mi=sn.map.cameraPosition;Mi!==void 0&&Mi.setValue(P,ue.setFromMatrixPosition(U.matrixWorld)),$.logarithmicDepthBuffer&&sn.setValue(P,"logDepthBufFC",2/(Math.log(U.far+1)/Math.LN2)),(be.isMeshPhongMaterial||be.isMeshToonMaterial||be.isMeshLambertMaterial||be.isMeshBasicMaterial||be.isMeshStandardMaterial||be.isShaderMaterial)&&sn.setValue(P,"isOrthographic",U.isOrthographicCamera===!0),M!==U&&(M=U,en=!0,zi=!0)}if(_e.isSkinnedMesh){sn.setOptional(P,_e,"bindMatrix"),sn.setOptional(P,_e,"bindMatrixInverse");const Vt=_e.skeleton;Vt&&(Vt.boneTexture===null&&Vt.computeBoneTexture(),sn.setValue(P,"boneTexture",Vt.boneTexture,k))}_e.isBatchedMesh&&(sn.setOptional(P,_e,"batchingTexture"),sn.setValue(P,"batchingTexture",_e._matricesTexture,k),sn.setOptional(P,_e,"batchingIdTexture"),sn.setValue(P,"batchingIdTexture",_e._indirectTexture,k),sn.setOptional(P,_e,"batchingColorTexture"),_e._colorsTexture!==null&&sn.setValue(P,"batchingColorTexture",_e._colorsTexture,k));const Ei=Se.morphAttributes;if((Ei.position!==void 0||Ei.normal!==void 0||Ei.color!==void 0)&&De.update(_e,Se,yt),(en||ft.receiveShadow!==_e.receiveShadow)&&(ft.receiveShadow=_e.receiveShadow,sn.setValue(P,"receiveShadow",_e.receiveShadow)),be.isMeshGouraudMaterial&&be.envMap!==null&&(Si.envMap.value=it,Si.flipEnvMap.value=it.isCubeTexture&&it.isRenderTargetTexture===!1?-1:1),be.isMeshStandardMaterial&&be.envMap===null&&he.environment!==null&&(Si.envMapIntensity.value=he.environmentIntensity),en&&(sn.setValue(P,"toneMappingExposure",g.toneMappingExposure),ft.needsLights&&He(Si,zi),Te&&be.fog===!0&&te.refreshFogUniforms(Si,Te),te.refreshMaterialUniforms(Si,be,O,q,v.state.transmissionRenderTarget[U.id]),$u.upload(P,nt(ft),Si,k)),be.isShaderMaterial&&be.uniformsNeedUpdate===!0&&($u.upload(P,nt(ft),Si,k),be.uniformsNeedUpdate=!1),be.isSpriteMaterial&&sn.setValue(P,"center",_e.center),sn.setValue(P,"modelViewMatrix",_e.modelViewMatrix),sn.setValue(P,"normalMatrix",_e.normalMatrix),sn.setValue(P,"modelMatrix",_e.matrixWorld),be.isShaderMaterial||be.isRawShaderMaterial){const Vt=be.uniformsGroups;for(let Mi=0,lh=Vt.length;Mi<lh;Mi++){const ba=Vt[Mi];bt.update(ba,yt),bt.bind(ba,yt)}}return yt}function He(U,he){U.ambientLightColor.needsUpdate=he,U.lightProbe.needsUpdate=he,U.directionalLights.needsUpdate=he,U.directionalLightShadows.needsUpdate=he,U.pointLights.needsUpdate=he,U.pointLightShadows.needsUpdate=he,U.spotLights.needsUpdate=he,U.spotLightShadows.needsUpdate=he,U.rectAreaLights.needsUpdate=he,U.hemisphereLights.needsUpdate=he}function Qe(U){return U.isMeshLambertMaterial||U.isMeshToonMaterial||U.isMeshPhongMaterial||U.isMeshStandardMaterial||U.isShadowMaterial||U.isShaderMaterial&&U.lights===!0}this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(U,he,Se){const be=ve.get(U);be.__autoAllocateDepthBuffer=U.resolveDepthBuffer===!1,be.__autoAllocateDepthBuffer===!1&&(be.__useRenderToTexture=!1),ve.get(U.texture).__webglTexture=he,ve.get(U.depthTexture).__webglTexture=be.__autoAllocateDepthBuffer?void 0:Se,be.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(U,he){const Se=ve.get(U);Se.__webglFramebuffer=he,Se.__useDefaultFramebuffer=he===void 0};const xt=P.createFramebuffer();this.setRenderTarget=function(U,he=0,Se=0){E=U,b=he,T=Se;let be=!0,_e=null,Te=!1,je=!1;if(U){const it=ve.get(U);if(it.__useDefaultFramebuffer!==void 0)ie.bindFramebuffer(P.FRAMEBUFFER,null),be=!1;else if(it.__webglFramebuffer===void 0)k.setupRenderTarget(U);else if(it.__hasExternalTextures)k.rebindTextures(U,ve.get(U.texture).__webglTexture,ve.get(U.depthTexture).__webglTexture);else if(U.depthBuffer){const et=U.depthTexture;if(it.__boundDepthTexture!==et){if(et!==null&&ve.has(et)&&(U.width!==et.image.width||U.height!==et.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");k.setupDepthRenderbuffer(U)}}const gt=U.texture;(gt.isData3DTexture||gt.isDataArrayTexture||gt.isCompressedArrayTexture)&&(je=!0);const vt=ve.get(U).__webglFramebuffer;U.isWebGLCubeRenderTarget?(Array.isArray(vt[he])?_e=vt[he][Se]:_e=vt[he],Te=!0):U.samples>0&&k.useMultisampledRTT(U)===!1?_e=ve.get(U).__webglMultisampledFramebuffer:Array.isArray(vt)?_e=vt[Se]:_e=vt,A.copy(U.viewport),C.copy(U.scissor),I=U.scissorTest}else A.copy(Z).multiplyScalar(O).floor(),C.copy(ne).multiplyScalar(O).floor(),I=j;if(Se!==0&&(_e=xt),ie.bindFramebuffer(P.FRAMEBUFFER,_e)&&be&&ie.drawBuffers(U,_e),ie.viewport(A),ie.scissor(C),ie.setScissorTest(I),Te){const it=ve.get(U.texture);P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+he,it.__webglTexture,Se)}else if(je){const it=he;for(let gt=0;gt<U.textures.length;gt++){const vt=ve.get(U.textures[gt]);P.framebufferTextureLayer(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0+gt,vt.__webglTexture,Se,it)}}else if(U!==null&&Se!==0){const it=ve.get(U.texture);P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,it.__webglTexture,Se)}S=-1},this.readRenderTargetPixels=function(U,he,Se,be,_e,Te,je,lt=0){if(!(U&&U.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let it=ve.get(U).__webglFramebuffer;if(U.isWebGLCubeRenderTarget&&je!==void 0&&(it=it[je]),it){ie.bindFramebuffer(P.FRAMEBUFFER,it);try{const gt=U.textures[lt],vt=gt.format,et=gt.type;if(!$.textureFormatReadable(vt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!$.textureTypeReadable(et)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}he>=0&&he<=U.width-be&&Se>=0&&Se<=U.height-_e&&(U.textures.length>1&&P.readBuffer(P.COLOR_ATTACHMENT0+lt),P.readPixels(he,Se,be,_e,at.convert(vt),at.convert(et),Te))}finally{const gt=E!==null?ve.get(E).__webglFramebuffer:null;ie.bindFramebuffer(P.FRAMEBUFFER,gt)}}},this.readRenderTargetPixelsAsync=async function(U,he,Se,be,_e,Te,je,lt=0){if(!(U&&U.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let it=ve.get(U).__webglFramebuffer;if(U.isWebGLCubeRenderTarget&&je!==void 0&&(it=it[je]),it)if(he>=0&&he<=U.width-be&&Se>=0&&Se<=U.height-_e){ie.bindFramebuffer(P.FRAMEBUFFER,it);const gt=U.textures[lt],vt=gt.format,et=gt.type;if(!$.textureFormatReadable(vt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(et))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Dt=P.createBuffer();P.bindBuffer(P.PIXEL_PACK_BUFFER,Dt),P.bufferData(P.PIXEL_PACK_BUFFER,Te.byteLength,P.STREAM_READ),U.textures.length>1&&P.readBuffer(P.COLOR_ATTACHMENT0+lt),P.readPixels(he,Se,be,_e,at.convert(vt),at.convert(et),0);const St=E!==null?ve.get(E).__webglFramebuffer:null;ie.bindFramebuffer(P.FRAMEBUFFER,St);const Qt=P.fenceSync(P.SYNC_GPU_COMMANDS_COMPLETE,0);return P.flush(),await MC(P,Qt,4),P.bindBuffer(P.PIXEL_PACK_BUFFER,Dt),P.getBufferSubData(P.PIXEL_PACK_BUFFER,0,Te),P.deleteBuffer(Dt),P.deleteSync(Qt),Te}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(U,he=null,Se=0){const be=Math.pow(2,-Se),_e=Math.floor(U.image.width*be),Te=Math.floor(U.image.height*be),je=he!==null?he.x:0,lt=he!==null?he.y:0;k.setTexture2D(U,0),P.copyTexSubImage2D(P.TEXTURE_2D,Se,0,0,je,lt,_e,Te),ie.unbindTexture()};const It=P.createFramebuffer(),Ue=P.createFramebuffer();this.copyTextureToTexture=function(U,he,Se=null,be=null,_e=0,Te=null){Te===null&&(_e!==0?(wc("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Te=_e,_e=0):Te=0);let je,lt,it,gt,vt,et,Dt,St,Qt;const zt=U.isCompressedTexture?U.mipmaps[Te]:U.image;if(Se!==null)je=Se.max.x-Se.min.x,lt=Se.max.y-Se.min.y,it=Se.isBox3?Se.max.z-Se.min.z:1,gt=Se.min.x,vt=Se.min.y,et=Se.isBox3?Se.min.z:0;else{const Ei=Math.pow(2,-_e);je=Math.floor(zt.width*Ei),lt=Math.floor(zt.height*Ei),U.isDataArrayTexture?it=zt.depth:U.isData3DTexture?it=Math.floor(zt.depth*Ei):it=1,gt=0,vt=0,et=0}be!==null?(Dt=be.x,St=be.y,Qt=be.z):(Dt=0,St=0,Qt=0);const Bt=at.convert(he.format),ft=at.convert(he.type);let Yt;he.isData3DTexture?(k.setTexture3D(he,0),Yt=P.TEXTURE_3D):he.isDataArrayTexture||he.isCompressedArrayTexture?(k.setTexture2DArray(he,0),Yt=P.TEXTURE_2D_ARRAY):(k.setTexture2D(he,0),Yt=P.TEXTURE_2D),P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,he.flipY),P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),P.pixelStorei(P.UNPACK_ALIGNMENT,he.unpackAlignment);const Nt=P.getParameter(P.UNPACK_ROW_LENGTH),yt=P.getParameter(P.UNPACK_IMAGE_HEIGHT),On=P.getParameter(P.UNPACK_SKIP_PIXELS),en=P.getParameter(P.UNPACK_SKIP_ROWS),zi=P.getParameter(P.UNPACK_SKIP_IMAGES);P.pixelStorei(P.UNPACK_ROW_LENGTH,zt.width),P.pixelStorei(P.UNPACK_IMAGE_HEIGHT,zt.height),P.pixelStorei(P.UNPACK_SKIP_PIXELS,gt),P.pixelStorei(P.UNPACK_SKIP_ROWS,vt),P.pixelStorei(P.UNPACK_SKIP_IMAGES,et);const sn=U.isDataArrayTexture||U.isData3DTexture,Si=he.isDataArrayTexture||he.isData3DTexture;if(U.isDepthTexture){const Ei=ve.get(U),Vt=ve.get(he),Mi=ve.get(Ei.__renderTarget),lh=ve.get(Vt.__renderTarget);ie.bindFramebuffer(P.READ_FRAMEBUFFER,Mi.__webglFramebuffer),ie.bindFramebuffer(P.DRAW_FRAMEBUFFER,lh.__webglFramebuffer);for(let ba=0;ba<it;ba++)sn&&(P.framebufferTextureLayer(P.READ_FRAMEBUFFER,P.COLOR_ATTACHMENT0,ve.get(U).__webglTexture,_e,et+ba),P.framebufferTextureLayer(P.DRAW_FRAMEBUFFER,P.COLOR_ATTACHMENT0,ve.get(he).__webglTexture,Te,Qt+ba)),P.blitFramebuffer(gt,vt,je,lt,Dt,St,je,lt,P.DEPTH_BUFFER_BIT,P.NEAREST);ie.bindFramebuffer(P.READ_FRAMEBUFFER,null),ie.bindFramebuffer(P.DRAW_FRAMEBUFFER,null)}else if(_e!==0||U.isRenderTargetTexture||ve.has(U)){const Ei=ve.get(U),Vt=ve.get(he);ie.bindFramebuffer(P.READ_FRAMEBUFFER,It),ie.bindFramebuffer(P.DRAW_FRAMEBUFFER,Ue);for(let Mi=0;Mi<it;Mi++)sn?P.framebufferTextureLayer(P.READ_FRAMEBUFFER,P.COLOR_ATTACHMENT0,Ei.__webglTexture,_e,et+Mi):P.framebufferTexture2D(P.READ_FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,Ei.__webglTexture,_e),Si?P.framebufferTextureLayer(P.DRAW_FRAMEBUFFER,P.COLOR_ATTACHMENT0,Vt.__webglTexture,Te,Qt+Mi):P.framebufferTexture2D(P.DRAW_FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_2D,Vt.__webglTexture,Te),_e!==0?P.blitFramebuffer(gt,vt,je,lt,Dt,St,je,lt,P.COLOR_BUFFER_BIT,P.NEAREST):Si?P.copyTexSubImage3D(Yt,Te,Dt,St,Qt+Mi,gt,vt,je,lt):P.copyTexSubImage2D(Yt,Te,Dt,St,gt,vt,je,lt);ie.bindFramebuffer(P.READ_FRAMEBUFFER,null),ie.bindFramebuffer(P.DRAW_FRAMEBUFFER,null)}else Si?U.isDataTexture||U.isData3DTexture?P.texSubImage3D(Yt,Te,Dt,St,Qt,je,lt,it,Bt,ft,zt.data):he.isCompressedArrayTexture?P.compressedTexSubImage3D(Yt,Te,Dt,St,Qt,je,lt,it,Bt,zt.data):P.texSubImage3D(Yt,Te,Dt,St,Qt,je,lt,it,Bt,ft,zt):U.isDataTexture?P.texSubImage2D(P.TEXTURE_2D,Te,Dt,St,je,lt,Bt,ft,zt.data):U.isCompressedTexture?P.compressedTexSubImage2D(P.TEXTURE_2D,Te,Dt,St,zt.width,zt.height,Bt,zt.data):P.texSubImage2D(P.TEXTURE_2D,Te,Dt,St,je,lt,Bt,ft,zt);P.pixelStorei(P.UNPACK_ROW_LENGTH,Nt),P.pixelStorei(P.UNPACK_IMAGE_HEIGHT,yt),P.pixelStorei(P.UNPACK_SKIP_PIXELS,On),P.pixelStorei(P.UNPACK_SKIP_ROWS,en),P.pixelStorei(P.UNPACK_SKIP_IMAGES,zi),Te===0&&he.generateMipmaps&&P.generateMipmap(Yt),ie.unbindTexture()},this.initRenderTarget=function(U){ve.get(U).__webglFramebuffer===void 0&&k.setupRenderTarget(U)},this.initTexture=function(U){U.isCubeTexture?k.setTextureCube(U,0):U.isData3DTexture?k.setTexture3D(U,0):U.isDataArrayTexture||U.isCompressedArrayTexture?k.setTexture2DArray(U,0):k.setTexture2D(U,0),ie.unbindTexture()},this.resetState=function(){b=0,T=0,E=null,ie.reset(),qe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return qs}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=tn._getDrawingBufferColorSpace(e),t.unpackColorSpace=tn._getUnpackColorSpace()}}const Y2=2048,j2=.5,K2=35,Z2=-35,J2=35,Q2=35,eD=-35,tD=.045,bb=Rm,nD=16777215,iD=.6,sD=16777215,rD=1.2,aD=10,oD=10,lD=5,cD=16777215,uD=1,dD=-5,hD=5,fD=-5,Xg=30,qg=1118481,pD=0,mD=11591910,_D=!0,Eu={low:512,medium:1024,high:2048,ultra:2048},Mu={low:.02,medium:.02,high:.015,ultra:.045},li={shadows:{enabled:!0,type:bb,mapSize:Y2,normalBias:tD,camera:{near:j2,far:K2,left:Z2,right:J2,top:Q2,bottom:eD}},presets:{low:{shadows:{enabled:!1,mapSize:Eu.low,normalBias:Mu.low},renderer:{antialias:!1}},medium:{shadows:{enabled:!0,mapSize:Eu.medium,normalBias:Mu.medium},renderer:{antialias:!0}},high:{shadows:{enabled:!0,mapSize:Eu.high,normalBias:Mu.high},renderer:{antialias:!0}},ultra:{shadows:{enabled:!0,mapSize:Eu.ultra,normalBias:Mu.ultra},renderer:{antialias:!0}}},renderer:{antialias:_D,clearColor:mD}};function la(i){if(!i){console.warn("[GraphicsConfig] applyRendererConfig: renderer is null");return}i.shadowMap.enabled=li.shadows.enabled,i.shadowMap.type=li.shadows.type,i.setClearColor(li.renderer.clearColor),i.antialias=li.renderer.antialias}function Fc(i){const e=new bl(nD,iD);return i.add(e),e}function Uc(i){const e=new Bn(sD,rD);e.position.set(aD,oD,lD);const t=li.shadows;return t.enabled?(e.castShadow=!0,e.shadow.mapSize.width=t.mapSize,e.shadow.mapSize.height=t.mapSize,e.shadow.camera.near=t.camera.near,e.shadow.camera.far=t.camera.far,e.shadow.camera.left=t.camera.left,e.shadow.camera.right=t.camera.right,e.shadow.camera.top=t.camera.top,e.shadow.camera.bottom=t.camera.bottom,e.shadow.normalBias=t.normalBias,e.shadow.camera.updateProjectionMatrix()):e.castShadow=!1,i.add(e),e}function zc(i){const e=new Bn(cD,uD);return e.position.set(dD,hD,fD),e.castShadow=!1,e.userData.isFillLight=!0,i.add(e),e}function vD(i,e=!1){const t={color:typeof i=="string"?i:new Mt(i),side:ws,depthWrite:!0,depthTest:!0};return e===!0?Object.assign(t,{transparent:!0,opacity:.6,shininess:Xg,specular:new Mt(qg),emissive:new Mt(13056)}):Object.assign(t,{transparent:!1,opacity:1,shininess:Xg,specular:new Mt(qg),emissive:new Mt(pD)}),new tP(t)}function gD(){const i=localStorage.getItem("graphicsPreset");i&&li.presets[i]?Ql(i):(Ql("ultra"),localStorage.setItem("graphicsPreset","ultra"))}function Ql(i){if(!li.presets[i])return;const e=li.presets[i],t=li.shadows.camera;e.shadows&&(Object.assign(li.shadows,e.shadows),li.shadows.type=bb,!e.shadows.camera&&t&&(li.shadows.camera=t)),e.renderer&&Object.assign(li.renderer,e.renderer)}function Wm(){return function(e){li.shadows.enabled&&e.traverse(t=>{t.isLight&&t.shadow&&(t.shadow.camera.updateMatrixWorld(),t.shadow.camera.updateProjectionMatrix())})}}function $m(i){const e=li.shadows;i.traverse(t=>{t.isDirectionalLight&&!t.userData.isFillLight&&(e.enabled?(t.castShadow=!0,t.shadow&&(t.shadow.mapSize.width=e.mapSize,t.shadow.mapSize.height=e.mapSize,t.shadow.normalBias=e.normalBias,e.camera&&(t.shadow.camera.near=e.camera.near,t.shadow.camera.far=e.camera.far,t.shadow.camera.left=e.camera.left,t.shadow.camera.right=e.camera.right,t.shadow.camera.top=e.camera.top,t.shadow.camera.bottom=e.camera.bottom),t.shadow.camera.updateProjectionMatrix())):t.castShadow=!1)})}class $i{static async initializeSDK(){try{return window.bridge?(await window.bridge.initialize(),this.platformInfo={platform:window.bridge.platform.id,language:window.bridge.platform.language,isSupported:!0},Promise.resolve()):(console.warn("PlayGama Bridge not found, using mock"),Promise.resolve())}catch(e){throw console.error("PlayGama Bridge initialization error:",e),e}}static async loadPlayerData(){var e;try{if(!((e=window.bridge)!=null&&e.storage)){const r=localStorage.getItem("lego-game-player");return r?JSON.parse(r):this.getDefaultPlayerData()}const t=window.bridge.STORAGE_TYPE.PLATFORM_INTERNAL;if(!await window.bridge.storage.isAvailable(t)){console.warn("Platform storage not available, using local storage");const r=localStorage.getItem("lego-game-player");return r?JSON.parse(r):this.getDefaultPlayerData()}const s=await window.bridge.storage.get("player_data",t);return s?JSON.parse(s):this.getDefaultPlayerData()}catch(t){return console.error("Failed to load player data:",t),this.getDefaultPlayerData()}}static async savePlayerData(e){var t;try{const n=JSON.stringify(e);if(localStorage.setItem("lego-game-player",n),!((t=window.bridge)!=null&&t.storage))return Promise.resolve();const s=window.bridge.STORAGE_TYPE.PLATFORM_INTERNAL;return await window.bridge.storage.isAvailable(s)&&await window.bridge.storage.set("player_data",n,s),Promise.resolve()}catch(n){throw console.error("Save player data error:",n),n}}static getDefaultPlayerData(){return{name:"Guest Player",avatar:1,coins:1e3,purchasedSets:[],assembledSets:[],settings:{sound:!0,music:!0}}}static async showRewardedAd(){var e;try{return(e=window.bridge)!=null&&e.advertisement?window.bridge.advertisement.isRewardedAvailable?(this.pauseGame(),await window.bridge.advertisement.showRewarded(),this.resumeGame(),{watched:!0,reward:50}):(console.warn("Rewarded ads not available on this platform"),{watched:!1,reward:0}):(console.warn("Advertisement not available"),{watched:!1,reward:0})}catch(t){return console.error("Rewarded ad error:",t),this.resumeGame(),{watched:!1,reward:0}}}static async showInterstitialAd(){var e;try{return(e=window.bridge)!=null&&e.advertisement?window.bridge.advertisement.isInterstitialAvailable?(this.pauseGame(),await window.bridge.advertisement.showInterstitial(),this.resumeGame(),{shown:!0}):{shown:!1}:{shown:!1}}catch(t){return console.error("Interstitial ad error:",t),this.resumeGame(),{shown:!1}}}static pauseGame(){window.dispatchEvent(new CustomEvent("game:pause"))}static resumeGame(){window.dispatchEvent(new CustomEvent("game:resume"))}static async trackEvent(e,t={}){try{if(!e||typeof e!="string")throw new Error("Invalid event name");return Promise.resolve()}catch(n){console.error("Track event error:",n)}}static getPlatformInfo(){var e,t,n,s;return window.bridge?{platform:window.bridge.platform.id,language:window.bridge.platform.language,payload:window.bridge.platform.payload,features:{rewardedAds:((e=window.bridge.advertisement)==null?void 0:e.isRewardedAvailable)||!1,interstitialAds:((t=window.bridge.advertisement)==null?void 0:t.isInterstitialAvailable)||!1,playerData:((n=window.bridge.storage)==null?void 0:n.isSupported("platform_internal"))||!1,authorization:((s=window.bridge.player)==null?void 0:s.isAuthorizationSupported)||!1}}:{platform:"web",language:"en",features:{}}}static getLanguage(){if(!window.bridge){const t=navigator.language.split("-")[0].toLowerCase();return["ru","en"].includes(t)?t:"en"}const e=window.bridge.platform.language;return["ru","en"].includes(e)?e:"en"}static setLanguage(e){}static async isPlayerAuthorized(){var e;return(e=window.bridge)!=null&&e.player?window.bridge.player.isAuthorized:!1}static async authorizePlayer(){var e,t;try{return(t=(e=window.bridge)==null?void 0:e.player)!=null&&t.isAuthorizationSupported?(await window.bridge.player.authorize(),{success:!0}):(console.warn("Authorization not supported on this platform"),{success:!1,reason:"not_supported"})}catch(n){return console.error("Authorization error:",n),{success:!1,reason:n.message}}}static getPlayerInfo(){var e;return(e=window.bridge)!=null&&e.player?{id:window.bridge.player.id,name:window.bridge.player.name,photos:window.bridge.player.photos,isAuthorized:window.bridge.player.isAuthorized}:null}static isFeatureAvailable(e){return this.getPlatformInfo().features[e]||!1}static async getAchievements(){try{return[{id:"first_build",name:"First Build",description:"Complete your first LEGO build",unlocked:!1,reward:50},{id:"master_builder",name:"Master Builder",description:"Complete 10 LEGO builds",unlocked:!1,reward:200}]}catch(e){return console.error("Get achievements error:",e),[]}}static async unlockAchievement(e){try{if(!e||typeof e!="string")throw new Error("Invalid achievement ID");return!0}catch(t){return console.error("Unlock achievement error:",t),!1}}static isSDKAvailable(){return typeof window<"u"&&window.bridge!==void 0}static isMockMode(){return!this.isSDKAvailable()}}const yD={mainMenu:{title:"LEGO  ",subtitle:", , !",startBuilding:"  ",shop:" ",openBoxes:"  ",assembleSets:"  ",characterAdventure:"  ",characterAdventureDescription:"  LEGO   ",alwaysAvailable:" ",setsAvailable:" ",setsReady:" ",buySetsFirst:"  ",collection:"",collectionDescription:"   ",setBuilder:" ",setBuilderDescription:"    ",setsPlaced:" ",devBuilder:" ",devBuilderDescription:"    ",developer:" ",comingSoon:"",setsBuilt:" ",blocksOwned:" ",playTime:" ",navigationError:" ",needToBuySets:"   !"},player:{name:" ",coins:"",setsOwned:" ",setsAssembled:" ",blocksPlaced:" ",changeName:" ",changeAvatar:" ",sound:"",music:"",watchAd:" ",profile:"",enterName:"  "},shop:{title:" LEGO ",yourCoins:" ",searchSets:" ...",allDifficulties:" ",easy:"",medium:"",hard:"",pieces:"",buy:"",owned:"",notEnoughCoins:" !",setPurchased:"  !",youAlreadyOwn:"     !"},builder:{title:"  ",blockPalette:" ",standardBricks:" ",plates:" ()",specialBlocks:" ",colors:"",glass:"",saveBuild:" ",loadBuild:" ",clearAll:" ",exportBuild:" ",importBuild:" ",buildSaved:" !",buildLoaded:" !",buildCleared:" !",mobileControls:" ",rotate:"",delete:"",platformSize:" ",saveLoad:"/",loadTestBuild:"  ",buildData:"  (JSON)",jsonPlaceholder:" JSON  ,   ...",jsonHint:"  ,    !",controls:"",controlDrag:"  ,   ",controlRotate:" R    ",controlDelete:" Delete    ",controlZoom:"   ",controlCamera:"  +    ",selectedBlock:" ",importFailed:"   ",selectBlock:" ",settings:"",tabs:{general:"",blocks:"",minifigures:"",info:""},minifigures:"",screenshot:"",takeScreenshot:" ",screenshotSaved:" !",screenshotError:" ",screenshotFailed:"   ",sceneNotReady:"   "},boxOpening:{title:"  ",selectSet:"   ",openBox:" ",collectAll:" ",boxOpened:" !",blocksCollected:" !",noSetsAvailable:"    ",noSetSelected:"  . ,   .",assembleSet:" "},assembly:{title:"  ",chooseSet:"   ",noPurchasedSets:"    .",visitShop:" ,   !",changeSet:" ",findThisBlock:"  :",assemblyComplete:" !",congratulations:"!  ",coinsEarned:" !",inventory:" ",wrongBlock:"    !",blockPlaced:" !",setCompleted:" !",reset:"",mainMenu:" ",blocks:"",progress:"",pieces:"",difficulty:"",availableBlocks:" ",noBlocksAvailable:"  ",selectBlock:"   ",clickToPlace:"  ,   "},common:{back:"",next:"",cancel:"",confirm:"",save:"",load:"",delete:"",close:"",yes:"",no:"",ok:"",error:"",success:"",loading:"...",unknown:""},blocks:{brick:"",plate:"",size:"",color:"",count:""},colors:{red:"",blue:"",green:"",yellow:"",white:"",black:"",gray:"",silver:"",pink:"",purple:"",orange:"",brown:""},difficulties:{easy:"",medium:"",hard:""},boxOpening:{title:"LEGO ",openBox:" ",assembleSet:" "},notifications:{setPurchased:" !",setCompleted:" !",buildSaved:" !",buildLoaded:" !",insufficientFunds:" !",alreadyOwned:"   !",errorOccurred:" !"},settings:{title:"",language:"",selectLanguage:" ",audio:""},graphics:{title:" ",preset:"",presets:{low:" ()",medium:"",high:"",ultra:""},advanced:" ",showAdvanced:" ",hideAdvanced:" ",shadows:{enabled:" ",quality:" "},antialias:""},collections:{title:"",saveSet:" ",setName:" ",setNamePlaceholder:"  ...",save:"",cancel:"",edit:"",delete:"",copyCode:" ",codeCopied:"    !",setSaved:" ",setSavedMessage:' "{name}"    ',setDeleted:" ",setDeletedMessage:' "{name}"   ',confirmDelete:" ?",confirmDeleteMessage:' ,     "{name}"?    .',noCollections:"  ",emptyCollectionsMessage:"      ,    ",noBlocksToSave:"   ",noBlocksToSaveMessage:"       ",setSaveFailed:"   ",characters:"",createdAt:"",editSet:" "},setBuilder:{title:" ",purchasedSets:" ",collections:"",platformSize:" ",placeSet:" ",removeSet:" ",noSetsAvailable:"    ",selectedSet:" ",setName:" ",setPlaced:" ",setPlacedMessage:"    ",setRemoved:" ",setRemovedMessage:"   ",setPlaceFailed:"   ",setRemoveFailed:"   "},devBuilder:{title:" ",selectedSet:" ",placingSet:" ...",setPlaced:" ",setPlacedMessage:"  ",setPlaceFailed:"   ",tabs:{createSet:" "},addToSet:"  ",setBlocks:" ",removeFromSet:"",generateJSON:" JSON",generateAndCopyJSON:"   JSON",copyJSON:" JSON",clearSet:" ",blockAddedToSet:" ",blockAddedToSetMessage:"   ",setAddedToSetMessage:"    ",blockRemovedFromSet:" ",blockRestoredToScene:"   ",failedToRestoreBlock:"     ",setCleared:" ",setClearedMessage:" ",noBlocksInSet:"   ",addBlocksHint:'    "  "',setMetadata:" ",setId:"ID ",setName:" ",setDescription:"",setPrice:"",setImage:"  ",setPieces:"",setDifficulty:"",setReward:"",setBoxTexture:" ",setBoxDimensions:" ",setPlatformSize:" ",width:"",height:"",depth:"",difficultyEasy:"",difficultyMedium:"",difficultyHard:"",generatedJSON:" JSON",jsonCopied:"JSON    !",jsonCopyFailed:"   JSON",confirmClearSet:" ,    ?     ."}},xD={mainMenu:{title:"LEGO Builder Game",subtitle:"Build, Collect, Explore!",startBuilding:" Start Building",shop:" Shop",openBoxes:" Open Boxes",assembleSets:" Assemble Sets",characterAdventure:" Character Adventure",characterAdventureDescription:"Explore the LEGO world with your character",alwaysAvailable:"Always Available",setsAvailable:"sets available",setsReady:"sets ready",buySetsFirst:"Buy sets first",collection:"Collection",collectionDescription:"View your completed builds",setBuilder:"Set Builder",setBuilderDescription:"Place sets on a large field",setsPlaced:"sets placed",devBuilder:"Dev Builder",devBuilderDescription:"Developer builder with advanced features",developer:"Developer",comingSoon:"Coming Soon",setsBuilt:"Sets Built",blocksOwned:"Blocks Owned",playTime:"Play Time",navigationError:"Failed to navigate",needToBuySets:"You need to buy some sets first!"},player:{name:"Player Name",coins:"Coins",setsOwned:"Sets Owned",setsAssembled:"Sets Assembled",blocksPlaced:"Blocks Placed",changeName:"Change Name",changeAvatar:"Change Avatar",sound:"Sound",music:"Music",watchAd:"Watch Ad",profile:"Profile",enterName:"Enter your name"},shop:{title:" LEGO Shop",yourCoins:"Your Coins",searchSets:"Search sets...",allDifficulties:"All Difficulties",easy:"Easy",medium:"Medium",hard:"Hard",pieces:"pieces",buy:"Buy",owned:"Owned",notEnoughCoins:"Not enough coins!",setPurchased:"Set purchased successfully!",youAlreadyOwn:"You already own this set!"},builder:{title:" Builder Mode",blockPalette:"Block Palette",standardBricks:"Standard Bricks",plates:"Plates (Flat)",specialBlocks:"Special Blocks",colors:"Colors",glass:"Glass",saveBuild:"Save Build",loadBuild:"Load Build",clearAll:"Clear All",exportBuild:"Export Build",importBuild:"Import Build",buildSaved:"Build saved!",buildLoaded:"Build loaded!",buildCleared:"All cleared!",mobileControls:"Mobile Controls",rotate:"Rotate",delete:"Delete",platformSize:"Platform Size",saveLoad:"Save/Load",loadTestBuild:"Load Test Build",buildData:"Build Data (JSON)",jsonPlaceholder:"Paste JSON data here to load a build...",jsonHint:"Copy this data to share your build with others!",controls:"Controls",controlDrag:"Click and drag to move bricks",controlRotate:"R key to rotate selected brick",controlDelete:"Delete key to remove selected brick",controlZoom:"Mouse wheel to zoom",controlCamera:"Right click + drag to rotate camera",selectedBlock:"Selected Block",importFailed:"Failed to import build",selectBlock:"Select Block",settings:"Settings",tabs:{general:"General",blocks:"Blocks",minifigures:"Minifigures",info:"Info"},minifigures:"Minifigures",screenshot:"Screenshot",takeScreenshot:"Take Screenshot",screenshotSaved:"Screenshot saved!",screenshotError:"Screenshot Error",screenshotFailed:"Failed to take screenshot",sceneNotReady:"Scene is not ready yet"},boxOpening:{title:" Box Opening",selectSet:"Select a set to open",openBox:"Open Box",collectAll:"Collect All",boxOpened:"Box opened!",blocksCollected:"Blocks collected!",noSetsAvailable:"No sets available for opening",noSetSelected:"No set selected. Please choose a set first.",assembleSet:"Assemble Set"},assembly:{title:" Assembly Mode",chooseSet:"Choose a Set to Assemble",noPurchasedSets:"No purchased sets available for assembly.",visitShop:"Visit the shop to buy some sets!",changeSet:"Change Set",findThisBlock:"Find this block:",assemblyComplete:"Assembly Complete!",congratulations:"Congratulations! You built",coinsEarned:"coins earned!",inventory:"Available Blocks",wrongBlock:"Wrong block type or color!",blockPlaced:"Block placed!",setCompleted:"Set completed!",reset:"Reset",mainMenu:"Main Menu",blocks:"blocks",progress:"Progress",pieces:"pieces",difficulty:"Difficulty",availableBlocks:"Available Blocks",noBlocksAvailable:"No blocks available",selectBlock:"Select a block to place",clickToPlace:"Click on the scene to place the block"},common:{back:"Back",next:"Next",cancel:"Cancel",confirm:"Confirm",save:"Save",load:"Load",delete:"Delete",close:"Close",yes:"Yes",no:"No",ok:"OK",error:"Error",success:"Success",loading:"Loading...",unknown:"Unknown"},blocks:{brick:"Brick",plate:"Plate",size:"Size",color:"Color",count:"Count"},colors:{red:"Red",blue:"Blue",green:"Green",yellow:"Yellow",white:"White",black:"Black",gray:"Gray",silver:"Silver",pink:"Pink",purple:"Purple",orange:"Orange",brown:"Brown"},difficulties:{easy:"Easy",medium:"Medium",hard:"Hard"},boxOpening:{title:"LEGO Set",openBox:"Open Box",assembleSet:"Assemble Set"},notifications:{setPurchased:"Set purchased!",setCompleted:"Set completed!",buildSaved:"Build saved!",buildLoaded:"Build loaded!",insufficientFunds:"Insufficient funds!",alreadyOwned:"Already in your collection!",errorOccurred:"An error occurred!"},settings:{title:"Settings",language:"Language",selectLanguage:"Select Language",audio:"Audio"},graphics:{title:"Graphics Settings",preset:"Quality Preset",presets:{low:"Low (Mobile)",medium:"Medium",high:"High",ultra:"Ultra"},advanced:"Advanced Settings",showAdvanced:"Show Advanced",hideAdvanced:"Hide Advanced",shadows:{enabled:"Enable Shadows",quality:"Shadow Quality"},antialias:"Anti-aliasing"},collections:{title:"Collections",saveSet:"Save Set",setName:"Set Name",setNamePlaceholder:"Enter set name...",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",copyCode:"Copy Code",codeCopied:"Code copied to clipboard!",setSaved:"Set Saved",setSavedMessage:'Set "{name}" has been saved to collections',setDeleted:"Set Deleted",setDeletedMessage:'Set "{name}" has been deleted from collections',confirmDelete:"Delete Set?",confirmDeleteMessage:'Are you sure you want to delete set "{name}"? This action cannot be undone.',noCollections:"No Saved Sets",emptyCollectionsMessage:"Create a set in the builder and save it to see it here",noBlocksToSave:"No Blocks to Save",noBlocksToSaveMessage:"Add at least one block before saving a set",setSaveFailed:"Failed to save set",characters:"characters",createdAt:"Created",editSet:"Edit Set"},setBuilder:{title:"Set Builder",purchasedSets:"Purchased Sets",collections:"Collections",platformSize:"Platform Size",placeSet:"Place Set",removeSet:"Remove Set",noSetsAvailable:"No sets available to place",selectedSet:"Selected Set",setName:"Set Name",setPlaced:"Set Placed",setPlacedMessage:"Set has been placed on the field",setRemoved:"Set Removed",setRemovedMessage:"Set has been removed from the field",setPlaceFailed:"Failed to place set",setRemoveFailed:"Failed to remove set"},devBuilder:{title:"Dev Builder",selectedSet:"Selected Set",placingSet:"Placing set...",setPlaced:"Set Placed",setPlacedMessage:"Set has been placed successfully",setPlaceFailed:"Failed to place set",tabs:{createSet:"Create Set"},addToSet:"Add to Set",setBlocks:"Set Blocks",removeFromSet:"Remove",generateJSON:"Generate JSON",generateAndCopyJSON:"Generate & Copy JSON",copyJSON:"Copy JSON",clearSet:"Clear Set",blockAddedToSet:"Block Added",blockAddedToSetMessage:"Block has been added to set",setAddedToSetMessage:"Set blocks have been added to set",blockRemovedFromSet:"Block Removed",blockRestoredToScene:"Block has been restored to scene",failedToRestoreBlock:"Failed to restore block to scene",setCleared:"Set Cleared",setClearedMessage:"Set has been cleared",noBlocksInSet:"No blocks in set",addBlocksHint:'Select blocks and click "Add to Set" to add them',setMetadata:"Set Metadata",setId:"Set ID",setName:"Set Name",setDescription:"Description",setPrice:"Price",setImage:"Image Path",setPieces:"Pieces",setDifficulty:"Difficulty",setReward:"Reward",setBoxTexture:"Box Texture",setBoxDimensions:"Box Dimensions",setPlatformSize:"Platform Size",width:"Width",height:"Height",depth:"Depth",difficultyEasy:"Easy",difficultyMedium:"Medium",difficultyHard:"Hard",generatedJSON:"Generated JSON",jsonCopied:"JSON copied to clipboard!",jsonCopyFailed:"Failed to copy JSON",confirmClearSet:"Are you sure you want to clear the set? This will reset all form data."}},_d={ru:yD,en:xD},vd="en",Ya=bT({legacy:!1,locale:vd,fallbackLocale:vd,messages:_d,globalInjection:!0,silentTranslationWarn:!0,silentFallbackWarn:!0});async function bD(){try{await $i.initializeSDK();const i=$i.getPlatformInfo();if(i&&i.language){const t=i.language.toLowerCase();if(_d[t]){Ya.global.locale.value=t;return}}const e=navigator.language.split("-")[0].toLowerCase();if(_d[e]){Ya.global.locale.value=e;return}Ya.global.locale.value=vd}catch(i){console.error("Failed to initialize i18n:",i),Ya.global.locale.value=vd}}function wD(i){var e;_d[i]?(Ya.global.locale.value=i,localStorage.setItem("lego-game-language",i),(e=$i.setLanguage)==null||e.call($i,i)):console.warn(`Language '${i}' not supported`)}function SD(){return Ya.global.locale.value}const ED=["for"],MD={key:0,class:"select__required"},TD={class:"select__container"},AD=["id","value","disabled","required"],CD={key:0,value:"",disabled:""},PD=["label"],RD=["value"],LD=["value"],ID={key:1,class:"select__message"},DD={key:0,class:"select__error"},kD={key:1,class:"select__hint"},BD={__name:"Select",props:{modelValue:{type:[String,Number],default:""},options:{type:Array,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:""},hint:{type:String,default:""},error:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)},optionLabel:{type:String,default:"label"},optionValue:{type:String,default:"value"}},emits:["update:modelValue","change","blur","focus"],setup(i,{emit:e}){const t=i,n=e,s=Dc(),r=ze(!1),a=tt(()=>["select-wrapper",{"select-wrapper._error":!!t.error,"select-wrapper._disabled":t.disabled,"select-wrapper._focused":r.value}]),o=tt(()=>["select",`select._${t.size}`]),l=f=>typeof f=="string"||typeof f=="number"?f:f[t.optionValue]??f.value??f,c=f=>typeof f=="string"||typeof f=="number"?f:f[t.optionLabel]??f.label??f,u=f=>{const p=f.target.value;n("update:modelValue",p),n("change",p)},d=f=>{r.value=!1,n("blur",f)},h=f=>{r.value=!0,n("focus",f)};return(f,p)=>(oe(),ge("div",{class:qt(["select-wrapper",a.value])},[i.label?(oe(),ge("label",{key:0,for:Ii(s),class:"select__label"},[Oe(se(i.label)+" ",1),i.required?(oe(),ge("span",MD,"*")):Ve("",!0)],8,ED)):Ve("",!0),B("div",TD,[B("select",{id:Ii(s),value:i.modelValue,disabled:i.disabled,required:i.required,class:qt(["select",o.value]),onChange:u,onBlur:d,onFocus:h},[i.placeholder?(oe(),ge("option",CD,se(i.placeholder),1)):Ve("",!0),(oe(!0),ge(At,null,Zt(i.options,m=>(oe(),ge(At,{key:l(m)},[m.group?(oe(),ge("optgroup",{key:0,label:m.label},[(oe(!0),ge(At,null,Zt(m.options,_=>(oe(),ge("option",{key:l(_),value:l(_)},se(c(_)),9,RD))),128))],8,PD)):(oe(),ge("option",{key:1,value:l(m)},se(c(m)),9,LD))],64))),128)),Hn(f.$slots,"default",{},void 0)],42,AD),p[0]||(p[0]=B("span",{class:"select__arrow"},[B("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[B("path",{d:"M1 1L6 6L11 1",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))]),i.error||i.hint?(oe(),ge("div",ID,[i.error?(oe(),ge("span",DD,se(i.error),1)):i.hint?(oe(),ge("span",kD,se(i.hint),1)):Ve("",!0)])):Ve("",!0)],2))}},Sc=Ht(BD,[["__scopeId","data-v-f7d2d8eb"]]),OD=["id","checked","disabled","required"],ND={key:0,class:"switch__label"},FD={__name:"Switch",props:{modelValue:{type:Boolean,default:!1},label:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)}},emits:["update:modelValue","change"],setup(i,{emit:e}){const t=i,n=e,s=Dc(),r=tt(()=>["switch",`switch._${t.size}`,{"switch._disabled":t.disabled}]),a=tt(()=>({"switch__slider._checked":t.modelValue})),o=l=>{t.disabled||(n("update:modelValue",l.target.checked),n("change",l.target.checked))};return(l,c)=>(oe(),ge("label",{class:qt(["switch",r.value])},[B("input",{id:Ii(s),type:"checkbox",checked:i.modelValue,disabled:i.disabled,required:i.required,class:"switch__input",onChange:o},null,40,OD),B("span",{class:qt(["switch__slider",a.value])},[...c[0]||(c[0]=[B("span",{class:"switch__thumb"},null,-1)])],2),i.label||l.$slots.default?(oe(),ge("span",ND,[Hn(l.$slots,"default",{},()=>[Oe(se(i.label),1)])])):Ve("",!0)],2))}},Yg=Ht(FD,[["__scopeId","data-v-7b22529e"]]),UD={class:"graphics-settings"},zD={class:"graphics-settings__content"},VD={class:"graphics-settings__title"},GD={class:"graphics-settings__section"},HD={class:"graphics-settings__section-title"},WD={class:"graphics-settings__preset"},$D={class:"graphics-settings__section"},XD={class:"graphics-settings__section-title"},qD={class:"graphics-settings__language"},YD={class:"graphics-settings__section"},jD={class:"graphics-settings__section-title"},KD={class:"graphics-settings__group"},ZD={class:"graphics-settings__group"},JD={__name:"GraphicsSettings",setup(i){const e=es(),{t}=wn(),n=ze("ultra"),s=ze(SD()),r=tt(()=>e.state.player.soundEnabled),a=tt(()=>e.state.player.musicEnabled),o=[{value:"low",label:t("graphics.presets.low")},{value:"medium",label:t("graphics.presets.medium")},{value:"high",label:t("graphics.presets.high")},{value:"ultra",label:t("graphics.presets.ultra")}],l=[{value:"en",label:" English"},{value:"ru",label:" "}],c=()=>{const m=localStorage.getItem("graphicsPreset");m&&li.presets[m]?(n.value=m,Ql(m)):(Ql("ultra"),n.value="ultra")},u=()=>{localStorage.setItem("graphicsPreset",n.value)},d=()=>{Ql(n.value),u()},h=()=>{wD(s.value)},f=()=>{e.dispatch("player/toggleSound")},p=()=>{e.dispatch("player/toggleMusic")};return In(()=>{c()}),(m,_)=>(oe(),ge("div",UD,[B("div",zD,[B("h3",VD,se(m.$t("settings.title")),1),B("div",GD,[B("h4",HD,se(m.$t("graphics.title")),1),B("div",WD,[we(Sc,{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=v=>n.value=v),label:m.$t("graphics.preset"),options:o,onChange:d},null,8,["modelValue","label"])])]),B("div",$D,[B("h4",XD,se(m.$t("settings.language")),1),B("div",qD,[we(Sc,{modelValue:s.value,"onUpdate:modelValue":_[1]||(_[1]=v=>s.value=v),label:m.$t("settings.selectLanguage"),options:l,onChange:h},null,8,["modelValue","label"])])]),B("div",YD,[B("h4",jD,se(m.$t("settings.audio")),1),B("div",KD,[we(Yg,{modelValue:r.value,"onUpdate:modelValue":_[2]||(_[2]=v=>r.value=v),label:m.$t("player.sound"),onChange:f},null,8,["modelValue","label"])]),B("div",ZD,[we(Yg,{modelValue:a.value,"onUpdate:modelValue":_[3]||(_[3]=v=>a.value=v),label:m.$t("player.music"),onChange:p},null,8,["modelValue","label"])])])])]))}},QD=Ht(JD,[["__scopeId","data-v-f78f6b56"]]),ek={class:"layout"},tk={class:"layout__content"},nk={__name:"Layout",setup(i){const{t:e}=wn(),t=ze(!1);return(n,s)=>(oe(),ge("div",ek,[we(BA,{onSettingsClick:s[0]||(s[0]=r=>t.value=!0)}),B("div",tk,[Hn(n.$slots,"default",{},void 0)]),we(Pr,{modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=r=>t.value=r),title:n.$t("settings.title"),size:"md",onClose:s[2]||(s[2]=r=>t.value=!1)},{default:Le(()=>[we(QD)]),_:1},8,["modelValue","title"])]))}},ik=Ht(nk,[["__scopeId","data-v-930065c5"]]),sk={class:"menu-card__content"},rk={__name:"MenuCard",props:{disabled:{type:Boolean,default:!1},hoverable:{type:Boolean,default:!0}},emits:["click"],setup(i,{emit:e}){const t=i,n=e,s=()=>{t.disabled||n("click")};return(r,a)=>(oe(),ge("div",{class:qt(["menu-card",{"menu-card--disabled":i.disabled,"menu-card--hoverable":i.hoverable}]),onClick:s},[B("div",sk,[Hn(r.$slots,"default",{},void 0)])],2))}},ka=Ht(rk,[["__scopeId","data-v-371bd77c"]]),ak={__name:"Badge",props:{variant:{type:String,default:"default",validator:i=>["default","primary","secondary","success","warning","danger","info"].includes(i)},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)},dot:{type:Boolean,default:!1},text:{type:String,default:""}},setup(i){const e=i,t=tt(()=>["badge",`badge._${e.variant}`,`badge._${e.size}`,{"badge._dot":e.dot}]),n=tt(()=>({}));return(s,r)=>(oe(),ge("span",{class:qt(["badge",t.value]),style:fi(n.value)},[i.dot?Ve("",!0):Hn(s.$slots,"default",{key:0},()=>[Oe(se(i.text),1)])],6))}},_n=Ht(ak,[["__scopeId","data-v-1171cfa7"]]),ok={class:"toast__icon"},lk={key:0,width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ck={key:1,width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},uk={key:2,width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},dk={key:3,width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},hk={class:"toast__content"},fk={key:0,class:"toast__title"},pk={key:1,class:"toast__message"},mk={__name:"Toast",props:{modelValue:{type:Boolean,default:!0},type:{type:String,default:"info",validator:i=>["success","error","warning","info"].includes(i)},title:{type:String,default:""},message:{type:String,default:""},duration:{type:Number,default:3e3},closable:{type:Boolean,default:!0}},emits:["update:modelValue","close"],setup(i,{emit:e}){const t=i,n=e,s=tt(()=>["toast",`toast._${t.type}`]),r=tt(()=>({})),a=()=>{n("update:modelValue",!1),n("close")};return Wn(()=>t.modelValue,o=>{o&&t.duration>0&&setTimeout(()=>{a()},t.duration)}),In(()=>{t.modelValue&&t.duration>0&&setTimeout(()=>{a()},t.duration)}),(o,l)=>(oe(),jt(Q0,{name:"toast"},{default:Le(()=>[i.modelValue?(oe(),ge("div",{key:0,class:qt(["toast",s.value]),style:fi(r.value)},[B("span",ok,[Hn(o.$slots,"icon",{},()=>[i.type==="success"?(oe(),ge("svg",lk,[...l[0]||(l[0]=[B("path",{d:"M16.667 5L7.5 14.167 3.333 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):i.type==="error"?(oe(),ge("svg",ck,[...l[1]||(l[1]=[B("path",{d:"M15 5L5 15M5 5L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):i.type==="warning"?(oe(),ge("svg",uk,[...l[2]||(l[2]=[B("path",{d:"M10 6.667V10M10 13.333H10.008M18.333 10C18.333 14.602 14.602 18.333 10 18.333C5.398 18.333 1.667 14.602 1.667 10C1.667 5.398 5.398 1.667 10 1.667C14.602 1.667 18.333 5.398 18.333 10Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):(oe(),ge("svg",dk,[...l[3]||(l[3]=[B("path",{d:"M10 1.667C5.398 1.667 1.667 5.398 1.667 10C1.667 14.602 5.398 18.333 10 18.333C14.602 18.333 18.333 14.602 18.333 10C18.333 5.398 14.602 1.667 10 1.667ZM10 13.333H10.008M10 6.667V10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])]))],!0)]),B("div",hk,[i.title?(oe(),ge("p",fk,se(i.title),1)):Ve("",!0),i.message?(oe(),ge("p",pk,se(i.message),1)):Ve("",!0),Hn(o.$slots,"default",{},void 0,!0)]),i.closable?(oe(),ge("button",{key:0,class:"toast__close",onClick:a,"aria-label":"Close"},[...l[4]||(l[4]=[B("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[B("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):Ve("",!0)],6)):Ve("",!0)]),_:3}))}},_k=Ht(mk,[["__scopeId","data-v-cbf1bb1e"]]),vk={__name:"ToastContainer",props:{position:{type:String,default:"top-right",validator:i=>["top-left","top-right","bottom-left","bottom-right","top-center","bottom-center"].includes(i)}},setup(i,{expose:e}){const t=i,n=ze([]),s=tt(()=>["toast-container",`toast-container._${t.position}`]);let r=0;const a=c=>{const u=++r,d={id:u,visible:!0,type:"info",title:"",message:"",duration:3e3,closable:!0,...c};return n.value.push(d),u},o=c=>{const u=n.value.findIndex(d=>d.id===c);u>-1&&n.value.splice(u,1)};return e({addToast:a,removeToast:o,clearAll:()=>{n.value=[]}}),(c,u)=>(oe(),jt(y0,{to:"body"},[B("div",{class:qt(["toast-container",s.value])},[(oe(!0),ge(At,null,Zt(n.value,d=>(oe(),jt(_k,{key:d.id,"model-value":d.visible,type:d.type,title:d.title,message:d.message,duration:d.duration,closable:d.closable,onClose:h=>o(d.id)},null,8,["model-value","type","title","message","duration","closable","onClose"]))),128))],2)]))}},ga=Ht(vk,[["__scopeId","data-v-9457189a"]]),gk={class:"main-menu"},yk={class:"main-menu__content"},xk={class:"main-menu__modes"},bk={class:"mode-card__title"},wk={class:"mode-card__description"},Sk={class:"mode-card__title"},Ek={class:"mode-card__description"},Mk={class:"mode-card__title"},Tk={class:"mode-card__description"},Ak={class:"mode-card__title"},Ck={class:"mode-card__description"},Pk={class:"mode-card__title"},Rk={class:"mode-card__description"},Lk={class:"mode-card__title"},Ik={class:"mode-card__description"},Dk={class:"mode-card__title"},kk={class:"mode-card__description"},Bk={class:"main-menu__stats"},Ok={class:"stat-card"},Nk={class:"stat-card__content"},Fk={class:"stat-card__info"},Uk={class:"stat-card__value"},zk={class:"stat-card__label"},Vk={class:"stat-card"},Gk={class:"stat-card__content"},Hk={class:"stat-card__info"},Wk={class:"stat-card__value"},$k={class:"stat-card__label"},Xk={class:"stat-card"},qk={class:"stat-card__content"},Yk={class:"stat-card__info"},jk={class:"stat-card__value"},Kk={class:"stat-card__label"},Zk={__name:"MainMenu",setup(i){const e=es(),{t}=wn(),n=ze(null),s=tt(()=>e.getters["sets/availableForPurchase"].length),r=tt(()=>e.getters["sets/purchasedSets"].length),a=tt(()=>r.value>0),o=tt(()=>e.getters["collections/collectionsCount"]),l=tt(()=>e.getters["setBuilder/placedSetsCount"]),c=tt(()=>e.state.player.totalSetsBuilt),u=tt(()=>e.getters["inventory/totalBlocks"]),d=tt(()=>{const p=e.state.player.playTime;if(p<60)return`${p}m`;const m=Math.floor(p/60),_=p%60;return`${m}h ${_}m`}),h=p=>{try{switch(p){case"builder":e.dispatch("navigateToScene","builder");break;case"shop":e.dispatch("navigateToScene","shop");break;case"assembly":a.value?e.dispatch("navigateToScene","set-selection"):f(t("mainMenu.needToBuySets"));break;case"character":e.dispatch("navigateToScene","character");break;case"collection":e.dispatch("navigateToScene","collections");break;case"set-builder":e.dispatch("navigateToScene","set-builder");break;case"dev-builder":e.dispatch("navigateToScene","dev-builder");break;default:console.warn("Unknown mode:",p)}}catch(m){console.error("Navigation error:",m),f(t("mainMenu.navigationError"))}},f=p=>{n.value?n.value.addToast({type:"error",title:t("common.error"),message:p,duration:4e3}):e.dispatch("setError",p)};return In(()=>{e.dispatch("player/trackEvent",{event:"main_menu_visited",data:{}})}),(p,m)=>(oe(),ge("div",gk,[B("div",yk,[B("div",xk,[we(ka,{disabled:!1,class:"mode-card",onClick:m[0]||(m[0]=_=>h("builder"))},{default:Le(()=>[m[7]||(m[7]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",bk,se(p.$t("mainMenu.startBuilding")),1),B("p",wk,se(p.$t("builder.title")),1),we(_n,{variant:"success",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(p.$t("mainMenu.alwaysAvailable")),1)]),_:1})]),_:1}),we(ka,{disabled:!1,class:"mode-card",onClick:m[1]||(m[1]=_=>h("shop"))},{default:Le(()=>[m[8]||(m[8]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",Sk,se(p.$t("mainMenu.shop")),1),B("p",Ek,se(p.$t("shop.title")),1),we(_n,{variant:"info",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(s.value)+" "+se(p.$t("mainMenu.setsAvailable")),1)]),_:1})]),_:1}),we(ka,{disabled:!a.value,class:"mode-card",onClick:m[2]||(m[2]=_=>h("assembly"))},{default:Le(()=>[m[9]||(m[9]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",Mk,se(p.$t("mainMenu.assembleSets")),1),B("p",Tk,se(p.$t("assembly.title")),1),we(_n,{variant:a.value?"success":"warning",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(a.value?`${r.value} ${p.$t("mainMenu.setsReady")}`:p.$t("mainMenu.buySetsFirst")),1)]),_:1},8,["variant"])]),_:1},8,["disabled"]),we(ka,{disabled:!1,class:"mode-card",onClick:m[3]||(m[3]=_=>h("character"))},{default:Le(()=>[m[10]||(m[10]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",Ak,se(p.$t("mainMenu.characterAdventure")),1),B("p",Ck,se(p.$t("mainMenu.characterAdventureDescription")),1),we(_n,{variant:"success",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(p.$t("mainMenu.alwaysAvailable")),1)]),_:1})]),_:1}),we(ka,{disabled:!1,class:"mode-card",onClick:m[4]||(m[4]=_=>h("collection"))},{default:Le(()=>[m[11]||(m[11]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",Pk,se(p.$t("mainMenu.collection")),1),B("p",Rk,se(p.$t("mainMenu.collectionDescription")),1),we(_n,{variant:"success",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(o.value)+" "+se(p.$t("mainMenu.setsAvailable")),1)]),_:1})]),_:1}),we(ka,{disabled:!1,class:"mode-card",onClick:m[5]||(m[5]=_=>h("set-builder"))},{default:Le(()=>[m[12]||(m[12]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",Lk,se(p.$t("mainMenu.setBuilder")),1),B("p",Ik,se(p.$t("mainMenu.setBuilderDescription")),1),we(_n,{variant:"success",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(l.value)+" "+se(p.$t("mainMenu.setsPlaced")),1)]),_:1})]),_:1}),we(ka,{disabled:!1,class:"mode-card",onClick:m[6]||(m[6]=_=>h("dev-builder"))},{default:Le(()=>[m[13]||(m[13]=B("div",{class:"mode-card__icon"},"",-1)),B("h3",Dk,se(p.$t("mainMenu.devBuilder")),1),B("p",kk,se(p.$t("mainMenu.devBuilderDescription")),1),we(_n,{variant:"warning",size:"sm",class:"mode-card__status"},{default:Le(()=>[Oe(se(p.$t("mainMenu.developer")),1)]),_:1})]),_:1})]),B("div",Bk,[B("div",Ok,[B("div",Nk,[m[14]||(m[14]=B("div",{class:"stat-card__icon"},"",-1)),B("div",Fk,[B("div",Uk,se(c.value),1),B("div",zk,se(p.$t("mainMenu.setsBuilt")),1)])])]),B("div",Vk,[B("div",Gk,[m[15]||(m[15]=B("div",{class:"stat-card__icon"},"",-1)),B("div",Hk,[B("div",Wk,se(u.value),1),B("div",$k,se(p.$t("mainMenu.blocksOwned")),1)])])]),B("div",Xk,[B("div",qk,[m[16]||(m[16]=B("div",{class:"stat-card__icon"},"",-1)),B("div",Yk,[B("div",jk,se(d.value),1),B("div",Kk,se(p.$t("mainMenu.playTime")),1)])])])])]),we(ga,{position:"top-center",ref_key:"toastContainer",ref:n},null,512)]))}},Jk=Ht(Zk,[["__scopeId","data-v-4aa468ae"]]),jg={type:"change"},Xm={type:"start"},wb={type:"end"},Tu=new Zd,Kg=new xs,Qk=Math.cos(70*SC.DEG2RAD),$n=new fe,Ci=2*Math.PI,cn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},rf=1e-6;class Vc extends dP{constructor(e,t=null){super(e,t),this.state=cn.NONE,this.target=new fe,this.cursor=new fe,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Zo.ROTATE,MIDDLE:Zo.DOLLY,RIGHT:Zo.PAN},this.touches={ONE:Uo.ROTATE,TWO:Uo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new fe,this._lastQuaternion=new io,this._lastTargetPosition=new fe,this._quat=new io().setFromUnitVectors(e.up,new fe(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new xg,this._sphericalDelta=new xg,this._scale=1,this._panOffset=new fe,this._rotateStart=new Lt,this._rotateEnd=new Lt,this._rotateDelta=new Lt,this._panStart=new Lt,this._panEnd=new Lt,this._panDelta=new Lt,this._dollyStart=new Lt,this._dollyEnd=new Lt,this._dollyDelta=new Lt,this._dollyDirection=new fe,this._mouse=new Lt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=tB.bind(this),this._onPointerDown=eB.bind(this),this._onPointerUp=nB.bind(this),this._onContextMenu=cB.bind(this),this._onMouseWheel=rB.bind(this),this._onKeyDown=aB.bind(this),this._onTouchStart=oB.bind(this),this._onTouchMove=lB.bind(this),this._onMouseDown=iB.bind(this),this._onMouseMove=sB.bind(this),this._interceptControlDown=uB.bind(this),this._interceptControlUp=dB.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(jg),this.update(),this.state=cn.NONE}update(e=null){const t=this.object.position;$n.copy(t).sub(this.target),$n.applyQuaternion(this._quat),this._spherical.setFromVector3($n),this.autoRotate&&this.state===cn.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=Ci:n>Math.PI&&(n-=Ci),s<-Math.PI?s+=Ci:s>Math.PI&&(s-=Ci),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=a!=this._spherical.radius}if($n.setFromSpherical(this._spherical),$n.applyQuaternion(this._quatInverse),t.copy(this.target).add($n),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const o=$n.length();a=this._clampDistance(o*this._scale);const l=o-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const o=new fe(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new fe(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(o),this.object.updateMatrixWorld(),a=$n.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(Tu.origin.copy(this.object.position),Tu.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Tu.direction))<Qk?this.object.lookAt(this.target):(Kg.setFromNormalAndCoplanarPoint(this.object.up,this.target),Tu.intersectPlane(Kg,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>rf||8*(1-this._lastQuaternion.dot(this.object.quaternion))>rf||this._lastTargetPosition.distanceToSquared(this.target)>rf?(this.dispatchEvent(jg),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Ci/60*this.autoRotateSpeed*e:Ci/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){$n.setFromMatrixColumn(t,0),$n.multiplyScalar(-e),this._panOffset.add($n)}_panUp(e,t){this.screenSpacePanning===!0?$n.setFromMatrixColumn(t,1):($n.setFromMatrixColumn(t,0),$n.crossVectors(this.object.up,$n)),$n.multiplyScalar(e),this._panOffset.add($n)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;$n.copy(s).sub(this.target);let r=$n.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/n.clientHeight,this.object.matrix),this._panUp(2*t*r/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),s=e-n.left,r=t-n.top,a=n.width,o=n.height;this._mouse.x=s/a*2-1,this._mouse.y=-(r/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Ci*this._rotateDelta.x/t.clientHeight),this._rotateUp(Ci*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(n*n+s*s);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateEnd.set(s,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Ci*this._rotateDelta.x/t.clientHeight),this._rotateUp(Ci*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+t.x)*.5,o=(e.pageY+t.y)*.5;this._updateZoomParameters(a,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Lt,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function eB(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function tB(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function nB(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(wb),this.state=cn.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function iB(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Zo.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=cn.DOLLY;break;case Zo.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=cn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=cn.ROTATE}break;case Zo.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=cn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=cn.PAN}break;default:this.state=cn.NONE}this.state!==cn.NONE&&this.dispatchEvent(Xm)}function sB(i){switch(this.state){case cn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case cn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case cn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function rB(i){this.enabled===!1||this.enableZoom===!1||this.state!==cn.NONE||(i.preventDefault(),this.dispatchEvent(Xm),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(wb))}function aB(i){this.enabled!==!1&&this._handleKeyDown(i)}function oB(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case Uo.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=cn.TOUCH_ROTATE;break;case Uo.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=cn.TOUCH_PAN;break;default:this.state=cn.NONE}break;case 2:switch(this.touches.TWO){case Uo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=cn.TOUCH_DOLLY_PAN;break;case Uo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=cn.TOUCH_DOLLY_ROTATE;break;default:this.state=cn.NONE}break;default:this.state=cn.NONE}this.state!==cn.NONE&&this.dispatchEvent(Xm)}function lB(i){switch(this._trackPointer(i),this.state){case cn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case cn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case cn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case cn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=cn.NONE}}function cB(i){this.enabled!==!1&&i.preventDefault()}function uB(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function dB(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function ya(i,e){let t=0,n=null;return function(...s){const r=performance.now(),a=r-t;a>=e?(t=r,i.apply(this,s)):(n&&clearTimeout(n),n=setTimeout(()=>{t=performance.now(),i.apply(this,s),n=null},e-a))}}function qm(i,e){let t=null;return function(...n){t&&clearTimeout(t),t=setTimeout(()=>{i.apply(this,n),t=null},e)}}const Sb=.96,Mr=.32,Ft=.8,As=.84;class th{constructor(e,t,n){this.camera=e,this.threeScene=t,this.renderer=n,this.raycaster=new Gm,this.mouse=new Lt,this.draggedObject=null,this.originalPosition=null,this.originalGridData=null,this.offset=new fe,this.plane=new xs(new fe(0,1,0),0),this.updateDragPositionThrottled=ya(this.updateDragPosition.bind(this),16),this.setupEventListeners()}setupEventListeners(){this.renderer.domElement.addEventListener("mousedown",this.onMouseDown.bind(this)),this.renderer.domElement.addEventListener("mousemove",this.onMouseMove.bind(this)),this.renderer.domElement.addEventListener("mouseup",this.onMouseUp.bind(this)),this.renderer.domElement.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!1}),this.renderer.domElement.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.renderer.domElement.addEventListener("touchend",this.onTouchEnd.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),document.addEventListener("mousemove",this.onGlobalMouseMove.bind(this)),document.addEventListener("touchmove",this.onGlobalTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.onTouchEnd.bind(this))}onMouseDown(e){if(e.button!==0)return;this.updateMousePosition(e),this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.threeScene.children.filter(s=>s.userData.isBrick||s.userData.isGround),n=this.raycaster.intersectObjects(t,!0);if(n.length>0){let r=n[0].object;for(;r.parent&&!r.userData.isBrick;)r=r.parent;if(r.userData.isBrick){if(r.userData.isImmobile||r.userData.isBasePlate||r.userData.isPlaced||r.userData.isGhost)return;const a=this.threeScene.children.filter(o=>o.userData.isBrick);if(this.selectionManager&&!this.selectionManager.selectBrick(r,a))return;this.startDragging(r,n[0].point),e.preventDefault()}}}onMouseMove(e){if(this.draggedObject){this.updateMousePosition(e),this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.threeScene.children.filter(s=>s.userData.isGround||s.userData.isBasePlate),n=this.raycaster.intersectObjects(t,!0);if(n.length>0){const s=n[0].point;if(this.legoScene&&this.legoScene.placementManager){const r=this.legoScene.placementManager.getPreviewPosition(this.draggedObject,s);(this.draggedObject.userData.isMinifigure||this.draggedObject.userData.specialType==="minifigure")&&(r.y+=As),this.draggedObject.position.copy(r);const a=this.legoScene.placementManager.isValidPosition(this.draggedObject,r);this.legoScene.visualizer&&this.legoScene.visualizer.showGhost(this.draggedObject,r,a)}else this.draggedObject.position.copy(s).add(this.offset)}e.preventDefault()}}onGlobalMouseMove(e){if(!this.draggedObject)return;const t=this.renderer.domElement.getBoundingClientRect();e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom&&(this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-((e.clientY-t.top)/t.height)*2+1,this.updateDragPositionThrottled())}updateDragPosition(){if(this.draggedObject){if(this.raycaster.setFromCamera(this.mouse,this.camera),this.assemblyScene){const e=this.assemblyScene.ghostBlock?this.assemblyScene.ghostBlock.position.y:.5,t=new xs(new fe(0,1,0),-e),n=new fe;if(this.raycaster.ray.intersectPlane(t,n),n){if(this.draggedObject.position.x=n.x,this.draggedObject.position.z=n.z,this.assemblyScene.ghostBlock)this.draggedObject.position.y=this.assemblyScene.ghostBlock.position.y;else{const s=this.threeScene.children.filter(a=>a.userData.isGround||a.userData.isBasePlate),r=this.raycaster.intersectObjects(s,!0);r.length>0?this.draggedObject.position.y=Math.max(r[0].point.y+.5,.5):this.draggedObject.position.y=e}this.assemblyScene.visualizer&&this.assemblyScene.visualizer.showGhost(this.draggedObject,this.draggedObject.position,!0)}}else if(this.legoScene&&this.legoScene.placementManager){const e=this.threeScene.children.filter(n=>n.userData.isGround||n.userData.isBasePlate),t=this.raycaster.intersectObjects(e,!0);if(t.length>0){const n=t[0].point,s=this.legoScene.placementManager.getPreviewPosition(this.draggedObject,n);(this.draggedObject.userData.isMinifigure||this.draggedObject.userData.specialType==="minifigure")&&(s.y+=As),this.draggedObject.position.copy(s);const r=this.legoScene.placementManager.isValidPosition(this.draggedObject,s);this.legoScene.visualizer&&this.legoScene.visualizer.showGhost(this.draggedObject,s,r)}}}}async onMouseUp(e){e.button===0&&this.draggedObject&&await this.stopDragging()}startDragging(e,t){this.draggedObject=e,this.originalPosition=e.position.clone(),this.originallyPlaced=!1,this.legoScene&&this.legoScene.placementManager&&(this.originallyPlaced=this.legoScene.placementManager.blocks.includes(e),this.originallyPlaced&&this.legoScene.placementManager.removeBlock(e,!1)),t?this.offset.copy(e.position).sub(t):this.offset.set(0,0,0),this.legoScene&&this.legoScene.controls&&(this.legoScene.controls.enabled=!1)}startDraggingFromPalette(e){this.startDragging(e,null),this.originallyPlaced=!1,this.isNewBlock=!0,this.assemblyScene&&this.assemblyScene.visualizer&&this.assemblyScene.visualizer.showGhost(e,e.position,!0)}startDrag(e,t,n){this.draggedObject=e,this.originalPosition=e.position.clone(),this.originallyPlaced=!1,this.isNewBlock=!0,this.assemblyScene&&this.assemblyScene.controls&&(this.assemblyScene.controls.enabled=!1),this.assemblyScene&&this.assemblyScene.visualizer&&this.assemblyScene.visualizer.showGhost(e,e.position,!0)}async stopDragging(){if(this.draggedObject){if(this.assemblyScene){if(this.assemblyScene.controls&&(this.assemblyScene.controls.enabled=!0),this.assemblyScene.visualizer&&this.assemblyScene.visualizer.hideGhost(this.draggedObject),this.draggedObject){const t=this.draggedObject.userData.type,n=this.draggedObject.userData.color;t&&n&&this.assemblyScene.ghostBlock?this.assemblyScene.checkGhostCollision(this.draggedObject,this.assemblyScene.ghostBlock)?await this.assemblyScene.tryPlaceBlock(t,n):(this.assemblyScene.scene.remove(this.draggedObject),this.assemblyScene.draggedBlock=null):(this.assemblyScene.scene.remove(this.draggedObject),this.assemblyScene.draggedBlock=null)}this.draggedObject=null;return}this.legoScene&&this.legoScene.visualizer&&this.legoScene.visualizer.hideGhost(this.draggedObject);let e=!1;this.legoScene&&this.legoScene.placementManager&&(e=this.legoScene.placementManager.placeBlock(this.draggedObject,this.draggedObject.position,!0)),e||(this.isNewBlock?this.threeScene.remove(this.draggedObject):(this.draggedObject.position.copy(this.originalPosition),this.originallyPlaced&&this.legoScene&&this.legoScene.placementManager&&this.legoScene.placementManager.blocks.push(this.draggedObject))),this.legoScene&&this.legoScene.controls&&(this.legoScene.controls.enabled=!0),this.draggedObject=null,this.originalPosition=null,this.originallyPlaced=!1,this.isNewBlock=!1}}updateMousePosition(e){const t=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-((e.clientY-t.top)/t.height)*2+1}updateTouchPosition(e){if(e.touches&&e.touches.length>0){const t=e.touches[0],n=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(t.clientX-n.left)/n.width*2-1,this.mouse.y=-((t.clientY-n.top)/n.height)*2+1}else if(e.changedTouches&&e.changedTouches.length>0){const t=e.changedTouches[0],n=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(t.clientX-n.left)/n.width*2-1,this.mouse.y=-((t.clientY-n.top)/n.height)*2+1}}onTouchStart(e){if(e.touches.length!==1)return;const t=e.touches[0],n={button:0,clientX:t.clientX,clientY:t.clientY,preventDefault:()=>e.preventDefault()};this.onMouseDown(n),e.preventDefault()}onTouchMove(e){if(this.draggedObject&&e.touches.length===1){this.updateTouchPosition(e),this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.threeScene.children.filter(s=>s.userData.isGround||s.userData.isBasePlate),n=this.raycaster.intersectObjects(t,!0);if(n.length>0){const s=n[0].point;if(this.legoScene&&this.legoScene.placementManager){const r=this.legoScene.placementManager.getPreviewPosition(this.draggedObject,s);(this.draggedObject.userData.isMinifigure||this.draggedObject.userData.specialType==="minifigure")&&(r.y+=As),this.draggedObject.position.copy(r);const a=this.legoScene.placementManager.isValidPosition(this.draggedObject,r);this.legoScene.visualizer&&this.legoScene.visualizer.showGhost(this.draggedObject,r,a)}else this.draggedObject.position.copy(s).add(this.offset)}e.preventDefault()}}async onTouchEnd(e){this.draggedObject&&await this.stopDragging()}onGlobalTouchMove(e){if(!this.draggedObject||!e.touches||e.touches.length!==1)return;const t=e.touches[0],n=this.renderer.domElement.getBoundingClientRect();t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom&&(this.updateTouchPosition(e),this.updateDragPositionThrottled()),e.preventDefault()}setBlockTransparency(e,t){e.traverse(n=>{n.isMesh&&n.material&&(n.material.transparent=t<1,n.material.opacity=t)})}}class Ym{constructor(){this.snapDistance=.1,this.snapAngle=Math.PI/4}checkSnap(e,t){if(!e.userData.isBrick||!t.userData.isBrick)return null;const n=this.getStudPositions(e),s=this.getStudPositions(t);let r=null,a=1/0;for(let o=0;o<n.length;o++)for(let l=0;l<s.length;l++){const c=n[o].distanceTo(s[l]);c<this.snapDistance&&c<a&&(a=c,r={studIndex:o,targetStudIndex:l,studPosition:n[o],targetStudPosition:s[l],offset:s[l].clone().sub(n[o])})}return r}applySnap(e,t){if(t){e.position.add(t.offset);const n=e.rotation.y,s=Math.round(n/(Math.PI/2))*(Math.PI/2);e.rotation.y=s}}getStudPositions(e){const t=[];return e.traverse(n=>{if(n.userData.type==="stud"){const s=new fe;n.getWorldPosition(s),t.push(s)}}),t}snapToGrid(e){return new fe(Math.round(e.x/.8)*.8,Math.round(e.y/.8)*.8,Math.round(e.z/.8)*.8)}}class jm{constructor(){this.selectedBrick=null,this.highlightMaterial=new xl({color:16776960,transparent:!0,opacity:.3,side:ws}),this.highlightBox=null,this.onSelectionChange=null}selectBrick(e,t=[]){return this.clearSelection(),e&&e.userData.isBrick?this.hasBlocksOnTop(e,t)?!1:(this.selectedBrick=e,this.onSelectionChange&&this.onSelectionChange(e),!0):!1}hasBlocksOnTop(e,t){const n=e.position,s=e.userData.blockHeight||.96,r=e.userData.width||1,a=e.userData.length||1;for(let o=0;o<r;o++)for(let l=0;l<a;l++){const c=n.x+(o-(r-1)/2)*.8,u=n.z+(l-(a-1)/2)*.8,d=n.y+s/2;for(const h of t){if(h===e)continue;const f=h.position,p=h.userData.blockHeight||.96,m=h.userData.width||1,_=h.userData.length||1,v=f.y-p/2;if(f.y+p/2,v>=d-.1){const x=f.x-(m-1)/2*.8-.4,y=f.x+(m-1)/2*.8+.4,g=f.z-(_-1)/2*.8-.4,w=f.z+(_-1)/2*.8+.4;if(c>=x&&c<=y&&u>=g&&u<=w)return!0}}}return!1}clearSelection(){this.selectedBrick&&(this.selectedBrick=null,this.onSelectionChange&&this.onSelectionChange(null))}getSelectedBrick(){return this.selectedBrick}isSelected(e){return this.selectedBrick===e}}function Au(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Eb={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,s,r){function a(c,u){if(!s[c]){if(!n[c]){var d=typeof Au=="function"&&Au;if(!u&&d)return d(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=s[c]={exports:{}};n[c][0].call(h.exports,function(f){var p=n[c][1][f];return a(p||f)},h,h.exports,t,n,s,r)}return s[c].exports}for(var o=typeof Au=="function"&&Au,l=0;l<r.length;l++)a(r[l]);return a}({1:[function(t,n,s){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,n,s){n.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,n,s){var r=t("../math/Vec3");t("../utils/Utils"),n.exports=a;function a(c){c=c||{},this.lowerBound=new r,c.lowerBound&&this.lowerBound.copy(c.lowerBound),this.upperBound=new r,c.upperBound&&this.upperBound.copy(c.upperBound)}var o=new r;a.prototype.setFromPoints=function(c,u,d,h){var f=this.lowerBound,p=this.upperBound,m=d;f.copy(c[0]),m&&m.vmult(f,f),p.copy(f);for(var _=1;_<c.length;_++){var v=c[_];m&&(m.vmult(v,o),v=o),v.x>p.x&&(p.x=v.x),v.x<f.x&&(f.x=v.x),v.y>p.y&&(p.y=v.y),v.y<f.y&&(f.y=v.y),v.z>p.z&&(p.z=v.z),v.z<f.z&&(f.z=v.z)}return u&&(u.vadd(f,f),u.vadd(p,p)),h&&(f.x-=h,f.y-=h,f.z-=h,p.x+=h,p.y+=h,p.z+=h),this},a.prototype.copy=function(c){return this.lowerBound.copy(c.lowerBound),this.upperBound.copy(c.upperBound),this},a.prototype.clone=function(){return new a().copy(this)},a.prototype.extend=function(c){var u=c.lowerBound.x;this.lowerBound.x>u&&(this.lowerBound.x=u);var d=c.upperBound.x;this.upperBound.x<d&&(this.upperBound.x=d);var u=c.lowerBound.y;this.lowerBound.y>u&&(this.lowerBound.y=u);var d=c.upperBound.y;this.upperBound.y<d&&(this.upperBound.y=d);var u=c.lowerBound.z;this.lowerBound.z>u&&(this.lowerBound.z=u);var d=c.upperBound.z;this.upperBound.z<d&&(this.upperBound.z=d)},a.prototype.overlaps=function(c){var u=this.lowerBound,d=this.upperBound,h=c.lowerBound,f=c.upperBound;return(h.x<=d.x&&d.x<=f.x||u.x<=f.x&&f.x<=d.x)&&(h.y<=d.y&&d.y<=f.y||u.y<=f.y&&f.y<=d.y)&&(h.z<=d.z&&d.z<=f.z||u.z<=f.z&&f.z<=d.z)},a.prototype.contains=function(c){var u=this.lowerBound,d=this.upperBound,h=c.lowerBound,f=c.upperBound;return u.x<=h.x&&d.x>=f.x&&u.y<=h.y&&d.y>=f.y&&u.z<=h.z&&d.z>=f.z},a.prototype.getCorners=function(c,u,d,h,f,p,m,_){var v=this.lowerBound,x=this.upperBound;c.copy(v),u.set(x.x,v.y,v.z),d.set(x.x,x.y,v.z),h.set(v.x,x.y,x.z),f.set(x.x,v.y,v.z),p.set(v.x,x.y,v.z),m.set(v.x,v.y,x.z),_.copy(x)};var l=[new r,new r,new r,new r,new r,new r,new r,new r];a.prototype.toLocalFrame=function(c,u){var d=l,h=d[0],f=d[1],p=d[2],m=d[3],_=d[4],v=d[5],x=d[6],y=d[7];this.getCorners(h,f,p,m,_,v,x,y);for(var g=0;g!==8;g++){var w=d[g];c.pointToLocal(w,w)}return u.setFromPoints(d)},a.prototype.toWorldFrame=function(c,u){var d=l,h=d[0],f=d[1],p=d[2],m=d[3],_=d[4],v=d[5],x=d[6],y=d[7];this.getCorners(h,f,p,m,_,v,x,y);for(var g=0;g!==8;g++){var w=d[g];c.pointToWorld(w,w)}return u.setFromPoints(d)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,n,s){n.exports=r;function r(){this.matrix=[]}r.prototype.get=function(a,o){if(a=a.index,o=o.index,o>a){var l=o;o=a,a=l}return this.matrix[(a*(a+1)>>1)+o-1]},r.prototype.set=function(a,o,l){if(a=a.index,o=o.index,o>a){var c=o;o=a,a=c}this.matrix[(a*(a+1)>>1)+o-1]=l?1:0},r.prototype.reset=function(){for(var a=0,o=this.matrix.length;a!==o;a++)this.matrix[a]=0},r.prototype.setNumObjects=function(a){this.matrix.length=a*(a-1)>>1}},{}],5:[function(t,n,s){var r=t("../objects/Body"),a=t("../math/Vec3"),o=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane"),n.exports=l;function l(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}l.prototype.collisionPairs=function(m,_,v){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var c=r.STATIC|r.KINEMATIC;l.prototype.needBroadphaseCollision=function(m,_){return!(!(m.collisionFilterGroup&_.collisionFilterMask)||!(_.collisionFilterGroup&m.collisionFilterMask)||(m.type&c||m.sleepState===r.SLEEPING)&&(_.type&c||_.sleepState===r.SLEEPING))},l.prototype.intersectionTest=function(m,_,v,x){this.useBoundingBoxes?this.doBoundingBoxBroadphase(m,_,v,x):this.doBoundingSphereBroadphase(m,_,v,x)};var u=new a;new a,new o,new a,l.prototype.doBoundingSphereBroadphase=function(m,_,v,x){var y=u;_.position.vsub(m.position,y);var g=Math.pow(m.boundingRadius+_.boundingRadius,2),w=y.norm2();w<g&&(v.push(m),x.push(_))},l.prototype.doBoundingBoxBroadphase=function(m,_,v,x){m.aabbNeedsUpdate&&m.computeAABB(),_.aabbNeedsUpdate&&_.computeAABB(),m.aabb.overlaps(_.aabb)&&(v.push(m),x.push(_))};var d={keys:[]},h=[],f=[];l.prototype.makePairsUnique=function(m,_){for(var v=d,x=h,y=f,g=m.length,w=0;w!==g;w++)x[w]=m[w],y[w]=_[w];m.length=0,_.length=0;for(var w=0;w!==g;w++){var b=x[w].id,T=y[w].id,E=b<T?b+","+T:T+","+b;v[E]=w,v.keys.push(E)}for(var w=0;w!==v.keys.length;w++){var E=v.keys.pop(),S=v[E];m.push(x[S]),_.push(y[S]),delete v[E]}},l.prototype.setWorld=function(m){};var p=new a;l.boundingSphereCheck=function(m,_){var v=p;return m.position.vsub(_.position,v),Math.pow(m.shape.boundingSphereRadius+_.shape.boundingSphereRadius,2)>v.norm2()},l.prototype.aabbQuery=function(m,_,v){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,n,s){n.exports=l;var r=t("./Broadphase"),a=t("../math/Vec3"),o=t("../shapes/Shape");function l(u,d,h,f,p){r.apply(this),this.nx=h||10,this.ny=f||10,this.nz=p||10,this.aabbMin=u||new a(100,100,100),this.aabbMax=d||new a(-100,-100,-100);var m=this.nx*this.ny*this.nz;if(m<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=m,this.binLengths.length=m;for(var _=0;_<m;_++)this.bins[_]=[],this.binLengths[_]=0}l.prototype=new r,l.prototype.constructor=l;var c=new a;new a,l.prototype.collisionPairs=function(u,d,h){var f=u.numObjects(),p=u.bodies,Q=this.aabbMax,X=this.aabbMin,m=this.nx,_=this.ny,v=this.nz,x=_*v,y=v,g=1,w=Q.x,b=Q.y,T=Q.z,E=X.x,S=X.y,M=X.z,A=m/(w-E),C=_/(b-S),I=v/(T-M),H=(w-E)/m,W=(b-S)/_,z=(T-M)/v,q=Math.sqrt(H*H+W*W+z*z)*.5,O=o.types,re=O.SPHERE,le=O.PLANE;O.BOX,O.COMPOUND,O.CONVEXPOLYHEDRON;for(var Z=this.bins,ne=this.binLengths,j=this.bins.length,ee=0;ee!==j;ee++)ne[ee]=0;var F=Math.ceil,X=Math.min,Q=Math.max;function ue(Pe,Ke,Ye,De,Xe,dt,at){var qe=(Pe-E)*A|0,bt=(Ke-S)*C|0,pe=(Ye-M)*I|0,Ne=F((De-E)*A),Ge=F((Xe-S)*C),st=F((dt-M)*I);qe<0?qe=0:qe>=m&&(qe=m-1),bt<0?bt=0:bt>=_&&(bt=_-1),pe<0?pe=0:pe>=v&&(pe=v-1),Ne<0?Ne=0:Ne>=m&&(Ne=m-1),Ge<0?Ge=0:Ge>=_&&(Ge=_-1),st<0?st=0:st>=v&&(st=v-1),qe*=x,bt*=y,pe*=g,Ne*=x,Ge*=y,st*=g;for(var Fe=qe;Fe<=Ne;Fe+=x)for(var Re=bt;Re<=Ge;Re+=y)for(var pt=pe;pt<=st;pt+=g){var Tt=Fe+Re+pt;Z[Tt][ne[Tt]++]=at}}for(var ee=0;ee!==f;ee++){var ce=p[ee],xe=ce.shape;switch(xe.type){case re:var Me=ce.position.x,Y=ce.position.y,P=ce.position.z,R=xe.radius;ue(Me-R,Y-R,P-R,Me+R,Y+R,P+R,ce);break;case le:xe.worldNormalNeedsUpdate&&xe.computeWorldNormal(ce.quaternion);var N=xe.worldNormal,$=E+H*.5-ce.position.x,ie=S+W*.5-ce.position.y,ye=M+z*.5-ce.position.z,ve=c;ve.set($,ie,ye);for(var k=0,V=0;k!==m;k++,V+=x,ve.y=ie,ve.x+=H)for(var de=0,D=0;de!==_;de++,D+=y,ve.z=ye,ve.y+=W)for(var L=0,J=0;L!==v;L++,J+=g,ve.z+=z)if(ve.dot(N)<q){var K=V+D+J;Z[K][ne[K]++]=ce}break;default:ce.aabbNeedsUpdate&&ce.computeAABB(),ue(ce.aabb.lowerBound.x,ce.aabb.lowerBound.y,ce.aabb.lowerBound.z,ce.aabb.upperBound.x,ce.aabb.upperBound.y,ce.aabb.upperBound.z,ce);break}}for(var ee=0;ee!==j;ee++){var te=ne[ee];if(te>1)for(var me=Z[ee],k=0;k!==te;k++)for(var ce=me[k],de=0;de!==k;de++){var Ie=me[de];this.needBroadphaseCollision(ce,Ie)&&this.intersectionTest(ce,Ie,d,h)}}this.makePairsUnique(d,h)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,n,s){n.exports=o;var r=t("./Broadphase"),a=t("./AABB");function o(){r.apply(this)}o.prototype=new r,o.prototype.constructor=o,o.prototype.collisionPairs=function(l,c,u){var d=l.bodies,h=d.length,f,p,m,_;for(f=0;f!==h;f++)for(p=0;p!==f;p++)m=d[f],_=d[p],this.needBroadphaseCollision(m,_)&&this.intersectionTest(m,_,c,u)},new a,o.prototype.aabbQuery=function(l,c,u){u=u||[];for(var d=0;d<l.bodies.length;d++){var h=l.bodies[d];h.aabbNeedsUpdate&&h.computeAABB(),h.aabb.overlaps(c)&&u.push(h)}return u}},{"./AABB":3,"./Broadphase":5}],8:[function(t,n,s){n.exports=r;function r(){this.matrix={}}r.prototype.get=function(a,o){if(a=a.id,o=o.id,o>a){var l=o;o=a,a=l}return a+"-"+o in this.matrix},r.prototype.set=function(a,o,l){if(a=a.id,o=o.id,o>a){var c=o;o=a,a=c}l?this.matrix[a+"-"+o]=!0:delete this.matrix[a+"-"+o]},r.prototype.reset=function(){this.matrix={}},r.prototype.setNumObjects=function(a){}},{}],9:[function(t,n,s){n.exports=d;var r=t("../math/Vec3"),a=t("../math/Quaternion"),o=t("../math/Transform");t("../shapes/ConvexPolyhedron"),t("../shapes/Box");var l=t("../collision/RaycastResult"),c=t("../shapes/Shape"),u=t("../collision/AABB");function d(j,ee){this.from=j?j.clone():new r,this.to=ee?ee.clone():new r,this._direction=new r,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=d.ANY,this.result=new l,this.hasHit=!1,this.callback=function(F){}}d.prototype.constructor=d,d.CLOSEST=1,d.ANY=2,d.ALL=4;var h=new u,f=[];d.prototype.intersectWorld=function(j,ee){return this.mode=ee.mode||d.ANY,this.result=ee.result||new l,this.skipBackfaces=!!ee.skipBackfaces,this.collisionFilterMask=typeof ee.collisionFilterMask<"u"?ee.collisionFilterMask:-1,this.collisionFilterGroup=typeof ee.collisionFilterGroup<"u"?ee.collisionFilterGroup:-1,ee.from&&this.from.copy(ee.from),ee.to&&this.to.copy(ee.to),this.callback=ee.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),f.length=0,j.broadphase.aabbQuery(j,h,f),this.intersectBodies(f),this.hasHit};var p=new r,m=new r;d.pointInTriangle=_;function _(j,ee,F,X){X.vsub(ee,le),F.vsub(ee,p),j.vsub(ee,m);var Q=le.dot(le),ue=le.dot(p),ce=le.dot(m),xe=p.dot(p),Me=p.dot(m),Y,P;return(Y=xe*ce-ue*Me)>=0&&(P=Q*Me-ue*ce)>=0&&Y+P<Q*xe-ue*ue}var v=new r,x=new a;d.prototype.intersectBody=function(j,ee){ee&&(this.result=ee,this._updateDirection());var F=this.checkCollisionResponse;if(!(F&&!j.collisionResponse)&&!(!(this.collisionFilterGroup&j.collisionFilterMask)||!(j.collisionFilterGroup&this.collisionFilterMask)))for(var X=v,Q=x,ue=0,ce=j.shapes.length;ue<ce;ue++){var xe=j.shapes[ue];if(!(F&&!xe.collisionResponse)&&(j.quaternion.mult(j.shapeOrientations[ue],Q),j.quaternion.vmult(j.shapeOffsets[ue],X),X.vadd(j.position,X),this.intersectShape(xe,Q,X,j),this.result._shouldStop))break}},d.prototype.intersectBodies=function(j,ee){ee&&(this.result=ee,this._updateDirection());for(var F=0,X=j.length;!this.result._shouldStop&&F<X;F++)this.intersectBody(j[F])},d.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},d.prototype.intersectShape=function(j,ee,F,X){var Q=this.from,ue=ne(Q,this._direction,F);if(!(ue>j.boundingSphereRadius)){var ce=this[j.type];ce&&ce.call(this,j,ee,F,X)}},new r,new r;var y=new r,g=new r,w=new r,b=new r;new r,new l,d.prototype.intersectBox=function(j,ee,F,X){return this.intersectConvex(j.convexPolyhedronRepresentation,ee,F,X)},d.prototype[c.types.BOX]=d.prototype.intersectBox,d.prototype.intersectPlane=function(j,ee,F,X){var Q=this.from,ue=this.to,ce=this._direction,xe=new r(0,0,1);ee.vmult(xe,xe);var Me=new r;Q.vsub(F,Me);var Y=Me.dot(xe);ue.vsub(F,Me);var P=Me.dot(xe);if(!(Y*P>0)&&!(Q.distanceTo(ue)<Y)){var R=xe.dot(ce);if(!(Math.abs(R)<this.precision)){var N=new r,$=new r,ie=new r;Q.vsub(F,N);var ye=-xe.dot(N)/R;ce.scale(ye,$),Q.vadd($,ie),this.reportIntersection(xe,ie,j,X,-1)}}},d.prototype[c.types.PLANE]=d.prototype.intersectPlane,d.prototype.getAABB=function(j){var ee=this.to,F=this.from;j.lowerBound.x=Math.min(ee.x,F.x),j.lowerBound.y=Math.min(ee.y,F.y),j.lowerBound.z=Math.min(ee.z,F.z),j.upperBound.x=Math.max(ee.x,F.x),j.upperBound.y=Math.max(ee.y,F.y),j.upperBound.z=Math.max(ee.z,F.z)};var T={faceList:[0]};d.prototype.intersectHeightfield=function(j,ee,F,X){j.data,j.elementSize;var Q=new r,ue=new d(this.from,this.to);o.pointToLocalFrame(F,ee,ue.from,ue.from),o.pointToLocalFrame(F,ee,ue.to,ue.to);var ce=[],xe=null,Me=null,Y=null,P=null,R=j.getIndexOfPosition(ue.from.x,ue.from.y,ce,!1);if(R&&(xe=ce[0],Me=ce[1],Y=ce[0],P=ce[1]),R=j.getIndexOfPosition(ue.to.x,ue.to.y,ce,!1),R&&((xe===null||ce[0]<xe)&&(xe=ce[0]),(Y===null||ce[0]>Y)&&(Y=ce[0]),(Me===null||ce[1]<Me)&&(Me=ce[1]),(P===null||ce[1]>P)&&(P=ce[1])),xe!==null){var N=[];j.getRectMinMax(xe,Me,Y,P,N),N[0],N[1];for(var $=xe;$<=Y;$++)for(var ie=Me;ie<=P;ie++){if(this.result._shouldStop||(j.getConvexTrianglePillar($,ie,!1),o.pointToWorldFrame(F,ee,j.pillarOffset,Q),this.intersectConvex(j.pillarConvex,ee,Q,X,T),this.result._shouldStop))return;j.getConvexTrianglePillar($,ie,!0),o.pointToWorldFrame(F,ee,j.pillarOffset,Q),this.intersectConvex(j.pillarConvex,ee,Q,X,T)}}},d.prototype[c.types.HEIGHTFIELD]=d.prototype.intersectHeightfield;var E=new r,S=new r;d.prototype.intersectSphere=function(j,ee,F,X){var Q=this.from,ue=this.to,ce=j.radius,xe=Math.pow(ue.x-Q.x,2)+Math.pow(ue.y-Q.y,2)+Math.pow(ue.z-Q.z,2),Me=2*((ue.x-Q.x)*(Q.x-F.x)+(ue.y-Q.y)*(Q.y-F.y)+(ue.z-Q.z)*(Q.z-F.z)),Y=Math.pow(Q.x-F.x,2)+Math.pow(Q.y-F.y,2)+Math.pow(Q.z-F.z,2)-Math.pow(ce,2),P=Math.pow(Me,2)-4*xe*Y,R=E,N=S;if(!(P<0))if(P===0)Q.lerp(ue,P,R),R.vsub(F,N),N.normalize(),this.reportIntersection(N,R,j,X,-1);else{var $=(-Me-Math.sqrt(P))/(2*xe),ie=(-Me+Math.sqrt(P))/(2*xe);if($>=0&&$<=1&&(Q.lerp(ue,$,R),R.vsub(F,N),N.normalize(),this.reportIntersection(N,R,j,X,-1)),this.result._shouldStop)return;ie>=0&&ie<=1&&(Q.lerp(ue,ie,R),R.vsub(F,N),N.normalize(),this.reportIntersection(N,R,j,X,-1))}},d.prototype[c.types.SPHERE]=d.prototype.intersectSphere;var M=new r;new r,new r;var A=new r;d.prototype.intersectConvex=function(ee,F,X,Q,ue){for(var ce=M,xe=A,Me=ue&&ue.faceList||null,Y=ee.faces,P=ee.vertices,R=ee.faceNormals,N=this._direction,$=this.from,ie=this.to,ye=$.distanceTo(ie),ve=Me?Me.length:Y.length,k=this.result,V=0;!k._shouldStop&&V<ve;V++){var de=Me?Me[V]:V,D=Y[de],L=R[de],J=F,K=X;xe.copy(P[D[0]]),J.vmult(xe,xe),xe.vadd(K,xe),xe.vsub($,xe),J.vmult(L,ce);var te=N.dot(ce);if(!(Math.abs(te)<this.precision)){var me=ce.dot(xe)/te;if(!(me<0)){N.mult(me,y),y.vadd($,y),g.copy(P[D[0]]),J.vmult(g,g),K.vadd(g,g);for(var Ie=1;!k._shouldStop&&Ie<D.length-1;Ie++){w.copy(P[D[Ie]]),b.copy(P[D[Ie+1]]),J.vmult(w,w),J.vmult(b,b),K.vadd(w,w),K.vadd(b,b);var Pe=y.distanceTo($);!(_(y,g,w,b)||_(y,w,g,b))||Pe>ye||this.reportIntersection(ce,y,ee,Q,de)}}}}},d.prototype[c.types.CONVEXPOLYHEDRON]=d.prototype.intersectConvex;var C=new r,I=new r,H=new r,W=new r,z=new r,q=new r;new u;var O=[],re=new o;d.prototype.intersectTrimesh=function(ee,F,X,Q,ue){var ce=C,xe=O,Me=re,Y=A,P=I,R=H,N=W,$=q,ie=z;ue&&ue.faceList;var ye=ee.indices;ee.vertices,ee.faceNormals;var ve=this.from,k=this.to,V=this._direction;Me.position.copy(X),Me.quaternion.copy(F),o.vectorToLocalFrame(X,F,V,P),o.pointToLocalFrame(X,F,ve,R),o.pointToLocalFrame(X,F,k,N);var de=R.distanceSquared(N);ee.tree.rayQuery(this,Me,xe);for(var D=0,L=xe.length;!this.result._shouldStop&&D!==L;D++){var J=xe[D];ee.getNormal(J,ce),ee.getVertex(ye[J*3],g),g.vsub(R,Y);var K=P.dot(ce),te=ce.dot(Y)/K;if(!(te<0)){P.scale(te,y),y.vadd(R,y),ee.getVertex(ye[J*3+1],w),ee.getVertex(ye[J*3+2],b);var me=y.distanceSquared(R);!(_(y,w,g,b)||_(y,g,w,b))||me>de||(o.vectorToWorldFrame(F,ce,ie),o.pointToWorldFrame(X,F,y,$),this.reportIntersection(ie,$,ee,Q,J))}}xe.length=0},d.prototype[c.types.TRIMESH]=d.prototype.intersectTrimesh,d.prototype.reportIntersection=function(j,ee,F,X,Q){var ue=this.from,ce=this.to,xe=ue.distanceTo(ee),Me=this.result;if(!(this.skipBackfaces&&j.dot(this._direction)>0))switch(Me.hitFaceIndex=typeof Q<"u"?Q:-1,this.mode){case d.ALL:this.hasHit=!0,Me.set(ue,ce,j,ee,F,X,xe),Me.hasHit=!0,this.callback(Me);break;case d.CLOSEST:(xe<Me.distance||!Me.hasHit)&&(this.hasHit=!0,Me.hasHit=!0,Me.set(ue,ce,j,ee,F,X,xe));break;case d.ANY:this.hasHit=!0,Me.hasHit=!0,Me.set(ue,ce,j,ee,F,X,xe),Me._shouldStop=!0;break}};var le=new r,Z=new r;function ne(j,ee,F){F.vsub(j,le);var X=le.dot(ee);ee.mult(X,Z),Z.vadd(j,Z);var Q=F.distanceTo(Z);return Q}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,n,s){var r=t("../math/Vec3");n.exports=a;function a(){this.rayFromWorld=new r,this.rayToWorld=new r,this.hitNormalWorld=new r,this.hitPointWorld=new r,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}a.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},a.prototype.abort=function(){this._shouldStop=!0},a.prototype.set=function(o,l,c,u,d,h,f){this.rayFromWorld.copy(o),this.rayToWorld.copy(l),this.hitNormalWorld.copy(c),this.hitPointWorld.copy(u),this.shape=d,this.body=h,this.distance=f}},{"../math/Vec3":30}],11:[function(t,n,s){t("../shapes/Shape");var r=t("../collision/Broadphase");n.exports=a;function a(o){r.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var l=this.axisList;this._addBodyHandler=function(c){l.push(c.body)},this._removeBodyHandler=function(c){var u=l.indexOf(c.body);u!==-1&&l.splice(u,1)},o&&this.setWorld(o)}a.prototype=new r,a.prototype.setWorld=function(o){this.axisList.length=0;for(var l=0;l<o.bodies.length;l++)this.axisList.push(o.bodies[l]);o.removeEventListener("addBody",this._addBodyHandler),o.removeEventListener("removeBody",this._removeBodyHandler),o.addEventListener("addBody",this._addBodyHandler),o.addEventListener("removeBody",this._removeBodyHandler),this.world=o,this.dirty=!0},a.insertionSortX=function(o){for(var l=1,c=o.length;l<c;l++){for(var u=o[l],d=l-1;d>=0&&!(o[d].aabb.lowerBound.x<=u.aabb.lowerBound.x);d--)o[d+1]=o[d];o[d+1]=u}return o},a.insertionSortY=function(o){for(var l=1,c=o.length;l<c;l++){for(var u=o[l],d=l-1;d>=0&&!(o[d].aabb.lowerBound.y<=u.aabb.lowerBound.y);d--)o[d+1]=o[d];o[d+1]=u}return o},a.insertionSortZ=function(o){for(var l=1,c=o.length;l<c;l++){for(var u=o[l],d=l-1;d>=0&&!(o[d].aabb.lowerBound.z<=u.aabb.lowerBound.z);d--)o[d+1]=o[d];o[d+1]=u}return o},a.prototype.collisionPairs=function(o,l,c){var u=this.axisList,d=u.length,h=this.axisIndex,f,p;for(this.dirty&&(this.sortList(),this.dirty=!1),f=0;f!==d;f++){var m=u[f];for(p=f+1;p<d;p++){var _=u[p];if(this.needBroadphaseCollision(m,_)){if(!a.checkBounds(m,_,h))break;this.intersectionTest(m,_,l,c)}}}},a.prototype.sortList=function(){for(var o=this.axisList,l=this.axisIndex,c=o.length,u=0;u!==c;u++){var d=o[u];d.aabbNeedsUpdate&&d.computeAABB()}l===0?a.insertionSortX(o):l===1?a.insertionSortY(o):l===2&&a.insertionSortZ(o)},a.checkBounds=function(o,l,c){var u,d;c===0?(u=o.position.x,d=l.position.x):c===1?(u=o.position.y,d=l.position.y):c===2&&(u=o.position.z,d=l.position.z);var h=o.boundingRadius,f=l.boundingRadius,p=u+h,m=d-f;return m<p},a.prototype.autoDetectAxis=function(){for(var o=0,l=0,c=0,u=0,d=0,h=0,f=this.axisList,p=f.length,m=1/p,_=0;_!==p;_++){var v=f[_],x=v.position.x;o+=x,l+=x*x;var y=v.position.y;c+=y,u+=y*y;var g=v.position.z;d+=g,h+=g*g}var w=l-o*o*m,b=u-c*c*m,T=h-d*d*m;w>b?w>T?this.axisIndex=0:this.axisIndex=2:b>T?this.axisIndex=1:this.axisIndex=2},a.prototype.aabbQuery=function(o,l,c){c=c||[],this.dirty&&(this.sortList(),this.dirty=!1);var u=this.axisIndex,d="x";u===1&&(d="y"),u===2&&(d="z");var h=this.axisList;l.lowerBound[d],l.upperBound[d];for(var f=0;f<h.length;f++){var p=h[f];p.aabbNeedsUpdate&&p.computeAABB(),p.aabb.overlaps(l)&&c.push(p)}return c}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,n,s){n.exports=c,t("./Constraint");var r=t("./PointToPointConstraint"),a=t("../equations/ConeEquation"),o=t("../equations/RotationalEquation");t("../equations/ContactEquation");var l=t("../math/Vec3");function c(u,d,h){h=h||{};var f=typeof h.maxForce<"u"?h.maxForce:1e6,p=h.pivotA?h.pivotA.clone():new l,m=h.pivotB?h.pivotB.clone():new l;this.axisA=h.axisA?h.axisA.clone():new l,this.axisB=h.axisB?h.axisB.clone():new l,r.call(this,u,p,d,m,f),this.collideConnected=!!h.collideConnected,this.angle=typeof h.angle<"u"?h.angle:0;var _=this.coneEquation=new a(u,d,h),v=this.twistEquation=new o(u,d,h);this.twistAngle=typeof h.twistAngle<"u"?h.twistAngle:0,_.maxForce=0,_.minForce=-f,v.maxForce=0,v.minForce=-f,this.equations.push(_,v)}c.prototype=new r,c.constructor=c,new l,new l,c.prototype.update=function(){var u=this.bodyA,d=this.bodyB,h=this.coneEquation,f=this.twistEquation;r.prototype.update.call(this),u.vectorToWorldFrame(this.axisA,h.axisA),d.vectorToWorldFrame(this.axisB,h.axisB),this.axisA.tangents(f.axisA,f.axisA),u.vectorToWorldFrame(f.axisA,f.axisA),this.axisB.tangents(f.axisB,f.axisB),d.vectorToWorldFrame(f.axisB,f.axisB),h.angle=this.angle,f.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,n,s){n.exports=a;var r=t("../utils/Utils");function a(o,l,c){c=r.defaults(c,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=o,this.bodyB=l,this.id=a.idCounter++,this.collideConnected=c.collideConnected,c.wakeUpBodies&&(o&&o.wakeUp(),l&&l.wakeUp())}a.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},a.prototype.enable=function(){for(var o=this.equations,l=0;l<o.length;l++)o[l].enabled=!0},a.prototype.disable=function(){for(var o=this.equations,l=0;l<o.length;l++)o[l].enabled=!1},a.idCounter=0},{"../utils/Utils":53}],14:[function(t,n,s){n.exports=o;var r=t("./Constraint"),a=t("../equations/ContactEquation");function o(l,c,u,d){r.call(this,l,c),typeof u>"u"&&(u=l.position.distanceTo(c.position)),typeof d>"u"&&(d=1e6),this.distance=u;var h=this.distanceEquation=new a(l,c);this.equations.push(h),h.minForce=-d,h.maxForce=d}o.prototype=new r,o.prototype.update=function(){var l=this.bodyA,c=this.bodyB,u=this.distanceEquation,d=this.distance*.5,h=u.ni;c.position.vsub(l.position,h),h.normalize(),h.mult(d,u.ri),h.mult(-d,u.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,n,s){n.exports=c,t("./Constraint");var r=t("./PointToPointConstraint"),a=t("../equations/RotationalEquation"),o=t("../equations/RotationalMotorEquation");t("../equations/ContactEquation");var l=t("../math/Vec3");function c(h,f,p){p=p||{};var m=typeof p.maxForce<"u"?p.maxForce:1e6,_=p.pivotA?p.pivotA.clone():new l,v=p.pivotB?p.pivotB.clone():new l;r.call(this,h,_,f,v,m);var x=this.axisA=p.axisA?p.axisA.clone():new l(1,0,0);x.normalize();var y=this.axisB=p.axisB?p.axisB.clone():new l(1,0,0);y.normalize();var g=this.rotationalEquation1=new a(h,f,p),w=this.rotationalEquation2=new a(h,f,p),b=this.motorEquation=new o(h,f,m);b.enabled=!1,this.equations.push(g,w,b)}c.prototype=new r,c.constructor=c,c.prototype.enableMotor=function(){this.motorEquation.enabled=!0},c.prototype.disableMotor=function(){this.motorEquation.enabled=!1},c.prototype.setMotorSpeed=function(h){this.motorEquation.targetVelocity=h},c.prototype.setMotorMaxForce=function(h){this.motorEquation.maxForce=h,this.motorEquation.minForce=-h};var u=new l,d=new l;c.prototype.update=function(){var h=this.bodyA,f=this.bodyB,p=this.motorEquation,m=this.rotationalEquation1,_=this.rotationalEquation2,v=u,x=d,y=this.axisA,g=this.axisB;r.prototype.update.call(this),h.quaternion.vmult(y,v),f.quaternion.vmult(g,x),v.tangents(m.axisA,_.axisA),m.axisB.copy(x),_.axisB.copy(x),this.motorEquation.enabled&&(h.quaternion.vmult(this.axisA,p.axisA),f.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,n,s){n.exports=l,t("./Constraint");var r=t("./PointToPointConstraint"),a=t("../equations/RotationalEquation");t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation");var o=t("../math/Vec3");function l(c,u,d){d=d||{};var h=typeof d.maxForce<"u"?d.maxForce:1e6,f=new o,p=new o,m=new o;c.position.vadd(u.position,m),m.scale(.5,m),u.pointToLocalFrame(m,p),c.pointToLocalFrame(m,f),r.call(this,c,f,u,p,h);var _=this.rotationalEquation1=new a(c,u,d),v=this.rotationalEquation2=new a(c,u,d),x=this.rotationalEquation3=new a(c,u,d);this.equations.push(_,v,x)}l.prototype=new r,l.constructor=l,new o,new o,l.prototype.update=function(){var c=this.bodyA,u=this.bodyB;this.motorEquation;var d=this.rotationalEquation1,h=this.rotationalEquation2,f=this.rotationalEquation3;r.prototype.update.call(this),c.vectorToWorldFrame(o.UNIT_X,d.axisA),u.vectorToWorldFrame(o.UNIT_Y,d.axisB),c.vectorToWorldFrame(o.UNIT_Y,h.axisA),u.vectorToWorldFrame(o.UNIT_Z,h.axisB),c.vectorToWorldFrame(o.UNIT_Z,f.axisA),u.vectorToWorldFrame(o.UNIT_X,f.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,n,s){n.exports=l;var r=t("./Constraint"),a=t("../equations/ContactEquation"),o=t("../math/Vec3");function l(c,u,d,h,f){r.call(this,c,d),f=typeof f<"u"?f:1e6,this.pivotA=u?u.clone():new o,this.pivotB=h?h.clone():new o;var p=this.equationX=new a(c,d),m=this.equationY=new a(c,d),_=this.equationZ=new a(c,d);this.equations.push(p,m,_),p.minForce=m.minForce=_.minForce=-f,p.maxForce=m.maxForce=_.maxForce=f,p.ni.set(1,0,0),m.ni.set(0,1,0),_.ni.set(0,0,1)}l.prototype=new r,l.prototype.update=function(){var c=this.bodyA,u=this.bodyB,d=this.equationX,h=this.equationY,f=this.equationZ;c.quaternion.vmult(this.pivotA,d.ri),u.quaternion.vmult(this.pivotB,d.rj),h.ri.copy(d.ri),h.rj.copy(d.rj),f.ri.copy(d.ri),f.rj.copy(d.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,n,s){n.exports=o;var r=t("../math/Vec3");t("../math/Mat3");var a=t("./Equation");function o(u,d,h){h=h||{};var f=typeof h.maxForce<"u"?h.maxForce:1e6;a.call(this,u,d,-f,f),this.axisA=h.axisA?h.axisA.clone():new r(1,0,0),this.axisB=h.axisB?h.axisB.clone():new r(0,1,0),this.angle=typeof h.angle<"u"?h.angle:0}o.prototype=new a,o.prototype.constructor=o;var l=new r,c=new r;o.prototype.computeB=function(u){var d=this.a,h=this.b,f=this.axisA,p=this.axisB,m=l,_=c,v=this.jacobianElementA,x=this.jacobianElementB;f.cross(p,m),p.cross(f,_),v.rotational.copy(_),x.rotational.copy(m);var y=Math.cos(this.angle)-f.dot(p),g=this.computeGW(),w=this.computeGiMf(),b=-y*d-g*h-u*w;return b}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,n,s){n.exports=o;var r=t("./Equation"),a=t("../math/Vec3");t("../math/Mat3");function o(_,v,x){x=typeof x<"u"?x:1e6,r.call(this,_,v,0,x),this.restitution=0,this.ri=new a,this.rj=new a,this.ni=new a}o.prototype=new r,o.prototype.constructor=o;var l=new a,c=new a,u=new a;o.prototype.computeB=function(_){var v=this.a,x=this.b,y=this.bi,g=this.bj,w=this.ri,b=this.rj,T=l,E=c,S=y.velocity,M=y.angularVelocity;y.force,y.torque;var A=g.velocity,C=g.angularVelocity;g.force,g.torque;var I=u,H=this.jacobianElementA,W=this.jacobianElementB,z=this.ni;w.cross(z,T),b.cross(z,E),z.negate(H.spatial),T.negate(H.rotational),W.spatial.copy(z),W.rotational.copy(E),I.copy(g.position),I.vadd(b,I),I.vsub(y.position,I),I.vsub(w,I);var q=z.dot(I),O=this.restitution+1,re=O*A.dot(z)-O*S.dot(z)+C.dot(E)-M.dot(T),le=this.computeGiMf(),Z=-q*v-re*x-_*le;return Z};var d=new a,h=new a,f=new a,p=new a,m=new a;o.prototype.getImpactVelocityAlongNormal=function(){var _=d,v=h,x=f,y=p,g=m;return this.bi.position.vadd(this.ri,x),this.bj.position.vadd(this.rj,y),this.bi.getVelocityAtWorldPoint(x,_),this.bj.getVelocityAtWorldPoint(y,v),_.vsub(v,g),this.ni.dot(g)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,n,s){n.exports=o;var r=t("../math/JacobianElement"),a=t("../math/Vec3");function o(m,_,v,x){this.id=o.id++,this.minForce=typeof v>"u"?-1e6:v,this.maxForce=typeof x>"u"?1e6:x,this.bi=m,this.bj=_,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}o.prototype.constructor=o,o.id=0,o.prototype.setSpookParams=function(m,_,v){var x=_,y=m,g=v;this.a=4/(g*(1+4*x)),this.b=4*x/(1+4*x),this.eps=4/(g*g*y*(1+4*x))},o.prototype.computeB=function(m,_,v){var x=this.computeGW(),y=this.computeGq(),g=this.computeGiMf();return-y*m-x*_-g*v},o.prototype.computeGq=function(){var m=this.jacobianElementA,_=this.jacobianElementB,v=this.bi,x=this.bj,y=v.position,g=x.position;return m.spatial.dot(y)+_.spatial.dot(g)};var l=new a;o.prototype.computeGW=function(){var m=this.jacobianElementA,_=this.jacobianElementB,v=this.bi,x=this.bj,y=v.velocity,g=x.velocity,w=v.angularVelocity||l,b=x.angularVelocity||l;return m.multiplyVectors(y,w)+_.multiplyVectors(g,b)},o.prototype.computeGWlambda=function(){var m=this.jacobianElementA,_=this.jacobianElementB,v=this.bi,x=this.bj,y=v.vlambda,g=x.vlambda,w=v.wlambda||l,b=x.wlambda||l;return m.multiplyVectors(y,w)+_.multiplyVectors(g,b)};var c=new a,u=new a,d=new a,h=new a;o.prototype.computeGiMf=function(){var m=this.jacobianElementA,_=this.jacobianElementB,v=this.bi,x=this.bj,y=v.force,g=v.torque,w=x.force,b=x.torque,T=v.invMassSolve,E=x.invMassSolve;return v.invInertiaWorldSolve?v.invInertiaWorldSolve.vmult(g,d):d.set(0,0,0),x.invInertiaWorldSolve?x.invInertiaWorldSolve.vmult(b,h):h.set(0,0,0),y.mult(T,c),w.mult(E,u),m.multiplyVectors(c,d)+_.multiplyVectors(u,h)};var f=new a;o.prototype.computeGiMGt=function(){var m=this.jacobianElementA,_=this.jacobianElementB,v=this.bi,x=this.bj,y=v.invMassSolve,g=x.invMassSolve,w=v.invInertiaWorldSolve,b=x.invInertiaWorldSolve,T=y+g;return w&&(w.vmult(m.rotational,f),T+=f.dot(m.rotational)),b&&(b.vmult(_.rotational,f),T+=f.dot(_.rotational)),T};var p=new a;new a,new a,new a,new a,new a,o.prototype.addToWlambda=function(m){var _=this.jacobianElementA,v=this.jacobianElementB,x=this.bi,y=this.bj,g=p;_.spatial.mult(x.invMassSolve*m,g),x.vlambda.vadd(g,x.vlambda),v.spatial.mult(y.invMassSolve*m,g),y.vlambda.vadd(g,y.vlambda),x.invInertiaWorldSolve&&(x.invInertiaWorldSolve.vmult(_.rotational,g),g.mult(m,g),x.wlambda.vadd(g,x.wlambda)),y.invInertiaWorldSolve&&(y.invInertiaWorldSolve.vmult(v.rotational,g),g.mult(m,g),y.wlambda.vadd(g,y.wlambda))},o.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,n,s){n.exports=o;var r=t("./Equation"),a=t("../math/Vec3");t("../math/Mat3");function o(u,d,h){r.call(this,u,d,-h,h),this.ri=new a,this.rj=new a,this.t=new a}o.prototype=new r,o.prototype.constructor=o;var l=new a,c=new a;o.prototype.computeB=function(u){this.a;var d=this.b;this.bi,this.bj;var h=this.ri,f=this.rj,p=l,m=c,_=this.t;h.cross(_,p),f.cross(_,m);var v=this.jacobianElementA,x=this.jacobianElementB;_.negate(v.spatial),p.negate(v.rotational),x.spatial.copy(_),x.rotational.copy(m);var y=this.computeGW(),g=this.computeGiMf(),w=-y*d-u*g;return w}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,n,s){n.exports=o;var r=t("../math/Vec3");t("../math/Mat3");var a=t("./Equation");function o(u,d,h){h=h||{};var f=typeof h.maxForce<"u"?h.maxForce:1e6;a.call(this,u,d,-f,f),this.axisA=h.axisA?h.axisA.clone():new r(1,0,0),this.axisB=h.axisB?h.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}o.prototype=new a,o.prototype.constructor=o;var l=new r,c=new r;o.prototype.computeB=function(u){var d=this.a,h=this.b,f=this.axisA,p=this.axisB,m=l,_=c,v=this.jacobianElementA,x=this.jacobianElementB;f.cross(p,m),p.cross(f,_),v.rotational.copy(_),x.rotational.copy(m);var y=Math.cos(this.maxAngle)-f.dot(p),g=this.computeGW(),w=this.computeGiMf(),b=-y*d-g*h-u*w;return b}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,n,s){n.exports=o;var r=t("../math/Vec3");t("../math/Mat3");var a=t("./Equation");function o(l,c,u){u=typeof u<"u"?u:1e6,a.call(this,l,c,-u,u),this.axisA=new r,this.axisB=new r,this.targetVelocity=0}o.prototype=new a,o.prototype.constructor=o,o.prototype.computeB=function(l){this.a;var c=this.b;this.bi,this.bj;var u=this.axisA,d=this.axisB,h=this.jacobianElementA,f=this.jacobianElementB;h.rotational.copy(u),d.negate(f.rotational);var p=this.computeGW()-this.targetVelocity,m=this.computeGiMf(),_=-p*c-l*m;return _}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,n,s){var r=t("../utils/Utils");n.exports=a;function a(o,l,c){c=r.defaults(c,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=a.idCounter++,this.materials=[o,l],this.friction=c.friction,this.restitution=c.restitution,this.contactEquationStiffness=c.contactEquationStiffness,this.contactEquationRelaxation=c.contactEquationRelaxation,this.frictionEquationStiffness=c.frictionEquationStiffness,this.frictionEquationRelaxation=c.frictionEquationRelaxation}a.idCounter=0},{"../utils/Utils":53}],25:[function(t,n,s){n.exports=r;function r(a){var o="";a=a||{},typeof a=="string"?(o=a,a={}):typeof a=="object"&&(o=""),this.name=o,this.id=r.idCounter++,this.friction=typeof a.friction<"u"?a.friction:-1,this.restitution=typeof a.restitution<"u"?a.restitution:-1}r.idCounter=0},{}],26:[function(t,n,s){n.exports=a;var r=t("./Vec3");function a(){this.spatial=new r,this.rotational=new r}a.prototype.multiplyElement=function(o){return o.spatial.dot(this.spatial)+o.rotational.dot(this.rotational)},a.prototype.multiplyVectors=function(o,l){return o.dot(this.spatial)+l.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,n,s){n.exports=a;var r=t("./Vec3");function a(o){o?this.elements=o:this.elements=[0,0,0,0,0,0,0,0,0]}a.prototype.identity=function(){var o=this.elements;o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1},a.prototype.setZero=function(){var o=this.elements;o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o[8]=0},a.prototype.setTrace=function(o){var l=this.elements;l[0]=o.x,l[4]=o.y,l[8]=o.z},a.prototype.getTrace=function(l){var l=l||new r,c=this.elements;l.x=c[0],l.y=c[4],l.z=c[8]},a.prototype.vmult=function(o,l){l=l||new r;var c=this.elements,u=o.x,d=o.y,h=o.z;return l.x=c[0]*u+c[1]*d+c[2]*h,l.y=c[3]*u+c[4]*d+c[5]*h,l.z=c[6]*u+c[7]*d+c[8]*h,l},a.prototype.smult=function(o){for(var l=0;l<this.elements.length;l++)this.elements[l]*=o},a.prototype.mmult=function(o,l){for(var c=l||new a,u=0;u<3;u++)for(var d=0;d<3;d++){for(var h=0,f=0;f<3;f++)h+=o.elements[u+f*3]*this.elements[f+d*3];c.elements[u+d*3]=h}return c},a.prototype.scale=function(o,l){l=l||new a;for(var c=this.elements,u=l.elements,d=0;d!==3;d++)u[3*d+0]=o.x*c[3*d+0],u[3*d+1]=o.y*c[3*d+1],u[3*d+2]=o.z*c[3*d+2];return l},a.prototype.solve=function(o,l){l=l||new r;for(var c=3,u=4,d=[],h=0;h<c*u;h++)d.push(0);var h,f;for(h=0;h<3;h++)for(f=0;f<3;f++)d[h+u*f]=this.elements[h+3*f];d[3+4*0]=o.x,d[3+4*1]=o.y,d[3+4*2]=o.z;var p=3,m=p,_,v=4,x;do{if(h=m-p,d[h+u*h]===0){for(f=h+1;f<m;f++)if(d[h+u*f]!==0){_=v;do x=v-_,d[x+u*h]+=d[x+u*f];while(--_);break}}if(d[h+u*h]!==0)for(f=h+1;f<m;f++){var y=d[h+u*f]/d[h+u*h];_=v;do x=v-_,d[x+u*f]=x<=h?0:d[x+u*f]-d[x+u*h]*y;while(--_)}}while(--p);if(l.z=d[2*u+3]/d[2*u+2],l.y=(d[1*u+3]-d[1*u+2]*l.z)/d[1*u+1],l.x=(d[0*u+3]-d[0*u+2]*l.z-d[0*u+1]*l.y)/d[0*u+0],isNaN(l.x)||isNaN(l.y)||isNaN(l.z)||l.x===1/0||l.y===1/0||l.z===1/0)throw"Could not solve equation! Got x=["+l.toString()+"], b=["+o.toString()+"], A=["+this.toString()+"]";return l},a.prototype.e=function(o,l,c){if(c===void 0)return this.elements[l+3*o];this.elements[l+3*o]=c},a.prototype.copy=function(o){for(var l=0;l<o.elements.length;l++)this.elements[l]=o.elements[l];return this},a.prototype.toString=function(){for(var o="",l=",",c=0;c<9;c++)o+=this.elements[c]+l;return o},a.prototype.reverse=function(o){o=o||new a;for(var l=3,c=6,u=[],d=0;d<l*c;d++)u.push(0);var d,h;for(d=0;d<3;d++)for(h=0;h<3;h++)u[d+c*h]=this.elements[d+3*h];u[3+6*0]=1,u[3+6*1]=0,u[3+6*2]=0,u[4+6*0]=0,u[4+6*1]=1,u[4+6*2]=0,u[5+6*0]=0,u[5+6*1]=0,u[5+6*2]=1;var f=3,p=f,m,_=c,v;do{if(d=p-f,u[d+c*d]===0){for(h=d+1;h<p;h++)if(u[d+c*h]!==0){m=_;do v=_-m,u[v+c*d]+=u[v+c*h];while(--m);break}}if(u[d+c*d]!==0)for(h=d+1;h<p;h++){var x=u[d+c*h]/u[d+c*d];m=_;do v=_-m,u[v+c*h]=v<=d?0:u[v+c*h]-u[v+c*d]*x;while(--m)}}while(--f);d=2;do{h=d-1;do{var x=u[d+c*h]/u[d+c*d];m=c;do v=c-m,u[v+c*h]=u[v+c*h]-u[v+c*d]*x;while(--m)}while(h--)}while(--d);d=2;do{var x=1/u[d+c*d];m=c;do v=c-m,u[v+c*d]=u[v+c*d]*x;while(--m)}while(d--);d=2;do{h=2;do{if(v=u[l+h+c*d],isNaN(v)||v===1/0)throw"Could not reverse! A=["+this.toString()+"]";o.e(d,h,v)}while(h--)}while(d--);return o},a.prototype.setRotationFromQuaternion=function(o){var l=o.x,c=o.y,u=o.z,d=o.w,h=l+l,f=c+c,p=u+u,m=l*h,_=l*f,v=l*p,x=c*f,y=c*p,g=u*p,w=d*h,b=d*f,T=d*p,E=this.elements;return E[3*0+0]=1-(x+g),E[3*0+1]=_-T,E[3*0+2]=v+b,E[3*1+0]=_+T,E[3*1+1]=1-(m+g),E[3*1+2]=y-w,E[3*2+0]=v-b,E[3*2+1]=y+w,E[3*2+2]=1-(m+x),this},a.prototype.transpose=function(o){o=o||new a;for(var l=o.elements,c=this.elements,u=0;u!==3;u++)for(var d=0;d!==3;d++)l[3*u+d]=c[3*d+u];return o}},{"./Vec3":30}],28:[function(t,n,s){n.exports=a;var r=t("./Vec3");function a(h,f,p,m){this.x=h!==void 0?h:0,this.y=f!==void 0?f:0,this.z=p!==void 0?p:0,this.w=m!==void 0?m:1}a.prototype.set=function(h,f,p,m){this.x=h,this.y=f,this.z=p,this.w=m},a.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},a.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},a.prototype.setFromAxisAngle=function(h,f){var p=Math.sin(f*.5);this.x=h.x*p,this.y=h.y*p,this.z=h.z*p,this.w=Math.cos(f*.5)},a.prototype.toAxisAngle=function(h){h=h||new r,this.normalize();var f=2*Math.acos(this.w),p=Math.sqrt(1-this.w*this.w);return p<.001?(h.x=this.x,h.y=this.y,h.z=this.z):(h.x=this.x/p,h.y=this.y/p,h.z=this.z/p),[h,f]};var o=new r,l=new r;a.prototype.setFromVectors=function(h,f){if(h.isAntiparallelTo(f)){var p=o,m=l;h.tangents(p,m),this.setFromAxisAngle(p,Math.PI)}else{var _=h.cross(f);this.x=_.x,this.y=_.y,this.z=_.z,this.w=Math.sqrt(Math.pow(h.norm(),2)*Math.pow(f.norm(),2))+h.dot(f),this.normalize()}};var c=new r,u=new r,d=new r;a.prototype.mult=function(h,f){f=f||new a;var p=this.w,m=c,_=u,v=d;return m.set(this.x,this.y,this.z),_.set(h.x,h.y,h.z),f.w=p*h.w-m.dot(_),m.cross(_,v),f.x=p*_.x+h.w*m.x+v.x,f.y=p*_.y+h.w*m.y+v.y,f.z=p*_.z+h.w*m.z+v.z,f},a.prototype.inverse=function(h){var f=this.x,p=this.y,m=this.z,_=this.w;h=h||new a,this.conjugate(h);var v=1/(f*f+p*p+m*m+_*_);return h.x*=v,h.y*=v,h.z*=v,h.w*=v,h},a.prototype.conjugate=function(h){return h=h||new a,h.x=-this.x,h.y=-this.y,h.z=-this.z,h.w=this.w,h},a.prototype.normalize=function(){var h=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);h===0?(this.x=0,this.y=0,this.z=0,this.w=0):(h=1/h,this.x*=h,this.y*=h,this.z*=h,this.w*=h)},a.prototype.normalizeFast=function(){var h=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;h===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=h,this.y*=h,this.z*=h,this.w*=h)},a.prototype.vmult=function(h,f){f=f||new r;var p=h.x,m=h.y,_=h.z,v=this.x,x=this.y,y=this.z,g=this.w,w=g*p+x*_-y*m,b=g*m+y*p-v*_,T=g*_+v*m-x*p,E=-v*p-x*m-y*_;return f.x=w*g+E*-v+b*-y-T*-x,f.y=b*g+E*-x+T*-v-w*-y,f.z=T*g+E*-y+w*-x-b*-v,f},a.prototype.copy=function(h){return this.x=h.x,this.y=h.y,this.z=h.z,this.w=h.w,this},a.prototype.toEuler=function(h,f){f=f||"YZX";var p,m,_,v=this.x,x=this.y,y=this.z,g=this.w;switch(f){case"YZX":var w=v*x+y*g;if(w>.499&&(p=2*Math.atan2(v,g),m=Math.PI/2,_=0),w<-.499&&(p=-2*Math.atan2(v,g),m=-Math.PI/2,_=0),isNaN(p)){var b=v*v,T=x*x,E=y*y;p=Math.atan2(2*x*g-2*v*y,1-2*T-2*E),m=Math.asin(2*w),_=Math.atan2(2*v*g-2*x*y,1-2*b-2*E)}break;default:throw new Error("Euler order "+f+" not supported yet.")}h.y=p,h.z=m,h.x=_},a.prototype.setFromEuler=function(h,f,p,m){m=m||"XYZ";var _=Math.cos(h/2),v=Math.cos(f/2),x=Math.cos(p/2),y=Math.sin(h/2),g=Math.sin(f/2),w=Math.sin(p/2);return m==="XYZ"?(this.x=y*v*x+_*g*w,this.y=_*g*x-y*v*w,this.z=_*v*w+y*g*x,this.w=_*v*x-y*g*w):m==="YXZ"?(this.x=y*v*x+_*g*w,this.y=_*g*x-y*v*w,this.z=_*v*w-y*g*x,this.w=_*v*x+y*g*w):m==="ZXY"?(this.x=y*v*x-_*g*w,this.y=_*g*x+y*v*w,this.z=_*v*w+y*g*x,this.w=_*v*x-y*g*w):m==="ZYX"?(this.x=y*v*x-_*g*w,this.y=_*g*x+y*v*w,this.z=_*v*w-y*g*x,this.w=_*v*x+y*g*w):m==="YZX"?(this.x=y*v*x+_*g*w,this.y=_*g*x+y*v*w,this.z=_*v*w-y*g*x,this.w=_*v*x-y*g*w):m==="XZY"&&(this.x=y*v*x-_*g*w,this.y=_*g*x-y*v*w,this.z=_*v*w+y*g*x,this.w=_*v*x+y*g*w),this},a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,n,s){var r=t("./Vec3"),a=t("./Quaternion");n.exports=o;function o(c){c=c||{},this.position=new r,c.position&&this.position.copy(c.position),this.quaternion=new a,c.quaternion&&this.quaternion.copy(c.quaternion)}var l=new a;o.pointToLocalFrame=function(c,u,d,f){var f=f||new r;return d.vsub(c,f),u.conjugate(l),l.vmult(f,f),f},o.prototype.pointToLocal=function(c,u){return o.pointToLocalFrame(this.position,this.quaternion,c,u)},o.pointToWorldFrame=function(c,u,d,f){var f=f||new r;return u.vmult(d,f),f.vadd(c,f),f},o.prototype.pointToWorld=function(c,u){return o.pointToWorldFrame(this.position,this.quaternion,c,u)},o.prototype.vectorToWorldFrame=function(c,d){var d=d||new r;return this.quaternion.vmult(c,d),d},o.vectorToWorldFrame=function(c,u,d){return c.vmult(u,d),d},o.vectorToLocalFrame=function(c,u,d,f){var f=f||new r;return u.w*=-1,u.vmult(d,f),u.w*=-1,f}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,n,s){n.exports=a;var r=t("./Mat3");function a(u,d,h){this.x=u||0,this.y=d||0,this.z=h||0}a.ZERO=new a(0,0,0),a.UNIT_X=new a(1,0,0),a.UNIT_Y=new a(0,1,0),a.UNIT_Z=new a(0,0,1),a.prototype.cross=function(u,d){var h=u.x,f=u.y,p=u.z,m=this.x,_=this.y,v=this.z;return d=d||new a,d.x=_*p-v*f,d.y=v*h-m*p,d.z=m*f-_*h,d},a.prototype.set=function(u,d,h){return this.x=u,this.y=d,this.z=h,this},a.prototype.setZero=function(){this.x=this.y=this.z=0},a.prototype.vadd=function(u,d){if(d)d.x=u.x+this.x,d.y=u.y+this.y,d.z=u.z+this.z;else return new a(this.x+u.x,this.y+u.y,this.z+u.z)},a.prototype.vsub=function(u,d){if(d)d.x=this.x-u.x,d.y=this.y-u.y,d.z=this.z-u.z;else return new a(this.x-u.x,this.y-u.y,this.z-u.z)},a.prototype.crossmat=function(){return new r([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},a.prototype.normalize=function(){var u=this.x,d=this.y,h=this.z,f=Math.sqrt(u*u+d*d+h*h);if(f>0){var p=1/f;this.x*=p,this.y*=p,this.z*=p}else this.x=0,this.y=0,this.z=0;return f},a.prototype.unit=function(u){u=u||new a;var d=this.x,h=this.y,f=this.z,p=Math.sqrt(d*d+h*h+f*f);return p>0?(p=1/p,u.x=d*p,u.y=h*p,u.z=f*p):(u.x=1,u.y=0,u.z=0),u},a.prototype.norm=function(){var u=this.x,d=this.y,h=this.z;return Math.sqrt(u*u+d*d+h*h)},a.prototype.length=a.prototype.norm,a.prototype.norm2=function(){return this.dot(this)},a.prototype.lengthSquared=a.prototype.norm2,a.prototype.distanceTo=function(u){var d=this.x,h=this.y,f=this.z,p=u.x,m=u.y,_=u.z;return Math.sqrt((p-d)*(p-d)+(m-h)*(m-h)+(_-f)*(_-f))},a.prototype.distanceSquared=function(u){var d=this.x,h=this.y,f=this.z,p=u.x,m=u.y,_=u.z;return(p-d)*(p-d)+(m-h)*(m-h)+(_-f)*(_-f)},a.prototype.mult=function(u,d){d=d||new a;var h=this.x,f=this.y,p=this.z;return d.x=u*h,d.y=u*f,d.z=u*p,d},a.prototype.scale=a.prototype.mult,a.prototype.dot=function(u){return this.x*u.x+this.y*u.y+this.z*u.z},a.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},a.prototype.negate=function(u){return u=u||new a,u.x=-this.x,u.y=-this.y,u.z=-this.z,u};var o=new a,l=new a;a.prototype.tangents=function(u,d){var h=this.norm();if(h>0){var f=o,p=1/h;f.set(this.x*p,this.y*p,this.z*p);var m=l;Math.abs(f.x)<.9?(m.set(1,0,0),f.cross(m,u)):(m.set(0,1,0),f.cross(m,u)),f.cross(u,d)}else u.set(1,0,0),d.set(0,1,0)},a.prototype.toString=function(){return this.x+","+this.y+","+this.z},a.prototype.toArray=function(){return[this.x,this.y,this.z]},a.prototype.copy=function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this},a.prototype.lerp=function(u,d,h){var f=this.x,p=this.y,m=this.z;h.x=f+(u.x-f)*d,h.y=p+(u.y-p)*d,h.z=m+(u.z-m)*d},a.prototype.almostEquals=function(u,d){return d===void 0&&(d=1e-6),!(Math.abs(this.x-u.x)>d||Math.abs(this.y-u.y)>d||Math.abs(this.z-u.z)>d)},a.prototype.almostZero=function(u){return u===void 0&&(u=1e-6),!(Math.abs(this.x)>u||Math.abs(this.y)>u||Math.abs(this.z)>u)};var c=new a;a.prototype.isAntiparallelTo=function(u,d){return this.negate(c),c.almostEquals(u,d)},a.prototype.clone=function(){return new a(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,n,s){n.exports=d;var r=t("../utils/EventTarget");t("../shapes/Shape");var a=t("../math/Vec3"),o=t("../math/Mat3"),l=t("../math/Quaternion");t("../material/Material");var c=t("../collision/AABB"),u=t("../shapes/Box");function d(A){A=A||{},r.apply(this),this.id=d.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new a,this.collisionFilterGroup=typeof A.collisionFilterGroup=="number"?A.collisionFilterGroup:1,this.collisionFilterMask=typeof A.collisionFilterMask=="number"?A.collisionFilterMask:1,this.collisionResponse=!0,this.position=new a,A.position&&this.position.copy(A.position),this.previousPosition=new a,this.initPosition=new a,this.velocity=new a,A.velocity&&this.velocity.copy(A.velocity),this.initVelocity=new a,this.force=new a;var C=typeof A.mass=="number"?A.mass:0;this.mass=C,this.invMass=C>0?1/C:0,this.material=A.material||null,this.linearDamping=typeof A.linearDamping=="number"?A.linearDamping:.01,this.type=C<=0?d.STATIC:d.DYNAMIC,typeof A.type==typeof d.STATIC&&(this.type=A.type),this.allowSleep=typeof A.allowSleep<"u"?A.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof A.sleepSpeedLimit<"u"?A.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof A.sleepTimeLimit<"u"?A.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new a,this.quaternion=new l,A.quaternion&&this.quaternion.copy(A.quaternion),this.initQuaternion=new l,this.angularVelocity=new a,A.angularVelocity&&this.angularVelocity.copy(A.angularVelocity),this.initAngularVelocity=new a,this.interpolatedPosition=new a,this.interpolatedQuaternion=new l,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new a,this.invInertia=new a,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new a,this.invInertiaWorldSolve=new o,this.fixedRotation=typeof A.fixedRotation<"u"?A.fixedRotation:!1,this.angularDamping=typeof A.angularDamping<"u"?A.angularDamping:.01,this.aabb=new c,this.aabbNeedsUpdate=!0,this.wlambda=new a,A.shape&&this.addShape(A.shape),this.updateMassProperties()}d.prototype=new r,d.prototype.constructor=d,d.DYNAMIC=1,d.STATIC=2,d.KINEMATIC=4,d.AWAKE=0,d.SLEEPY=1,d.SLEEPING=2,d.idCounter=0,d.prototype.wakeUp=function(){var A=this.sleepState;this.sleepState=0,A===d.SLEEPING&&this.dispatchEvent({type:"wakeup"})},d.prototype.sleep=function(){this.sleepState=d.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},d.sleepyEvent={type:"sleepy"},d.sleepEvent={type:"sleep"},d.prototype.sleepTick=function(A){if(this.allowSleep){var C=this.sleepState,I=this.velocity.norm2()+this.angularVelocity.norm2(),H=Math.pow(this.sleepSpeedLimit,2);C===d.AWAKE&&I<H?(this.sleepState=d.SLEEPY,this.timeLastSleepy=A,this.dispatchEvent(d.sleepyEvent)):C===d.SLEEPY&&I>H?this.wakeUp():C===d.SLEEPY&&A-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(d.sleepEvent))}},d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},d.prototype.pointToLocalFrame=function(A,I){var I=I||new a;return A.vsub(this.position,I),this.quaternion.conjugate().vmult(I,I),I},d.prototype.vectorToLocalFrame=function(A,I){var I=I||new a;return this.quaternion.conjugate().vmult(A,I),I},d.prototype.pointToWorldFrame=function(A,I){var I=I||new a;return this.quaternion.vmult(A,I),I.vadd(this.position,I),I},d.prototype.vectorToWorldFrame=function(A,I){var I=I||new a;return this.quaternion.vmult(A,I),I};var h=new a,f=new l;d.prototype.addShape=function(A,C,I){var H=new a,W=new l;return C&&H.copy(C),I&&W.copy(I),this.shapes.push(A),this.shapeOffsets.push(H),this.shapeOrientations.push(W),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},d.prototype.updateBoundingRadius=function(){for(var A=this.shapes,C=this.shapeOffsets,I=A.length,H=0,W=0;W!==I;W++){var z=A[W];z.updateBoundingSphereRadius();var q=C[W].norm(),O=z.boundingSphereRadius;q+O>H&&(H=q+O)}this.boundingRadius=H};var p=new c;d.prototype.computeAABB=function(){for(var A=this.shapes,C=this.shapeOffsets,I=this.shapeOrientations,H=A.length,W=h,z=f,q=this.quaternion,O=this.aabb,re=p,le=0;le!==H;le++){var Z=A[le];I[le].mult(q,z),z.vmult(C[le],W),W.vadd(this.position,W),Z.calculateWorldAABB(W,z,re.lowerBound,re.upperBound),le===0?O.copy(re):O.extend(re)}this.aabbNeedsUpdate=!1};var m=new o,_=new o;new o,d.prototype.updateInertiaWorld=function(A){var C=this.invInertia;if(!(C.x===C.y&&C.y===C.z&&!A)){var I=m,H=_;I.setRotationFromQuaternion(this.quaternion),I.transpose(H),I.scale(C,I),I.mmult(H,this.invInertiaWorld)}};var v=new a,x=new a;d.prototype.applyForce=function(A,C){if(this.type===d.DYNAMIC){var I=v;C.vsub(this.position,I);var H=x;I.cross(A,H),this.force.vadd(A,this.force),this.torque.vadd(H,this.torque)}};var y=new a,g=new a;d.prototype.applyLocalForce=function(A,C){if(this.type===d.DYNAMIC){var I=y,H=g;this.vectorToWorldFrame(A,I),this.pointToWorldFrame(C,H),this.applyForce(I,H)}};var w=new a,b=new a,T=new a;d.prototype.applyImpulse=function(A,C){if(this.type===d.DYNAMIC){var I=w;C.vsub(this.position,I);var H=b;H.copy(A),H.mult(this.invMass,H),this.velocity.vadd(H,this.velocity);var W=T;I.cross(A,W),this.invInertiaWorld.vmult(W,W),this.angularVelocity.vadd(W,this.angularVelocity)}};var E=new a,S=new a;d.prototype.applyLocalImpulse=function(A,C){if(this.type===d.DYNAMIC){var I=E,H=S;this.vectorToWorldFrame(A,I),this.pointToWorldFrame(C,H),this.applyImpulse(I,H)}};var M=new a;d.prototype.updateMassProperties=function(){var A=M;this.invMass=this.mass>0?1/this.mass:0;var C=this.inertia,I=this.fixedRotation;this.computeAABB(),A.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),u.calculateInertia(A,this.mass,C),this.invInertia.set(C.x>0&&!I?1/C.x:0,C.y>0&&!I?1/C.y:0,C.z>0&&!I?1/C.z:0),this.updateInertiaWorld(!0)},d.prototype.getVelocityAtWorldPoint=function(A,C){var I=new a;return A.vsub(this.position,I),this.angularVelocity.cross(I,C),this.velocity.vadd(C,C),C}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,n,s){t("./Body");var r=t("../math/Vec3"),a=t("../math/Quaternion");t("../collision/RaycastResult");var o=t("../collision/Ray"),l=t("../objects/WheelInfo");n.exports=c;function c(q){this.chassisBody=q.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof q.indexRightAxis<"u"?q.indexRightAxis:1,this.indexForwardAxis=typeof q.indexForwardAxis<"u"?q.indexForwardAxis:0,this.indexUpAxis=typeof q.indexUpAxis<"u"?q.indexUpAxis:2}new r,new r,new r;var u=new r,d=new r,h=new r;new o,c.prototype.addWheel=function(q){q=q||{};var O=new l(q),re=this.wheelInfos.length;return this.wheelInfos.push(O),re},c.prototype.setSteeringValue=function(q,O){var re=this.wheelInfos[O];re.steering=q},new r,c.prototype.applyEngineForce=function(q,O){this.wheelInfos[O].engineForce=q},c.prototype.setBrake=function(q,O){this.wheelInfos[O].brake=q},c.prototype.addToWorld=function(q){this.constraints,q.add(this.chassisBody);var O=this;this.preStepCallback=function(){O.updateVehicle(q.dt)},q.addEventListener("preStep",this.preStepCallback),this.world=q},c.prototype.getVehicleAxisWorld=function(q,O){O.set(q===0?1:0,q===1?1:0,q===2?1:0),this.chassisBody.vectorToWorldFrame(O,O)},c.prototype.updateVehicle=function(q){for(var O=this.wheelInfos,re=O.length,le=this.chassisBody,Z=0;Z<re;Z++)this.updateWheelTransform(Z);this.currentVehicleSpeedKmHour=3.6*le.velocity.norm();var ne=new r;this.getVehicleAxisWorld(this.indexForwardAxis,ne),ne.dot(le.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var Z=0;Z<re;Z++)this.castRay(O[Z]);this.updateSuspension(q);for(var j=new r,ee=new r,Z=0;Z<re;Z++){var F=O[Z],X=F.suspensionForce;X>F.maxSuspensionForce&&(X=F.maxSuspensionForce),F.raycastResult.hitNormalWorld.scale(X*q,j),F.raycastResult.hitPointWorld.vsub(le.position,ee),le.applyImpulse(j,F.raycastResult.hitPointWorld)}this.updateFriction(q);var Q=new r,ue=new r,ce=new r;for(Z=0;Z<re;Z++){var F=O[Z];le.getVelocityAtWorldPoint(F.chassisConnectionPointWorld,ce);var xe=1;switch(this.indexUpAxis){case 1:xe=-1;break}if(F.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,ue);var Me=ue.dot(F.raycastResult.hitNormalWorld);F.raycastResult.hitNormalWorld.scale(Me,Q),ue.vsub(Q,ue);var Y=ue.dot(ce);F.deltaRotation=xe*Y*q/F.radius}(F.sliding||!F.isInContact)&&F.engineForce!==0&&F.useCustomSlidingRotationalSpeed&&(F.deltaRotation=(F.engineForce>0?1:-1)*F.customSlidingRotationalSpeed*q),Math.abs(F.brake)>Math.abs(F.engineForce)&&(F.deltaRotation=0),F.rotation+=F.deltaRotation,F.deltaRotation*=.99}},c.prototype.updateSuspension=function(q){for(var O=this.chassisBody,re=O.mass,le=this.wheelInfos,Z=le.length,ne=0;ne<Z;ne++){var j=le[ne];if(j.isInContact){var ee,F=j.suspensionRestLength,X=j.suspensionLength,Q=F-X;ee=j.suspensionStiffness*Q*j.clippedInvContactDotSuspension;var ue=j.suspensionRelativeVelocity,ce;ue<0?ce=j.dampingCompression:ce=j.dampingRelaxation,ee-=ce*ue,j.suspensionForce=ee*re,j.suspensionForce<0&&(j.suspensionForce=0)}else j.suspensionForce=0}},c.prototype.removeFromWorld=function(q){this.constraints,q.remove(this.chassisBody),q.removeEventListener("preStep",this.preStepCallback),this.world=null};var f=new r,p=new r;c.prototype.castRay=function(q){var O=f,re=p;this.updateWheelTransformWorld(q);var le=this.chassisBody,Z=-1,ne=q.suspensionRestLength+q.radius;q.directionWorld.scale(ne,O);var j=q.chassisConnectionPointWorld;j.vadd(O,re);var ee=q.raycastResult;ee.reset();var F=le.collisionResponse;le.collisionResponse=!1,this.world.rayTest(j,re,ee),le.collisionResponse=F;var X=ee.body;if(q.raycastResult.groundObject=0,X){Z=ee.distance,q.raycastResult.hitNormalWorld=ee.hitNormalWorld,q.isInContact=!0;var Q=ee.distance;q.suspensionLength=Q-q.radius;var ue=q.suspensionRestLength-q.maxSuspensionTravel,ce=q.suspensionRestLength+q.maxSuspensionTravel;q.suspensionLength<ue&&(q.suspensionLength=ue),q.suspensionLength>ce&&(q.suspensionLength=ce,q.raycastResult.reset());var xe=q.raycastResult.hitNormalWorld.dot(q.directionWorld),Me=new r;le.getVelocityAtWorldPoint(q.raycastResult.hitPointWorld,Me);var Y=q.raycastResult.hitNormalWorld.dot(Me);if(xe>=-.1)q.suspensionRelativeVelocity=0,q.clippedInvContactDotSuspension=1/.1;else{var P=-1/xe;q.suspensionRelativeVelocity=Y*P,q.clippedInvContactDotSuspension=P}}else q.suspensionLength=q.suspensionRestLength+0*q.maxSuspensionTravel,q.suspensionRelativeVelocity=0,q.directionWorld.scale(-1,q.raycastResult.hitNormalWorld),q.clippedInvContactDotSuspension=1;return Z},c.prototype.updateWheelTransformWorld=function(q){q.isInContact=!1;var O=this.chassisBody;O.pointToWorldFrame(q.chassisConnectionPointLocal,q.chassisConnectionPointWorld),O.vectorToWorldFrame(q.directionLocal,q.directionWorld),O.vectorToWorldFrame(q.axleLocal,q.axleWorld)},c.prototype.updateWheelTransform=function(q){var O=u,re=d,le=h,Z=this.wheelInfos[q];this.updateWheelTransformWorld(Z),Z.directionLocal.scale(-1,O),re.copy(Z.axleLocal),O.cross(re,le),le.normalize(),re.normalize();var ne=Z.steering,j=new a;j.setFromAxisAngle(O,ne);var ee=new a;ee.setFromAxisAngle(re,Z.rotation);var F=Z.worldTransform.quaternion;this.chassisBody.quaternion.mult(j,F),F.mult(ee,F),F.normalize();var X=Z.worldTransform.position;X.copy(Z.directionWorld),X.scale(Z.suspensionLength,X),X.vadd(Z.chassisConnectionPointWorld,X)};var m=[new r(1,0,0),new r(0,1,0),new r(0,0,1)];c.prototype.getWheelTransformWorld=function(q){return this.wheelInfos[q].worldTransform};var _=new r,v=[],x=[],y=1;c.prototype.updateFriction=function(q){for(var O=_,re=this.wheelInfos,le=re.length,Z=this.chassisBody,ne=x,j=v,ee=0;ee<le;ee++){var F=re[ee],X=F.raycastResult.body;F.sideImpulse=0,F.forwardImpulse=0,ne[ee]||(ne[ee]=new r),j[ee]||(j[ee]=new r)}for(var ee=0;ee<le;ee++){var F=re[ee],X=F.raycastResult.body;if(X){var Q=j[ee],ue=this.getWheelTransformWorld(ee);ue.vectorToWorldFrame(m[this.indexRightAxis],Q);var ce=F.raycastResult.hitNormalWorld,xe=Q.dot(ce);ce.scale(xe,O),Q.vsub(O,Q),Q.normalize(),ce.cross(Q,ne[ee]),ne[ee].normalize(),F.sideImpulse=z(Z,F.raycastResult.hitPointWorld,X,F.raycastResult.hitPointWorld,Q),F.sideImpulse*=y}}var Me=1,Y=.5;this.sliding=!1;for(var ee=0;ee<le;ee++){var F=re[ee],X=F.raycastResult.body,P=0;if(F.slipInfo=1,X){var R=0,N=F.brake?F.brake:R;P=T(Z,X,F.raycastResult.hitPointWorld,ne[ee],N),P+=F.engineForce*q;var $=N/P;F.slipInfo*=$}if(F.forwardImpulse=0,F.skidInfo=1,X){F.skidInfo=1;var ie=F.suspensionForce*q*F.frictionSlip,ye=ie,ve=ie*ye;F.forwardImpulse=P;var k=F.forwardImpulse*Y,V=F.sideImpulse*Me,de=k*k+V*V;if(F.sliding=!1,de>ve){this.sliding=!0,F.sliding=!0;var $=ie/Math.sqrt(de);F.skidInfo*=$}}}if(this.sliding)for(var ee=0;ee<le;ee++){var F=re[ee];F.sideImpulse!==0&&F.skidInfo<1&&(F.forwardImpulse*=F.skidInfo,F.sideImpulse*=F.skidInfo)}for(var ee=0;ee<le;ee++){var F=re[ee],D=new r;if(D.copy(F.raycastResult.hitPointWorld),F.forwardImpulse!==0){var L=new r;ne[ee].scale(F.forwardImpulse,L),Z.applyImpulse(L,D)}if(F.sideImpulse!==0){var X=F.raycastResult.body,J=new r;J.copy(F.raycastResult.hitPointWorld);var K=new r;j[ee].scale(F.sideImpulse,K),Z.pointToLocalFrame(D,D),D["xyz"[this.indexUpAxis]]*=F.rollInfluence,Z.pointToWorldFrame(D,D),Z.applyImpulse(K,D),K.scale(-1,K),X.applyImpulse(K,J)}}};var g=new r,w=new r,b=new r;function T(q,O,re,le,Z){var ne=0,j=re,ee=g,F=w,X=b;q.getVelocityAtWorldPoint(j,ee),O.getVelocityAtWorldPoint(j,F),ee.vsub(F,X);var Q=le.dot(X),ue=C(q,re,le),ce=C(O,re,le),xe=1,Me=xe/(ue+ce);return ne=-Q*Me,Z<ne&&(ne=Z),ne<-Z&&(ne=-Z),ne}var E=new r,S=new r,M=new r,A=new r;function C(q,O,re){var le=E,Z=S,ne=M,j=A;return O.vsub(q.position,le),le.cross(re,Z),q.invInertiaWorld.vmult(Z,j),j.cross(le,ne),q.invMass+re.dot(ne)}var I=new r,H=new r,W=new r;function z(q,O,re,le,Z,ce){var j=Z.norm2();if(j>1.1)return 0;var ee=I,F=H,X=W;q.getVelocityAtWorldPoint(O,ee),re.getVelocityAtWorldPoint(le,F),ee.vsub(F,X);var Q=Z.dot(X),ue=1/(q.invMass+re.invMass),ce=-.2*Q*ue;return ce}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,n,s){var r=t("./Body"),a=t("../shapes/Sphere"),o=t("../shapes/Box"),l=t("../math/Vec3"),c=t("../constraints/HingeConstraint");n.exports=u;function u(f){if(this.wheelBodies=[],this.coordinateSystem=typeof f.coordinateSystem>"u"?new l(1,2,3):f.coordinateSystem.clone(),this.chassisBody=f.chassisBody,!this.chassisBody){var p=new o(new l(5,2,.5));this.chassisBody=new r(1,p)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}u.prototype.addWheel=function(f){f=f||{};var p=f.body;p||(p=new r(1,new a(1.2))),this.wheelBodies.push(p),this.wheelForces.push(0),new l;var m=typeof f.position<"u"?f.position.clone():new l,_=new l;this.chassisBody.pointToWorldFrame(m,_),p.position.set(_.x,_.y,_.z);var v=typeof f.axis<"u"?f.axis.clone():new l(0,1,0);this.wheelAxes.push(v);var x=new c(this.chassisBody,p,{pivotA:m,axisA:v,pivotB:l.ZERO,axisB:v,collideConnected:!1});return this.constraints.push(x),this.wheelBodies.length-1},u.prototype.setSteeringValue=function(f,p){var m=this.wheelAxes[p],_=Math.cos(f),v=Math.sin(f),x=m.x,y=m.y;this.constraints[p].axisA.set(_*x-v*y,v*x+_*y,0)},u.prototype.setMotorSpeed=function(f,p){var m=this.constraints[p];m.enableMotor(),m.motorTargetVelocity=f},u.prototype.disableMotor=function(f){var p=this.constraints[f];p.disableMotor()};var d=new l;u.prototype.setWheelForce=function(f,p){this.wheelForces[p]=f},u.prototype.applyWheelForce=function(f,p){var m=this.wheelAxes[p],_=this.wheelBodies[p],v=_.torque;m.scale(f,d),_.vectorToWorldFrame(d,d),v.vadd(d,v)},u.prototype.addToWorld=function(f){for(var p=this.constraints,m=this.wheelBodies.concat([this.chassisBody]),_=0;_<m.length;_++)f.add(m[_]);for(var _=0;_<p.length;_++)f.addConstraint(p[_]);f.addEventListener("preStep",this._update.bind(this))},u.prototype._update=function(){for(var f=this.wheelForces,p=0;p<f.length;p++)this.applyWheelForce(f[p],p)},u.prototype.removeFromWorld=function(f){for(var p=this.constraints,m=this.wheelBodies.concat([this.chassisBody]),_=0;_<m.length;_++)f.remove(m[_]);for(var _=0;_<p.length;_++)f.removeConstraint(p[_])};var h=new l;u.prototype.getWheelSpeed=function(f){var p=this.wheelAxes[f],m=this.wheelBodies[f],_=m.angularVelocity;return this.chassisBody.vectorToWorldFrame(p,h),_.dot(h)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,n,s){n.exports=a,t("../shapes/Shape");var r=t("../math/Vec3");t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function a(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}a.prototype.add=function(p){this.particles.push(p),this.neighbors.length<this.particles.length&&this.neighbors.push([])},a.prototype.remove=function(p){var m=this.particles.indexOf(p);m!==-1&&(this.particles.splice(m,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var o=new r;a.prototype.getNeighbors=function(p,m){for(var _=this.particles.length,v=p.id,x=this.smoothingRadius*this.smoothingRadius,y=o,g=0;g!==_;g++){var w=this.particles[g];w.position.vsub(p.position,y),v!==w.id&&y.norm2()<x&&m.push(w)}};var l=new r,c=new r,u=new r,d=new r,h=new r,f=new r;a.prototype.update=function(){for(var p=this.particles.length,m=l,_=this.speedOfSound,v=this.eps,x=0;x!==p;x++){var y=this.particles[x],g=this.neighbors[x];g.length=0,this.getNeighbors(y,g),g.push(this.particles[x]);for(var w=g.length,b=0,T=0;T!==w;T++){y.position.vsub(g[T].position,m);var E=m.norm(),S=this.w(E);b+=g[T].mass*S}this.densities[x]=b,this.pressures[x]=_*_*(this.densities[x]-this.density)}for(var M=c,A=u,C=d,I=h,H=f,x=0;x!==p;x++){var W=this.particles[x];M.set(0,0,0),A.set(0,0,0);for(var z,q,g=this.neighbors[x],w=g.length,T=0;T!==w;T++){var O=g[T];W.position.vsub(O.position,I);var re=I.norm();z=-O.mass*(this.pressures[x]/(this.densities[x]*this.densities[x]+v)+this.pressures[T]/(this.densities[T]*this.densities[T]+v)),this.gradw(I,C),C.mult(z,C),M.vadd(C,M),O.velocity.vsub(W.velocity,H),H.mult(1/(1e-4+this.densities[x]*this.densities[T])*this.viscosity*O.mass,H),q=this.nablaw(re),H.mult(q,H),A.vadd(H,A)}A.mult(W.mass,A),M.mult(W.mass,M),W.force.vadd(A,W.force),W.force.vadd(M,W.force)}},a.prototype.w=function(p){var m=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(m,9))*Math.pow(m*m-p*p,3)},a.prototype.gradw=function(p,m){var _=p.norm(),v=this.smoothingRadius;p.mult(945/(32*Math.PI*Math.pow(v,9))*Math.pow(v*v-_*_,2),m)},a.prototype.nablaw=function(p){var m=this.smoothingRadius,_=945/(32*Math.PI*Math.pow(m,9))*(m*m-p*p)*(7*p*p-3*m*m);return _}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,n,s){var r=t("../math/Vec3");n.exports=a;function a(x,y,g){g=g||{},this.restLength=typeof g.restLength=="number"?g.restLength:1,this.stiffness=g.stiffness||100,this.damping=g.damping||1,this.bodyA=x,this.bodyB=y,this.localAnchorA=new r,this.localAnchorB=new r,g.localAnchorA&&this.localAnchorA.copy(g.localAnchorA),g.localAnchorB&&this.localAnchorB.copy(g.localAnchorB),g.worldAnchorA&&this.setWorldAnchorA(g.worldAnchorA),g.worldAnchorB&&this.setWorldAnchorB(g.worldAnchorB)}a.prototype.setWorldAnchorA=function(x){this.bodyA.pointToLocalFrame(x,this.localAnchorA)},a.prototype.setWorldAnchorB=function(x){this.bodyB.pointToLocalFrame(x,this.localAnchorB)},a.prototype.getWorldAnchorA=function(x){this.bodyA.pointToWorldFrame(this.localAnchorA,x)},a.prototype.getWorldAnchorB=function(x){this.bodyB.pointToWorldFrame(this.localAnchorB,x)};var o=new r,l=new r,c=new r,u=new r,d=new r,h=new r,f=new r,p=new r,m=new r,_=new r,v=new r;a.prototype.applyForce=function(){var x=this.stiffness,y=this.damping,g=this.restLength,w=this.bodyA,b=this.bodyB,T=o,E=l,S=c,M=u,A=v,C=d,I=h,H=f,W=p,z=m,q=_;this.getWorldAnchorA(C),this.getWorldAnchorB(I),C.vsub(w.position,H),I.vsub(b.position,W),I.vsub(C,T);var O=T.norm();E.copy(T),E.normalize(),b.velocity.vsub(w.velocity,S),b.angularVelocity.cross(W,A),S.vadd(A,S),w.angularVelocity.cross(H,A),S.vsub(A,S),E.mult(-x*(O-g)-y*S.dot(E),M),w.force.vsub(M,w.force),b.force.vadd(M,b.force),H.cross(M,z),W.cross(M,q),w.torque.vsub(z,w.torque),b.torque.vadd(q,b.torque)}},{"../math/Vec3":30}],36:[function(t,n,s){var r=t("../math/Vec3"),a=t("../math/Transform"),o=t("../collision/RaycastResult"),l=t("../utils/Utils");n.exports=c;function c(h){h=l.defaults(h,{chassisConnectionPointLocal:new r,chassisConnectionPointWorld:new r,directionLocal:new r,directionWorld:new r,axleLocal:new r,axleWorld:new r,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=h.maxSuspensionTravel,this.customSlidingRotationalSpeed=h.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=h.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=h.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=h.chassisConnectionPointWorld.clone(),this.directionLocal=h.directionLocal.clone(),this.directionWorld=h.directionWorld.clone(),this.axleLocal=h.axleLocal.clone(),this.axleWorld=h.axleWorld.clone(),this.suspensionRestLength=h.suspensionRestLength,this.suspensionMaxLength=h.suspensionMaxLength,this.radius=h.radius,this.suspensionStiffness=h.suspensionStiffness,this.dampingCompression=h.dampingCompression,this.dampingRelaxation=h.dampingRelaxation,this.frictionSlip=h.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=h.rollInfluence,this.maxSuspensionForce=h.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=h.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new a,this.isInContact=!1}var d=new r,u=new r,d=new r;c.prototype.updateWheel=function(h){var f=this.raycastResult;if(this.isInContact){var p=f.hitNormalWorld.dot(f.directionWorld);f.hitPointWorld.vsub(h.position,u),h.getVelocityAtWorldPoint(u,d);var m=f.hitNormalWorld.dot(d);if(p>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var _=-1/p;this.suspensionRelativeVelocity=m*_,this.clippedInvContactDotSuspension=_}}else f.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,f.directionWorld.scale(-1,f.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,n,s){n.exports=l;var r=t("./Shape"),a=t("../math/Vec3"),o=t("./ConvexPolyhedron");function l(d){r.call(this),this.type=r.types.BOX,this.halfExtents=d,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}l.prototype=new r,l.prototype.constructor=l,l.prototype.updateConvexPolyhedronRepresentation=function(){var d=this.halfExtents.x,h=this.halfExtents.y,f=this.halfExtents.z,p=a,m=[new p(-d,-h,-f),new p(d,-h,-f),new p(d,h,-f),new p(-d,h,-f),new p(-d,-h,f),new p(d,-h,f),new p(d,h,f),new p(-d,h,f)],_=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new p(0,0,1),new p(0,1,0),new p(1,0,0);var v=new o(m,_);this.convexPolyhedronRepresentation=v,v.material=this.material},l.prototype.calculateLocalInertia=function(d,h){return h=h||new a,l.calculateInertia(this.halfExtents,d,h),h},l.calculateInertia=function(d,h,f){var p=d;f.x=1/12*h*(2*p.y*2*p.y+2*p.z*2*p.z),f.y=1/12*h*(2*p.x*2*p.x+2*p.z*2*p.z),f.z=1/12*h*(2*p.y*2*p.y+2*p.x*2*p.x)},l.prototype.getSideNormals=function(d,h){var f=d,p=this.halfExtents;if(f[0].set(p.x,0,0),f[1].set(0,p.y,0),f[2].set(0,0,p.z),f[3].set(-p.x,0,0),f[4].set(0,-p.y,0),f[5].set(0,0,-p.z),h!==void 0)for(var m=0;m!==f.length;m++)h.vmult(f[m],f[m]);return f},l.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},l.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var c=new a;new a,l.prototype.forEachWorldCorner=function(d,h,f){for(var p=this.halfExtents,m=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]],_=0;_<m.length;_++)c.set(m[_][0],m[_][1],m[_][2]),h.vmult(c,c),d.vadd(c,c),f(c.x,c.y,c.z)};var u=[new a,new a,new a,new a,new a,new a,new a,new a];l.prototype.calculateWorldAABB=function(d,h,f,p){var m=this.halfExtents;u[0].set(m.x,m.y,m.z),u[1].set(-m.x,m.y,m.z),u[2].set(-m.x,-m.y,m.z),u[3].set(-m.x,-m.y,-m.z),u[4].set(m.x,-m.y,-m.z),u[5].set(m.x,m.y,-m.z),u[6].set(-m.x,m.y,-m.z),u[7].set(m.x,-m.y,m.z);var _=u[0];h.vmult(_,_),d.vadd(_,_),p.copy(_),f.copy(_);for(var v=1;v<8;v++){var _=u[v];h.vmult(_,_),d.vadd(_,_);var x=_.x,y=_.y,g=_.z;x>p.x&&(p.x=x),y>p.y&&(p.y=y),g>p.z&&(p.z=g),x<f.x&&(f.x=x),y<f.y&&(f.y=y),g<f.z&&(f.z=g)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,n,s){n.exports=l;var r=t("./Shape"),a=t("../math/Vec3");t("../math/Quaternion");var o=t("../math/Transform");function l(Z,ne,j){r.call(this),this.type=r.types.CONVEXPOLYHEDRON,this.vertices=Z||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=ne||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=j?j.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}l.prototype=new r,l.prototype.constructor=l;var c=new a;l.prototype.computeEdges=function(){var Z=this.faces,ne=this.vertices;ne.length;var j=this.uniqueEdges;j.length=0;for(var ee=c,F=0;F!==Z.length;F++)for(var X=Z[F],Q=X.length,ue=0;ue!==Q;ue++){var ce=(ue+1)%Q;ne[X[ue]].vsub(ne[X[ce]],ee),ee.normalize();for(var xe=!1,Me=0;Me!==j.length;Me++)if(j[Me].almostEquals(ee)||j[Me].almostEquals(ee)){xe=!0;break}xe||j.push(ee.clone())}},l.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var Z=0;Z<this.faces.length;Z++){for(var ne=0;ne<this.faces[Z].length;ne++)if(!this.vertices[this.faces[Z][ne]])throw new Error("Vertex "+this.faces[Z][ne]+" not found!");var j=this.faceNormals[Z]||new a;this.getFaceNormal(Z,j),j.negate(j),this.faceNormals[Z]=j;var ee=this.vertices[this.faces[Z][0]];if(j.dot(ee)<0){console.error(".faceNormals["+Z+"] = Vec3("+j.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var ne=0;ne<this.faces[Z].length;ne++)console.warn(".vertices["+this.faces[Z][ne]+"] = Vec3("+this.vertices[this.faces[Z][ne]].toString()+")")}}};var u=new a,d=new a;l.computeNormal=function(Z,ne,j,ee){ne.vsub(Z,d),j.vsub(ne,u),u.cross(d,ee),ee.isZero()||ee.normalize()},l.prototype.getFaceNormal=function(Z,ne){var j=this.faces[Z],ee=this.vertices[j[0]],F=this.vertices[j[1]],X=this.vertices[j[2]];return l.computeNormal(ee,F,X,ne)};var h=new a;l.prototype.clipAgainstHull=function(Z,ne,j,ee,F,X,Q,ue,ce){for(var xe=h,Me=-1,Y=-Number.MAX_VALUE,P=0;P<j.faces.length;P++){xe.copy(j.faceNormals[P]),F.vmult(xe,xe);var R=xe.dot(X);R>Y&&(Y=R,Me=P)}for(var N=[],$=j.faces[Me],ie=$.length,ye=0;ye<ie;ye++){var ve=j.vertices[$[ye]],k=new a;k.copy(ve),F.vmult(k,k),ee.vadd(k,k),N.push(k)}Me>=0&&this.clipFaceAgainstHull(X,Z,ne,N,Q,ue,ce)};var f=new a,p=new a,m=new a,_=new a,v=new a,x=new a;l.prototype.findSeparatingAxis=function(Z,ne,j,ee,F,X,Q,ue){var ce=f,xe=p,Me=m,Y=_,P=v,R=x,N=Number.MAX_VALUE,$=this;if($.uniqueAxes)for(var ye=0;ye!==$.uniqueAxes.length;ye++){j.vmult($.uniqueAxes[ye],ce);var k=$.testSepAxis(ce,Z,ne,j,ee,F);if(k===!1)return!1;k<N&&(N=k,X.copy(ce))}else for(var ie=Q?Q.length:$.faces.length,ye=0;ye<ie;ye++){var ve=Q?Q[ye]:ye;ce.copy($.faceNormals[ve]),j.vmult(ce,ce);var k=$.testSepAxis(ce,Z,ne,j,ee,F);if(k===!1)return!1;k<N&&(N=k,X.copy(ce))}if(Z.uniqueAxes)for(var ye=0;ye!==Z.uniqueAxes.length;ye++){F.vmult(Z.uniqueAxes[ye],xe);var k=$.testSepAxis(xe,Z,ne,j,ee,F);if(k===!1)return!1;k<N&&(N=k,X.copy(xe))}else for(var V=ue?ue.length:Z.faces.length,ye=0;ye<V;ye++){var ve=ue?ue[ye]:ye;xe.copy(Z.faceNormals[ve]),F.vmult(xe,xe);var k=$.testSepAxis(xe,Z,ne,j,ee,F);if(k===!1)return!1;k<N&&(N=k,X.copy(xe))}for(var de=0;de!==$.uniqueEdges.length;de++){j.vmult($.uniqueEdges[de],Y);for(var D=0;D!==Z.uniqueEdges.length;D++)if(F.vmult(Z.uniqueEdges[D],P),Y.cross(P,R),!R.almostZero()){R.normalize();var L=$.testSepAxis(R,Z,ne,j,ee,F);if(L===!1)return!1;L<N&&(N=L,X.copy(R))}}return ee.vsub(ne,Me),Me.dot(X)>0&&X.negate(X),!0};var y=[],g=[];l.prototype.testSepAxis=function(Z,ne,j,ee,F,X){var Q=this;l.project(Q,Z,j,ee,y),l.project(ne,Z,F,X,g);var ue=y[0],ce=y[1],xe=g[0],Me=g[1];if(ue<Me||xe<ce)return!1;var Y=ue-Me,P=xe-ce,R=Y<P?Y:P;return R};var w=new a,b=new a;l.prototype.calculateLocalInertia=function(Z,ne){this.computeLocalAABB(w,b);var j=b.x-w.x,ee=b.y-w.y,F=b.z-w.z;ne.x=1/12*Z*(2*ee*2*ee+2*F*2*F),ne.y=1/12*Z*(2*j*2*j+2*F*2*F),ne.z=1/12*Z*(2*ee*2*ee+2*j*2*j)},l.prototype.getPlaneConstantOfFace=function(Z){var ne=this.faces[Z],j=this.faceNormals[Z],ee=this.vertices[ne[0]],F=-j.dot(ee);return F};var T=new a,E=new a,S=new a,M=new a,A=new a,C=new a,I=new a,H=new a;l.prototype.clipFaceAgainstHull=function(Z,ne,j,ee,F,X,Q){for(var ue=T,ce=E,xe=S,Me=M,Y=A,P=C,R=I,N=H,$=this,ie=[],ye=ee,ve=ie,k=-1,V=Number.MAX_VALUE,de=0;de<$.faces.length;de++){ue.copy($.faceNormals[de]),j.vmult(ue,ue);var D=ue.dot(Z);D<V&&(V=D,k=de)}if(!(k<0)){var L=$.faces[k];L.connectedFaces=[];for(var J=0;J<$.faces.length;J++)for(var K=0;K<$.faces[J].length;K++)L.indexOf($.faces[J][K])!==-1&&J!==k&&L.connectedFaces.indexOf(J)===-1&&L.connectedFaces.push(J);ye.length;for(var te=L.length,me=0;me<te;me++){var Ie=$.vertices[L[me]],Pe=$.vertices[L[(me+1)%te]];Ie.vsub(Pe,ce),xe.copy(ce),j.vmult(xe,xe),ne.vadd(xe,xe),Me.copy(this.faceNormals[k]),j.vmult(Me,Me),ne.vadd(Me,Me),xe.cross(Me,Y),Y.negate(Y),P.copy(Ie),j.vmult(P,P),ne.vadd(P,P),-P.dot(Y);var De;{var Ke=L.connectedFaces[me];R.copy(this.faceNormals[Ke]);var Ye=this.getPlaneConstantOfFace(Ke);N.copy(R),j.vmult(N,N);var De=Ye-N.dot(ne)}for(this.clipFaceAgainstPlane(ye,ve,N,De);ye.length;)ye.shift();for(;ve.length;)ye.push(ve.shift())}R.copy(this.faceNormals[k]);var Ye=this.getPlaneConstantOfFace(k);N.copy(R),j.vmult(N,N);for(var De=Ye-N.dot(ne),J=0;J<ye.length;J++){var Xe=N.dot(ye[J])+De;if(Xe<=F&&(console.log("clamped: depth="+Xe+" to minDist="+(F+"")),Xe=F),Xe<=X){var dt=ye[J];if(Xe<=0){var at={point:dt,normal:N,depth:Xe};Q.push(at)}}}}},l.prototype.clipFaceAgainstPlane=function(Z,ne,j,ee){var F,X,Q=Z.length;if(Q<2)return ne;var ue=Z[Z.length-1],ce=Z[0];F=j.dot(ue)+ee;for(var xe=0;xe<Q;xe++){if(ce=Z[xe],X=j.dot(ce)+ee,F<0)if(X<0){var Me=new a;Me.copy(ce),ne.push(Me)}else{var Me=new a;ue.lerp(ce,F/(F-X),Me),ne.push(Me)}else if(X<0){var Me=new a;ue.lerp(ce,F/(F-X),Me),ne.push(Me),ne.push(ce)}ue=ce,F=X}return ne},l.prototype.computeWorldVertices=function(Z,ne){for(var j=this.vertices.length;this.worldVertices.length<j;)this.worldVertices.push(new a);for(var ee=this.vertices,F=this.worldVertices,X=0;X!==j;X++)ne.vmult(ee[X],F[X]),Z.vadd(F[X],F[X]);this.worldVerticesNeedsUpdate=!1},new a,l.prototype.computeLocalAABB=function(Z,ne){var j=this.vertices.length,ee=this.vertices;Z.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ne.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var F=0;F<j;F++){var X=ee[F];X.x<Z.x?Z.x=X.x:X.x>ne.x&&(ne.x=X.x),X.y<Z.y?Z.y=X.y:X.y>ne.y&&(ne.y=X.y),X.z<Z.z?Z.z=X.z:X.z>ne.z&&(ne.z=X.z)}},l.prototype.computeWorldFaceNormals=function(Z){for(var ne=this.faceNormals.length;this.worldFaceNormals.length<ne;)this.worldFaceNormals.push(new a);for(var j=this.faceNormals,ee=this.worldFaceNormals,F=0;F!==ne;F++)Z.vmult(j[F],ee[F]);this.worldFaceNormalsNeedsUpdate=!1},l.prototype.updateBoundingSphereRadius=function(){for(var Z=0,ne=this.vertices,j=0,ee=ne.length;j!==ee;j++){var F=ne[j].norm2();F>Z&&(Z=F)}this.boundingSphereRadius=Math.sqrt(Z)};var W=new a;l.prototype.calculateWorldAABB=function(Z,ne,j,ee){for(var F=this.vertices.length,X=this.vertices,Q,ue,ce,xe,Me,Y,P=0;P<F;P++){W.copy(X[P]),ne.vmult(W,W),Z.vadd(W,W);var R=W;R.x<Q||Q===void 0?Q=R.x:(R.x>xe||xe===void 0)&&(xe=R.x),R.y<ue||ue===void 0?ue=R.y:(R.y>Me||Me===void 0)&&(Me=R.y),R.z<ce||ce===void 0?ce=R.z:(R.z>Y||Y===void 0)&&(Y=R.z)}j.set(Q,ue,ce),ee.set(xe,Me,Y)},l.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},l.prototype.getAveragePointLocal=function(Z){Z=Z||new a;for(var ne=this.vertices.length,j=this.vertices,ee=0;ee<ne;ee++)Z.vadd(j[ee],Z);return Z.mult(1/ne,Z),Z},l.prototype.transformAllPoints=function(Z,ne){var j=this.vertices.length,ee=this.vertices;if(ne){for(var F=0;F<j;F++){var X=ee[F];ne.vmult(X,X)}for(var F=0;F<this.faceNormals.length;F++){var X=this.faceNormals[F];ne.vmult(X,X)}}if(Z)for(var F=0;F<j;F++){var X=ee[F];X.vadd(Z,X)}};var z=new a,q=new a,O=new a;l.prototype.pointIsInside=function(Z){var ne=this.vertices.length,j=this.vertices,ee=this.faces,F=this.faceNormals,X=null,Q=this.faces.length,ue=z;this.getAveragePointLocal(ue);for(var ce=0;ce<Q;ce++){this.faces[ce].length;var ne=F[ce],xe=j[ee[ce][0]],Me=q;Z.vsub(xe,Me);var Y=ne.dot(Me),P=O;ue.vsub(xe,P);var R=ne.dot(P);if(Y<0&&R>0||Y>0&&R<0)return!1}return X?1:-1},new a;var re=new a,le=new a;l.project=function(Z,ne,j,ee,F){var X=Z.vertices.length,Q=re,ue=0,ce=0,xe=le,Me=Z.vertices;xe.setZero(),o.vectorToLocalFrame(j,ee,ne,Q),o.pointToLocalFrame(j,ee,xe,xe);var Y=xe.dot(Q);ce=ue=Me[0].dot(Q);for(var P=1;P<X;P++){var R=Me[P].dot(Q);R>ue&&(ue=R),R<ce&&(ce=R)}if(ce-=Y,ue-=Y,ce>ue){var N=ce;ce=ue,ue=N}F[0]=ue,F[1]=ce}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,n,s){n.exports=l;var r=t("./Shape"),a=t("../math/Vec3");t("../math/Quaternion");var o=t("./ConvexPolyhedron");function l(c,u,d,h){var f=h,p=[],m=[],_=[],v=[],x=[],y=Math.cos,g=Math.sin;p.push(new a(u*y(0),u*g(0),-d*.5)),v.push(0),p.push(new a(c*y(0),c*g(0),d*.5)),x.push(1);for(var w=0;w<f;w++){var b=2*Math.PI/f*(w+1),T=2*Math.PI/f*(w+.5);w<f-1?(p.push(new a(u*y(b),u*g(b),-d*.5)),v.push(2*w+2),p.push(new a(c*y(b),c*g(b),d*.5)),x.push(2*w+3),_.push([2*w+2,2*w+3,2*w+1,2*w])):_.push([0,1,2*w+1,2*w]),(f%2===1||w<f/2)&&m.push(new a(y(T),g(T),0))}_.push(x),m.push(new a(0,0,1));for(var E=[],w=0;w<v.length;w++)E.push(v[v.length-w-1]);_.push(E),this.type=r.types.CONVEXPOLYHEDRON,o.call(this,p,_,m)}l.prototype=new o},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,n,s){var r=t("./Shape"),a=t("./ConvexPolyhedron"),o=t("../math/Vec3"),l=t("../utils/Utils");n.exports=c;function c(u,d){d=l.defaults(d,{maxValue:null,minValue:null,elementSize:1}),this.data=u,this.maxValue=d.maxValue,this.minValue=d.minValue,this.elementSize=d.elementSize,d.minValue===null&&this.updateMinValue(),d.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,r.call(this),this.pillarConvex=new a,this.pillarOffset=new o,this.type=r.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}c.prototype=new r,c.prototype.update=function(){this._cachedPillars={}},c.prototype.updateMinValue=function(){for(var u=this.data,d=u[0][0],h=0;h!==u.length;h++)for(var f=0;f!==u[h].length;f++){var p=u[h][f];p<d&&(d=p)}this.minValue=d},c.prototype.updateMaxValue=function(){for(var u=this.data,d=u[0][0],h=0;h!==u.length;h++)for(var f=0;f!==u[h].length;f++){var p=u[h][f];p>d&&(d=p)}this.maxValue=d},c.prototype.setHeightValueAtIndex=function(u,d,h){var f=this.data;f[u][d]=h,this.clearCachedConvexTrianglePillar(u,d,!1),u>0&&(this.clearCachedConvexTrianglePillar(u-1,d,!0),this.clearCachedConvexTrianglePillar(u-1,d,!1)),d>0&&(this.clearCachedConvexTrianglePillar(u,d-1,!0),this.clearCachedConvexTrianglePillar(u,d-1,!1)),d>0&&u>0&&this.clearCachedConvexTrianglePillar(u-1,d-1,!0)},c.prototype.getRectMinMax=function(u,d,h,f,p){p=p||[];for(var m=this.data,_=this.minValue,v=u;v<=h;v++)for(var x=d;x<=f;x++){var y=m[v][x];y>_&&(_=y)}p[0]=this.minValue,p[1]=_},c.prototype.getIndexOfPosition=function(u,d,h,f){var p=this.elementSize,m=this.data,_=Math.floor(u/p),v=Math.floor(d/p);return h[0]=_,h[1]=v,f&&(_<0&&(_=0),v<0&&(v=0),_>=m.length-1&&(_=m.length-1),v>=m[0].length-1&&(v=m[0].length-1)),!(_<0||v<0||_>=m.length-1||v>=m[0].length-1)},c.prototype.getHeightAt=function(u,d,h){var f=[];this.getIndexOfPosition(u,d,f,h);var p=[];return this.getRectMinMax(f[0],f[1]+1,f[0],f[1]+1,p),(p[0]+p[1])/2},c.prototype.getCacheConvexTrianglePillarKey=function(u,d,h){return u+"_"+d+"_"+(h?1:0)},c.prototype.getCachedConvexTrianglePillar=function(u,d,h){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(u,d,h)]},c.prototype.setCachedConvexTrianglePillar=function(u,d,h,f,p){this._cachedPillars[this.getCacheConvexTrianglePillarKey(u,d,h)]={convex:f,offset:p}},c.prototype.clearCachedConvexTrianglePillar=function(u,d,h){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(u,d,h)]},c.prototype.getConvexTrianglePillar=function(u,d,h){var f=this.pillarConvex,p=this.pillarOffset;if(this.cacheEnabled){var m=this.getCachedConvexTrianglePillar(u,d,h);if(m){this.pillarConvex=m.convex,this.pillarOffset=m.offset;return}f=new a,p=new o,this.pillarConvex=f,this.pillarOffset=p}var m=this.data,_=this.elementSize,v=f.faces;f.vertices.length=6;for(var x=0;x<6;x++)f.vertices[x]||(f.vertices[x]=new o);v.length=5;for(var x=0;x<5;x++)v[x]||(v[x]=[]);var y=f.vertices,g=(Math.min(m[u][d],m[u+1][d],m[u][d+1],m[u+1][d+1])-this.minValue)/2+this.minValue;h?(p.set((u+.75)*_,(d+.75)*_,g),y[0].set(.25*_,.25*_,m[u+1][d+1]-g),y[1].set(-.75*_,.25*_,m[u][d+1]-g),y[2].set(.25*_,-.75*_,m[u+1][d]-g),y[3].set(.25*_,.25*_,-g-1),y[4].set(-.75*_,.25*_,-g-1),y[5].set(.25*_,-.75*_,-g-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=2,v[2][1]=5,v[2][2]=3,v[2][3]=0,v[3][0]=3,v[3][1]=4,v[3][2]=1,v[3][3]=0,v[4][0]=1,v[4][1]=4,v[4][2]=5,v[4][3]=2):(p.set((u+.25)*_,(d+.25)*_,g),y[0].set(-.25*_,-.25*_,m[u][d]-g),y[1].set(.75*_,-.25*_,m[u+1][d]-g),y[2].set(-.25*_,.75*_,m[u][d+1]-g),y[3].set(-.25*_,-.25*_,-g-1),y[4].set(.75*_,-.25*_,-g-1),y[5].set(-.25*_,.75*_,-g-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=0,v[2][1]=2,v[2][2]=5,v[2][3]=3,v[3][0]=1,v[3][1]=0,v[3][2]=3,v[3][3]=4,v[4][0]=4,v[4][1]=5,v[4][2]=2,v[4][3]=1),f.computeNormals(),f.computeEdges(),f.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(u,d,h,f,p)},c.prototype.calculateLocalInertia=function(u,d){return d=d||new o,d.set(0,0,0),d},c.prototype.volume=function(){return Number.MAX_VALUE},c.prototype.calculateWorldAABB=function(u,d,h,f){h.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},c.prototype.updateBoundingSphereRadius=function(){var u=this.data,d=this.elementSize;this.boundingSphereRadius=new o(u.length*d,u[0].length*d,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,n,s){n.exports=o;var r=t("./Shape"),a=t("../math/Vec3");function o(){r.call(this),this.type=r.types.PARTICLE}o.prototype=new r,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(l,c){return c=c||new a,c.set(0,0,0),c},o.prototype.volume=function(){return 0},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},o.prototype.calculateWorldAABB=function(l,c,u,d){u.copy(l),d.copy(l)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,n,s){n.exports=o;var r=t("./Shape"),a=t("../math/Vec3");function o(){r.call(this),this.type=r.types.PLANE,this.worldNormal=new a,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}o.prototype=new r,o.prototype.constructor=o,o.prototype.computeWorldNormal=function(c){var u=this.worldNormal;u.set(0,0,1),c.vmult(u,u),this.worldNormalNeedsUpdate=!1},o.prototype.calculateLocalInertia=function(c,u){return u=u||new a,u},o.prototype.volume=function(){return Number.MAX_VALUE};var l=new a;o.prototype.calculateWorldAABB=function(c,u,d,h){l.set(0,0,1),u.vmult(l,l);var f=Number.MAX_VALUE;d.set(-f,-f,-f),h.set(f,f,f),l.x===1&&(h.x=c.x),l.y===1&&(h.y=c.y),l.z===1&&(h.z=c.z),l.x===-1&&(d.x=c.x),l.y===-1&&(d.y=c.y),l.z===-1&&(d.z=c.z)},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,n,s){n.exports=r;var r=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function r(){this.id=r.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}r.prototype.constructor=r,r.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},r.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},r.prototype.calculateLocalInertia=function(a,o){throw"calculateLocalInertia() not implemented for shape type "+this.type},r.idCounter=0,r.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,n,s){n.exports=o;var r=t("./Shape"),a=t("../math/Vec3");function o(l){if(r.call(this),this.radius=l!==void 0?Number(l):1,this.type=r.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}o.prototype=new r,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(l,c){c=c||new a;var u=2*l*this.radius*this.radius/5;return c.x=u,c.y=u,c.z=u,c},o.prototype.volume=function(){return 4*Math.PI*this.radius/3},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},o.prototype.calculateWorldAABB=function(l,c,u,d){for(var h=this.radius,f=["x","y","z"],p=0;p<f.length;p++){var m=f[p];u[m]=l[m]-h,d[m]=l[m]+h}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,n,s){n.exports=u;var r=t("./Shape"),a=t("../math/Vec3");t("../math/Quaternion");var o=t("../math/Transform"),l=t("../collision/AABB"),c=t("../utils/Octree");function u(E,S){r.call(this),this.type=r.types.TRIMESH,this.vertices=new Float32Array(E),this.indices=new Int16Array(S),this.normals=new Float32Array(S.length),this.aabb=new l,this.edges=null,this.scale=new a(1,1,1),this.tree=new c,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}u.prototype=new r,u.prototype.constructor=u;var d=new a;u.prototype.updateTree=function(){var E=this.tree;E.reset(),E.aabb.copy(this.aabb);var S=this.scale;E.aabb.lowerBound.x*=1/S.x,E.aabb.lowerBound.y*=1/S.y,E.aabb.lowerBound.z*=1/S.z,E.aabb.upperBound.x*=1/S.x,E.aabb.upperBound.y*=1/S.y,E.aabb.upperBound.z*=1/S.z;for(var M=new l,A=new a,C=new a,I=new a,H=[A,C,I],W=0;W<this.indices.length/3;W++){var z=W*3;this._getUnscaledVertex(this.indices[z],A),this._getUnscaledVertex(this.indices[z+1],C),this._getUnscaledVertex(this.indices[z+2],I),M.setFromPoints(H),E.insert(M,W)}E.removeEmptyNodes()};var h=new l;u.prototype.getTrianglesInAABB=function(E,S){h.copy(E);var M=this.scale,A=M.x,C=M.y,I=M.z,H=h.lowerBound,W=h.upperBound;return H.x/=A,H.y/=C,H.z/=I,W.x/=A,W.y/=C,W.z/=I,this.tree.aabbQuery(h,S)},u.prototype.setScale=function(E){var S=this.scale.x===this.scale.y===this.scale.z,M=E.x===E.y===E.z;S&&M||this.updateNormals(),this.scale.copy(E),this.updateAABB(),this.updateBoundingSphereRadius()},u.prototype.updateNormals=function(){for(var E=d,S=this.normals,M=0;M<this.indices.length/3;M++){var A=M*3,C=this.indices[A],I=this.indices[A+1],H=this.indices[A+2];this.getVertex(C,v),this.getVertex(I,x),this.getVertex(H,y),u.computeNormal(x,v,y,E),S[A]=E.x,S[A+1]=E.y,S[A+2]=E.z}},u.prototype.updateEdges=function(){for(var E={},S=function(z,q){var O=C<I?C+"_"+I:I+"_"+C;E[O]=!0},M=0;M<this.indices.length/3;M++){var A=M*3,C=this.indices[A],I=this.indices[A+1];this.indices[A+2],S(),S(),S()}var H=Object.keys(E);this.edges=new Int16Array(H.length*2);for(var M=0;M<H.length;M++){var W=H[M].split("_");this.edges[2*M]=parseInt(W[0],10),this.edges[2*M+1]=parseInt(W[1],10)}},u.prototype.getEdgeVertex=function(E,S,M){var A=this.edges[E*2+(S?1:0)];this.getVertex(A,M)};var f=new a,p=new a;u.prototype.getEdgeVector=function(E,S){var M=f,A=p;this.getEdgeVertex(E,0,M),this.getEdgeVertex(E,1,A),A.vsub(M,S)};var m=new a,_=new a;u.computeNormal=function(E,S,M,A){S.vsub(E,_),M.vsub(S,m),m.cross(_,A),A.isZero()||A.normalize()};var v=new a,x=new a,y=new a;u.prototype.getVertex=function(E,S){var M=this.scale;return this._getUnscaledVertex(E,S),S.x*=M.x,S.y*=M.y,S.z*=M.z,S},u.prototype._getUnscaledVertex=function(E,S){var M=E*3,A=this.vertices;return S.set(A[M],A[M+1],A[M+2])},u.prototype.getWorldVertex=function(E,S,M,A){return this.getVertex(E,A),o.pointToWorldFrame(S,M,A,A),A},u.prototype.getTriangleVertices=function(E,S,M,A){var C=E*3;this.getVertex(this.indices[C],S),this.getVertex(this.indices[C+1],M),this.getVertex(this.indices[C+2],A)},u.prototype.getNormal=function(E,S){var M=E*3;return S.set(this.normals[M],this.normals[M+1],this.normals[M+2])};var g=new l;u.prototype.calculateLocalInertia=function(E,S){this.computeLocalAABB(g);var M=g.upperBound.x-g.lowerBound.x,A=g.upperBound.y-g.lowerBound.y,C=g.upperBound.z-g.lowerBound.z;return S.set(1/12*E*(2*A*2*A+2*C*2*C),1/12*E*(2*M*2*M+2*C*2*C),1/12*E*(2*A*2*A+2*M*2*M))};var w=new a;u.prototype.computeLocalAABB=function(E){var S=E.lowerBound,M=E.upperBound,A=this.vertices.length;this.vertices;var C=w;this.getVertex(0,C),S.copy(C),M.copy(C);for(var I=0;I!==A;I++)this.getVertex(I,C),C.x<S.x?S.x=C.x:C.x>M.x&&(M.x=C.x),C.y<S.y?S.y=C.y:C.y>M.y&&(M.y=C.y),C.z<S.z?S.z=C.z:C.z>M.z&&(M.z=C.z)},u.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},u.prototype.updateBoundingSphereRadius=function(){for(var E=0,S=this.vertices,M=new a,A=0,C=S.length/3;A!==C;A++){this.getVertex(A,M);var I=M.norm2();I>E&&(E=I)}this.boundingSphereRadius=Math.sqrt(E)},new a;var b=new o,T=new l;u.prototype.calculateWorldAABB=function(E,S,M,A){var C=b,I=T;C.position=E,C.quaternion=S,this.aabb.toWorldFrame(C,I),M.copy(I.lowerBound),A.copy(I.upperBound)},u.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},u.createTorus=function(E,S,M,A,C){E=E||1,S=S||.5,M=M||8,A=A||6,C=C||Math.PI*2;for(var I=[],H=[],W=0;W<=M;W++)for(var z=0;z<=A;z++){var q=z/A*C,O=W/M*Math.PI*2,re=(E+S*Math.cos(O))*Math.cos(q),le=(E+S*Math.cos(O))*Math.sin(q),Z=S*Math.sin(O);I.push(re,le,Z)}for(var W=1;W<=M;W++)for(var z=1;z<=A;z++){var ne=(A+1)*W+z-1,j=(A+1)*(W-1)+z-1,ee=(A+1)*(W-1)+z,F=(A+1)*W+z;H.push(ne,j,F),H.push(j,ee,F)}return new u(I,H)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,n,s){n.exports=a,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver");function a(){r.call(this),this.iterations=10,this.tolerance=1e-7}a.prototype=new r;var o=[],l=[],c=[];a.prototype.solve=function(u,d){var h=0,f=this.iterations,p=this.tolerance*this.tolerance,m=this.equations,_=m.length,v=d.bodies,x=v.length,y=u,g,w,b,T,E,S;if(_!==0)for(var M=0;M!==x;M++)v[M].updateSolveMassProperties();var A=l,C=c,I=o;A.length=_,C.length=_,I.length=_;for(var M=0;M!==_;M++){var H=m[M];I[M]=0,C[M]=H.computeB(y),A[M]=1/H.computeC()}if(_!==0){for(var M=0;M!==x;M++){var W=v[M],z=W.vlambda,q=W.wlambda;z.set(0,0,0),q&&q.set(0,0,0)}for(h=0;h!==f;h++){T=0;for(var O=0;O!==_;O++){var H=m[O];g=C[O],w=A[O],S=I[O],E=H.computeGWlambda(),b=w*(g-E-H.eps*S),S+b<H.minForce?b=H.minForce-S:S+b>H.maxForce&&(b=H.maxForce-S),I[O]+=b,T+=b>0?b:-b,H.addToWlambda(b)}if(T*T<p)break}for(var M=0;M!==x;M++){var W=v[M],re=W.velocity,le=W.angularVelocity;re.vadd(W.vlambda,re),le&&le.vadd(W.wlambda,le)}}return h}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,n,s){n.exports=r;function r(){this.equations=[]}r.prototype.solve=function(a,o){return 0},r.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)},r.prototype.removeEquation=function(a){var o=this.equations,l=o.indexOf(a);l!==-1&&o.splice(l,1)},r.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,n,s){n.exports=o,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver"),a=t("../objects/Body");function o(v){for(r.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=v,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}o.prototype=new r;var l=[],c=[],u={bodies:[]},d=a.STATIC;function h(v){for(var x=v.length,y=0;y!==x;y++){var g=v[y];if(!g.visited&&!(g.body.type&d))return g}return!1}var f=[];function p(v,x,y,g){for(f.push(v),v.visited=!0,x(v,y,g);f.length;)for(var w=f.pop(),b;b=h(w.children);)b.visited=!0,x(b,y,g),f.push(b)}function m(v,x,y){x.push(v.body);for(var g=v.eqs.length,w=0;w!==g;w++){var b=v.eqs[w];y.indexOf(b)===-1&&y.push(b)}}o.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},o.prototype.solve=function(v,x){for(var y=l,g=this.nodePool,w=x.bodies,b=this.equations,T=b.length,E=w.length,S=this.subsolver;g.length<E;)g.push(this.createNode());y.length=E;for(var M=0;M<E;M++)y[M]=g[M];for(var M=0;M!==E;M++){var A=y[M];A.body=w[M],A.children.length=0,A.eqs.length=0,A.visited=!1}for(var C=0;C!==T;C++){var I=b[C],M=w.indexOf(I.bi),H=w.indexOf(I.bj),W=y[M],z=y[H];W.children.push(z),W.eqs.push(I),z.children.push(W),z.eqs.push(I)}var q,O=0,re=c;S.tolerance=this.tolerance,S.iterations=this.iterations;for(var le=u;q=h(y);){re.length=0,le.bodies.length=0,p(q,m,le.bodies,re);var Z=re.length;re=re.sort(_);for(var M=0;M!==Z;M++)S.addEquation(re[M]);S.solve(v,le),S.removeAllEquations(),O++}return O};function _(v,x){return x.id-v.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,n,s){var r=function(){};n.exports=r,r.prototype={constructor:r,addEventListener:function(a,o){this._listeners===void 0&&(this._listeners={});var l=this._listeners;return l[a]===void 0&&(l[a]=[]),l[a].indexOf(o)===-1&&l[a].push(o),this},hasEventListener:function(a,o){if(this._listeners===void 0)return!1;var l=this._listeners;return l[a]!==void 0&&l[a].indexOf(o)!==-1},removeEventListener:function(a,o){if(this._listeners===void 0)return this;var l=this._listeners;if(l[a]===void 0)return this;var c=l[a].indexOf(o);return c!==-1&&l[a].splice(c,1),this},dispatchEvent:function(a){if(this._listeners===void 0)return this;var o=this._listeners,l=o[a.type];if(l!==void 0){a.target=this;for(var c=0,u=l.length;c<u;c++)l[c].call(this,a)}return this}}},{}],50:[function(t,n,s){var r=t("../collision/AABB"),a=t("../math/Vec3");n.exports=l;function o(d){d=d||{},this.root=d.root||null,this.aabb=d.aabb?d.aabb.clone():new r,this.data=[],this.children=[]}function l(d,h){h=h||{},h.root=null,h.aabb=d,o.call(this,h),this.maxDepth=typeof h.maxDepth<"u"?h.maxDepth:8}l.prototype=new o,o.prototype.reset=function(d,h){this.children.length=this.data.length=0},o.prototype.insert=function(d,h,f){var p=this.data;if(f=f||0,!this.aabb.contains(d))return!1;var m=this.children;if(f<(this.maxDepth||this.root.maxDepth)){var _=!1;m.length||(this.subdivide(),_=!0);for(var v=0;v!==8;v++)if(m[v].insert(d,h,f+1))return!0;_&&(m.length=0)}return p.push(h),!0};var c=new a;o.prototype.subdivide=function(){var d=this.aabb,h=d.lowerBound,f=d.upperBound,p=this.children;p.push(new o({aabb:new r({lowerBound:new a(0,0,0)})}),new o({aabb:new r({lowerBound:new a(1,0,0)})}),new o({aabb:new r({lowerBound:new a(1,1,0)})}),new o({aabb:new r({lowerBound:new a(1,1,1)})}),new o({aabb:new r({lowerBound:new a(0,1,1)})}),new o({aabb:new r({lowerBound:new a(0,0,1)})}),new o({aabb:new r({lowerBound:new a(1,0,1)})}),new o({aabb:new r({lowerBound:new a(0,1,0)})})),f.vsub(h,c),c.scale(.5,c);for(var m=this.root||this,_=0;_!==8;_++){var v=p[_];v.root=m;var x=v.aabb.lowerBound;x.x*=c.x,x.y*=c.y,x.z*=c.z,x.vadd(h,x),x.vadd(c,v.aabb.upperBound)}},o.prototype.aabbQuery=function(d,h){this.data,this.children;for(var f=[this];f.length;){var p=f.pop();p.aabb.overlaps(d)&&Array.prototype.push.apply(h,p.data),Array.prototype.push.apply(f,p.children)}return h};var u=new r;o.prototype.rayQuery=function(d,h,f){return d.getAABB(u),u.toLocalFrame(h,u),this.aabbQuery(u,f),f},o.prototype.removeEmptyNodes=function(){for(var d=[this];d.length;){for(var h=d.pop(),f=h.children.length-1;f>=0;f--)h.children[f].data.length||h.children.splice(f,1);Array.prototype.push.apply(d,h.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,n,s){n.exports=r;function r(){this.objects=[],this.type=Object}r.prototype.release=function(){for(var a=arguments.length,o=0;o!==a;o++)this.objects.push(arguments[o])},r.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},r.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,n,s){n.exports=r;function r(){this.data={keys:[]}}r.prototype.get=function(a,o){if(a>o){var l=o;o=a,a=l}return this.data[a+"-"+o]},r.prototype.set=function(a,o,l){if(a>o){var c=o;o=a,a=c}var u=a+"-"+o;this.get(a,o)||this.data.keys.push(u),this.data[u]=l},r.prototype.reset=function(){for(var a=this.data,o=a.keys;o.length>0;){var l=o.pop();delete a[l]}}},{}],53:[function(t,n,s){function r(){}n.exports=r,r.defaults=function(a,o){a=a||{};for(var l in o)l in a||(a[l]=o[l]);return a}},{}],54:[function(t,n,s){n.exports=o;var r=t("../math/Vec3"),a=t("./Pool");function o(){a.call(this),this.type=r}o.prototype=new a,o.prototype.constructObject=function(){return new r}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,n,s){n.exports=p;var r=t("../collision/AABB"),a=t("../shapes/Shape"),o=t("../collision/Ray"),l=t("../math/Vec3"),c=t("../math/Transform");t("../shapes/ConvexPolyhedron");var u=t("../math/Quaternion");t("../solver/Solver");var d=t("../utils/Vec3Pool"),h=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation");function p(Ae){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new d,this.world=Ae,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(Ae,Ce,Be,ke,Et,rt){var $e;this.contactPointPool.length?($e=this.contactPointPool.pop(),$e.bi=Ae,$e.bj=Ce):$e=new h(Ae,Ce),$e.enabled=Ae.collisionResponse&&Ce.collisionResponse&&Be.collisionResponse&&ke.collisionResponse;var Je=this.currentContactMaterial;$e.restitution=Je.restitution,$e.setSpookParams(Je.contactEquationStiffness,Je.contactEquationRelaxation,this.world.dt);var Ee=Be.material||Ae.material,We=ke.material||Ce.material;return Ee&&We&&Ee.restitution>=0&&We.restitution>=0&&($e.restitution=Ee.restitution*We.restitution),$e.si=Et||Be,$e.sj=rt||ke,$e},p.prototype.createFrictionEquationsFromContact=function(Ae,Ce){var Be=Ae.bi,ke=Ae.bj,Et=Ae.si,rt=Ae.sj,$e=this.world,Je=this.currentContactMaterial,Ee=Je.friction,We=Et.material||Be.material,nt=rt.material||ke.material;if(We&&nt&&We.friction>=0&&nt.friction>=0&&(Ee=We.friction*nt.friction),Ee>0){var ht=Ee*$e.gravity.length(),Ze=Be.invMass+ke.invMass;Ze>0&&(Ze=1/Ze);var He=this.frictionEquationPool,Qe=He.length?He.pop():new f(Be,ke,ht*Ze),xt=He.length?He.pop():new f(Be,ke,ht*Ze);return Qe.bi=xt.bi=Be,Qe.bj=xt.bj=ke,Qe.minForce=xt.minForce=-ht*Ze,Qe.maxForce=xt.maxForce=ht*Ze,Qe.ri.copy(Ae.ri),Qe.rj.copy(Ae.rj),xt.ri.copy(Ae.ri),xt.rj.copy(Ae.rj),Ae.ni.tangents(Qe.t,xt.t),Qe.setSpookParams(Je.frictionEquationStiffness,Je.frictionEquationRelaxation,$e.dt),xt.setSpookParams(Je.frictionEquationStiffness,Je.frictionEquationRelaxation,$e.dt),Qe.enabled=xt.enabled=Ae.enabled,Ce.push(Qe,xt),!0}return!1};var m=new l,_=new l,v=new l;p.prototype.createFrictionFromAverage=function(Ae){var Ce=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(Ce,this.frictionResult)||Ae===1)){var Be=this.frictionResult[this.frictionResult.length-2],ke=this.frictionResult[this.frictionResult.length-1];m.setZero(),_.setZero(),v.setZero();var Et=Ce.bi;Ce.bj;for(var rt=0;rt!==Ae;rt++)Ce=this.result[this.result.length-1-rt],Ce.bodyA!==Et?(m.vadd(Ce.ni,m),_.vadd(Ce.ri,_),v.vadd(Ce.rj,v)):(m.vsub(Ce.ni,m),_.vadd(Ce.rj,_),v.vadd(Ce.ri,v));var $e=1/Ae;_.scale($e,Be.ri),v.scale($e,Be.rj),ke.ri.copy(Be.ri),ke.rj.copy(Be.rj),m.normalize(),m.tangents(Be.t,ke.t)}};var x=new l,y=new l,g=new u,w=new u;p.prototype.getContacts=function(Ae,Ce,Be,ke,Et,rt,$e){this.contactPointPool=Et,this.frictionEquationPool=$e,this.result=ke,this.frictionResult=rt;for(var Je=g,Ee=w,We=x,nt=y,ht=0,Ze=Ae.length;ht!==Ze;ht++){var He=Ae[ht],Qe=Ce[ht],xt=null;He.material&&Qe.material&&(xt=Be.getContactMaterial(He.material,Qe.material)||null);for(var It=0;It<He.shapes.length;It++){He.quaternion.mult(He.shapeOrientations[It],Je),He.quaternion.vmult(He.shapeOffsets[It],We),We.vadd(He.position,We);for(var Ue=He.shapes[It],U=0;U<Qe.shapes.length;U++){Qe.quaternion.mult(Qe.shapeOrientations[U],Ee),Qe.quaternion.vmult(Qe.shapeOffsets[U],nt),nt.vadd(Qe.position,nt);var he=Qe.shapes[U];if(!(We.distanceTo(nt)>Ue.boundingSphereRadius+he.boundingSphereRadius)){var Se=null;Ue.material&&he.material&&(Se=Be.getContactMaterial(Ue.material,he.material)||null),this.currentContactMaterial=Se||xt||Be.defaultContactMaterial;var be=this[Ue.type|he.type];be&&(Ue.type<he.type?be.call(this,Ue,he,We,nt,Je,Ee,He,Qe,Ue,he):be.call(this,he,Ue,nt,We,Ee,Je,Qe,He,Ue,he))}}}}},p.prototype[a.types.BOX|a.types.BOX]=p.prototype.boxBox=function(Ae,Ce,Be,ke,Et,rt,$e,Je){Ae.convexPolyhedronRepresentation.material=Ae.material,Ce.convexPolyhedronRepresentation.material=Ce.material,Ae.convexPolyhedronRepresentation.collisionResponse=Ae.collisionResponse,Ce.convexPolyhedronRepresentation.collisionResponse=Ce.collisionResponse,this.convexConvex(Ae.convexPolyhedronRepresentation,Ce.convexPolyhedronRepresentation,Be,ke,Et,rt,$e,Je,Ae,Ce)},p.prototype[a.types.BOX|a.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(Ae,Ce,Be,ke,Et,rt,$e,Je){Ae.convexPolyhedronRepresentation.material=Ae.material,Ae.convexPolyhedronRepresentation.collisionResponse=Ae.collisionResponse,this.convexConvex(Ae.convexPolyhedronRepresentation,Ce,Be,ke,Et,rt,$e,Je,Ae,Ce)},p.prototype[a.types.BOX|a.types.PARTICLE]=p.prototype.boxParticle=function(Ae,Ce,Be,ke,Et,rt,$e,Je){Ae.convexPolyhedronRepresentation.material=Ae.material,Ae.convexPolyhedronRepresentation.collisionResponse=Ae.collisionResponse,this.convexParticle(Ae.convexPolyhedronRepresentation,Ce,Be,ke,Et,rt,$e,Je,Ae,Ce)},p.prototype[a.types.SPHERE]=p.prototype.sphereSphere=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=this.createContactEquation($e,Je,Ae,Ce);ke.vsub(Be,Ee.ni),Ee.ni.normalize(),Ee.ri.copy(Ee.ni),Ee.rj.copy(Ee.ni),Ee.ri.mult(Ae.radius,Ee.ri),Ee.rj.mult(-Ce.radius,Ee.rj),Ee.ri.vadd(Be,Ee.ri),Ee.ri.vsub($e.position,Ee.ri),Ee.rj.vadd(ke,Ee.rj),Ee.rj.vsub(Je.position,Ee.rj),this.result.push(Ee),this.createFrictionEquationsFromContact(Ee,this.frictionResult)};var b=new l,T=new l,E=new l;p.prototype[a.types.PLANE|a.types.TRIMESH]=p.prototype.planeTrimesh=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=new l,We=b;We.set(0,0,1),Et.vmult(We,We);for(var nt=0;nt<Ce.vertices.length/3;nt++){Ce.getVertex(nt,Ee);var ht=new l;ht.copy(Ee),c.pointToWorldFrame(ke,rt,ht,Ee);var Ze=T;Ee.vsub(Be,Ze);var He=We.dot(Ze);if(He<=0){var Qe=this.createContactEquation($e,Je,Ae,Ce);Qe.ni.copy(We);var xt=E;We.scale(Ze.dot(We),xt),Ee.vsub(xt,xt),Qe.ri.copy(xt),Qe.ri.vsub($e.position,Qe.ri),Qe.rj.copy(Ee),Qe.rj.vsub(Je.position,Qe.rj),this.result.push(Qe),this.createFrictionEquationsFromContact(Qe,this.frictionResult)}}};var S=new l,M=new l;new l;var A=new l,C=new l,I=new l,H=new l,W=new l,z=new l,q=new l,O=new l,re=new l,le=new l,Z=new l,ne=new r,j=[];p.prototype[a.types.SPHERE|a.types.TRIMESH]=p.prototype.sphereTrimesh=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=I,We=H,nt=W,ht=z,Ze=q,He=O,Qe=ne,xt=C,It=M,Ue=j;c.pointToLocalFrame(ke,rt,Be,Ze);var U=Ae.radius;Qe.lowerBound.set(Ze.x-U,Ze.y-U,Ze.z-U),Qe.upperBound.set(Ze.x+U,Ze.y+U,Ze.z+U),Ce.getTrianglesInAABB(Qe,Ue);for(var he=A,Se=Ae.radius*Ae.radius,be=0;be<Ue.length;be++)for(var _e=0;_e<3;_e++)if(Ce.getVertex(Ce.indices[Ue[be]*3+_e],he),he.vsub(Ze,It),It.norm2()<=Se){xt.copy(he),c.pointToWorldFrame(ke,rt,xt,he),he.vsub(Be,It);var Te=this.createContactEquation($e,Je,Ae,Ce);Te.ni.copy(It),Te.ni.normalize(),Te.ri.copy(Te.ni),Te.ri.scale(Ae.radius,Te.ri),Te.ri.vadd(Be,Te.ri),Te.ri.vsub($e.position,Te.ri),Te.rj.copy(he),Te.rj.vsub(Je.position,Te.rj),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult)}for(var be=0;be<Ue.length;be++)for(var _e=0;_e<3;_e++){Ce.getVertex(Ce.indices[Ue[be]*3+_e],Ee),Ce.getVertex(Ce.indices[Ue[be]*3+(_e+1)%3],We),We.vsub(Ee,nt),Ze.vsub(We,He);var je=He.dot(nt);Ze.vsub(Ee,He);var lt=He.dot(nt);if(lt>0&&je<0){Ze.vsub(Ee,He),ht.copy(nt),ht.normalize(),lt=He.dot(ht),ht.scale(lt,He),He.vadd(Ee,He);var it=He.distanceTo(Ze);if(it<Ae.radius){var Te=this.createContactEquation($e,Je,Ae,Ce);He.vsub(Ze,Te.ni),Te.ni.normalize(),Te.ni.scale(Ae.radius,Te.ri),c.pointToWorldFrame(ke,rt,He,He),He.vsub(Je.position,Te.rj),c.vectorToWorldFrame(rt,Te.ni,Te.ni),c.vectorToWorldFrame(rt,Te.ri,Te.ri),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult)}}}for(var gt=re,vt=le,et=Z,Dt=S,be=0,St=Ue.length;be!==St;be++){Ce.getTriangleVertices(Ue[be],gt,vt,et),Ce.getNormal(Ue[be],Dt),Ze.vsub(gt,He);var it=He.dot(Dt);if(Dt.scale(it,He),Ze.vsub(He,He),it=He.distanceTo(Ze),o.pointInTriangle(He,gt,vt,et)&&it<Ae.radius){var Te=this.createContactEquation($e,Je,Ae,Ce);He.vsub(Ze,Te.ni),Te.ni.normalize(),Te.ni.scale(Ae.radius,Te.ri),c.pointToWorldFrame(ke,rt,He,He),He.vsub(Je.position,Te.rj),c.vectorToWorldFrame(rt,Te.ni,Te.ni),c.vectorToWorldFrame(rt,Te.ri,Te.ri),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult)}}Ue.length=0};var ee=new l,F=new l;p.prototype[a.types.SPHERE|a.types.PLANE]=p.prototype.spherePlane=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=this.createContactEquation($e,Je,Ae,Ce);if(Ee.ni.set(0,0,1),rt.vmult(Ee.ni,Ee.ni),Ee.ni.negate(Ee.ni),Ee.ni.normalize(),Ee.ni.mult(Ae.radius,Ee.ri),Be.vsub(ke,ee),Ee.ni.mult(Ee.ni.dot(ee),F),ee.vsub(F,Ee.rj),-ee.dot(Ee.ni)<=Ae.radius){var We=Ee.ri,nt=Ee.rj;We.vadd(Be,We),We.vsub($e.position,We),nt.vadd(ke,nt),nt.vsub(Je.position,nt),this.result.push(Ee),this.createFrictionEquationsFromContact(Ee,this.frictionResult)}};var X=new l,Q=new l,ue=new l;function ce(Ae,Ce,Be){for(var ke=null,Et=Ae.length,rt=0;rt!==Et;rt++){var $e=Ae[rt],Je=X;Ae[(rt+1)%Et].vsub($e,Je);var Ee=Q;Je.cross(Ce,Ee);var We=ue;Be.vsub($e,We);var nt=Ee.dot(We);if(ke===null||nt>0&&ke===!0||nt<=0&&ke===!1){ke===null&&(ke=nt>0);continue}else return!1}return!0}var xe=new l,Me=new l,Y=new l,P=new l,R=[new l,new l,new l,new l,new l,new l],N=new l,$=new l,ie=new l,ye=new l;p.prototype[a.types.SPHERE|a.types.BOX]=p.prototype.sphereBox=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=this.v3pool,We=R;Be.vsub(ke,xe),Ce.getSideNormals(We,rt);for(var nt=Ae.radius,ht=!1,Ze=$,He=ie,Qe=ye,xt=null,It=0,Ue=0,U=0,he=null,Se=0,be=We.length;Se!==be&&ht===!1;Se++){var _e=Me;_e.copy(We[Se]);var Te=_e.norm();_e.normalize();var je=xe.dot(_e);if(je<Te+nt&&je>0){var lt=Y,it=P;lt.copy(We[(Se+1)%3]),it.copy(We[(Se+2)%3]);var gt=lt.norm(),vt=it.norm();lt.normalize(),it.normalize();var et=xe.dot(lt),Dt=xe.dot(it);if(et<gt&&et>-gt&&Dt<vt&&Dt>-vt){var en=Math.abs(je-Te-nt);(he===null||en<he)&&(he=en,Ue=et,U=Dt,xt=Te,Ze.copy(_e),He.copy(lt),Qe.copy(it),It++)}}}if(It){ht=!0;var yt=this.createContactEquation($e,Je,Ae,Ce);Ze.mult(-nt,yt.ri),yt.ni.copy(Ze),yt.ni.negate(yt.ni),Ze.mult(xt,Ze),He.mult(Ue,He),Ze.vadd(He,Ze),Qe.mult(U,Qe),Ze.vadd(Qe,yt.rj),yt.ri.vadd(Be,yt.ri),yt.ri.vsub($e.position,yt.ri),yt.rj.vadd(ke,yt.rj),yt.rj.vsub(Je.position,yt.rj),this.result.push(yt),this.createFrictionEquationsFromContact(yt,this.frictionResult)}for(var St=Ee.get(),Qt=N,zt=0;zt!==2&&!ht;zt++)for(var Bt=0;Bt!==2&&!ht;Bt++)for(var ft=0;ft!==2&&!ht;ft++)if(St.set(0,0,0),zt?St.vadd(We[0],St):St.vsub(We[0],St),Bt?St.vadd(We[1],St):St.vsub(We[1],St),ft?St.vadd(We[2],St):St.vsub(We[2],St),ke.vadd(St,Qt),Qt.vsub(Be,Qt),Qt.norm2()<nt*nt){ht=!0;var yt=this.createContactEquation($e,Je,Ae,Ce);yt.ri.copy(Qt),yt.ri.normalize(),yt.ni.copy(yt.ri),yt.ri.mult(nt,yt.ri),yt.rj.copy(St),yt.ri.vadd(Be,yt.ri),yt.ri.vsub($e.position,yt.ri),yt.rj.vadd(ke,yt.rj),yt.rj.vsub(Je.position,yt.rj),this.result.push(yt),this.createFrictionEquationsFromContact(yt,this.frictionResult)}Ee.release(St),St=null;for(var Yt=Ee.get(),Nt=Ee.get(),yt=Ee.get(),On=Ee.get(),en=Ee.get(),zi=We.length,zt=0;zt!==zi&&!ht;zt++)for(var Bt=0;Bt!==zi&&!ht;Bt++)if(zt%3!==Bt%3){We[Bt].cross(We[zt],Yt),Yt.normalize(),We[zt].vadd(We[Bt],Nt),yt.copy(Be),yt.vsub(Nt,yt),yt.vsub(ke,yt);var sn=yt.dot(Yt);Yt.mult(sn,On);for(var ft=0;ft===zt%3||ft===Bt%3;)ft++;en.copy(Be),en.vsub(On,en),en.vsub(Nt,en),en.vsub(ke,en);var Si=Math.abs(sn),Ei=en.norm();if(Si<We[ft].norm()&&Ei<nt){ht=!0;var Vt=this.createContactEquation($e,Je,Ae,Ce);Nt.vadd(On,Vt.rj),Vt.rj.copy(Vt.rj),en.negate(Vt.ni),Vt.ni.normalize(),Vt.ri.copy(Vt.rj),Vt.ri.vadd(ke,Vt.ri),Vt.ri.vsub(Be,Vt.ri),Vt.ri.normalize(),Vt.ri.mult(nt,Vt.ri),Vt.ri.vadd(Be,Vt.ri),Vt.ri.vsub($e.position,Vt.ri),Vt.rj.vadd(ke,Vt.rj),Vt.rj.vsub(Je.position,Vt.rj),this.result.push(Vt),this.createFrictionEquationsFromContact(Vt,this.frictionResult)}}Ee.release(Yt,Nt,yt,On,en)};var ve=new l,k=new l,V=new l,de=new l,D=new l,L=new l,J=new l,K=new l,te=new l,me=new l;p.prototype[a.types.SPHERE|a.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=this.v3pool;Be.vsub(ke,ve);for(var We=Ce.faceNormals,nt=Ce.faces,ht=Ce.vertices,Ze=Ae.radius,He=0;He!==ht.length;He++){var Qe=ht[He],xt=D;rt.vmult(Qe,xt),ke.vadd(xt,xt);var It=de;if(xt.vsub(Be,It),It.norm2()<Ze*Ze){U=!0;var Ue=this.createContactEquation($e,Je,Ae,Ce);Ue.ri.copy(It),Ue.ri.normalize(),Ue.ni.copy(Ue.ri),Ue.ri.mult(Ze,Ue.ri),xt.vsub(ke,Ue.rj),Ue.ri.vadd(Be,Ue.ri),Ue.ri.vsub($e.position,Ue.ri),Ue.rj.vadd(ke,Ue.rj),Ue.rj.vsub(Je.position,Ue.rj),this.result.push(Ue),this.createFrictionEquationsFromContact(Ue,this.frictionResult);return}}for(var U=!1,He=0,he=nt.length;He!==he&&U===!1;He++){var Se=We[He],be=nt[He],_e=L;rt.vmult(Se,_e);var Te=J;rt.vmult(ht[be[0]],Te),Te.vadd(ke,Te);var je=K;_e.mult(-Ze,je),Be.vadd(je,je);var lt=te;je.vsub(Te,lt);var it=lt.dot(_e),gt=me;if(Be.vsub(Te,gt),it<0&&gt.dot(_e)>0){for(var vt=[],et=0,Dt=be.length;et!==Dt;et++){var St=Ee.get();rt.vmult(ht[be[et]],St),ke.vadd(St,St),vt.push(St)}if(ce(vt,_e,Be)){U=!0;var Ue=this.createContactEquation($e,Je,Ae,Ce);_e.mult(-Ze,Ue.ri),_e.negate(Ue.ni);var Qt=Ee.get();_e.mult(-it,Qt);var zt=Ee.get();_e.mult(-Ze,zt),Be.vsub(ke,Ue.rj),Ue.rj.vadd(zt,Ue.rj),Ue.rj.vadd(Qt,Ue.rj),Ue.rj.vadd(ke,Ue.rj),Ue.rj.vsub(Je.position,Ue.rj),Ue.ri.vadd(Be,Ue.ri),Ue.ri.vsub($e.position,Ue.ri),Ee.release(Qt),Ee.release(zt),this.result.push(Ue),this.createFrictionEquationsFromContact(Ue,this.frictionResult);for(var et=0,Bt=vt.length;et!==Bt;et++)Ee.release(vt[et]);return}else for(var et=0;et!==be.length;et++){var ft=Ee.get(),Yt=Ee.get();rt.vmult(ht[be[(et+1)%be.length]],ft),rt.vmult(ht[be[(et+2)%be.length]],Yt),ke.vadd(ft,ft),ke.vadd(Yt,Yt);var Nt=k;Yt.vsub(ft,Nt);var yt=V;Nt.unit(yt);var On=Ee.get(),en=Ee.get();Be.vsub(ft,en);var zi=en.dot(yt);yt.mult(zi,On),On.vadd(ft,On);var sn=Ee.get();if(On.vsub(Be,sn),zi>0&&zi*zi<Nt.norm2()&&sn.norm2()<Ze*Ze){var Ue=this.createContactEquation($e,Je,Ae,Ce);On.vsub(ke,Ue.rj),On.vsub(Be,Ue.ni),Ue.ni.normalize(),Ue.ni.mult(Ze,Ue.ri),Ue.rj.vadd(ke,Ue.rj),Ue.rj.vsub(Je.position,Ue.rj),Ue.ri.vadd(Be,Ue.ri),Ue.ri.vsub($e.position,Ue.ri),this.result.push(Ue),this.createFrictionEquationsFromContact(Ue,this.frictionResult);for(var et=0,Bt=vt.length;et!==Bt;et++)Ee.release(vt[et]);Ee.release(ft),Ee.release(Yt),Ee.release(On),Ee.release(sn),Ee.release(en);return}Ee.release(ft),Ee.release(Yt),Ee.release(On),Ee.release(sn),Ee.release(en)}for(var et=0,Bt=vt.length;et!==Bt;et++)Ee.release(vt[et])}}},new l,new l,p.prototype[a.types.PLANE|a.types.BOX]=p.prototype.planeBox=function(Ae,Ce,Be,ke,Et,rt,$e,Je){Ce.convexPolyhedronRepresentation.material=Ce.material,Ce.convexPolyhedronRepresentation.collisionResponse=Ce.collisionResponse,this.planeConvex(Ae,Ce.convexPolyhedronRepresentation,Be,ke,Et,rt,$e,Je)};var Ie=new l,Pe=new l,Ke=new l,Ye=new l;p.prototype[a.types.PLANE|a.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=Ie,We=Pe;We.set(0,0,1),Et.vmult(We,We);for(var nt=0,ht=Ke,Ze=0;Ze!==Ce.vertices.length;Ze++){Ee.copy(Ce.vertices[Ze]),rt.vmult(Ee,Ee),ke.vadd(Ee,Ee),Ee.vsub(Be,ht);var He=We.dot(ht);if(He<=0){var Qe=this.createContactEquation($e,Je,Ae,Ce),xt=Ye;We.mult(We.dot(ht),xt),Ee.vsub(xt,xt),xt.vsub(Be,Qe.ri),Qe.ni.copy(We),Ee.vsub(ke,Qe.rj),Qe.ri.vadd(Be,Qe.ri),Qe.ri.vsub($e.position,Qe.ri),Qe.rj.vadd(ke,Qe.rj),Qe.rj.vsub(Je.position,Qe.rj),this.result.push(Qe),nt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Qe,this.frictionResult)}}this.enableFrictionReduction&&nt&&this.createFrictionFromAverage(nt)};var De=new l,Xe=new l;p.prototype[a.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(Ae,Ce,Be,ke,Et,rt,$e,Je,Ee,We,nt,ht){var Ze=De;if(!(Be.distanceTo(ke)>Ae.boundingSphereRadius+Ce.boundingSphereRadius)&&Ae.findSeparatingAxis(Ce,Be,Et,ke,rt,Ze,nt,ht)){var He=[],Qe=Xe;Ae.clipAgainstHull(Be,Et,Ce,ke,rt,Ze,-100,100,He);for(var xt=0,It=0;It!==He.length;It++){var Ue=this.createContactEquation($e,Je,Ae,Ce,Ee,We),U=Ue.ri,he=Ue.rj;Ze.negate(Ue.ni),He[It].normal.negate(Qe),Qe.mult(He[It].depth,Qe),He[It].point.vadd(Qe,U),he.copy(He[It].point),U.vsub(Be,U),he.vsub(ke,he),U.vadd(Be,U),U.vsub($e.position,U),he.vadd(ke,he),he.vsub(Je.position,he),this.result.push(Ue),xt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Ue,this.frictionResult)}this.enableFrictionReduction&&xt&&this.createFrictionFromAverage(xt)}};var dt=new l,at=new l,qe=new l;p.prototype[a.types.PLANE|a.types.PARTICLE]=p.prototype.planeParticle=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=dt;Ee.set(0,0,1),$e.quaternion.vmult(Ee,Ee);var We=at;ke.vsub($e.position,We);var nt=Ee.dot(We);if(nt<=0){var ht=this.createContactEquation(Je,$e,Ce,Ae);ht.ni.copy(Ee),ht.ni.negate(ht.ni),ht.ri.set(0,0,0);var Ze=qe;Ee.mult(Ee.dot(ke),Ze),ke.vsub(Ze,Ze),ht.rj.copy(Ze),this.result.push(ht),this.createFrictionEquationsFromContact(ht,this.frictionResult)}};var bt=new l;p.prototype[a.types.PARTICLE|a.types.SPHERE]=p.prototype.sphereParticle=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=bt;Ee.set(0,0,1),ke.vsub(Be,Ee);var We=Ee.norm2();if(We<=Ae.radius*Ae.radius){var nt=this.createContactEquation(Je,$e,Ce,Ae);Ee.normalize(),nt.rj.copy(Ee),nt.rj.mult(Ae.radius,nt.rj),nt.ni.copy(Ee),nt.ni.negate(nt.ni),nt.ri.set(0,0,0),this.result.push(nt),this.createFrictionEquationsFromContact(nt,this.frictionResult)}};var pe=new u,Ne=new l;new l;var Ge=new l,st=new l,Fe=new l;p.prototype[a.types.PARTICLE|a.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=-1,We=Ge,nt=Fe,ht=null,Ze=Ne;if(Ze.copy(ke),Ze.vsub(Be,Ze),Et.conjugate(pe),pe.vmult(Ze,Ze),Ae.pointIsInside(Ze)){Ae.worldVerticesNeedsUpdate&&Ae.computeWorldVertices(Be,Et),Ae.worldFaceNormalsNeedsUpdate&&Ae.computeWorldFaceNormals(Et);for(var He=0,Qe=Ae.faces.length;He!==Qe;He++){var xt=[Ae.worldVertices[Ae.faces[He][0]]],It=Ae.worldFaceNormals[He];ke.vsub(xt[0],st);var Ue=-It.dot(st);(ht===null||Math.abs(Ue)<Math.abs(ht))&&(ht=Ue,Ee=He,We.copy(It))}if(Ee!==-1){var U=this.createContactEquation(Je,$e,Ce,Ae);We.mult(ht,nt),nt.vadd(ke,nt),nt.vsub(Be,nt),U.rj.copy(nt),We.negate(U.ni),U.ri.set(0,0,0);var he=U.ri,Se=U.rj;he.vadd(ke,he),he.vsub(Je.position,he),Se.vadd(Be,Se),Se.vsub($e.position,Se),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},p.prototype[a.types.BOX|a.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(Ae,Ce,Be,ke,Et,rt,$e,Je){Ae.convexPolyhedronRepresentation.material=Ae.material,Ae.convexPolyhedronRepresentation.collisionResponse=Ae.collisionResponse,this.convexHeightfield(Ae.convexPolyhedronRepresentation,Ce,Be,ke,Et,rt,$e,Je)};var Re=new l,pt=new l,Tt=[0];p.prototype[a.types.CONVEXPOLYHEDRON|a.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=Ce.data,We=Ce.elementSize,nt=Ae.boundingSphereRadius,ht=pt,Ze=Tt,He=Re;c.pointToLocalFrame(ke,rt,Be,He);var Qe=Math.floor((He.x-nt)/We)-1,xt=Math.ceil((He.x+nt)/We)+1,It=Math.floor((He.y-nt)/We)-1,Ue=Math.ceil((He.y+nt)/We)+1;if(!(xt<0||Ue<0||Qe>Ee.length||It>Ee[0].length)){Qe<0&&(Qe=0),xt<0&&(xt=0),It<0&&(It=0),Ue<0&&(Ue=0),Qe>=Ee.length&&(Qe=Ee.length-1),xt>=Ee.length&&(xt=Ee.length-1),Ue>=Ee[0].length&&(Ue=Ee[0].length-1),It>=Ee[0].length&&(It=Ee[0].length-1);var U=[];Ce.getRectMinMax(Qe,It,xt,Ue,U);var he=U[0],Se=U[1];if(!(He.z-nt>Se||He.z+nt<he))for(var be=Qe;be<xt;be++)for(var _e=It;_e<Ue;_e++)Ce.getConvexTrianglePillar(be,_e,!1),c.pointToWorldFrame(ke,rt,Ce.pillarOffset,ht),Be.distanceTo(ht)<Ce.pillarConvex.boundingSphereRadius+Ae.boundingSphereRadius&&this.convexConvex(Ae,Ce.pillarConvex,Be,ht,Et,rt,$e,Je,null,null,Ze,null),Ce.getConvexTrianglePillar(be,_e,!0),c.pointToWorldFrame(ke,rt,Ce.pillarOffset,ht),Be.distanceTo(ht)<Ce.pillarConvex.boundingSphereRadius+Ae.boundingSphereRadius&&this.convexConvex(Ae,Ce.pillarConvex,Be,ht,Et,rt,$e,Je,null,null,Ze,null)}};var Jt=new l,Ct=new l;p.prototype[a.types.SPHERE|a.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(Ae,Ce,Be,ke,Et,rt,$e,Je){var Ee=Ce.data,We=Ae.radius,nt=Ce.elementSize,ht=Ct,Ze=Jt;c.pointToLocalFrame(ke,rt,Be,Ze);var He=Math.floor((Ze.x-We)/nt)-1,Qe=Math.ceil((Ze.x+We)/nt)+1,xt=Math.floor((Ze.y-We)/nt)-1,It=Math.ceil((Ze.y+We)/nt)+1;if(!(Qe<0||It<0||He>Ee.length||It>Ee[0].length)){He<0&&(He=0),Qe<0&&(Qe=0),xt<0&&(xt=0),It<0&&(It=0),He>=Ee.length&&(He=Ee.length-1),Qe>=Ee.length&&(Qe=Ee.length-1),It>=Ee[0].length&&(It=Ee[0].length-1),xt>=Ee[0].length&&(xt=Ee[0].length-1);var Ue=[];Ce.getRectMinMax(He,xt,Qe,It,Ue);var U=Ue[0],he=Ue[1];if(!(Ze.z-We>he||Ze.z+We<U))for(var Se=this.result,be=He;be<Qe;be++)for(var _e=xt;_e<It;_e++){var Te=Se.length;Ce.getConvexTrianglePillar(be,_e,!1),c.pointToWorldFrame(ke,rt,Ce.pillarOffset,ht),Be.distanceTo(ht)<Ce.pillarConvex.boundingSphereRadius+Ae.boundingSphereRadius&&this.sphereConvex(Ae,Ce.pillarConvex,Be,ht,Et,rt,$e,Je),Ce.getConvexTrianglePillar(be,_e,!0),c.pointToWorldFrame(ke,rt,Ce.pillarOffset,ht),Be.distanceTo(ht)<Ce.pillarConvex.boundingSphereRadius+Ae.boundingSphereRadius&&this.sphereConvex(Ae,Ce.pillarConvex,Be,ht,Et,rt,$e,Je);var je=Se.length-Te;if(je>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,n,s){n.exports=g;var r=t("../shapes/Shape"),a=t("../math/Vec3"),o=t("../math/Quaternion"),l=t("../solver/GSSolver");t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation");var c=t("./Narrowphase"),u=t("../utils/EventTarget"),d=t("../collision/ArrayCollisionMatrix"),h=t("../material/Material"),f=t("../material/ContactMaterial"),p=t("../objects/Body"),m=t("../utils/TupleDictionary"),_=t("../collision/RaycastResult"),v=t("../collision/AABB"),x=t("../collision/Ray"),y=t("../collision/NaiveBroadphase");function g(){u.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new a,this.broadphase=new y,this.bodies=[],this.solver=new l,this.constraints=[],this.narrowphase=new c(this),this.collisionMatrix=new d,this.collisionMatrixPrevious=new d,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new m,this.defaultMaterial=new h("default"),this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}g.prototype=new u,new v;var w=new x;if(g.prototype.getContactMaterial=function(O,re){return this.contactMaterialTable.get(O.id,re.id)},g.prototype.numObjects=function(){return this.bodies.length},g.prototype.collisionMatrixTick=function(){var O=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=O,this.collisionMatrix.reset()},g.prototype.add=g.prototype.addBody=function(O){this.bodies.indexOf(O)===-1&&(O.index=this.bodies.length,this.bodies.push(O),O.world=this,O.initPosition.copy(O.position),O.initVelocity.copy(O.velocity),O.timeLastSleepy=this.time,O instanceof p&&(O.initAngularVelocity.copy(O.angularVelocity),O.initQuaternion.copy(O.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=O,this.dispatchEvent(this.addBodyEvent))},g.prototype.addConstraint=function(O){this.constraints.push(O)},g.prototype.removeConstraint=function(O){var re=this.constraints.indexOf(O);re!==-1&&this.constraints.splice(re,1)},g.prototype.rayTest=function(O,re,le){le instanceof _?this.raycastClosest(O,re,{skipBackfaces:!0},le):this.raycastAll(O,re,{skipBackfaces:!0},le)},g.prototype.raycastAll=function(O,re,le,Z){return le.mode=x.ALL,le.from=O,le.to=re,le.callback=Z,w.intersectWorld(this,le)},g.prototype.raycastAny=function(O,re,le,Z){return le.mode=x.ANY,le.from=O,le.to=re,le.result=Z,w.intersectWorld(this,le)},g.prototype.raycastClosest=function(O,re,le,Z){return le.mode=x.CLOSEST,le.from=O,le.to=re,le.result=Z,w.intersectWorld(this,le)},g.prototype.remove=function(O){O.world=null;var re=this.bodies.length-1,le=this.bodies,Z=le.indexOf(O);if(Z!==-1){le.splice(Z,1);for(var ne=0;ne!==le.length;ne++)le[ne].index=ne;this.collisionMatrix.setNumObjects(re),this.removeBodyEvent.body=O,this.dispatchEvent(this.removeBodyEvent)}},g.prototype.removeBody=g.prototype.remove,g.prototype.addMaterial=function(O){this.materials.push(O)},g.prototype.addContactMaterial=function(O){this.contactmaterials.push(O),this.contactMaterialTable.set(O.materials[0].id,O.materials[1].id,O)},typeof performance>"u"&&(performance={}),!performance.now){var b=Date.now();performance.timing&&performance.timing.navigationStart&&(b=performance.timing.navigationStart),performance.now=function(){return Date.now()-b}}var T=new a;g.prototype.step=function(O,re,le){if(le=le||10,re=re||0,re===0)this.internalStep(O),this.time+=O;else{var Z=Math.floor((this.time+re)/O)-Math.floor(this.time/O);Z=Math.min(Z,le);for(var ne=performance.now(),j=0;j!==Z&&(this.internalStep(O),!(performance.now()-ne>O*1e3));j++);this.time+=re;for(var ee=this.time%O,F=ee/O,X=T,Q=this.bodies,ue=0;ue!==Q.length;ue++){var ce=Q[ue];ce.type!==p.STATIC&&ce.sleepState!==p.SLEEPING?(ce.position.vsub(ce.previousPosition,X),X.scale(F,X),ce.position.vadd(X,ce.interpolatedPosition)):(ce.interpolatedPosition.copy(ce.position),ce.interpolatedQuaternion.copy(ce.quaternion))}}};var E={type:"postStep"},S={type:"preStep"},M={type:"collide",body:null,contact:null},A=[],C=[],I=[],H=[];new a,new a,new a,new a,new a,new a,new a,new a,new a,new o;var W=new o,z=new o,q=new a;g.prototype.internalStep=function(O){this.dt=O;var re=this.contacts,le=I,Z=H,ne=this.numObjects(),j=this.bodies,ee=this.solver,F=this.gravity,X=this.doProfiling,Q=this.profile,ue=p.DYNAMIC,ce,xe=this.constraints,Me=C;F.norm();var Y=F.x,P=F.y,R=F.z,N=0;for(X&&(ce=performance.now()),N=0;N!==ne;N++){var $=j[N];if($.type&ue){var ie=$.force,ye=$.mass;ie.x+=ye*Y,ie.y+=ye*P,ie.z+=ye*R}}for(var N=0,ve=this.subsystems.length;N!==ve;N++)this.subsystems[N].update();X&&(ce=performance.now()),le.length=0,Z.length=0,this.broadphase.collisionPairs(this,le,Z),X&&(Q.broadphase=performance.now()-ce);var De=xe.length;for(N=0;N!==De;N++){var k=xe[N];if(!k.collideConnected)for(var V=le.length-1;V>=0;V-=1)(k.bodyA===le[V]&&k.bodyB===Z[V]||k.bodyB===le[V]&&k.bodyA===Z[V])&&(le.splice(V,1),Z.splice(V,1))}this.collisionMatrixTick(),X&&(ce=performance.now());var de=A,D=re.length;for(N=0;N!==D;N++)de.push(re[N]);re.length=0;var L=this.frictionEquations.length;for(N=0;N!==L;N++)Me.push(this.frictionEquations[N]);this.frictionEquations.length=0,this.narrowphase.getContacts(le,Z,this,re,de,this.frictionEquations,Me),X&&(Q.narrowphase=performance.now()-ce),X&&(ce=performance.now());for(var N=0;N<this.frictionEquations.length;N++)ee.addEquation(this.frictionEquations[N]);for(var J=re.length,K=0;K!==J;K++){var k=re[K],$=k.bi,te=k.bj;k.si,k.sj;var me;if($.material&&te.material?me=this.getContactMaterial($.material,te.material)||this.defaultContactMaterial:me=this.defaultContactMaterial,me.friction,$.material&&te.material&&($.material.friction>=0&&te.material.friction>=0&&$.material.friction*te.material.friction,$.material.restitution>=0&&te.material.restitution>=0&&(k.restitution=$.material.restitution*te.material.restitution)),ee.addEquation(k),$.allowSleep&&$.type===p.DYNAMIC&&$.sleepState===p.SLEEPING&&te.sleepState===p.AWAKE&&te.type!==p.STATIC){var Ie=te.velocity.norm2()+te.angularVelocity.norm2(),Pe=Math.pow(te.sleepSpeedLimit,2);Ie>=Pe*2&&($._wakeUpAfterNarrowphase=!0)}if(te.allowSleep&&te.type===p.DYNAMIC&&te.sleepState===p.SLEEPING&&$.sleepState===p.AWAKE&&$.type!==p.STATIC){var Ke=$.velocity.norm2()+$.angularVelocity.norm2(),Ye=Math.pow($.sleepSpeedLimit,2);Ke>=Ye*2&&(te._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set($,te,!0),this.collisionMatrixPrevious.get($,te)||(M.body=te,M.contact=k,$.dispatchEvent(M),M.body=$,te.dispatchEvent(M))}for(X&&(Q.makeContactConstraints=performance.now()-ce,ce=performance.now()),N=0;N!==ne;N++){var $=j[N];$._wakeUpAfterNarrowphase&&($.wakeUp(),$._wakeUpAfterNarrowphase=!1)}var De=xe.length;for(N=0;N!==De;N++){var k=xe[N];k.update();for(var V=0,Xe=k.equations.length;V!==Xe;V++){var dt=k.equations[V];ee.addEquation(dt)}}ee.solve(O,this),X&&(Q.solve=performance.now()-ce),ee.removeAllEquations();var at=Math.pow;for(N=0;N!==ne;N++){var $=j[N];if($.type&ue){var qe=at(1-$.linearDamping,O),bt=$.velocity;bt.mult(qe,bt);var pe=$.angularVelocity;if(pe){var Ne=at(1-$.angularDamping,O);pe.mult(Ne,pe)}}}for(this.dispatchEvent(S),N=0;N!==ne;N++){var $=j[N];$.preStep&&$.preStep.call($)}X&&(ce=performance.now());var Ge=W,st=z,Fe=this.stepnumber,Re=p.DYNAMIC|p.KINEMATIC,pt=Fe%(this.quatNormalizeSkip+1)===0,Tt=this.quatNormalizeFast,Jt=O*.5;for(r.types.PLANE,r.types.CONVEXPOLYHEDRON,N=0;N!==ne;N++){var Ct=j[N],Ae=Ct.force,Ce=Ct.torque;if(Ct.type&Re&&Ct.sleepState!==p.SLEEPING){var Be=Ct.velocity,ke=Ct.angularVelocity,Et=Ct.position,rt=Ct.quaternion,$e=Ct.invMass,Je=Ct.invInertiaWorld;Be.x+=Ae.x*$e*O,Be.y+=Ae.y*$e*O,Be.z+=Ae.z*$e*O,Ct.angularVelocity&&(Je.vmult(Ce,q),q.mult(O,q),q.vadd(ke,ke)),Et.x+=Be.x*O,Et.y+=Be.y*O,Et.z+=Be.z*O,Ct.angularVelocity&&(Ge.set(ke.x,ke.y,ke.z,0),Ge.mult(rt,st),rt.x+=Jt*st.x,rt.y+=Jt*st.y,rt.z+=Jt*st.z,rt.w+=Jt*st.w,pt&&(Tt?rt.normalizeFast():rt.normalize())),Ct.aabb&&(Ct.aabbNeedsUpdate=!0),Ct.updateInertiaWorld&&Ct.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,X&&(Q.integrate=performance.now()-ce),this.time+=O,this.stepnumber+=1,this.dispatchEvent(E),N=0;N!==ne;N++){var $=j[N],Ee=$.postStep;Ee&&Ee.call($)}if(this.allowSleep)for(N=0;N!==ne;N++)j[N].sleepTick(this.time)},g.prototype.clearForces=function(){for(var O=this.bodies,re=O.length,le=0;le!==re;le++){var Z=O[le];Z.force,Z.torque,Z.force.set(0,0,0),Z.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(Eb);var ss=Eb.exports;class hB{constructor(){this.world=new ss.World,this.world.gravity.set(0,-9.82,0),this.world.broadphase=new ss.NaiveBroadphase,this.world.solver.iterations=10,this.legoMaterial=new ss.Material("lego"),this.legoContactMaterial=new ss.ContactMaterial(this.legoMaterial,this.legoMaterial,{friction:.8,restitution:.1,contactEquationStiffness:1e6,contactEquationRelaxation:4}),this.world.addContactMaterial(this.legoContactMaterial),this.groundMaterial=new ss.Material("ground");const e=new ss.ContactMaterial(this.groundMaterial,this.legoMaterial,{friction:.9,restitution:.05});this.world.addContactMaterial(e),this.bodies=new Map,this.timeStep=1/60}addBrick(e,t={}){const{mass:n=.05,position:s={x:0,y:0,z:0}}=t,r=this.createBrickShape(e),a=new ss.Body({mass:n,shape:r});return a.position.set(s.x,s.y,s.z),a.material=this.legoMaterial,a.userData={brick:e},this.world.add(a),this.bodies.set(e,a),a}createBrickShape(e){const t=e.userData.width||2,n=e.userData.height||2;return new ss.Box(new ss.Vec3(t*.4,.48,n*.4))}addGround(e){const t=new ss.Plane,n=new ss.Body({mass:0,shape:t});return n.quaternion.setFromAxisAngle(new ss.Vec3(1,0,0),-Math.PI/2),n.position.set(0,-.5,0),n.material=this.groundMaterial,this.world.add(n),this.bodies.set(e,n),n}update(){this.world.step(this.timeStep),this.bodies.forEach((e,t)=>{t.position&&(t.position.copy(e.position),t.quaternion.copy(e.quaternion))})}removeBrick(e){const t=this.bodies.get(e);t&&(this.world.remove(t),this.bodies.delete(e))}applyForce(e,t,n=null){const s=this.bodies.get(e);s&&(n?s.applyForce(t,n):s.applyForce(t,s.position))}setBrickPosition(e,t){const n=this.bodies.get(e);n&&(n.position.set(t.x,t.y,t.z),n.velocity.set(0,0,0))}setPhysicsEnabled(e,t){const n=this.bodies.get(e);n&&(t?(this.world.add(n),n.mass=.05,n.updateMassProperties()):this.world.remove(n))}}function fB(i,e=!1){const t=i[0].index!==null,n=new Set(Object.keys(i[0].attributes)),s=new Set(Object.keys(i[0].morphAttributes)),r={},a={},o=i[0].morphTargetsRelative,l=new Bs;let c=0;for(let u=0;u<i.length;++u){const d=i[u];let h=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in d.attributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;r[f]===void 0&&(r[f]=[]),r[f].push(d.attributes[f]),h++}if(h!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in d.morphAttributes){if(!s.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(d.morphAttributes[f])}if(e){let f;if(t)f=d.index.count;else if(d.attributes.position!==void 0)f=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,u),c+=f}}if(t){let u=0;const d=[];for(let h=0;h<i.length;++h){const f=i[h].index;for(let p=0;p<f.count;++p)d.push(f.getX(p)+u);u+=i[h].attributes.position.count}l.setIndex(d)}for(const u in r){const d=Zg(r[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,d)}for(const u in a){const d=a[u][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let h=0;h<d;++h){const f=[];for(let m=0;m<a[u].length;++m)f.push(a[u][m][h]);const p=Zg(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(p)}}return l}function Zg(i){let e,t,n,s=-1,r=0;for(let c=0;c<i.length;++c){const u=i[c];if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=u.itemSize),t!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=u.normalized),n!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=u.gpuType),s!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=u.count*t}const a=new e(r),o=new Rs(a,t,n);let l=0;for(let c=0;c<i.length;++c){const u=i[c];if(u.isInterleavedBufferAttribute){const d=l/t;for(let h=0,f=u.count;h<f;h++)for(let p=0;p<t;p++){const m=u.getComponent(h,p);o.setComponent(h+d,p,m)}}else a.set(u.array,l);l+=u.count*t}return s!==void 0&&(o.gpuType=s),o}const Wt={RED:"#D40000",BLUE:"#0055BF",YELLOW:"#FFD500",GREEN:"#00852B",ORANGE:"#FF8C00",PURPLE:"#800080",PINK:"#ED3CCA",WHITE:"#FFFFFF",BRIGHT_GREEN:"#00C000",BROWN:"#6B4423",BLACK:"#000000",GRAY:"#808080"},rs={RED:"#FF4444",BLUE:"#3399FF",YELLOW:"#FFFF00",GREEN:"#00FF00",ORANGE:"#FFCC33",PURPLE:"#CC66FF",PINK:"#FF66CC",WHITE:"#8a8a8a",BRIGHT_GREEN:"#66FF66",BROWN:"#CC8833",BLACK:"#808080",GRAY:"#bdbdbd"};function Hi(i,e=!1){return vD(i,e)}Hi(Wt.RED),Hi(Wt.BLUE),Hi(Wt.YELLOW),Hi(Wt.GREEN),Hi(Wt.ORANGE),Hi(Wt.PURPLE),Hi(Wt.PINK),Hi(Wt.WHITE),Hi(Wt.BRIGHT_GREEN),Hi(Wt.BROWN),Hi(Wt.BLACK),Hi(Wt.GRAY);const Fn=.8,Vo=.48,ja=.18;class ho{constructor(e,t,n="red",s=!1){this.width=e,this.length=t,this.color=n,this.isGlass=s,this.mesh=null,this.studPositions=[],this.blockHeight=Sb,this.blockType="brick"}createBrick(e=!0){const t=new Zn,n=this.createMaterial();if(e){const s=[],r=this.createBodyGeometry();s.push(r);for(let l=0;l<this.width;l++)for(let c=0;c<this.length;c++){const u=new ul(Vo/2,Vo/2,ja,16),d=(l-(this.width-1)/2)*Fn,h=(c-(this.length-1)/2)*Fn,f=this.blockHeight/2+ja/2+.001;u.translate(d,f,h),s.push(u),this.studPositions.push(new fe(d,f,h))}const a=fB(s),o=new yn(a,n);o.castShadow=!0,o.receiveShadow=!0,t.add(o)}else{const s=this.createBodyGeometry(),r=new yn(s,n);r.castShadow=!0,r.receiveShadow=!0,t.add(r),this.createStuds(t)}return t.userData.width=this.width,t.userData.length=this.length,t.userData.blockHeight=this.blockHeight,t.userData.blockType=this.blockType,t.userData.color=this.color,t.userData.isGlass=this.isGlass,t.userData.isBrick=!0,t.userData.type=this.getType(),t.userData.brick=this,this.mesh=t,t}getType(){return`${this.width}x${this.length}`}createBodyGeometry(){const e=this.width*Fn-.001,t=this.length*Fn-.001,n=this.blockHeight;return new ji(e,n,t)}createMaterial(){const t={red:Wt.RED,blue:Wt.BLUE,yellow:Wt.YELLOW,green:Wt.GREEN,orange:Wt.ORANGE,purple:Wt.PURPLE,pink:Wt.PINK,white:Wt.WHITE,brightGreen:Wt.BRIGHT_GREEN,brown:Wt.BROWN,black:Wt.BLACK,gray:Wt.GRAY}[this.color]||this.color;return Hi(t,this.isGlass)}createStuds(e){for(let t=0;t<this.width;t++)for(let n=0;n<this.length;n++){const s=new ul(Vo/2,Vo/2,ja,16),r=this.createMaterial(),a=new yn(s,r);a.castShadow=!0,a.receiveShadow=!0;const o=(t-(this.width-1)/2)*Fn,l=(n-(this.length-1)/2)*Fn,c=this.blockHeight/2+ja/2+.001;a.position.set(o,c,l),a.userData={type:"stud",brick:this},e.add(a),this.studPositions.push(new fe(o,c,l))}}getStudPositions(){return this.mesh?this.studPositions.map(e=>{const t=e.clone();return t.applyMatrix4(this.mesh.matrixWorld),t}):[]}}class Km{constructor(e){this.scene=e,this.raycaster=new Gm,this.blocks=[],this.platformSize=20}setPlatformSize(e){this.platformSize=e}isWithinPlatformBounds(e,t){var h,f;const n=((h=e.userData)==null?void 0:h.width)||1,s=((f=e.userData)==null?void 0:f.length)||1,r=this.platformSize*Ft/2,a=(n-1)*Ft/2,o=(s-1)*Ft/2,l=t.x-a,c=t.x+a,u=t.z-o,d=t.z+o;return l>=-r&&c<=r&&u>=-r&&d<=r}getStudPositions(e,t){var s,r,a;const n=[];if(e.traverse(o=>{if(o.isMesh&&o.userData.type==="stud"){const l=new fe;o.getWorldPosition(l),n.push(l)}}),n.length===0){const o=((s=e.userData)==null?void 0:s.width)||1,l=((r=e.userData)==null?void 0:r.length)||1,c=((a=e.userData)==null?void 0:a.blockHeight)||.96;for(let u=0;u<o;u++)for(let d=0;d<l;d++){const h=new fe;h.x=t.x+(u-(o-1)/2)*Ft,h.z=t.z+(d-(l-1)/2)*Ft,h.y=t.y-c/2,n.push(h)}}return n}findPlacementHeight(e,t){let n=!1;e.traverse(h=>{if(h.isMesh&&h.userData.type==="stud"){n=!1;return}});let s=!1;e.traverse(h=>{h.isMesh&&h.userData.type==="stud"&&(s=!0)}),n=!s;const r=e.position.clone(),a=e.matrixWorld.clone();e.position.copy(t),e.updateMatrixWorld(!0);const o=this.getStudPositions(e,t);e.position.copy(r),e.matrixWorld.copy(a);const l=e.userData.blockHeight||.96;let c=0,u=0,d=1/0;for(let h=0;h<o.length;h++){const f=o[h],p=new fe(f.x,100,f.z),m=new fe(0,-1,0);this.raycaster.set(p,m);const _=this.blocks.filter(x=>x!==e),v=this.raycaster.intersectObjects(_,!0);if(v.length>0){let x=!1;for(const y of v){let w=y.object;for(;w.parent&&!w.userData.isBrick;)w=w.parent;if(!w.userData.isBrick)continue;const b=this.getStudPositions(w,w.position);let T=!1;if(w.traverse(A=>{A.isMesh&&A.userData.type==="stud"&&(T=!0)}),!T){const A=w.userData.blockHeight||.96,C=w.position.y+A/2;d=Math.min(d,C);continue}if(b.length===0)continue;const E=y.point,S=w.userData.blockHeight||.96,M=w.position.y+S/2+ja/2;n&&f.y;for(const A of b){const C=Math.abs(E.x-A.x),I=Math.abs(E.z-A.z);if(C<Vo/2&&I<Vo/2){let H=!1;if(n){const W=w.position.y+S/2,z=E.y-W;H=z>=-.1&&z<=ja+.1}else H=Math.abs(E.y-M)<ja;if(H){const W=w.position.y+S/2;if(n){const z=W+l/2;c=Math.max(c,z)}else c=Math.max(c,W);u++,x=!0;break}}}if(x)break}}}if(u>0||c===0){let h;return n?u>0?h=c:h=l/2:h=c===0?l/2:c+l/2,d!==1/0&&h-l/2<d?null:h}return null}hasSupport(e,t){const n=this.blocks.includes(e);let s=-1;n&&(s=this.blocks.indexOf(e),this.blocks.splice(s,1));try{const r=e.position&&e.position.y!==void 0&&e.position.y!==0?e.position.clone():new fe(t.x,t.y,t.z),a=e.userData.blockHeight||.96,o=r.y+a/2,l=new fe(r.x,o+.1,r.z),c=new fe(0,-1,0);this.raycaster.set(l,c);const u=this.blocks,d=this.raycaster.intersectObjects(u,!0),h=this.scene.children.filter(_=>_.userData.isBasePlate||_.userData.isGround),f=this.raycaster.intersectObjects(h,!0),p=[...d,...f].sort((_,v)=>_.distance-v.distance);if(p.length>0){const v=p[0].object;if(v.userData.isBasePlate||v.userData.isGround){const y=r.y-a/2;return y>=-.01&&y<=.01}let x=v;for(;x.parent&&!x.userData.isBrick;)x=x.parent;if(x.userData.isBrick&&x!==e)return!0}const m=r.y-a/2;return m>=-.01&&m<=.01}finally{n&&s!==-1&&this.blocks.splice(s,0,e)}}snapToGrid(e,t=null,n=null){let s=Math.round(e.x/Ft)*Ft,r=Math.round(e.z/Ft)*Ft;const a=(o,l)=>{const c=Math.abs(o-l);return Math.abs(c-Ft/2)<.01?o:Math.abs(o-l)<.01||o>=l?l+Ft/2:l-Ft/2};if(t===1&&n===1){const o=e.x,l=e.z,c=Math.round(o/Ft)*Ft,u=Math.round(l/Ft)*Ft;s=a(o,c),r=a(l,u)}else if(t===1&&n>1){const o=e.x,l=Math.round(o/Ft)*Ft;if(s=a(o,l),n%2===1){const c=e.z,u=Math.round(c/Ft)*Ft;r=a(c,u)}else r=Math.round(e.z/Ft)*Ft}else if(n===1&&t>1){const o=e.z,l=Math.round(o/Ft)*Ft;if(r=a(o,l),t%2===1){const c=e.x,u=Math.round(c/Ft)*Ft;s=a(c,u)}else s=Math.round(e.x/Ft)*Ft}else if(t>1&&n>1){if(t%2===1){const o=e.x,l=Math.round(o/Ft)*Ft;s=a(o,l)}else s=Math.round(e.x/Ft)*Ft;if(n%2===1){const o=e.z,l=Math.round(o/Ft)*Ft;r=a(o,l)}else r=Math.round(e.z/Ft)*Ft}return new fe(s,e.y,r)}placeBlock(e,t,n=!1){var f,p,m;const s=((f=e.userData)==null?void 0:f.width)||1,r=((p=e.userData)==null?void 0:p.length)||1,a=this.snapToGrid(t,s,r);if(!((m=e.userData)!=null&&m.isBasePlate)&&!this.isWithinPlatformBounds(e,a))return!1;const o=e.userData.isMinifigure||e.userData.specialType==="minifigure";let l=a.clone();o&&t.y>1&&(l.y=Math.max(0,a.y-As));const c=this.blocks.includes(e);if(c&&n){const _=this.blocks.indexOf(e);this.blocks.splice(_,1);const v=this.findPlacementHeight(e,l);if(v===null)return this.blocks.splice(_,0,e),!1;this.blocks.splice(_,0,e);let x=v+.001;return(e.userData.isMinifigure||e.userData.specialType==="minifigure")&&(x+=As),e.position.set(a.x,x,a.z),!0}if(!c&&n){const _=this.findPlacementHeight(e,l);if(_===null)return!1;let v=_+.001;return(e.userData.isMinifigure||e.userData.specialType==="minifigure")&&(v+=As),e.position.set(a.x,v,a.z),this.blocks.push(e),!0}let u=this.findPlacementHeight(e,l),d=a;if(u===null){const _=this.findNearestValidPosition(e,l);if(_&&this.isWithinPlatformBounds(e,_))d=new fe(_.x,_.y,_.z),u=_.y-.001;else return!1}let h=u+.001;return o&&(h+=As),e.position.set(d.x,h,d.z),this.blocks.includes(e)||this.blocks.push(e),!0}removeBlock(e,t=!0){const n=this.blocks.indexOf(e);n>-1&&this.blocks.splice(n,1),t&&this.updateBlocksAbove(e.position)}updateBlocksAbove(e,t=null){this.blocks.filter(n=>{if(n===t)return!1;const s=Math.abs(n.position.x-e.x),r=Math.abs(n.position.z-e.z);return n.position.y-e.y>0&&s<5*Ft&&r<5*Ft})}findNearestValidPosition(e,t,n=3){var l,c;const s=((l=e.userData)==null?void 0:l.width)||1,r=((c=e.userData)==null?void 0:c.length)||1,a=this.snapToGrid(t,s,r);let o=this.findPlacementHeight(e,a);if(o!==null)return new fe(a.x,o+.001,a.z);for(let u=1;u<=n;u++)for(let d=-u;d<=u;d++)for(let h=-u;h<=u;h++){if(Math.abs(d)<u&&Math.abs(h)<u||d===0&&h===0)continue;const f=new fe(a.x+d*Ft,a.y,a.z+h*Ft),p=this.snapToGrid(f,s,r);if(this.isWithinPlatformBounds(e,p)&&(o=this.findPlacementHeight(e,p),o!==null))return new fe(p.x,o+.001,p.z)}return null}getPreviewPosition(e,t){var u,d,h;const n=((u=e.userData)==null?void 0:u.width)||1,s=((d=e.userData)==null?void 0:d.length)||1,r=this.snapToGrid(t,n,s);if(!((h=e.userData)!=null&&h.isBasePlate)&&!this.isWithinPlatformBounds(e,r))return new fe(r.x,.5,r.z);const a=this.blocks.includes(e);let o=-1;a&&(o=this.blocks.indexOf(e),this.blocks.splice(o,1));let l=null,c=r;if(a){if(l=this.findPlacementHeight(e,r),l===null)return o!==-1&&this.blocks.splice(o,0,e),new fe(r.x,.5,r.z)}else if(l=this.findPlacementHeight(e,r),l===null){const f=this.findNearestValidPosition(e,r);if(f)c=new fe(f.x,f.y,f.z),l=f.y-.001;else return o!==-1&&this.blocks.splice(o,0,e),new fe(r.x,.5,r.z)}return a&&o!==-1&&this.blocks.splice(o,0,e),new fe(c.x,l+.001,c.z)}isValidPosition(e,t){var c,u;const n=((c=e.userData)==null?void 0:c.width)||1,s=((u=e.userData)==null?void 0:u.length)||1,r=this.snapToGrid(t,n,s),a=this.blocks.includes(e);let o=-1;a&&(o=this.blocks.indexOf(e),this.blocks.splice(o,1));let l=this.findPlacementHeight(e,r);if(l===null){const d=this.findNearestValidPosition(e,r);l=d?d.y-.001:null}return a&&o!==-1&&this.blocks.splice(o,0,e),l!==null}clear(){this.blocks=[]}getAllBlocks(){return this.blocks}}class nh{constructor(e){this.scene=e,this.originalMaterials=new Map,this.ghostMaterials=new Map,this.raycastLines=[]}showGhost(e,t,n){e.traverse(s=>{if(s.isMesh&&s.material&&!s.userData.doNotModify){if(this.originalMaterials.has(s)||this.originalMaterials.set(s,s.material),!this.ghostMaterials.has(s)){const a=this.originalMaterials.get(s);let o;Array.isArray(a)?o=a.map(l=>{const c=l.clone();return c.transparent=!0,c.opacity=.4,c}):(o=a.clone(),o.transparent=!0,o.opacity=.4),this.ghostMaterials.set(s,o)}const r=this.ghostMaterials.get(s);Array.isArray(r)?r.forEach(a=>{n?a.emissive.setHex(13056):a.emissive.setHex(3342336)}):n?r.emissive.setHex(13056):r.emissive.setHex(3342336),s.material=r}})}hideGhost(e){e.traverse(t=>{if(t.isMesh&&t.material){const n=this.originalMaterials.get(t);n&&(t.material=n)}}),e.traverse(t=>{t.isMesh&&(this.originalMaterials.delete(t),this.ghostMaterials.delete(t))})}showRaycastLines(e,t=!1){if(t){this.clearRaycastLines();for(const n of e){const s=new Bs().setFromPoints([new fe(n.x,n.y+10,n.z),new fe(n.x,0,n.z)]),r=new ub({color:16776960}),a=new QC(s,r);this.scene.add(a),this.raycastLines.push(a)}}}clearRaycastLines(){for(const e of this.raycastLines)this.scene.remove(e);this.raycastLines=[]}}class Sl extends ho{constructor(e="red",t=!1){super(4,4,e,t),this.blockHeight=Mr,this.blockType="plate"}static create(e="red",t=!1,n=!0){return new Sl(e,t).createBrick(n)}}const ro=Object.freeze(Object.defineProperty({__proto__:null,Plate4x4:Sl},Symbol.toStringTag,{value:"Module"}));class Gc extends ho{constructor(e="green"){super(8,8,e),this.blockHeight=Mr,this.blockType="plate"}static create(e="green",t=!1,n=!0){return new Gc(e).createBrick(n)}}class El extends ho{constructor(e="green"){super(16,16,e),this.blockHeight=Mr,this.blockType="plate"}static create(e="green",t=!1,n=!0){return new El(e).createBrick(n)}}class Hc extends ho{constructor(e="green"){super(32,32,e),this.blockHeight=Mr,this.blockType="plate"}static create(e="green",t=!1,n=!0){return new Hc(e).createBrick(n)}}class Wc extends ho{constructor(e="green"){super(20,20,e),this.blockHeight=Mr,this.blockType="plate"}static create(e="green",t=!1,n=!0){return new Wc(e).createBrick(n)}}const pB="modulepreload",mB=function(i,e){return new URL(i,e).href},Jg={},ae=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(c=>{if(c=mB(c,n),c in Jg)return;Jg[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(!!n)for(let p=a.length-1;p>=0;p--){const m=a[p];if(m.href===c&&(!u||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":pB,u||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((p,m)=>{f.addEventListener("load",p),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})};function Zm(i){try{const e=JSON.stringify(i);return`LEGO-SET:${btoa(encodeURIComponent(e))}`}catch(e){throw console.error("Failed to encode set:",e),new Error("Failed to encode set data")}}function Qg(i){try{if(!i||typeof i!="string")throw new Error("Invalid encoded string");if(i.startsWith("LEGO-SET:")){const e=i.substring(9),t=decodeURIComponent(atob(e));return JSON.parse(t)}else try{const e=decodeURIComponent(atob(i));return JSON.parse(e)}catch{return JSON.parse(i)}}catch(e){throw console.error("Failed to decode set:",e),new Error("Failed to decode set data: "+e.message)}}function _B(i){return!i||typeof i!="string"?!1:i.startsWith("LEGO-SET:")||i.length>50&&!i.trim().startsWith("{")}class gd{constructor(e){this.legoScene=e}exportBuild(){const e={platformSize:this.legoScene.platformSize||20,blocks:[]};return this.legoScene.placementManager.getAllBlocks().forEach(t=>{var r;if((r=t.userData)!=null&&r.isBasePlate)return;let n=t.userData.specialType;if(!n){const a=t.userData.type||"2x2";n=`${t.userData.blockType||"brick"}-${a}`}const s={type:n,color:t.userData.color||"red",glass:t.userData.isGlass||!1,position:{x:Math.round(t.position.x*1e3)/1e3,y:Math.round(t.position.y*1e3)/1e3,z:Math.round(t.position.z*1e3)/1e3},rotation:{x:Math.round(t.rotation.x*100)/100,y:Math.round(t.rotation.y*100)/100,z:Math.round(t.rotation.z*100)/100}};e.blocks.push(s)}),JSON.stringify(e,null,2)}async importBuild(e){try{if(!e||typeof e!="string")return!1;let t;if(_B(e))try{t=Qg(e)}catch(s){console.warn("Failed to decode set, trying JSON parse:",s),t=JSON.parse(e)}else try{t=JSON.parse(e)}catch{try{t=Qg(e)}catch{throw new Error("Invalid build data format: not valid JSON or encoded set")}}if(!t.blocks||!Array.isArray(t.blocks))throw new Error("Invalid build data format: missing or invalid blocks array");this.clearAllBlocks();const n=t.platformSize||20;this.legoScene.setPlatformSize&&this.legoScene.setPlatformSize(n);for(const s of t.blocks)await this.createBlockFromData(s);return!0}catch(t){return console.error("Failed to import build:",t),!1}}clearAllBlocks(){[...this.legoScene.bricks].forEach(t=>{this.legoScene.removeBrick(t)}),this.legoScene.placementManager.clear()}async createBlockFromData(e){let t;try{let n=e.type;if(!n)if(e.specialType)n=e.specialType;else if(e.blockType&&e.width&&e.length)n=`${e.blockType}-${e.width}x${e.length}`;else{console.error("Invalid block data:",e);return}switch(n=n.toLowerCase(),n){case"cylinder-1x1":const{Cylinder1x1:o}=await ae(async()=>{const{Cylinder1x1:y}=await import("./Cylinder1x1-CatK-O-Q.js");return{Cylinder1x1:y}},[],import.meta.url);t=o;break;case"cylinder-plate-1x1":const{CylinderPlate1x1:l}=await ae(async()=>{const{CylinderPlate1x1:y}=await import("./CylinderPlate1x1-C9BKk24L.js");return{CylinderPlate1x1:y}},[],import.meta.url);t=l;break;case"cylinder-plate-2x2":const{CylinderPlate2x2:c}=await ae(async()=>{const{CylinderPlate2x2:y}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:y}},[],import.meta.url);t=c;break;case"flat-plate-1x1":const{FlatPlate1x1:u}=await ae(async()=>{const{FlatPlate1x1:y}=await import("./FlatPlate1x1-COVjvhfm.js");return{FlatPlate1x1:y}},[],import.meta.url);t=u;break;case"flat-plate-1x2":const{FlatPlate1x2:d}=await ae(async()=>{const{FlatPlate1x2:y}=await import("./FlatPlate1x2-WO8sp-SC.js");return{FlatPlate1x2:y}},[],import.meta.url);t=d;break;case"flat-plate-1x2-center-stud":const{FlatPlate1x2CenterStud:h}=await ae(async()=>{const{FlatPlate1x2CenterStud:y}=await import("./FlatPlate1x2CenterStud-CgU774Nu.js");return{FlatPlate1x2CenterStud:y}},__vite__mapDeps([0,1]),import.meta.url);t=h;break;case"flat-plate-1x4":const{FlatPlate1x4:f}=await ae(async()=>{const{FlatPlate1x4:y}=await import("./FlatPlate1x4-BhPvU6tM.js");return{FlatPlate1x4:y}},[],import.meta.url);t=f;break;case"minifigure":const{Minifigure:p}=await ae(async()=>{const{Minifigure:y}=await Promise.resolve().then(()=>Ml);return{Minifigure:y}},void 0,import.meta.url);t=p;break;case"side-stud-brick-1x1":const{SideStudBrick1x1:m}=await ae(async()=>{const{SideStudBrick1x1:y}=await import("./SideStudBrick1x1-Bw5mv8V9.js");return{SideStudBrick1x1:y}},__vite__mapDeps([2,3]),import.meta.url);t=m;break;case"corner-brick-1x1":const{CornerBrick1x1:_}=await ae(async()=>{const{CornerBrick1x1:y}=await import("./CornerBrick1x1-2hjvabOl.js");return{CornerBrick1x1:y}},[],import.meta.url);t=_;break;case"stepped-brick-2x2":const{SteppedBrick2x2:v}=await ae(async()=>{const{SteppedBrick2x2:y}=await import("./SteppedBrick2x2-DHsbtfck.js");return{SteppedBrick2x2:y}},[],import.meta.url);t=v;break;default:const x=n.split("-");if(x.length>=2){const y=x[0],g=x.slice(1).join("-"),[w,b]=g.split("x").map(Number);if(!isNaN(w)&&!isNaN(b))switch(`${y.charAt(0).toUpperCase()+y.slice(1)}_${w}X${b}`){case"Brick_1X1":const{Brick1x1:E}=await ae(async()=>{const{Brick1x1:P}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:P}},[],import.meta.url);t=E;break;case"Brick_1X2":const{Brick1x2:S}=await ae(async()=>{const{Brick1x2:P}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:P}},[],import.meta.url);t=S;break;case"Brick_1X3":const{Brick1x3:M}=await ae(async()=>{const{Brick1x3:P}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:P}},[],import.meta.url);t=M;break;case"Brick_1X4":const{Brick1x4:A}=await ae(async()=>{const{Brick1x4:P}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:P}},[],import.meta.url);t=A;break;case"Brick_1X6":const{Brick1x6:C}=await ae(async()=>{const{Brick1x6:P}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:P}},[],import.meta.url);t=C;break;case"Brick_1X8":const{Brick1x8:I}=await ae(async()=>{const{Brick1x8:P}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:P}},[],import.meta.url);t=I;break;case"Brick_1X12":const{Brick1x12:H}=await ae(async()=>{const{Brick1x12:P}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:P}},[],import.meta.url);t=H;break;case"Brick_2X2":const{Brick2x2:W}=await ae(async()=>{const{Brick2x2:P}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:P}},[],import.meta.url);t=W;break;case"Brick_2X3":const{Brick2x3:z}=await ae(async()=>{const{Brick2x3:P}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:P}},[],import.meta.url);t=z;break;case"Brick_2X4":const{Brick2x4:q}=await ae(async()=>{const{Brick2x4:P}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:P}},[],import.meta.url);t=q;break;case"Brick_2X6":const{Brick2x6:O}=await ae(async()=>{const{Brick2x6:P}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:P}},[],import.meta.url);t=O;break;case"Brick_2X8":const{Brick2x8:re}=await ae(async()=>{const{Brick2x8:P}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:P}},[],import.meta.url);t=re;break;case"Plate_1X1":const{Plate1x1:le}=await ae(async()=>{const{Plate1x1:P}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:P}},[],import.meta.url);t=le;break;case"Plate_1X2":const{Plate1x2:Z}=await ae(async()=>{const{Plate1x2:P}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:P}},[],import.meta.url);t=Z;break;case"Plate_1X3":const{Plate1x3:ne}=await ae(async()=>{const{Plate1x3:P}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:P}},[],import.meta.url);t=ne;break;case"Plate_1X4":const{Plate1x4:j}=await ae(async()=>{const{Plate1x4:P}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:P}},[],import.meta.url);t=j;break;case"Plate_1X6":const{Plate1x6:ee}=await ae(async()=>{const{Plate1x6:P}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:P}},[],import.meta.url);t=ee;break;case"Plate_1X8":const{Plate1x8:F}=await ae(async()=>{const{Plate1x8:P}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:P}},[],import.meta.url);t=F;break;case"Plate_2X2":const{Plate2x2:X}=await ae(async()=>{const{Plate2x2:P}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:P}},[],import.meta.url);t=X;break;case"Plate_2X3":const{Plate2x3:Q}=await ae(async()=>{const{Plate2x3:P}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:P}},[],import.meta.url);t=Q;break;case"Plate_2X4":const{Plate2x4:ue}=await ae(async()=>{const{Plate2x4:P}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:P}},[],import.meta.url);t=ue;break;case"Plate_2X6":const{Plate2x6:ce}=await ae(async()=>{const{Plate2x6:P}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:P}},[],import.meta.url);t=ce;break;case"Plate_2X8":const{Plate2x8:xe}=await ae(async()=>{const{Plate2x8:P}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:P}},[],import.meta.url);t=xe;break;case"Plate_4X4":const{Plate4x4:Me}=await ae(async()=>{const{Plate4x4:P}=await Promise.resolve().then(()=>ro);return{Plate4x4:P}},void 0,import.meta.url);t=Me;break;case"Plate_4X8":const{Plate4x8:Y}=await ae(async()=>{const{Plate4x8:P}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:P}},[],import.meta.url);t=Y;break;default:console.warn(`Unknown standard block type: ${n}`);break}else console.warn(`Invalid dimensions in type: ${n}`)}else console.warn(`Invalid type format: ${n}`);break}if(!t){const o=e.width||e.length||2,l=e.length||e.height||2,c=e.blockType==="plate";if(o===1&&l===1)t=c?(await ae(async()=>{const{Plate1x1:u}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:u}},[],import.meta.url)).Plate1x1:(await ae(async()=>{const{Brick1x1:u}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:u}},[],import.meta.url)).Brick1x1;else if(o===1&&l===2)t=c?(await ae(async()=>{const{Plate1x2:u}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:u}},[],import.meta.url)).Plate1x2:(await ae(async()=>{const{Brick1x2:u}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:u}},[],import.meta.url)).Brick1x2;else if(o===1&&l===3)t=c?(await ae(async()=>{const{Plate1x3:u}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:u}},[],import.meta.url)).Plate1x3:(await ae(async()=>{const{Brick1x3:u}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:u}},[],import.meta.url)).Brick1x3;else if(o===1&&l===4)t=c?(await ae(async()=>{const{Plate1x4:u}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:u}},[],import.meta.url)).Plate1x4:(await ae(async()=>{const{Brick1x4:u}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:u}},[],import.meta.url)).Brick1x4;else if(o===1&&l===6)t=c?(await ae(async()=>{const{Plate1x6:u}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:u}},[],import.meta.url)).Plate1x6:(await ae(async()=>{const{Brick1x6:u}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:u}},[],import.meta.url)).Brick1x6;else if(o===1&&l===8)t=c?(await ae(async()=>{const{Plate1x8:u}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:u}},[],import.meta.url)).Plate1x8:(await ae(async()=>{const{Brick1x8:u}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:u}},[],import.meta.url)).Brick1x8;else if(o===1&&l===12)t=c?null:(await ae(async()=>{const{Brick1x12:u}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:u}},[],import.meta.url)).Brick1x12;else if(o===2&&l===2)if(c)try{const{CylinderPlate2x2:u}=await ae(async()=>{const{CylinderPlate2x2:d}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:d}},[],import.meta.url);t=u}catch{t=(await ae(async()=>{const{Plate2x2:d}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:d}},[],import.meta.url)).Plate2x2}else t=(await ae(async()=>{const{Brick2x2:u}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:u}},[],import.meta.url)).Brick2x2;else if(o===2&&l===3)t=c?(await ae(async()=>{const{Plate2x3:u}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:u}},[],import.meta.url)).Plate2x3:(await ae(async()=>{const{Brick2x3:u}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:u}},[],import.meta.url)).Brick2x3;else if(o===2&&l===4)t=c?(await ae(async()=>{const{Plate2x4:u}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:u}},[],import.meta.url)).Plate2x4:(await ae(async()=>{const{Brick2x4:u}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:u}},[],import.meta.url)).Brick2x4;else if(o===2&&l===6)t=c?(await ae(async()=>{const{Plate2x6:u}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:u}},[],import.meta.url)).Plate2x6:(await ae(async()=>{const{Brick2x6:u}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:u}},[],import.meta.url)).Brick2x6;else if(o===2&&l===8)t=c?(await ae(async()=>{const{Plate2x8:u}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:u}},[],import.meta.url)).Plate2x8:(await ae(async()=>{const{Brick2x8:u}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:u}},[],import.meta.url)).Brick2x8;else if(o===4&&l===4)t=c?(await ae(async()=>{const{Plate4x4:u}=await Promise.resolve().then(()=>ro);return{Plate4x4:u}},void 0,import.meta.url)).Plate4x4:null;else if(o===4&&l===8)t=c?(await ae(async()=>{const{Plate4x8:u}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:u}},[],import.meta.url)).Plate4x8:null;else return;if(!t)return}if(!t){console.error("Could not determine block class for:",e);return}const s=e.color||"red",r=e.glass!==void 0?e.glass:e.isGlass||!1,a=await t.create(s,r);if(!a)return;if(n==="minifigure"&&a.userData.minifigureInstance)try{await a.userData.minifigureInstance.applySkin("/images/skins/steve.png")}catch(o){console.error("Failed to load skin for minifigure:",o)}a.position.set(e.position.x,e.position.y,e.position.z),a.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),this.legoScene.addBrick(a,!0)}catch(n){console.error("Failed to create block from data:",n)}}getBuildStats(){const e={totalBlocks:this.legoScene.bricks.length,blockTypes:{},colors:{},bounds:{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}};return this.legoScene.bricks.forEach(t=>{const n=t.userData.type||"unknown",s=t.userData.color||"unknown";e.blockTypes[n]=(e.blockTypes[n]||0)+1,e.colors[s]=(e.colors[s]||0)+1,e.bounds.min.x=Math.min(e.bounds.min.x,t.position.x),e.bounds.min.y=Math.min(e.bounds.min.y,t.position.y),e.bounds.min.z=Math.min(e.bounds.min.z,t.position.z),e.bounds.max.x=Math.max(e.bounds.max.x,t.position.x),e.bounds.max.y=Math.max(e.bounds.max.y,t.position.y),e.bounds.max.z=Math.max(e.bounds.max.z,t.position.z)}),e}}class vB{constructor(e){this.container=e,this.scene=new Qs,this.camera=null,this.renderer=null,this.controls=null,this.animationId=null,this.dragController=null,this.snapController=new Ym,this.selectionManager=new jm,this.physicsController=new hB,this.placementManager=new Km(this.scene),this.visualizer=new nh(this.scene),this.saveLoadManager=new gd(this),this.bricks=[],this.platformSize=16,this.basePlate=null,this.loadingPromise=new Promise(t=>{this.resolveLoading=t}),this.init()}init(){this.setupRenderer(),this.setupCamera(),this.setupLights(),this.setupControls(),this.setupInteraction(),this.setupGrid(),this.updateGraphics(),this.animate()}setupRenderer(){this.renderer=new er({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),la(this.renderer),this.container.appendChild(this.renderer.domElement)}setupCamera(){this.camera=new An(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0)}setupLights(){Fc(this.scene),Uc(this.scene),zc(this.scene)}setupControls(){this.controls=new Vc(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enableZoom=!0,this.controls.enablePan=!0,this.controls.maxPolarAngle=Math.PI/2;const e=qm(()=>{this.updateShadowCameras()},1e3);this.controls.addEventListener("change",e)}setupInteraction(){this.dragController=new th(this.camera,this.scene,this.renderer),this.dragController.legoScene=this,this.dragController.selectionManager=this.selectionManager,document.addEventListener("keydown",this.onKeyDown.bind(this))}updateShadowCameras(){Wm()(this.scene)}setupGrid(){this.createPlatform(this.platformSize)}createPlatform(e){if(this.basePlate){this.scene.remove(this.basePlate);const l=this.placementManager.blocks.indexOf(this.basePlate);l>-1&&this.placementManager.blocks.splice(l,1)}let t;switch(e){case 4:t=Sl.create("green");break;case 8:t=Gc.create("green");break;case 16:t=El.create("green");break;case 32:t=Hc.create("green");break;default:t=Wc.create("green")}t.position.set(0,-.32/2,0),t.userData.isBrick=!0,t.userData.isBasePlate=!0,t.userData.isImmobile=!0,t.userData.doNotModify=!0,t.userData.platformSize=e,t.castShadow=!1,t.receiveShadow=!0,t.traverse(l=>{l.isMesh&&(l.castShadow=!1,l.receiveShadow=!0)}),this.scene.add(t),this.basePlate=t,this.placementManager.blocks.push(t),this.placementManager.setPlatformSize(e);const n=this.scene.children.find(l=>l.userData.isGround);n&&this.scene.remove(n);const s=Math.max(e*.8*2,40),r=new va(s,s),a=new xl({color:9498256,transparent:!0,opacity:.1}),o=new yn(r,a);o.rotation.x=-Math.PI/2,o.position.y=-1,o.userData.isGround=!0,this.scene.add(o)}setPlatformSize(e){this.platformSize!==e&&(this.platformSize=e,this.createPlatform(e))}onKeyDown(e){const t=this.selectionManager.getSelectedBrick();if(t)switch(e.key.toLowerCase()){case"r":if(t.userData.isImmobile||t.userData.isBasePlate)return;t.rotation.y+=Math.PI/2;const n=t.userData.width,s=t.userData.length;if(t.userData.width=s,t.userData.length=n,this.placementManager.blocks.includes(t)){const r=t.position.clone();this.placementManager.removeBlock(t,!1);const a=new fe(r.x,r.y+10,r.z),o=this.placementManager.findPlacementHeight(t,a);if(o!==null&&o>=.1){const l=new fe(r.x,o,r.z);this.placementManager.placeBlock(t,l,!0)}else t.position.copy(r),this.placementManager.blocks.includes(t)||this.placementManager.blocks.push(t)}break;case"delete":case"backspace":if(t.userData.isImmobile||t.userData.isBasePlate)return;this.removeBrick(t);break}}addBrick(e,t=!1){if(e.userData.isBrick=!0,e.castShadow=!0,e.receiveShadow=!0,e.traverse(n=>{n.isMesh&&(n.castShadow=!0,n.receiveShadow=!0)}),this.scene.add(e),this.bricks.push(e),t){if(this.placementManager.blocks.includes(e)||this.placementManager.blocks.push(e),e.userData.isMinifigure||e.userData.specialType==="minifigure"){const n=As,s=e.position.y;s<.5||s<1?e.position.y=n:e.position.y=s+n}}else if(this.placementManager.placeBlock(e,e.position),e.userData.isMinifigure||e.userData.specialType==="minifigure"){const n=As,s=e.position.y;s<.5?e.position.y=n:e.position.y=s+n}}removeBrick(e){if(e.userData&&(e.userData.isImmobile||e.userData.isBasePlate))return;const t=this.bricks.indexOf(e);t>-1&&this.bricks.splice(t,1),this.selectionManager.isSelected(e)&&this.selectionManager.clearSelection(),this.placementManager.removeBlock(e),this.scene.remove(e)}animate(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.controls.update(),this.renderer.render(this.scene,this.camera),this.resolveLoading&&(this.resolveLoading(),this.resolveLoading=null)}resize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}updateGraphics(){la(this.renderer),$m(this.scene)}dispose(){this.animationId&&cancelAnimationFrame(this.animationId),this.renderer.dispose(),this.controls.dispose()}}const gB=["for"],yB={key:0,class:"textarea__required"},xB=["id","value","placeholder","disabled","readonly","required","maxlength","rows","minlength"],bB={key:1,class:"textarea__footer"},wB={key:0,class:"textarea__message"},SB={key:0,class:"textarea__error"},EB={key:1,class:"textarea__hint"},MB={key:1,class:"textarea__count"},TB={__name:"Textarea",props:{modelValue:{type:String,default:""},label:{type:String,default:""},placeholder:{type:String,default:""},hint:{type:String,default:""},error:{type:String,default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},maxlength:{type:Number,default:null},minlength:{type:Number,default:null},rows:{type:Number,default:4},minHeight:{type:String,default:null},maxHeight:{type:String,default:null},autoResize:{type:Boolean,default:!1},showCount:{type:Boolean,default:!1},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)}},emits:["update:modelValue","blur","focus"],setup(i,{emit:e}){const t=i,n=e,s=Dc(),r=ze(!1),a=tt(()=>["textarea-wrapper",{"textarea-wrapper._error":!!t.error,"textarea-wrapper._disabled":t.disabled,"textarea-wrapper._focused":r.value}]),o=tt(()=>["textarea",`textarea._${t.size}`]),l=tt(()=>{const f={};return t.minHeight&&(f.minHeight=t.minHeight),t.maxHeight&&(f.maxHeight=t.maxHeight),t.autoResize&&(f.resize="none",f.overflow="hidden"),f}),c=tt(()=>{var f;return((f=t.modelValue)==null?void 0:f.length)||0}),u=f=>{const p=f.target.value;n("update:modelValue",p),t.autoResize&&(f.target.style.height="auto",f.target.style.height=`${f.target.scrollHeight}px`)},d=f=>{r.value=!1,n("blur",f)},h=f=>{r.value=!0,n("focus",f)};return(f,p)=>(oe(),ge("div",{class:qt(["textarea-wrapper",a.value])},[i.label?(oe(),ge("label",{key:0,for:Ii(s),class:"textarea__label"},[Oe(se(i.label)+" ",1),i.required?(oe(),ge("span",yB,"*")):Ve("",!0)],8,gB)):Ve("",!0),B("textarea",{id:Ii(s),value:i.modelValue,placeholder:i.placeholder,disabled:i.disabled,readonly:i.readonly,required:i.required,maxlength:i.maxlength,rows:i.rows,minlength:i.minlength,class:qt(["textarea",o.value]),style:fi(l.value),onInput:u,onBlur:d,onFocus:h},null,46,xB),i.error||i.hint||i.showCount?(oe(),ge("div",bB,[i.error||i.hint?(oe(),ge("div",wB,[i.error?(oe(),ge("span",SB,se(i.error),1)):i.hint?(oe(),ge("span",EB,se(i.hint),1)):Ve("",!0)])):Ve("",!0),i.showCount?(oe(),ge("span",MB,se(c.value)+se(i.maxlength?` / ${i.maxlength}`:""),1)):Ve("",!0)])):Ve("",!0)],2))}},yd=Ht(TB,[["__scopeId","data-v-131fe9c3"]]),AB={class:"builder-controls"},CB={class:"builder-controls__sections"},PB={class:"builder-controls__section"},RB={class:"section-title"},LB={class:"button-group"},IB={class:"builder-controls__section"},DB={class:"section-title"},kB={class:"button-group"},BB={class:"builder-controls__section"},OB={class:"section-title"},NB={class:"button-group"},FB={class:"builder-controls__section"},UB={class:"section-title"},zB={class:"button-group"},VB={class:"builder-controls__section"},GB={class:"section-title"},HB={class:"hint-text"},WB={__name:"BuilderControls",props:{buildJson:{type:String,default:""}},emits:["export","export-as-code","import","load-test","clear","json-change","platform-size-change","screenshot","save-set"],setup(i,{emit:e}){const{t}=wn(),n=e,s=[4,8,16,32],r=ze(16),a=()=>{n("export")},o=()=>{n("export-as-code")},l=()=>{n("import")},c=()=>{n("load-test")},u=()=>{n("clear")},d=m=>{n("json-change",m)},h=m=>{r.value=m,n("platform-size-change",m)},f=()=>{n("screenshot")},p=()=>{n("save-set")};return(m,_)=>(oe(),ge("div",AB,[B("div",CB,[B("div",PB,[B("h4",RB,se(m.$t("builder.platformSize")),1),B("div",LB,[(oe(),ge(At,null,Zt(s,v=>we(wt,{key:v,variant:r.value===v?"primary":"outline",size:"sm",class:"button",onClick:x=>h(v)},{default:Le(()=>[Oe(se(v)+"x"+se(v),1)]),_:2},1032,["variant","onClick"])),64))])]),B("div",IB,[B("h4",DB,se(m.$t("builder.saveLoad")),1),B("div",kB,[we(wt,{variant:"primary",size:"sm",class:"button",onClick:a},{default:Le(()=>[Oe(se(m.$t("builder.exportBuild")),1)]),_:1}),we(wt,{variant:"outline",size:"sm",class:"button",onClick:o},{default:Le(()=>[Oe("  "+se(m.$t("collections.copyCode")),1)]),_:1}),we(wt,{variant:"secondary",size:"sm",class:"button",onClick:l},{default:Le(()=>[Oe(se(m.$t("builder.importBuild")),1)]),_:1}),we(wt,{variant:"outline",size:"sm",class:"button",onClick:c},{default:Le(()=>[Oe(se(m.$t("builder.loadTestBuild")),1)]),_:1}),we(wt,{variant:"danger",size:"sm",class:"button",onClick:u},{default:Le(()=>[Oe(se(m.$t("builder.clearAll")),1)]),_:1})])]),B("div",BB,[B("h4",OB,se(m.$t("collections.title")),1),B("div",NB,[we(wt,{variant:"primary",size:"sm",class:"button",onClick:p},{default:Le(()=>[Oe("  "+se(m.$t("collections.saveSet")),1)]),_:1})])]),B("div",FB,[B("h4",UB,se(m.$t("builder.screenshot")),1),B("div",zB,[we(wt,{variant:"primary",size:"sm",class:"button",onClick:f},{default:Le(()=>[Oe("  "+se(m.$t("builder.takeScreenshot")),1)]),_:1})])]),B("div",VB,[B("h4",GB,se(m.$t("builder.buildData")),1),we(yd,{"model-value":i.buildJson,placeholder:m.$t("builder.jsonPlaceholder"),rows:8,"onUpdate:modelValue":d},null,8,["model-value","placeholder"]),B("p",HB,se(m.$t("builder.jsonHint")),1)])])]))}},$B=Ht(WB,[["__scopeId","data-v-3782ba81"]]),xd={red:Wt.RED,blue:Wt.BLUE,yellow:Wt.YELLOW,green:Wt.GREEN,orange:Wt.ORANGE,purple:Wt.PURPLE,pink:Wt.PINK,white:Wt.WHITE,brightGreen:Wt.BRIGHT_GREEN,brown:Wt.BROWN,black:Wt.BLACK,gray:Wt.GRAY},bd={red:rs.RED,blue:rs.BLUE,yellow:rs.YELLOW,green:rs.GREEN,orange:rs.ORANGE,purple:rs.PURPLE,pink:rs.PINK,white:rs.WHITE,brightGreen:rs.BRIGHT_GREEN,brown:rs.BROWN,black:rs.BLACK,gray:rs.GRAY},ey=Wt.RED,XB="/previews/blocks/";function qB(i,e,t=!1){const n=`${i}-${e}.png`;return`${XB}${n}`}function YB(i,e,t=!1){return new Promise(n=>{const s=qB(i,e,t),r=new Image;r.onload=()=>n(s),r.onerror=()=>n(null),r.src=s})}let ec=[],af=!1;const bs=new Map;async function jB(){if(bs.size===0)return;let i=0;for(const[e,t]of bs.entries())try{const n=document.createElement("a");n.href=t,n.download=`${e}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),i++,await new Promise(s=>setTimeout(s,100))}catch(n){console.error(`[DownloadPreviews] Failed to download ${e}:`,n)}}async function KB(i,e,t,n){const s=`${i}-${e}`;return bs.has(s)?bs.get(s):new Promise(r=>{ec.push(async()=>{const l=new Qs;l.background=new Mt(16777215);const c=new An(45,240/240,.1,100),u=new er({antialias:!0,alpha:!0,powerPreference:"low-power"});u.setSize(240,240),u.shadowMap.enabled=!1;const d=new bl(16777215,.6);l.add(d);const h=new Bn(16777215,1);h.position.set(5,8,5),l.add(h);const f=new Qd(16777215,1.5);f.position.set(0,10,0),f.angle=Math.PI/4,f.penumbra=.5,f.target.position.set(0,0,0),l.add(f),l.add(f.target);const p=new Bn(16777215,.6);p.position.set(-5,3,-5),l.add(p);const m=new Bn(16777215,.5);m.position.set(0,-2,-8),l.add(m);const _=new Bn(16777215,.5);_.position.set(-3,2,-3),l.add(_);const v=n(),x=await(v instanceof Promise?v:Promise.resolve(v));if(!x){u.dispose(),l.clear(),r(null);return}x.position.set(0,0,0),x.rotation.set(0,0,0);const y=x.userData.color||e,g=xd[y]||Wt.RED,w=parseInt(g.replace("#",""),16),b=bd[y]||bd.red,T=parseInt(b.replace("#",""),16);x.traverse(z=>{if(z.isMesh&&z.material){let q;Array.isArray(z.material)?q=z.material.map(O=>O.clone()):q=z.material.clone(),Array.isArray(q)?q.forEach(O=>{z.userData.type==="stud"?(O.color.setHex(T),O.emissive!==void 0&&(O.emissive.setHex(T),O.emissiveIntensity!==void 0&&(O.emissiveIntensity=.3))):O.color.setHex(w),O.transparent=!1,O.opacity=1}):(z.userData.type==="stud"?(q.color.setHex(T),q.emissive!==void 0&&(q.emissive.setHex(T),q.emissiveIntensity!==void 0&&(q.emissiveIntensity=.3))):q.color.setHex(w),q.transparent=!1,q.opacity=1),z.material=q}}),l.add(x);const E=new kr().setFromObject(x),S=E.getSize(new fe),M=E.getCenter(new fe),C=Math.max(S.x,S.y,S.z)*1.75,I=Math.PI/6;c.position.set(C*Math.sin(I),C*Math.cos(I),C*Math.sin(I)),c.lookAt(M),u.render(l,c);const W=u.domElement.toDataURL("image/png",1);bs.set(s,W),r(W),u.dispose(),x.traverse(z=>{z.geometry&&z.geometry.dispose(),z.material&&(Array.isArray(z.material)?z.material.forEach(q=>q.dispose()):z.material.dispose())}),l.clear(),r(W)}),Mb()})}const Mb=async()=>{if(!(af||ec.length===0)){for(af=!0;ec.length>0;){const i=ec.shift();try{await i(),await new Promise(e=>setTimeout(e,50))}catch(e){console.error("Render task failed:",e)}}af=!1}},ZB={name:"LegoBlock3DPreview",props:{label:{type:String,required:!0},blockType:{type:String,required:!0},color:{type:String,default:"red"},isGlass:{type:Boolean,default:!1},createBlockFn:{type:Function,required:!0}},setup(i){const e=ze(null),t=async()=>{if(!i.createBlockFn)return;const r=`${i.blockType}-${i.color}`;if(bs.has(r)){const o=bs.get(r);e.value=o;return}const a=await YB(i.blockType,i.color,!1);if(a){e.value=a,bs.set(r,a);return}return new Promise(o=>{ec.push(async()=>{const u=new Qs;u.background=new Mt(16777215);const d=new An(45,240/240,.1,100),h=new er({antialias:!0,alpha:!0,powerPreference:"low-power"});h.setSize(240,240),h.shadowMap.enabled=!1;const f=new bl(16777215,.6);u.add(f);const p=new Bn(16777215,1);p.position.set(5,8,5),u.add(p);const m=new Qd(16777215,1.5);m.position.set(0,10,0),m.angle=Math.PI/4,m.penumbra=.5,m.target.position.set(0,0,0),u.add(m),u.add(m.target);const _=new Bn(16777215,.6);_.position.set(-5,3,-5),u.add(_);const v=new Bn(16777215,.5);v.position.set(0,-2,-8),u.add(v);const x=new Bn(16777215,.5);x.position.set(-3,2,-3),u.add(x);const y=i.createBlockFn(),g=await(y instanceof Promise?y:Promise.resolve(y));if(!g){h.dispose(),u.clear(),o();return}g.position.set(0,0,0),g.rotation.set(0,0,0);const w=g.userData.color||i.color||"red",b=xd[w]||Wt.RED,T=parseInt(b.replace("#",""),16),E=bd[w]||bd.red,S=parseInt(E.replace("#",""),16);g.traverse(re=>{if(re.isMesh&&re.material){let le;Array.isArray(re.material)?le=re.material.map(Z=>Z.clone()):le=re.material.clone(),Array.isArray(le)?le.forEach(Z=>{re.userData.type==="stud"?(Z.color.setHex(S),Z.emissive!==void 0&&(Z.emissive.setHex(S),Z.emissiveIntensity!==void 0&&(Z.emissiveIntensity=.3))):Z.color.setHex(T),Z.transparent=!1,Z.opacity=1}):(re.userData.type==="stud"?(le.color.setHex(S),le.emissive!==void 0&&(le.emissive.setHex(S),le.emissiveIntensity!==void 0&&(le.emissiveIntensity=.3))):le.color.setHex(T),le.transparent=!1,le.opacity=1),re.material=le}}),u.add(g);const M=new kr().setFromObject(g),A=M.getSize(new fe),C=M.getCenter(new fe),H=Math.max(A.x,A.y,A.z)*1.75,W=Math.PI/6;d.position.set(H*Math.sin(W),H*Math.cos(W),H*Math.sin(W)),d.lookAt(C),h.render(u,d);const q=h.domElement.toDataURL("image/png",1),O=`${i.blockType}-${i.color}`;bs.set(O,q),e.value=q,h.dispose(),g.traverse(re=>{re.geometry&&re.geometry.dispose(),re.material&&(Array.isArray(re.material)?re.material.forEach(le=>le.dispose()):re.material.dispose())}),u.clear(),o()}),Mb()})};Wn([()=>i.blockType,()=>i.color],()=>{const r=`${i.blockType}-${i.color}`;if(bs.has(r)){e.value=bs.get(r);return}e.value=null,Cr(()=>{t()})}),In(()=>{Cr(()=>{t()})});const n=tt(()=>i.isGlass),s=tt(()=>i.isGlass?.8:1);return{previewImage:e,isGlass:n,imageOpacity:s}}},JB={class:"lego-block-3d-preview"},QB={class:"preview-container"},eO={key:0,class:"preview-image-wrapper"},tO=["src","alt"],nO={key:1,class:"preview-loading"},iO={key:2,class:"preview-extra"},sO={class:"block-label"};function rO(i,e,t,n,s,r){return oe(),ge("div",JB,[B("div",QB,[n.previewImage?(oe(),ge("div",eO,[B("img",{src:n.previewImage,alt:t.label,style:fi({opacity:n.imageOpacity}),class:"preview-image",draggable:"false",onDragstart:e[0]||(e[0]=fc(()=>{},["prevent"]))},null,44,tO)])):(oe(),ge("div",nO,"Loading...")),i.$slots.extra?(oe(),ge("div",iO,[Hn(i.$slots,"extra",{},void 0)])):Ve("",!0)]),B("span",sO,se(t.label),1)])}const qr=Ht(ZB,[["render",rO],["__scopeId","data-v-285207f2"]]),aO=["id","checked","disabled","required"],oO={key:0,class:"checkbox__icon",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},lO={key:1,class:"checkbox__icon",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},cO={key:0,class:"checkbox__label"},uO={__name:"Checkbox",props:{modelValue:{type:Boolean,default:!1},label:{type:String,default:""},disabled:{type:Boolean,default:!1},required:{type:Boolean,default:!1},indeterminate:{type:Boolean,default:!1},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)}},emits:["update:modelValue","change"],setup(i,{emit:e}){const t=i,n=e,s=Dc(),r=tt(()=>["checkbox",`checkbox._${t.size}`,{"checkbox._disabled":t.disabled}]),a=tt(()=>({"checkbox__checkmark._checked":t.modelValue,"checkbox__checkmark._indeterminate":t.indeterminate&&!t.modelValue})),o=l=>{t.disabled||(n("update:modelValue",l.target.checked),n("change",l.target.checked))};return(l,c)=>(oe(),ge("label",{class:qt(["checkbox",r.value])},[B("input",{id:Ii(s),type:"checkbox",checked:i.modelValue,disabled:i.disabled,required:i.required,class:"checkbox__input",onChange:o},null,40,aO),B("span",{class:qt(["checkbox__checkmark",a.value])},[i.modelValue?(oe(),ge("svg",oO,[...c[0]||(c[0]=[B("path",{d:"M13.333 4L6 11.333 2.667 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):i.indeterminate?(oe(),ge("svg",lO,[...c[1]||(c[1]=[B("path",{d:"M2 8H14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])])):Ve("",!0)],2),i.label||l.$slots.default?(oe(),ge("span",cO,[Hn(l.$slots,"default",{},()=>[Oe(se(i.label),1)])])):Ve("",!0)],2))}},Tb=Ht(uO,[["__scopeId","data-v-abf86373"]]),dO={class:"block-palette"},hO={class:"block-palette__content"},fO={class:"block-palette__section"},pO={class:"block-palette__section-title"},mO={class:"block-palette__colors"},_O=["onClick","title"],vO=["onClick","title"],gO=["onClick","title"],yO={class:"block-palette__section"},xO={class:"block-palette__section"},bO={class:"block-palette__section-title"},wO={class:"block-palette__grid"},SO=["onMousedown","onTouchstart"],EO={class:"block-palette__section"},MO={class:"block-palette__section-title"},TO={class:"block-palette__grid"},AO=["onMousedown","onTouchstart"],CO={class:"block-palette__section"},PO={class:"block-palette__section-title"},RO={class:"block-palette__grid"},LO=["onMousedown","onTouchstart"],IO={__name:"BlockPalette",props:{onCreateBlock:{type:Function,required:!0}},setup(i){const e=i,{t}=wn(),n=ze("red"),s=ze(!1),r=["red","blue","yellow","green"],a=["orange","purple","pink","white"],o=["brightGreen","brown","black","gray"],l=ze([{type:"brick-1x1",label:"1x1",width:1,length:1},{type:"brick-1x2",label:"1x2",width:1,length:2},{type:"brick-1x3",label:"1x3",width:1,length:3},{type:"brick-1x4",label:"1x4",width:1,length:4},{type:"brick-1x6",label:"1x6",width:1,length:6},{type:"brick-1x8",label:"1x8",width:1,length:8},{type:"brick-1x12",label:"1x12",width:1,length:12},{type:"brick-2x2",label:"2x2",width:2,length:2},{type:"brick-2x3",label:"2x3",width:2,length:3},{type:"brick-2x4",label:"2x4",width:2,length:4},{type:"brick-2x6",label:"2x6",width:2,length:6},{type:"brick-2x8",label:"2x8",width:2,length:8}]),c=ze([{type:"plate-1x1",label:"1x1",width:1,length:1},{type:"plate-1x2",label:"1x2",width:1,length:2},{type:"plate-1x3",label:"1x3",width:1,length:3},{type:"plate-1x4",label:"1x4",width:1,length:4},{type:"plate-1x6",label:"1x6",width:1,length:6},{type:"plate-1x8",label:"1x8",width:1,length:8},{type:"plate-2x2",label:"2x2",width:2,length:2},{type:"plate-2x3",label:"2x3",width:2,length:3},{type:"plate-2x4",label:"2x4",width:2,length:4},{type:"plate-2x6",label:"2x6",width:2,length:6},{type:"plate-2x8",label:"2x8",width:2,length:8},{type:"plate-4x4",label:"4x4",width:4,length:4}]),u=ze([{type:"cylinder-1x1",label:"Cylinder 1x1",width:1,length:1},{type:"cylinder-plate-1x1",label:"Cylinder Plate 1x1",width:1,length:1},{type:"flat-plate-1x1",label:"Flat Plate 1x1",width:1,length:1},{type:"flat-plate-1x2",label:"Flat Plate 1x2",width:1,length:2},{type:"flat-plate-1x2-center-stud",label:"Flat Plate 1x2 Center Stud",width:1,length:2},{type:"flat-plate-1x4",label:"Flat Plate 1x4",width:1,length:4},{type:"cylinder-plate-2x2",label:"Cylinder Plate 2x2",width:2,length:2},{type:"minifigure",label:"Minifigure",width:1,length:1}]),d=E=>{n.value=E},h=async E=>{const S=s.value===!0;return await f(E,n.value,S)},f=async(E,S,M)=>{let A=null;try{switch(E){case"brick-1x1":A=(await ae(async()=>{const{Brick1x1:C}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:C}},[],import.meta.url)).Brick1x1;break;case"brick-1x2":A=(await ae(async()=>{const{Brick1x2:C}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:C}},[],import.meta.url)).Brick1x2;break;case"brick-1x3":A=(await ae(async()=>{const{Brick1x3:C}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:C}},[],import.meta.url)).Brick1x3;break;case"brick-1x4":A=(await ae(async()=>{const{Brick1x4:C}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:C}},[],import.meta.url)).Brick1x4;break;case"brick-1x6":A=(await ae(async()=>{const{Brick1x6:C}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:C}},[],import.meta.url)).Brick1x6;break;case"brick-1x8":A=(await ae(async()=>{const{Brick1x8:C}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:C}},[],import.meta.url)).Brick1x8;break;case"brick-1x12":A=(await ae(async()=>{const{Brick1x12:C}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:C}},[],import.meta.url)).Brick1x12;break;case"brick-2x2":A=(await ae(async()=>{const{Brick2x2:C}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:C}},[],import.meta.url)).Brick2x2;break;case"brick-2x3":A=(await ae(async()=>{const{Brick2x3:C}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:C}},[],import.meta.url)).Brick2x3;break;case"brick-2x4":A=(await ae(async()=>{const{Brick2x4:C}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:C}},[],import.meta.url)).Brick2x4;break;case"brick-2x6":A=(await ae(async()=>{const{Brick2x6:C}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:C}},[],import.meta.url)).Brick2x6;break;case"brick-2x8":A=(await ae(async()=>{const{Brick2x8:C}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:C}},[],import.meta.url)).Brick2x8;break;case"plate-1x1":A=(await ae(async()=>{const{Plate1x1:C}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:C}},[],import.meta.url)).Plate1x1;break;case"plate-1x2":A=(await ae(async()=>{const{Plate1x2:C}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:C}},[],import.meta.url)).Plate1x2;break;case"plate-1x3":A=(await ae(async()=>{const{Plate1x3:C}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:C}},[],import.meta.url)).Plate1x3;break;case"plate-1x4":A=(await ae(async()=>{const{Plate1x4:C}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:C}},[],import.meta.url)).Plate1x4;break;case"plate-1x6":A=(await ae(async()=>{const{Plate1x6:C}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:C}},[],import.meta.url)).Plate1x6;break;case"plate-1x8":A=(await ae(async()=>{const{Plate1x8:C}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:C}},[],import.meta.url)).Plate1x8;break;case"plate-2x2":A=(await ae(async()=>{const{Plate2x2:C}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:C}},[],import.meta.url)).Plate2x2;break;case"plate-2x3":A=(await ae(async()=>{const{Plate2x3:C}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:C}},[],import.meta.url)).Plate2x3;break;case"plate-2x4":A=(await ae(async()=>{const{Plate2x4:C}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:C}},[],import.meta.url)).Plate2x4;break;case"plate-2x6":A=(await ae(async()=>{const{Plate2x6:C}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:C}},[],import.meta.url)).Plate2x6;break;case"plate-2x8":A=(await ae(async()=>{const{Plate2x8:C}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:C}},[],import.meta.url)).Plate2x8;break;case"plate-4x4":A=(await ae(async()=>{const{Plate4x4:C}=await Promise.resolve().then(()=>ro);return{Plate4x4:C}},void 0,import.meta.url)).Plate4x4;break;case"plate-4x8":A=(await ae(async()=>{const{Plate4x8:C}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:C}},[],import.meta.url)).Plate4x8;break;case"cylinder-1x1":A=(await ae(async()=>{const{Cylinder1x1:C}=await import("./Cylinder1x1-CatK-O-Q.js");return{Cylinder1x1:C}},[],import.meta.url)).Cylinder1x1;break;case"cylinder-plate-1x1":A=(await ae(async()=>{const{CylinderPlate1x1:C}=await import("./CylinderPlate1x1-C9BKk24L.js");return{CylinderPlate1x1:C}},[],import.meta.url)).CylinderPlate1x1;break;case"flat-plate-1x1":A=(await ae(async()=>{const{FlatPlate1x1:C}=await import("./FlatPlate1x1-COVjvhfm.js");return{FlatPlate1x1:C}},[],import.meta.url)).FlatPlate1x1;break;case"flat-plate-1x2":A=(await ae(async()=>{const{FlatPlate1x2:C}=await import("./FlatPlate1x2-WO8sp-SC.js");return{FlatPlate1x2:C}},[],import.meta.url)).FlatPlate1x2;break;case"flat-plate-1x2-center-stud":A=(await ae(async()=>{const{FlatPlate1x2CenterStud:C}=await import("./FlatPlate1x2CenterStud-CgU774Nu.js");return{FlatPlate1x2CenterStud:C}},__vite__mapDeps([0,1]),import.meta.url)).FlatPlate1x2CenterStud;break;case"flat-plate-1x4":A=(await ae(async()=>{const{FlatPlate1x4:C}=await import("./FlatPlate1x4-BhPvU6tM.js");return{FlatPlate1x4:C}},[],import.meta.url)).FlatPlate1x4;break;case"cylinder-plate-2x2":A=(await ae(async()=>{const{CylinderPlate2x2:C}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:C}},[],import.meta.url)).CylinderPlate2x2;break;case"minifigure":A=(await ae(async()=>{const{Minifigure:C}=await Promise.resolve().then(()=>Ml);return{Minifigure:C}},void 0,import.meta.url)).Minifigure;break;default:return null}if(A){const C=await A.create(S,M,!1);if(E==="minifigure"&&C.userData.minifigureInstance)try{await C.userData.minifigureInstance.applySkin("/images/skins/steve.png")}catch(I){console.error("Failed to load skin for minifigure:",I)}return C}}catch(C){return console.error(`Failed to load block type ${E}:`,C),null}return null};let p=!1,m=null,_=null,v=null;const x=(E,S)=>{E.button===0&&(E.preventDefault(),E.stopPropagation(),p=!0,m=S,_=E.clientX,v=E.clientY,document.addEventListener("mousemove",g),document.addEventListener("mouseup",w))},y=(E,S)=>{if(E.touches.length!==1)return;E.preventDefault(),E.stopPropagation(),p=!0,m=S;const M=E.touches[0];_=M.clientX,v=M.clientY,document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("touchend",T)},g=async E=>{if(!p||!m)return;const S=5,M=Math.abs(E.clientX-_),A=Math.abs(E.clientY-v);if(!(M<S&&A<S)&&e.onCreateBlock){const C=s.value===!0,I=await f(m,n.value,C);I&&(m&&(m.startsWith("cylinder-")||m.startsWith("flat-plate-"))&&(I.userData.specialType=m),e.onCreateBlock(I,E.clientX,E.clientY),p=!1,m=null,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",w))}},w=E=>{p&&(p=!1,m=null,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",w))},b=async E=>{if(!p||!m||E.touches.length!==1)return;E.preventDefault();const S=E.touches[0],M=5,A=Math.abs(S.clientX-_),C=Math.abs(S.clientY-v);if(!(A<M&&C<M)&&e.onCreateBlock){const I=s.value===!0,H=await f(m,n.value,I);H&&(m&&(m.startsWith("cylinder-")||m.startsWith("flat-plate-"))&&(H.userData.specialType=m),e.onCreateBlock(H,S.clientX,S.clientY),p=!1,m=null,document.removeEventListener("touchmove",b),document.removeEventListener("touchend",T))}},T=E=>{p&&(p=!1,m=null,document.removeEventListener("touchmove",b),document.removeEventListener("touchend",T))};return In(()=>{}),(E,S)=>(oe(),ge("div",dO,[B("div",hO,[B("div",fO,[B("h4",pO,se(E.$t("builder.colors")),1),B("div",mO,[(oe(),ge(At,null,Zt(r,M=>B("button",{key:M,onClick:A=>d(M),class:qt(["color-button",{"color-button--active":n.value===M,[`color-button--${M}`]:!0}]),title:E.$t(`colors.${M}`)},null,10,_O)),64)),(oe(),ge(At,null,Zt(a,M=>B("button",{key:M,onClick:A=>d(M),class:qt(["color-button",{"color-button--active":n.value===M,[`color-button--${M}`]:!0}]),title:E.$t(`colors.${M}`)},null,10,vO)),64)),(oe(),ge(At,null,Zt(o,M=>B("button",{key:M,onClick:A=>d(M),class:qt(["color-button",{"color-button--active":n.value===M,[`color-button--${M}`]:!0}]),title:E.$t(`colors.${M}`)},null,10,gO)),64))]),n.value?(oe(),jt(_n,{key:0,variant:"primary",size:"sm",class:"block-palette__color-badge"},{default:Le(()=>[Oe(se(E.$t(`colors.${n.value}`)),1)]),_:1})):Ve("",!0)]),B("div",yO,[we(Tb,{modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=M=>s.value=M),label:E.$t("builder.glass"),size:"md"},null,8,["modelValue","label"])]),B("div",xO,[B("h4",bO,se(E.$t("builder.standardBricks")),1),B("div",wO,[(oe(!0),ge(At,null,Zt(l.value,M=>(oe(),ge("div",{key:M.type,class:"block-palette__block-card",onMousedown:A=>x(A,M.type),onTouchstart:A=>y(A,M.type),draggable:"false"},[we(qr,{label:M.label,"block-type":M.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>h(M.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,SO))),128))])]),B("div",EO,[B("h4",MO,se(E.$t("builder.plates")),1),B("div",TO,[(oe(!0),ge(At,null,Zt(c.value,M=>(oe(),ge("div",{key:M.type,class:"block-palette__block-card",onMousedown:A=>x(A,M.type),onTouchstart:A=>y(A,M.type),draggable:"false"},[we(qr,{label:M.label,"block-type":M.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>h(M.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,AO))),128))])]),B("div",CO,[B("h4",PO,se(E.$t("builder.specialBlocks")),1),B("div",RO,[(oe(!0),ge(At,null,Zt(u.value,M=>(oe(),ge("div",{key:M.type,class:"block-palette__block-card",onMousedown:A=>x(A,M.type),onTouchstart:A=>y(A,M.type),draggable:"false"},[we(qr,{label:M.label,"block-type":M.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>h(M.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,LO))),128))])])])]))}},Ab=Ht(IO,[["__scopeId","data-v-57293449"]]);let Xu=[],of=!1;const lf=new Map;async function DO(i,e){const t=`minifigure-${i}`;return lf.has(t)?lf.get(t):new Promise(n=>{Xu.push(async()=>{const a=new Qs;a.background=new Mt(16777215);const o=new An(45,240/240,.1,100),l=new er({antialias:!0,alpha:!0,powerPreference:"low-power"});l.setSize(240,240),l.shadowMap.enabled=!1;const c=new bl(16777215,.6);a.add(c);const u=new Bn(16777215,1);u.position.set(5,8,5),a.add(u);const d=new Qd(16777215,1.5);d.position.set(0,10,0),d.angle=Math.PI/4,d.penumbra=.5,d.target.position.set(0,0,0),a.add(d),a.add(d.target);const h=new Bn(16777215,.6);h.position.set(-5,3,-5),a.add(h);const f=new Bn(16777215,.5);f.position.set(0,-2,-8),a.add(f);const p=new Bn(16777215,.5);p.position.set(-3,2,-3),a.add(p);const m=e(),_=await(m instanceof Promise?m:Promise.resolve(m));if(!_){l.dispose(),a.clear(),n(null);return}_.position.set(0,0,0),_.rotation.set(0,0,0),a.add(_);const v=new kr().setFromObject(_),x=v.getSize(new fe),y=v.getCenter(new fe),w=Math.max(x.x,x.y,x.z)*1.75,b=Math.PI/6;o.position.set(w*Math.sin(b),w*Math.cos(b),w*Math.sin(b)),o.lookAt(y),l.render(a,o);const E=l.domElement.toDataURL("image/png",1);lf.set(t,E),l.dispose(),_.traverse(S=>{S.geometry&&S.geometry.dispose(),S.material&&(Array.isArray(S.material)?S.material.forEach(M=>M.dispose()):S.material.dispose())}),a.clear(),n(E)}),kO()})}const kO=async()=>{if(!(of||Xu.length===0)){for(of=!0;Xu.length>0;){const i=Xu.shift();try{await i(),await new Promise(e=>setTimeout(e,50))}catch(e){console.error("Render task failed:",e)}}of=!1}},BO={name:"Minifigure3DPreview",props:{label:{type:String,required:!0},skinPath:{type:String,required:!0},createMinifigureFn:{type:Function,required:!0}},setup(i){const e=ze(null),t=ze(0),n=async()=>{try{const s=await DO(i.skinPath,i.createMinifigureFn);s&&(e.value=s,await Cr(),t.value=1)}catch(s){console.error("Failed to generate preview:",s)}};return In(()=>{n()}),Wn(()=>i.skinPath,()=>{e.value=null,t.value=0,n()}),{previewImage:e,imageOpacity:t}}},OO={class:"minifigure-3d-preview"},NO={class:"preview-container"},FO={key:0,class:"preview-image-wrapper"},UO=["src","alt"],zO={key:1,class:"preview-loading"},VO={key:2,class:"preview-extra"},GO={class:"block-label"};function HO(i,e,t,n,s,r){return oe(),ge("div",OO,[B("div",NO,[n.previewImage?(oe(),ge("div",FO,[B("img",{src:n.previewImage,alt:t.label,style:fi({opacity:n.imageOpacity}),class:"preview-image",draggable:"false",onDragstart:e[0]||(e[0]=fc(()=>{},["prevent"]))},null,44,UO)])):(oe(),ge("div",zO,"Loading...")),i.$slots.extra?(oe(),ge("div",VO,[Hn(i.$slots,"extra",{},void 0)])):Ve("",!0)]),B("span",GO,se(t.label),1)])}const WO=Ht(BO,[["render",HO],["__scopeId","data-v-7597292d"]]);class ao extends ho{constructor(e="red",t=!1){super(1,1,e,t),this.blockHeight=Sb*2,this.skinTexture=null,this.isWalking=!1,this.animationTime=0,this.walkDirection=1,this.bodyParts={head:null,torso:null,leftArm:null,rightArm:null,leftLeg:null,rightLeg:null}}async createBrick(){const e=new Zn;return await this.createHead(e),this.createTorso(e),this.createArms(e),this.createLegs(e),e.userData.width=this.width,e.userData.length=this.length,e.userData.blockHeight=this.blockHeight,e.userData.blockType="special",e.userData.color=this.color,e.userData.isGlass=this.isGlass,e.userData.isMinifigure=!0,e.userData.type="minifigure",e.userData.specialType="minifigure",this.mesh=e,e}createFaceTexture(e,t,n,s){var c;const r=this.createMaterial();if(!((c=this.skinTexture)!=null&&c.image))return r;const a=document.createElement("canvas");a.width=n,a.height=s;const o=a.getContext("2d");try{o.drawImage(this.skinTexture.image,e,t,n,s,0,0,n,s)}catch(u){return console.warn("Failed to draw image for texture:",u),r}const l=new eP(a);return l.magFilter=wi,l.minFilter=wi,new md({map:l})}createMaterialsArray(e){return e.map(([t,n,s,r])=>this.createFaceTexture(t,n,s,r))}async createHead(e){const t=Fn,n=new ji(t,t,t),s=[[16,8,8,8],[0,8,8,8],[8,0,8,8],[16,0,8,8],[8,8,8,8],[24,8,8,8]],r=new yn(n,this.createMaterialsArray(s));r.castShadow=!0,r.receiveShadow=!0;const a=Fn*1.5;r.position.set(0,a/2+t/2,0),e.add(r),this.bodyParts.head=r}createTorso(e){const t=Fn*1.5,n=Fn,s=Fn*.5,r=new ji(n,t,s),a=[[16,20,4,12],[28,20,4,12],[20,16,8,4],[28,16,8,4],[20,20,8,12],[32,20,8,12]],o=new yn(r,this.createMaterialsArray(a));o.castShadow=!0,o.receiveShadow=!0,o.position.set(0,0,0),e.add(o),this.bodyParts.torso=o}createLimbMesh(e,t,n,s){const r=new ji(e,t,n),a=new yn(r,this.createMaterialsArray(s));return a.castShadow=!0,a.receiveShadow=!0,a.position.y=-t/2,a}createArms(e){const t=Fn*1.5,n=Fn*.5,s=Fn*.5,r=[[40,20,4,12],[48,20,4,12],[44,16,4,4],[48,16,4,4],[44,20,4,12],[52,20,4,12]],a=Fn,l=Fn*1.5*.45,c=new Zn,u=this.createLimbMesh(n,t,s,r);c.add(u),c.position.set(-.6000000000000001,l,0),e.add(c),this.bodyParts.leftArm=c;const d=new Zn,h=this.createLimbMesh(n,t,s,r);d.add(h),d.position.set(a/2+n/2,l,0),e.add(d),this.bodyParts.rightArm=d}createLegs(e){const t=Fn*1.5,n=Fn*.5,s=Fn*.5,r=[[0,20,4,12],[8,20,4,12],[4,16,4,4],[8,16,4,4],[4,20,4,12],[12,20,4,12]],a=Fn,o=-1.2000000000000002/2,l=new Zn,c=this.createLimbMesh(n,t,s,r);l.add(c),l.position.set(-a/4,o,0),e.add(l),this.bodyParts.leftLeg=l;const u=new Zn,d=this.createLimbMesh(n,t,s,r);u.add(d),u.position.set(a/4,o,0),e.add(u),this.bodyParts.rightLeg=u}disposeObject(e){e&&(e.isGroup?e.traverse(t=>{t.isMesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(n=>n.dispose()):t.material.dispose()))}):e.isMesh&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>t.dispose()):e.material.dispose())))}static async loadSkinTexture(e){return new Promise((t,n)=>{new fb().load(e,r=>{r.magFilter=wi,r.minFilter=wi,r.flipY=!1,t(r)},void 0,n)})}async applySkin(e){this.skinTexture=await ao.loadSkinTexture(e),this.mesh&&(Object.values(this.bodyParts).forEach(t=>{this.disposeObject(t),t&&this.mesh.remove(t)}),await this.createHead(this.mesh),this.createTorso(this.mesh),this.createArms(this.mesh),this.createLegs(this.mesh))}startWalking(){this.isWalking=!0,this.animationTime=0}stopWalking(){this.isWalking=!1,this.bodyParts.leftLeg&&(this.bodyParts.leftLeg.rotation.x=0),this.bodyParts.rightLeg&&(this.bodyParts.rightLeg.rotation.x=0),this.bodyParts.leftArm&&(this.bodyParts.leftArm.rotation.x=0),this.bodyParts.rightArm&&(this.bodyParts.rightArm.rotation.x=0)}updateAnimation(e){if(!this.isWalking||!this.mesh)return;this.animationTime+=e;const t=1,s=this.animationTime%t/t*Math.PI*2;let r=Math.sin(s)*(Math.PI/6),a=-Math.sin(s)*(Math.PI/6),o=-Math.sin(s)*(Math.PI/4),l=Math.sin(s)*(Math.PI/4);this.walkDirection<0&&([r,a]=[l,o]),this.bodyParts.leftLeg&&(this.bodyParts.leftLeg.rotation.x=r),this.bodyParts.rightLeg&&(this.bodyParts.rightLeg.rotation.x=a),this.bodyParts.leftArm&&(this.bodyParts.leftArm.rotation.x=o),this.bodyParts.rightArm&&(this.bodyParts.rightArm.rotation.x=l)}static async create(e="red",t=!1,n=!0){const s=new ao(e,t),r=await s.createBrick();return r.userData.minifigureInstance=s,r}}const Ml=Object.freeze(Object.defineProperty({__proto__:null,Minifigure:ao},Symbol.toStringTag,{value:"Module"})),$O={class:"minifigure-palette"},XO={class:"minifigure-palette__content"},qO={class:"minifigure-palette__section"},YO={class:"minifigure-palette__section-title"},jO={class:"minifigure-palette__grid"},KO=["onMousedown","onTouchstart"],ZO={__name:"MinifigurePalette",props:{onCreateBlock:{type:Function,required:!0}},setup(i){const e=i,{t}=wn(),n=ze([{name:"steve",path:"/images/skins/steve.png",label:"Steve"},{name:"pinguin",path:"/images/skins/pinguin.png",label:"Penguin"},{name:"santa",path:"/images/skins/santa.png",label:"Santa"},{name:"zombie",path:"/images/skins/zombie.png",label:"Zombie"},{name:"walter",path:"/images/skins/walter.png",label:"Walter"},{name:"farmer",path:"/images/skins/farmer.png",label:"Farmer"},{name:"chad",path:"/images/skins/chad.png",label:"Chad"},{name:"lego_green",path:"/images/skins/lego_green.png",label:"Lego Green"},{name:"capibara",path:"/images/skins/capibara.png",label:"Capybara"},{name:"trump",path:"/images/skins/trump.png",label:"Trump"},{name:"guy",path:"/images/skins/guy.png",label:"Guy"},{name:"gta",path:"/images/skins/gta.png",label:"GTA"},{name:"sandwitch",path:"/images/skins/sandwitch.png",label:"Sandwich"},{name:"lego_orange",path:"/images/skins/lego_orange.png",label:"Lego Orange"},{name:"lego_red",path:"/images/skins/lego_red.png",label:"Lego Red"}]),s=async l=>{const c=await ao.create("red",!1,!1);if(c.userData.minifigureInstance)try{await c.userData.minifigureInstance.applySkin(l)}catch(u){console.error("Failed to load skin for preview:",u)}return c},r=async l=>{const c=await ao.create("red",!1,!0);if(c.userData.minifigureInstance)try{await c.userData.minifigureInstance.applySkin(l)}catch(u){console.error("Failed to load skin for minifigure:",u)}return c},a=async(l,c)=>{l.preventDefault();const u=await r(c.path);e.onCreateBlock&&e.onCreateBlock(u,l.clientX,l.clientY)},o=async(l,c)=>{l.preventDefault();const u=l.touches[0],d=await r(c.path);e.onCreateBlock&&e.onCreateBlock(d,u.clientX,u.clientY)};return(l,c)=>(oe(),ge("div",$O,[B("div",XO,[B("div",qO,[B("h4",YO,se(l.$t("builder.minifigures")),1),B("div",jO,[(oe(!0),ge(At,null,Zt(n.value,u=>(oe(),ge("div",{key:u.name,class:"minifigure-palette__card",onMousedown:d=>a(d,u),onTouchstart:d=>o(d,u),draggable:"false"},[we(WO,{label:u.label,"skin-path":u.path,"create-minifigure-fn":()=>s(u.path)},null,8,["label","skin-path","create-minifigure-fn"])],40,KO))),128))])])])]))}},Cb=Ht(ZO,[["__scopeId","data-v-eb12a75e"]]),JO={class:"builder-info"},QO={class:"builder-info__content"},eN={class:"builder-info__section"},tN={class:"builder-info__section-title"},nN={class:"builder-info__list"},iN={__name:"BuilderInfo",setup(i){const{t:e}=wn();return(t,n)=>(oe(),ge("div",JO,[B("div",QO,[B("div",eN,[B("h4",tN,se(t.$t("builder.controls")),1),B("ul",nN,[B("li",null,se(t.$t("builder.controlDrag")),1),B("li",null,se(t.$t("builder.controlRotate")),1),B("li",null,se(t.$t("builder.controlDelete")),1),B("li",null,se(t.$t("builder.controlZoom")),1),B("li",null,se(t.$t("builder.controlCamera")),1)])])])]))}},Pb=Ht(iN,[["__scopeId","data-v-6d80a859"]]),sN={class:"builder-sidebar"},rN={class:"builder-sidebar__tabs"},aN=["onClick"],oN={class:"builder-sidebar__content"},lN={key:0,class:"builder-sidebar__tab-panel"},cN={key:1,class:"builder-sidebar__tab-panel"},uN={key:2,class:"builder-sidebar__tab-panel"},dN={key:3,class:"builder-sidebar__tab-panel"},hN={__name:"BuilderSidebar",props:{buildJson:{type:String,default:""}},emits:["export","export-as-code","import","load-test","clear","json-change","platform-size-change","create-block","screenshot","save-set"],setup(i){const{t:e}=wn(),t=ze("general"),n=tt(()=>[{id:"general",label:e("builder.tabs.general")},{id:"blocks",label:e("builder.tabs.blocks")},{id:"minifigures",label:e("builder.tabs.minifigures")},{id:"info",label:e("builder.tabs.info")}]);return(s,r)=>(oe(),ge("div",sN,[B("div",rN,[(oe(!0),ge(At,null,Zt(n.value,a=>(oe(),ge("button",{key:a.id,onClick:o=>t.value=a.id,class:qt(["builder-sidebar__tab",{"builder-sidebar__tab--active":t.value===a.id}])},se(a.label),11,aN))),128))]),B("div",oN,[t.value==="general"?(oe(),ge("div",lN,[we($B,{"build-json":i.buildJson,onExport:r[0]||(r[0]=a=>s.$emit("export")),onExportAsCode:r[1]||(r[1]=a=>s.$emit("export-as-code")),onImport:r[2]||(r[2]=a=>s.$emit("import")),onLoadTest:r[3]||(r[3]=a=>s.$emit("load-test")),onClear:r[4]||(r[4]=a=>s.$emit("clear")),onJsonChange:r[5]||(r[5]=a=>s.$emit("json-change",a)),onPlatformSizeChange:r[6]||(r[6]=a=>s.$emit("platform-size-change",a)),onScreenshot:r[7]||(r[7]=a=>s.$emit("screenshot")),onSaveSet:r[8]||(r[8]=a=>s.$emit("save-set"))},null,8,["build-json"])])):Ve("",!0),t.value==="blocks"?(oe(),ge("div",cN,[we(Ab,{"on-create-block":(a,o,l)=>s.$emit("create-block",a,o,l)},null,8,["on-create-block"])])):Ve("",!0),t.value==="minifigures"?(oe(),ge("div",uN,[we(Cb,{"on-create-block":(a,o,l)=>s.$emit("create-block",a,o,l)},null,8,["on-create-block"])])):Ve("",!0),t.value==="info"?(oe(),ge("div",dN,[we(Pb)])):Ve("",!0)])]))}},fN=Ht(hN,[["__scopeId","data-v-561d4dc2"]]),pN={key:0,class:"loading__spinner"},mN={key:1,class:"loading__dots"},_N={key:2,class:"loading__pulse"},vN={key:3,class:"loading__text"},gN={key:0,class:"loading__spinner"},yN={key:1,class:"loading__dots"},xN={key:2,class:"loading__pulse"},bN={key:3,class:"loading__text"},wN={__name:"Loading",props:{variant:{type:String,default:"spinner",validator:i=>["spinner","dots","pulse"].includes(i)},size:{type:String,default:"md",validator:i=>["sm","md","lg"].includes(i)},overlay:{type:Boolean,default:!1},text:{type:String,default:""}},setup(i){const e=i,t=tt(()=>"loading-overlay"),n=tt(()=>["loading",`loading._${e.size}`,`loading._${e.variant}`]);return(s,r)=>i.overlay?(oe(),ge("div",{key:0,class:qt(["loading-overlay",t.value])},[B("div",{class:qt(["loading",n.value])},[i.variant==="spinner"?(oe(),ge("div",pN,[...r[0]||(r[0]=[B("svg",{viewBox:"0 0 50 50",class:"spinner"},[B("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-dasharray":"31.416","stroke-dashoffset":"31.416"},[B("animate",{attributeName:"stroke-dasharray",dur:"2s",values:"0 31.416;15.708 15.708;0 31.416;0 31.416",repeatCount:"indefinite"}),B("animate",{attributeName:"stroke-dashoffset",dur:"2s",values:"0;-15.708;-31.416;-31.416",repeatCount:"indefinite"})])],-1)])])):i.variant==="dots"?(oe(),ge("div",mN,[...r[1]||(r[1]=[B("span",null,null,-1),B("span",null,null,-1),B("span",null,null,-1)])])):i.variant==="pulse"?(oe(),ge("div",_N,[...r[2]||(r[2]=[B("span",null,null,-1)])])):Ve("",!0),i.text?(oe(),ge("p",vN,se(i.text),1)):Ve("",!0)],2)],2)):(oe(),ge("div",{key:1,class:qt(["loading",n.value])},[i.variant==="spinner"?(oe(),ge("div",gN,[...r[3]||(r[3]=[B("svg",{viewBox:"0 0 50 50",class:"spinner"},[B("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-dasharray":"31.416","stroke-dashoffset":"31.416"},[B("animate",{attributeName:"stroke-dasharray",dur:"2s",values:"0 31.416;15.708 15.708;0 31.416;0 31.416",repeatCount:"indefinite"}),B("animate",{attributeName:"stroke-dashoffset",dur:"2s",values:"0;-15.708;-31.416;-31.416",repeatCount:"indefinite"})])],-1)])])):i.variant==="dots"?(oe(),ge("div",yN,[...r[4]||(r[4]=[B("span",null,null,-1),B("span",null,null,-1),B("span",null,null,-1)])])):i.variant==="pulse"?(oe(),ge("div",xN,[...r[5]||(r[5]=[B("span",null,null,-1)])])):Ve("",!0),i.text?(oe(),ge("p",bN,se(i.text),1)):Ve("",!0)],2))}},ca=Ht(wN,[["__scopeId","data-v-04f323b9"]]),SN={class:"save-set-modal"},EN={class:"save-set-modal__field"},MN={class:"save-set-modal__label",for:"set-name"},TN=["placeholder"],AN={class:"save-set-modal__hint"},CN={__name:"SaveSetModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","save"],setup(i,{emit:e}){const t=i,n=e,{t:s}=wn();es();const r=ze(""),a=ze(null),o=tt(()=>r.value.trim().length>0&&r.value.trim().length<=50);Wn(()=>t.modelValue,u=>{u&&(r.value="",Cr(()=>{a.value&&a.value.focus()}))});const l=()=>{o.value&&(n("save",r.value.trim()),r.value="")},c=()=>{r.value="",n("update:modelValue",!1)};return(u,d)=>(oe(),jt(Pr,{"model-value":i.modelValue,title:u.$t("collections.saveSet"),size:"sm","onUpdate:modelValue":d[1]||(d[1]=h=>u.$emit("update:modelValue",h)),onClose:c},{footer:Le(()=>[we(wt,{variant:"secondary",size:"md",onClick:c},{default:Le(()=>[Oe(se(u.$t("collections.cancel")),1)]),_:1}),we(wt,{variant:"primary",size:"md",disabled:!o.value,onClick:l},{default:Le(()=>[Oe(se(u.$t("collections.save")),1)]),_:1},8,["disabled"])]),default:Le(()=>[B("div",SN,[B("div",EN,[B("label",MN,se(u.$t("collections.setName")),1),CS(B("input",{id:"set-name",ref_key:"nameInput",ref:a,"onUpdate:modelValue":d[0]||(d[0]=h=>r.value=h),type:"text",class:"save-set-modal__input",placeholder:u.$t("collections.setNamePlaceholder"),maxlength:"50",onKeyup:[ad(l,["enter"]),ad(c,["esc"])]},null,40,TN),[[o1,r.value]]),B("p",AN,se(r.value.length)+"/50 "+se(u.$t("collections.characters")),1)])])]),_:1},8,["model-value","title"]))}},PN=Ht(CN,[["__scopeId","data-v-f275278d"]]),RN={class:"lego-builder"},LN={class:"lego-builder__sidebar"},IN={key:0,class:"lego-builder__mobile-toolbar"},DN={key:1,class:"lego-builder__selection-info"},kN={class:"selection-info"},BN={class:"selection-info__title"},ON={class:"selection-info__details"},NN={class:"selection-info__detail"},FN={class:"selection-info__label"},UN={class:"selection-info__detail"},zN={class:"selection-info__label"},VN={class:"color-modal__content"},GN={class:"color-modal__row"},HN=["onClick","title"],WN={class:"color-modal__row"},$N=["onClick","title"],XN={class:"color-modal__row"},qN=["onClick","title"],YN={__name:"LegoBuilder",setup(i){const{t:e}=wn(),t=es(),n=ze(null),s=ze(""),r=ze(null),a=ze(!1),o=ze("brick-2x2"),l=ze("red"),c=ze(!1),u=ze(null),d=ze(!0),h=ze(null),f=ze(!1),p=ze(!1),m=ze(!1),_=["red","blue","yellow","green"],v=["orange","purple","pink","white"],x=["brightGreen","brown","black","gray"];let y=null;In(async()=>{if(n.value){y=new vB(n.value),await y.loadingPromise,d.value=!1,a.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768,y.selectionManager.onSelectionChange=X=>{r.value=X};const F=sessionStorage.getItem("loadCollectionId");F&&(sessionStorage.removeItem("loadCollectionId"),await ee(F)),window.addEventListener("resize",g)}}),Ds(()=>{y&&y.dispose(),window.removeEventListener("resize",g)});const g=ya(()=>{y&&y.resize()},200),w=()=>{if(!y)return;const F=y.saveLoadManager.exportBuild();s.value=F,navigator.clipboard.writeText(F).catch(()=>{}),h.value&&h.value.addToast({type:"success",title:e("builder.buildSaved"),message:e("builder.buildSaved"),duration:2e3})},b=()=>{if(y)try{const F=y.saveLoadManager.exportBuild(),X=JSON.parse(F),Q=Zm(X);navigator.clipboard.writeText(Q).catch(()=>{}),h.value&&h.value.addToast({type:"success",title:e("collections.codeCopied"),message:e("collections.codeCopied"),duration:2e3})}catch(F){console.error("Failed to export as code:",F),h.value&&h.value.addToast({type:"error",title:e("common.error"),message:"Failed to export as code",duration:3e3})}},T=async()=>{if(!(!y||!s.value.trim()))try{await y.saveLoadManager.importBuild(s.value),h.value&&h.value.addToast({type:"success",title:e("builder.buildLoaded"),message:e("builder.buildLoaded"),duration:2e3})}catch(F){console.error("Import error:",F),h.value&&h.value.addToast({type:"error",title:e("common.error"),message:F.message||e("builder.importFailed"),duration:3e3})}},E=async()=>{if(!y)return;const F=`{
  "version": "2.0",
  "timestamp": "2025-11-02T06:06:14.891Z",
  "blocks": [
    {
      "type": "2x6",
      "blockType": "brick",
      "width": 2,
      "length": 6,
      "blockHeight": 0.96,
      "color": "red",
      "isGlass": false,
      "position": {
        "x": 0.8,
        "y": 0.481,
        "z": 0.8
      },
      "rotation": {
        "x": 0,
        "y": 0,
        "z": 0
      }
    },
    {
      "type": "2x6",
      "blockType": "brick",
      "width": 2,
      "length": 6,
      "blockHeight": 0.96,
      "color": "blue",
      "isGlass": false,
      "position": {
        "x": 0.8,
        "y": 1.442,
        "z": 0.8
      },
      "rotation": {
        "x": 0,
        "y": 0,
        "z": 0
      }
    },
    {
      "type": "2x6",
      "blockType": "brick",
      "width": 2,
      "length": 6,
      "blockHeight": 0.96,
      "color": "white",
      "isGlass": false,
      "position": {
        "x": 0.8,
        "y": 2.403,
        "z": 0.8
      },
      "rotation": {
        "x": 0,
        "y": 0,
        "z": 0
      }
    }
  ]
}`;s.value=F,await T()},S=()=>{y&&(y.saveLoadManager.clearAllBlocks(),s.value="",h.value&&h.value.addToast({type:"success",title:e("builder.buildCleared"),message:e("builder.buildCleared"),duration:2e3}))},M=async F=>{F!==void 0&&(s.value=F),s.value.trim()&&s.value.includes('"blocks"')&&setTimeout(async()=>{s.value.trim()&&await T()},1e3)},A=()=>{if(y&&r.value){const F=new KeyboardEvent("keydown",{key:"r"});y.onKeyDown(F)}},C=()=>{if(y&&r.value){const F=new KeyboardEvent("keydown",{key:"Delete"});y.onKeyDown(F)}},I=F=>!F||!F.userData?!1:F.userData.isGlass===!0,H=(F,X,Q)=>{if(!y||!F)return;u.value=F,y.addBrick(F),y.selectionManager&&y.selectionManager.selectBrick(F);const ue=n.value.getBoundingClientRect(),ce=X-ue.left,xe=Q-ue.top,Me={x:ce/ue.width*2-1,y:-(xe/ue.height*2)+1};if(y.dragController){y.dragController.mouse.set(Me.x,Me.y),y.dragController.raycaster.setFromCamera(y.dragController.mouse,y.dragController.camera);const Y=y.dragController.threeScene.children.filter(R=>R.userData.isGround),P=y.dragController.raycaster.intersectObjects(Y,!0);if(P.length>0){const R=P[0].point;if(y.placementManager){const N=y.placementManager.getPreviewPosition(F,R);F.position.copy(N)}else F.position.copy(R)}y.dragController.startDraggingFromPalette(F)}},W=F=>{y&&y.setPlatformSize(F)},z=()=>{if(!y||!y.renderer||!y.scene||!y.camera){h.value&&h.value.addToast({type:"error",title:e("builder.screenshotError"),message:e("builder.sceneNotReady"),duration:3e3});return}try{y.controls&&y.controls.update(),requestAnimationFrame(()=>{try{y.renderer.render(y.scene,y.camera),requestAnimationFrame(()=>{try{const F=y.renderer.domElement;if(!F||F.width===0||F.height===0)throw new Error("Canvas is not ready");const X=y.renderer.getContext(),Q=F.width,ue=F.height;let ce;try{if(ce=F.toDataURL("image/png",1),!ce||ce==="data:,")throw new Error("toDataURL returned empty data")}catch(Y){console.warn("toDataURL failed, using readPixels fallback:",Y);const P=new Uint8Array(Q*ue*4);X.readPixels(0,0,Q,ue,X.RGBA,X.UNSIGNED_BYTE,P);const R=new Uint8Array(Q*ue*4);for(let ye=0;ye<ue;ye++){const ve=ye*Q*4,k=(ue-1-ye)*Q*4;R.set(P.subarray(ve,ve+Q*4),k)}const N=document.createElement("canvas");N.width=Q,N.height=ue;const $=N.getContext("2d"),ie=$.createImageData(Q,ue);ie.data.set(R),$.putImageData(ie,0,0),ce=N.toDataURL("image/png",1)}const xe=q(ce),Me=`lego-builder-screenshot-${Date.now()}.png`;O(Me,xe),h.value&&h.value.addToast({type:"success",title:e("builder.screenshotSaved"),message:e("builder.screenshotSaved"),duration:2e3})}catch(F){console.error("Screenshot capture failed:",F),h.value&&h.value.addToast({type:"error",title:e("builder.screenshotError"),message:F.message||e("builder.screenshotFailed"),duration:3e3})}})}catch(F){console.error("Screenshot render failed:",F),h.value&&h.value.addToast({type:"error",title:e("builder.screenshotError"),message:F.message||e("builder.screenshotFailed"),duration:3e3})}})}catch(F){console.error("Screenshot failed:",F),h.value&&h.value.addToast({type:"error",title:e("builder.screenshotError"),message:F.message||e("builder.screenshotFailed"),duration:3e3})}},q=F=>{const X=F.split(","),Q=X[0].match(/:(.*?);/)[1],ue=atob(X[1]);let ce=ue.length;const xe=new Uint8Array(ce);for(;ce--;)xe[ce]=ue.charCodeAt(ce);return new Blob([xe],{type:Q})},O=(F,X)=>{const Q=URL.createObjectURL(X),ue=document.createElement("a");ue.href=Q,ue.download=F,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),URL.revokeObjectURL(Q)},re=F=>{l.value=F,a.value||(p.value=!1)},le=F=>xd[F]||xd.red,Z=(F,X,Q)=>{if(H(F,X||window.innerWidth/2,Q||window.innerHeight/2),f.value=!1,F.userData){const ue=F.userData.width||2,ce=F.userData.length||2;o.value=`brick-${ue}x${ce}`,l.value=F.userData.color||"red",c.value=F.userData.isGlass||!1}},ne=()=>{var Q;if(!y)return;if(!(((Q=y.placementManager)==null?void 0:Q.getAllBlocks())||[]).some(ue=>{var ce;return!((ce=ue.userData)!=null&&ce.isBasePlate)})){h.value&&h.value.addToast({type:"warning",title:e("collections.noBlocksToSave"),message:e("collections.noBlocksToSaveMessage"),duration:3e3});return}m.value=!0},j=async F=>{if(!(!y||!F))try{const X=y.saveLoadManager.exportBuild(),Q=JSON.parse(X);await t.dispatch("collections/saveCollection",{name:F,buildData:Q}),m.value=!1,h.value&&h.value.addToast({type:"success",title:e("collections.setSaved"),message:e("collections.setSavedMessage",{name:F}),duration:3e3})}catch(X){console.error("Failed to save set:",X),h.value&&h.value.addToast({type:"error",title:e("common.error"),message:X.message||e("collections.setSaveFailed"),duration:3e3})}},ee=async F=>{if(y)try{const X=t.getters["collections/allCollections"].find(ue=>ue.id===F);if(!X){console.warn("Collection not found:",F);return}y.saveLoadManager.clearAllBlocks();const Q=JSON.stringify(X.buildData);await y.saveLoadManager.importBuild(Q),s.value=Q,h.value&&h.value.addToast({type:"success",title:e("builder.buildLoaded"),message:e("collections.editSet")+": "+X.name,duration:3e3})}catch(X){console.error("Failed to load collection:",X),h.value&&h.value.addToast({type:"error",title:e("common.error"),message:"Failed to load collection",duration:3e3})}};return(F,X)=>(oe(),ge("div",RN,[B("div",LN,[we(fN,{"build-json":s.value,onExport:w,onExportAsCode:b,onImport:T,onLoadTest:E,onClear:S,onJsonChange:M,onPlatformSizeChange:W,onCreateBlock:H,onScreenshot:z,onSaveSet:ne},null,8,["build-json"])]),B("div",{ref_key:"threeContainer",ref:n,class:"lego-builder__canvas"},[a.value?(oe(),ge("div",IN,[we(wt,{variant:"ghost",size:"md",onClick:X[0]||(X[0]=Q=>f.value=!0),class:"mobile-toolbar__btn"},{"icon-left":Le(()=>[...X[7]||(X[7]=[Oe("",-1)])]),default:Le(()=>[Oe(" "+se(F.$t("builder.selectBlock")),1)]),_:1}),we(wt,{variant:"ghost",size:"md",onClick:X[1]||(X[1]=Q=>p.value=!0),class:"mobile-toolbar__btn",style:fi({backgroundColor:le(l.value)})},{default:Le(()=>[Oe(se(F.$t(`colors.${l.value}`)),1)]),_:1},8,["style"]),we(wt,{variant:"primary",size:"md",onClick:A,disabled:!r.value,class:"mobile-toolbar__btn"},{"icon-left":Le(()=>[...X[8]||(X[8]=[Oe("",-1)])]),default:Le(()=>[Oe(" "+se(F.$t("builder.rotate")),1)]),_:1},8,["disabled"]),we(wt,{variant:"danger",size:"md",onClick:C,disabled:!r.value,class:"mobile-toolbar__btn"},{"icon-left":Le(()=>[...X[9]||(X[9]=[Oe("",-1)])]),default:Le(()=>[Oe(" "+se(F.$t("builder.delete")),1)]),_:1},8,["disabled"])])):Ve("",!0),r.value?(oe(),ge("div",DN,[B("div",kN,[B("h4",BN,se(F.$t("builder.selectedBlock")),1),B("div",ON,[B("p",NN,[B("span",FN,se(F.$t("blocks.size"))+":",1),Oe(" "+se(r.value.userData.width)+"x"+se(r.value.userData.length),1)]),B("p",UN,[B("span",zN,se(F.$t("blocks.color"))+":",1),Oe(" "+se(F.$t(`colors.${r.value.userData.color}`)),1)]),I(r.value)?(oe(),jt(_n,{key:0,variant:"success",size:"sm",class:"selection-info__badge"},{default:Le(()=>[Oe(se(F.$t("builder.glass")),1)]),_:1})):Ve("",!0)])])])):Ve("",!0),d.value?(oe(),jt(ca,{key:2,variant:"spinner",size:"lg",text:F.$t("common.loading"),overlay:""},null,8,["text"])):Ve("",!0)],512),we(ga,{position:"top-center",ref_key:"toastContainer",ref:h},null,512),we(Pr,{modelValue:f.value,"onUpdate:modelValue":X[2]||(X[2]=Q=>f.value=Q),title:F.$t("builder.blockPalette"),size:"lg",onClose:X[3]||(X[3]=Q=>f.value=!1)},{default:Le(()=>[f.value?(oe(),jt(Ab,{key:0,"on-create-block":Z})):Ve("",!0)]),_:1},8,["modelValue","title"]),we(Pr,{modelValue:p.value,"onUpdate:modelValue":X[4]||(X[4]=Q=>p.value=Q),title:F.$t("builder.colors"),size:"md",onClose:X[5]||(X[5]=Q=>p.value=!1)},{default:Le(()=>[B("div",VN,[B("div",GN,[(oe(),ge(At,null,Zt(_,Q=>B("button",{key:Q,onClick:ue=>re(Q),class:qt(["color-modal__button",{"color-modal__button--active":l.value===Q}]),style:fi({backgroundColor:le(Q)}),title:F.$t(`colors.${Q}`)},null,14,HN)),64))]),B("div",WN,[(oe(),ge(At,null,Zt(v,Q=>B("button",{key:Q,onClick:ue=>re(Q),class:qt(["color-modal__button",{"color-modal__button--active":l.value===Q}]),style:fi({backgroundColor:le(Q)}),title:F.$t(`colors.${Q}`)},null,14,$N)),64))]),B("div",XN,[(oe(),ge(At,null,Zt(x,Q=>B("button",{key:Q,onClick:ue=>re(Q),class:qt(["color-modal__button",{"color-modal__button--active":l.value===Q}]),style:fi({backgroundColor:le(Q)}),title:F.$t(`colors.${Q}`)},null,14,qN)),64))])])]),_:1},8,["modelValue","title"]),we(PN,{modelValue:m.value,"onUpdate:modelValue":X[6]||(X[6]=Q=>m.value=Q),onSave:j},null,8,["modelValue"])]))}},jN=Ht(YN,[["__scopeId","data-v-d3dcc8d4"]]);let qu=[],cf=!1;const Bl=new Map,KN=async()=>{if(!(cf||qu.length===0)){for(cf=!0;qu.length>0;){const i=qu.shift();try{await i(),await new Promise(e=>setTimeout(e,50))}catch(e){console.error("Set render task failed:",e)}}cf=!1}},ZN={name:"Set3DPreview",components:{Loading:ca},props:{set:{type:Object,required:!0,validator:i=>i&&i.id&&Array.isArray(i.blocks)}},setup(i){const e=ze(null),t=async s=>{let r;try{if(s.specialType)switch(s.specialType){case"cylinder-1x1":const{Cylinder1x1:c}=await ae(async()=>{const{Cylinder1x1:g}=await import("./Cylinder1x1-CatK-O-Q.js");return{Cylinder1x1:g}},[],import.meta.url);r=c;break;case"cylinder-plate-1x1":const{CylinderPlate1x1:u}=await ae(async()=>{const{CylinderPlate1x1:g}=await import("./CylinderPlate1x1-C9BKk24L.js");return{CylinderPlate1x1:g}},[],import.meta.url);r=u;break;case"cylinder-plate-2x2":const{CylinderPlate2x2:d}=await ae(async()=>{const{CylinderPlate2x2:g}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:g}},[],import.meta.url);r=d;break;case"flat-plate-1x1":const{FlatPlate1x1:h}=await ae(async()=>{const{FlatPlate1x1:g}=await import("./FlatPlate1x1-COVjvhfm.js");return{FlatPlate1x1:g}},[],import.meta.url);r=h;break;case"flat-plate-1x2":const{FlatPlate1x2:f}=await ae(async()=>{const{FlatPlate1x2:g}=await import("./FlatPlate1x2-WO8sp-SC.js");return{FlatPlate1x2:g}},[],import.meta.url);r=f;break;case"flat-plate-1x2-center-stud":const{FlatPlate1x2CenterStud:p}=await ae(async()=>{const{FlatPlate1x2CenterStud:g}=await import("./FlatPlate1x2CenterStud-CgU774Nu.js");return{FlatPlate1x2CenterStud:g}},__vite__mapDeps([0,1]),import.meta.url);r=p;break;case"flat-plate-1x4":const{FlatPlate1x4:m}=await ae(async()=>{const{FlatPlate1x4:g}=await import("./FlatPlate1x4-BhPvU6tM.js");return{FlatPlate1x4:g}},[],import.meta.url);r=m;break;case"minifigure":const{Minifigure:_}=await ae(async()=>{const{Minifigure:g}=await Promise.resolve().then(()=>Ml);return{Minifigure:g}},void 0,import.meta.url);r=_;break;case"side-stud-brick-1x1":const{SideStudBrick1x1:v}=await ae(async()=>{const{SideStudBrick1x1:g}=await import("./SideStudBrick1x1-Bw5mv8V9.js");return{SideStudBrick1x1:g}},__vite__mapDeps([2,3]),import.meta.url);r=v;break;case"corner-brick-1x1":const{CornerBrick1x1:x}=await ae(async()=>{const{CornerBrick1x1:g}=await import("./CornerBrick1x1-2hjvabOl.js");return{CornerBrick1x1:g}},[],import.meta.url);r=x;break;case"stepped-brick-2x2":const{SteppedBrick2x2:y}=await ae(async()=>{const{SteppedBrick2x2:g}=await import("./SteppedBrick2x2-DHsbtfck.js");return{SteppedBrick2x2:g}},[],import.meta.url);r=y;break;default:break}if(!r){let c=s.blockType==="plate",u=s.width||1,d=s.length||1;if(s.type&&s.type.includes("-")){const f=s.type.split("-");if(f.length>=2){const p=f[0],m=f[1];c=p==="plate";const _=m.split("x");_.length===2&&(u=parseInt(_[0])||u,d=parseInt(_[1])||d)}}switch(`${c?"Plate":"Brick"}_${u}X${d}`){case"Brick_1X1":const{Brick1x1:f}=await ae(async()=>{const{Brick1x1:j}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:j}},[],import.meta.url);r=f;break;case"Brick_1X2":const{Brick1x2:p}=await ae(async()=>{const{Brick1x2:j}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:j}},[],import.meta.url);r=p;break;case"Brick_1X3":const{Brick1x3:m}=await ae(async()=>{const{Brick1x3:j}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:j}},[],import.meta.url);r=m;break;case"Brick_1X4":const{Brick1x4:_}=await ae(async()=>{const{Brick1x4:j}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:j}},[],import.meta.url);r=_;break;case"Brick_1X6":const{Brick1x6:v}=await ae(async()=>{const{Brick1x6:j}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:j}},[],import.meta.url);r=v;break;case"Brick_1X8":const{Brick1x8:x}=await ae(async()=>{const{Brick1x8:j}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:j}},[],import.meta.url);r=x;break;case"Brick_1X12":const{Brick1x12:y}=await ae(async()=>{const{Brick1x12:j}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:j}},[],import.meta.url);r=y;break;case"Brick_2X2":const{Brick2x2:g}=await ae(async()=>{const{Brick2x2:j}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:j}},[],import.meta.url);r=g;break;case"Brick_2X3":const{Brick2x3:w}=await ae(async()=>{const{Brick2x3:j}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:j}},[],import.meta.url);r=w;break;case"Brick_2X4":const{Brick2x4:b}=await ae(async()=>{const{Brick2x4:j}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:j}},[],import.meta.url);r=b;break;case"Brick_2X6":const{Brick2x6:T}=await ae(async()=>{const{Brick2x6:j}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:j}},[],import.meta.url);r=T;break;case"Brick_2X8":const{Brick2x8:E}=await ae(async()=>{const{Brick2x8:j}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:j}},[],import.meta.url);r=E;break;case"Plate_1X1":const{Plate1x1:S}=await ae(async()=>{const{Plate1x1:j}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:j}},[],import.meta.url);r=S;break;case"Plate_1X2":const{Plate1x2:M}=await ae(async()=>{const{Plate1x2:j}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:j}},[],import.meta.url);r=M;break;case"Plate_1X3":const{Plate1x3:A}=await ae(async()=>{const{Plate1x3:j}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:j}},[],import.meta.url);r=A;break;case"Plate_1X4":const{Plate1x4:C}=await ae(async()=>{const{Plate1x4:j}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:j}},[],import.meta.url);r=C;break;case"Plate_1X6":const{Plate1x6:I}=await ae(async()=>{const{Plate1x6:j}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:j}},[],import.meta.url);r=I;break;case"Plate_1X8":const{Plate1x8:H}=await ae(async()=>{const{Plate1x8:j}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:j}},[],import.meta.url);r=H;break;case"Plate_2X2":const{Plate2x2:W}=await ae(async()=>{const{Plate2x2:j}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:j}},[],import.meta.url);r=W;break;case"Plate_2X3":const{Plate2x3:z}=await ae(async()=>{const{Plate2x3:j}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:j}},[],import.meta.url);r=z;break;case"Plate_2X4":const{Plate2x4:q}=await ae(async()=>{const{Plate2x4:j}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:j}},[],import.meta.url);r=q;break;case"Plate_2X6":const{Plate2x6:O}=await ae(async()=>{const{Plate2x6:j}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:j}},[],import.meta.url);r=O;break;case"Plate_2X8":const{Plate2x8:re}=await ae(async()=>{const{Plate2x8:j}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:j}},[],import.meta.url);r=re;break;case"Plate_4X4":const{Plate4x4:le}=await ae(async()=>{const{Plate4x4:j}=await Promise.resolve().then(()=>ro);return{Plate4x4:j}},void 0,import.meta.url);r=le;break;case"Plate_4X8":const{Plate4x8:Z}=await ae(async()=>{const{Plate4x8:j}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:j}},[],import.meta.url);r=Z;break;default:const ne=s.blockType==="plate";if(u===1&&d===1)r=ne?(await ae(async()=>{const{Plate1x1:j}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:j}},[],import.meta.url)).Plate1x1:(await ae(async()=>{const{Brick1x1:j}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:j}},[],import.meta.url)).Brick1x1;else if(u===2&&d===2)if(ne)try{const{CylinderPlate2x2:j}=await ae(async()=>{const{CylinderPlate2x2:ee}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:ee}},[],import.meta.url);r=j}catch{r=(await ae(async()=>{const{Plate2x2:ee}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:ee}},[],import.meta.url)).Plate2x2}else r=(await ae(async()=>{const{Brick2x2:j}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:j}},[],import.meta.url)).Brick2x2;break}}if(!r)return console.warn("[Set3DPreview] Could not determine block class for:",s),null;const a=s.isGlass||!1,o=s.color||"red",l=r.create(o,a);return l?(s.specialType&&(l.userData.specialType=s.specialType),s.type&&(l.userData.type=s.type),s.width&&(l.userData.width=s.width),s.length&&(l.userData.length=s.length),s.blockHeight&&(l.userData.blockHeight=s.blockHeight),s.blockType&&(l.userData.blockType=s.blockType),s.color&&(l.userData.color=s.color),s.isGlass!==void 0&&(l.userData.isGlass=s.isGlass),l):null}catch(a){return console.error("[Set3DPreview] Error creating block:",a),null}},n=async()=>{if(!i.set||!i.set.blocks||i.set.blocks.length===0){console.warn("[Set3DPreview] Set has no blocks");return}const s=`set-${i.set.id}`;if(Bl.has(s)){const r=Bl.get(s);e.value=r;return}return new Promise(r=>{qu.push(async()=>{const l=new Qs;l.background=new Mt(16777215);const c=new An(45,240/240,.1,100),u=new er({antialias:!0,alpha:!0,powerPreference:"low-power"});u.setSize(240,240),u.shadowMap.enabled=!1;const d=new bl(16777215,.6);l.add(d);const h=new Bn(16777215,1);h.position.set(5,8,5),l.add(h);const f=new Qd(16777215,1.5);f.position.set(0,10,0),f.angle=Math.PI/4,f.penumbra=.5,f.target.position.set(0,0,0),l.add(f),l.add(f.target);const p=new Bn(16777215,.6);p.position.set(-5,3,-5),l.add(p);const m=new Bn(16777215,.5);m.position.set(0,-2,-8),l.add(m);const _=new Bn(16777215,.5);_.position.set(-3,2,-3),l.add(_);const v=[];try{for(const M of i.set.blocks){const A=await t(M);A&&(M.position&&A.position.set(M.position.x||0,M.position.y||0,M.position.z||0),M.rotation&&A.rotation.set(M.rotation.x||0,M.rotation.y||0,M.rotation.z||0),l.add(A),v.push(A))}}catch(M){console.error("[Set3DPreview] Error creating blocks:",M),u.dispose(),l.clear(),r();return}if(v.length===0){console.warn("[Set3DPreview] No blocks were created"),u.dispose(),l.clear(),r();return}const x=new kr;v.forEach(M=>{x.expandByObject(M)});const y=x.getSize(new fe),g=x.getCenter(new fe),b=Math.max(y.x,y.y,y.z)*1.75,T=Math.PI/6;c.position.set(g.x+b*Math.sin(T),g.y+b*Math.cos(T),g.z+b*Math.sin(T)),c.lookAt(g),u.render(l,c);const S=u.domElement.toDataURL("image/png",1);Bl.set(s,S),e.value=S,u.dispose(),v.forEach(M=>{M.traverse(A=>{A.geometry&&A.geometry.dispose(),A.material&&(Array.isArray(A.material)?A.material.forEach(C=>C.dispose()):A.material.dispose())})}),l.clear(),r()}),KN()})};return Wn(()=>{var s;return(s=i.set)==null?void 0:s.id},()=>{var r;const s=`set-${(r=i.set)==null?void 0:r.id}`;if(Bl.has(s)){e.value=Bl.get(s);return}e.value=null,Cr(()=>{n()})}),In(()=>{Cr(()=>{n()})}),{previewImage:e}}},JN={class:"set-3d-preview"},QN={class:"preview-container"},eF={key:0,class:"preview-image-wrapper"},tF=["src","alt"],nF={key:1,class:"preview-loading"},iF={key:2,class:"preview-extra"};function sF(i,e,t,n,s,r){const a=If("Loading");return oe(),ge("div",JN,[B("div",QN,[n.previewImage?(oe(),ge("div",eF,[B("img",{src:n.previewImage,alt:t.set.name,class:"preview-image",draggable:"false",onDragstart:e[0]||(e[0]=fc(()=>{},["prevent"]))},null,40,tF)])):(oe(),ge("div",nF,[we(a,{variant:"spinner",size:"sm"})])),i.$slots.extra?(oe(),ge("div",iF,[Hn(i.$slots,"extra",{},void 0)])):Ve("",!0)])])}const oo=Ht(ZN,[["render",sF],["__scopeId","data-v-9e248e62"]]),rF={class:"shop"},aF={class:"shop__content"},oF={class:"shop__header"},lF={class:"shop-header"},cF={class:"shop-header__title"},uF={class:"shop-header__filters"},dF={class:"shop__sets"},hF={key:1,class:"shop__empty"},fF={class:"empty-state"},pF={key:2,class:"shop__grid"},mF={class:"set-card__image"},_F={class:"set-card__info"},vF={class:"set-card__name"},gF={class:"set-card__description"},yF={class:"set-card__stats"},xF={class:"set-card__price"},bF={class:"set-card__price-amount"},wF={class:"set-card__actions"},SF={key:0,class:"purchase-modal__content"},EF={class:"purchase-modal__preview"},MF={class:"purchase-modal__image"},TF={class:"purchase-modal__info"},AF={class:"purchase-modal__stats"},CF={class:"purchase-modal__summary"},PF={class:"purchase-modal__cost"},RF={class:"purchase-modal__cost-item"},LF={class:"purchase-modal__cost-item purchase-modal__cost-item--total"},IF={class:"purchase-modal__balance"},DF={class:"purchase-modal__balance-remaining"},kF={__name:"Shop",setup(i){const e=es(),{t}=wn(),n=ze("all"),s=ze("all"),r=ze(!1),a=ze(null),o=ze(!1),l=ze(null),c=tt(()=>[{value:"all",label:t("shop.allSets")},{value:"available",label:t("shop.available")},{value:"purchased",label:t("shop.purchased")},{value:"easy",label:t("shop.easy")},{value:"medium",label:t("shop.medium")},{value:"hard",label:t("shop.hard")}]),u=tt(()=>[{value:"all",label:t("shop.allPrices")},{value:"0-500",label:t("shop.under500")},{value:"500-1000",label:t("shop.500to1000")},{value:"1000+",label:t("shop.above1000")}]),d=tt(()=>e.state.sets.isLoadingSets),h=tt(()=>e.state.sets.availableSets),f=tt(()=>e.state.player.coins),p=tt(()=>{let g=[...h.value];if(n.value==="available"?g=e.getters["sets/availableForPurchase"]:n.value==="purchased"?g=e.getters["sets/purchasedSets"]:["easy","medium","hard"].includes(n.value)&&(g=e.getters["sets/setsByDifficulty"](n.value)),s.value!=="all"){const w=s.value.split("-"),b=parseInt(w[0])||0,T=w[1]==="+"?1/0:parseInt(w[1])||1/0;g=g.filter(E=>{const S=E.price||0;return S>=b&&S<=T})}return g}),m=g=>e.getters["player/ownsSet"](g),_=g=>e.getters["player/canAfford"](g),v=g=>{a.value=g,r.value=!0},x=async()=>{if(a.value)try{o.value=!0,await e.dispatch("player/buySet",a.value),await e.dispatch("inventory/addSetBlocks",a.value.blocks),e.dispatch("player/trackEvent",{event:"set_purchased",data:{setId:a.value.id,price:a.value.price}}),l.value&&l.value.addToast({type:"success",title:t("shop.setPurchased"),message:t("shop.setPurchasedSuccess"),duration:3e3}),y()}catch(g){console.error("Purchase error:",g),l.value&&l.value.addToast({type:"error",title:t("common.error"),message:g.message||t("shop.purchaseFailed"),duration:4e3})}finally{o.value=!1}},y=()=>{r.value=!1,a.value=null};return In(()=>{h.value.length===0&&e.dispatch("sets/loadSetsFromJSON"),e.dispatch("player/trackEvent",{event:"shop_visited",data:{}})}),(g,w)=>(oe(),ge("div",rF,[B("div",aF,[B("div",oF,[B("div",lF,[B("div",cF,[B("h2",null," "+se(g.$t("shop.title")),1),B("p",null,se(g.$t("shop.description")),1)]),B("div",uF,[we(Sc,{modelValue:n.value,"onUpdate:modelValue":w[0]||(w[0]=b=>n.value=b),label:g.$t("shop.filter"),options:c.value,size:"sm"},null,8,["modelValue","label","options"]),we(Sc,{modelValue:s.value,"onUpdate:modelValue":w[1]||(w[1]=b=>s.value=b),label:g.$t("shop.priceRange"),options:u.value,size:"sm"},null,8,["modelValue","label","options"])])])]),B("div",dF,[d.value?(oe(),jt(ca,{key:0,variant:"spinner",size:"lg",text:g.$t("common.loading"),overlay:""},null,8,["text"])):p.value.length===0?(oe(),ge("div",hF,[B("div",fF,[w[3]||(w[3]=B("div",{class:"empty-state__icon"},"",-1)),B("h3",null,se(g.$t("shop.noSetsFound")),1),B("p",null,se(g.$t("shop.tryAdjustingFilters")),1)])])):(oe(),ge("div",pF,[(oe(!0),ge(At,null,Zt(p.value,b=>{var T;return oe(),ge("div",{key:b.id,class:qt(["set-card",{"set-card--purchased":m(b.id),"set-card--unavailable":!_(b.price)}])},[B("div",mF,[we(oo,{set:b},{extra:Le(()=>[m(b.id)?(oe(),jt(_n,{key:0,variant:"success",size:"sm",class:"set-card__badge"},{default:Le(()=>[Oe("  "+se(g.$t("shop.owned")),1)]),_:1})):Ve("",!0)]),_:2},1032,["set"])]),B("div",_F,[B("h3",vF,se(b.name),1),B("p",gF,se(b.description),1),B("div",yF,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>[Oe("  "+se(b.pieces)+" "+se(g.$t("shop.pieces")),1)]),_:2},1024),we(_n,{variant:"default",size:"sm"},{default:Le(()=>[Oe("  "+se(b.difficulty),1)]),_:2},1024)]),B("div",xF,[w[4]||(w[4]=B("span",{class:"set-card__price-icon"},"",-1)),B("span",bF,se(b.price.toLocaleString()),1)])]),B("div",wF,[m(b.id)?(oe(),jt(wt,{key:0,variant:"outline","full-width":"",disabled:""},{default:Le(()=>[Oe("  "+se(g.$t("shop.owned")),1)]),_:1})):_(b.price)?(oe(),jt(wt,{key:2,variant:"primary","full-width":"",loading:o.value&&((T=a.value)==null?void 0:T.id)===b.id,onClick:E=>v(b)},{default:Le(()=>[Oe(se(g.$t("shop.buy")),1)]),_:1},8,["loading","onClick"])):(oe(),jt(wt,{key:1,variant:"outline","full-width":"",disabled:""},{default:Le(()=>[Oe("  "+se(g.$t("shop.notEnoughCoins")),1)]),_:1}))])],2)}),128))]))])]),we(Pr,{modelValue:r.value,"onUpdate:modelValue":w[2]||(w[2]=b=>r.value=b),title:g.$t("shop.confirmPurchase"),size:"md",onClose:y},{footer:Le(()=>[we(wt,{variant:"outline",onClick:y},{default:Le(()=>[Oe(se(g.$t("common.cancel")),1)]),_:1}),we(wt,{variant:"primary",loading:o.value,disabled:o.value,onClick:x},{default:Le(()=>[Oe(se(g.$t("shop.confirmPurchase")),1)]),_:1},8,["loading","disabled"])]),default:Le(()=>[a.value?(oe(),ge("div",SF,[B("div",EF,[B("div",MF,[we(oo,{set:a.value},null,8,["set"])]),B("div",TF,[B("h4",null,se(a.value.name),1),B("p",null,se(a.value.description),1),B("div",AF,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>[Oe("  "+se(a.value.pieces)+" "+se(g.$t("shop.pieces")),1)]),_:1}),we(_n,{variant:"default",size:"sm"},{default:Le(()=>[Oe("  "+se(a.value.difficulty),1)]),_:1})])])]),B("div",CF,[B("div",PF,[B("div",RF,[B("span",null,se(g.$t("shop.setPrice"))+":",1),B("span",null," "+se(a.value.price.toLocaleString()),1)]),B("div",LF,[B("span",null,se(g.$t("shop.totalCost"))+":",1),B("span",null," "+se(a.value.price.toLocaleString()),1)])]),B("div",IF,[B("span",null,se(g.$t("shop.yourBalance"))+":  "+se(f.value.toLocaleString()),1),B("span",DF,se(g.$t("shop.remaining"))+":  "+se((f.value-a.value.price).toLocaleString()),1)])])])):Ve("",!0)]),_:1},8,["modelValue","title"]),we(ga,{position:"top-center",ref_key:"toastContainer",ref:l},null,512)]))}},BF=Ht(kF,[["__scopeId","data-v-2209219b"]]),OF={class:"set-selection"},NF={class:"set-selection__content"},FF={class:"set-selection__header"},UF={class:"set-selection__title"},zF={key:0,class:"set-selection__subtitle"},VF={key:0,class:"set-selection__grid"},GF=["onClick"],HF={class:"set-card__image"},WF=["src","alt"],$F={key:1,class:"set-card__image-placeholder"},XF={class:"set-card__info"},qF={class:"set-card__name"},YF={key:0,class:"set-card__description"},jF={class:"set-card__details"},KF={key:1,class:"set-selection__empty"},ZF={class:"empty-state"},JF={__name:"SetSelection",setup(i){const e=es(),{t}=wn(),n=ze(null),s=tt(()=>e.getters["sets/purchasedSets"]),r=async c=>{try{await e.dispatch("sets/selectSet",c.id),e.dispatch("navigateToScene","box-opening")}catch(u){console.error("Failed to select set:",u),n.value&&n.value.addToast({type:"error",message:t("assembly.wrongBlock"),duration:3e3})}},a=()=>{e.dispatch("navigateToScene","shop")},o=c=>({easy:"success",medium:"warning",hard:"danger"})[c]||"default",l=c=>{const u={house:"",robot:"",car:"",castle:"",garden:"",rose:"",bush:"",tower:"",test:""},d=c==null?void 0:c.toLowerCase().split(" ")[0];return u[d]||""};return In(()=>{e.state.sets.availableSets.length===0&&e.dispatch("sets/loadSetsFromJSON")}),(c,u)=>(oe(),ge("div",OF,[B("div",NF,[B("div",FF,[B("h1",UF,se(c.$t("assembly.chooseSet")),1),s.value.length===0?(oe(),ge("p",zF,se(c.$t("assembly.noPurchasedSets")),1)):Ve("",!0)]),s.value.length>0?(oe(),ge("div",VF,[(oe(!0),ge(At,null,Zt(s.value,d=>(oe(),ge("div",{key:d.id,class:"set-card",onClick:h=>r(d)},[B("div",HF,[d.image?(oe(),ge("img",{key:0,src:d.image,alt:d.name,class:"set-card__image-img"},null,8,WF)):(oe(),ge("div",$F,se(l(d.name)),1))]),B("div",XF,[B("h3",qF,se(d.name),1),d.description?(oe(),ge("p",YF,se(d.description),1)):Ve("",!0),B("div",jF,[we(_n,{variant:"primary",size:"sm"},{default:Le(()=>{var h;return[Oe("  "+se(d.pieces||((h=d.blocks)==null?void 0:h.length)||0)+" "+se(c.$t("assembly.pieces")),1)]}),_:2},1024),d.difficulty?(oe(),jt(_n,{key:0,variant:o(d.difficulty),size:"sm"},{default:Le(()=>[Oe("  "+se(c.$t(`difficulties.${d.difficulty}`)),1)]),_:2},1032,["variant"])):Ve("",!0)])])],8,GF))),128))])):(oe(),ge("div",KF,[B("div",ZF,[u[0]||(u[0]=B("div",{class:"empty-state__icon"},"",-1)),B("h3",null,se(c.$t("assembly.noPurchasedSets")),1),B("p",null,se(c.$t("assembly.visitShop")),1),we(wt,{variant:"primary",onClick:a,class:"mt-md"},{default:Le(()=>[Oe(se(c.$t("mainMenu.shop")),1)]),_:1})])]))]),we(ga,{position:"top-center",ref_key:"toastContainer",ref:n},null,512)]))}},QF=Ht(JF,[["__scopeId","data-v-14b55b24"]]);function vr(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Rb(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var Ki={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},dl={duration:.5,overwrite:!1,delay:0},Jm,ri,bn,us=1e8,hn=1/us,Up=Math.PI*2,e3=Up/4,t3=0,Lb=Math.sqrt,n3=Math.cos,i3=Math.sin,ei=function(e){return typeof e=="string"},Pn=function(e){return typeof e=="function"},Rr=function(e){return typeof e=="number"},Qm=function(e){return typeof e>"u"},Js=function(e){return typeof e=="object"},ki=function(e){return e!==!1},e_=function(){return typeof window<"u"},Cu=function(e){return Pn(e)||ei(e)},Ib=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},mi=Array.isArray,zp=/(?:-?\.?\d|\.)+/gi,Db=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Go=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,uf=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,kb=/[+-]=-?[.\d]+/,Bb=/[^,'"\[\]\s]+/gi,s3=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,En,Vs,Vp,t_,Ji={},wd={},Ob,Nb=function(e){return(wd=hl(e,Ji))&&Fi},n_=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Ec=function(e,t){return!t&&console.warn(e)},Fb=function(e,t){return e&&(Ji[e]=t)&&wd&&(wd[e]=t)||Ji},Mc=function(){return 0},r3={suppressEvents:!0,isStart:!0,kill:!1},Yu={suppressEvents:!0,kill:!1},a3={suppressEvents:!0},i_={},ea=[],Gp={},Ub,Wi={},df={},ty=30,ju=[],s_="",r_=function(e){var t=e[0],n,s;if(Js(t)||Pn(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(s=ju.length;s--&&!ju[s].targetTest(t););n=ju[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new cw(e[s],n)))||e.splice(s,1);return e},Ja=function(e){return e._gsap||r_(ds(e))[0]._gsap},zb=function(e,t,n){return(n=e[t])&&Pn(n)?e[t]():Qm(n)&&e.getAttribute&&e.getAttribute(t)||n},Bi=function(e,t){return(e=e.split(",")).forEach(t)||e},Dn=function(e){return Math.round(e*1e5)/1e5||0},Vn=function(e){return Math.round(e*1e7)/1e7||0},el=function(e,t){var n=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+s:n==="-"?e-s:n==="*"?e*s:e/s},o3=function(e,t){for(var n=t.length,s=0;e.indexOf(t[s])<0&&++s<n;);return s<n},Sd=function(){var e=ea.length,t=ea.slice(0),n,s;for(Gp={},ea.length=0,n=0;n<e;n++)s=t[n],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},a_=function(e){return!!(e._initted||e._startAt||e.add)},Vb=function(e,t,n,s){ea.length&&!ri&&Sd(),e.render(t,n,!!(ri&&t<0&&a_(e))),ea.length&&!ri&&Sd()},Gb=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Bb).length<2?t:ei(e)?e.trim():e},Hb=function(e){return e},Qi=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},l3=function(e){return function(t,n){for(var s in n)s in t||s==="duration"&&e||s==="ease"||(t[s]=n[s])}},hl=function(e,t){for(var n in t)e[n]=t[n];return e},ny=function i(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=Js(t[n])?i(e[n]||(e[n]={}),t[n]):t[n]);return e},Ed=function(e,t){var n={},s;for(s in e)s in t||(n[s]=e[s]);return n},tc=function(e){var t=e.parent||En,n=e.keyframes?l3(mi(e.keyframes)):Qi;if(ki(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},c3=function(e,t){for(var n=e.length,s=n===t.length;s&&n--&&e[n]===t[n];);return n<0},Wb=function(e,t,n,s,r){var a=e[s],o;if(r)for(o=t[r];a&&a[r]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[s]=t,t._prev=a,t.parent=t._dp=e,t},ih=function(e,t,n,s){n===void 0&&(n="_first"),s===void 0&&(s="_last");var r=t._prev,a=t._next;r?r._next=a:e[n]===t&&(e[n]=a),a?a._prev=r:e[s]===t&&(e[s]=r),t._next=t._prev=t.parent=null},ua=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Qa=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},u3=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Hp=function(e,t,n,s){return e._startAt&&(ri?e._startAt.revert(Yu):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,s))},d3=function i(e){return!e||e._ts&&i(e.parent)},iy=function(e){return e._repeat?fl(e._tTime,e=e.duration()+e._rDelay)*e:0},fl=function(e,t){var n=Math.floor(e=Vn(e/t));return e&&n===e?n-1:n},Md=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},sh=function(e){return e._end=Vn(e._start+(e._tDur/Math.abs(e._ts||e._rts||hn)||0))},rh=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Vn(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),sh(e),n._dirty||Qa(n,e)),e},$b=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=Md(e.rawTime(),t),(!t._dur||$c(0,t.totalDuration(),n)-t._tTime>hn)&&t.render(n,!0)),Qa(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-hn}},Ws=function(e,t,n,s){return t.parent&&ua(t),t._start=Vn((Rr(n)?n:n||e!==En?os(e,n,t):e._time)+t._delay),t._end=Vn(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Wb(e,t,"_first","_last",e._sort?"_start":0),Wp(t)||(e._recent=t),s||$b(e,t),e._ts<0&&rh(e,e._tTime),e},Xb=function(e,t){return(Ji.ScrollTrigger||n_("scrollTrigger",t))&&Ji.ScrollTrigger.create(t,e)},qb=function(e,t,n,s,r){if(l_(e,t,r),!e._initted)return 1;if(!n&&e._pt&&!ri&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Ub!==Xi.frame)return ea.push(e),e._lazy=[r,s],1},h3=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},Wp=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},f3=function(e,t,n,s){var r=e.ratio,a=t<0||!t&&(!e._start&&h3(e)&&!(!e._initted&&Wp(e))||(e._ts<0||e._dp._ts<0)&&!Wp(e))?0:1,o=e._rDelay,l=0,c,u,d;if(o&&e._repeat&&(l=$c(0,e._tDur,t),u=fl(l,o),e._yoyo&&u&1&&(a=1-a),u!==fl(e._tTime,o)&&(r=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==r||ri||s||e._zTime===hn||!t&&e._zTime){if(!e._initted&&qb(e,t,s,n,l))return;for(d=e._zTime,e._zTime=t||(n?hn:0),n||(n=t&&!d),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=l,c=e._pt;c;)c.r(a,c.d),c=c._next;t<0&&Hp(e,t,n,!0),e._onUpdate&&!n&&Yi(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&Yi(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&ua(e,1),!n&&!ri&&(Yi(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},p3=function(e,t,n){var s;if(n>t)for(s=e._first;s&&s._start<=n;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=n;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},pl=function(e,t,n,s){var r=e._repeat,a=Vn(t)||0,o=e._tTime/e._tDur;return o&&!s&&(e._time*=a/e._dur),e._dur=a,e._tDur=r?r<0?1e10:Vn(a*(r+1)+e._rDelay*r):a,o>0&&!s&&rh(e,e._tTime=e._tDur*o),e.parent&&sh(e),n||Qa(e.parent,e),e},sy=function(e){return e instanceof bi?Qa(e):pl(e,e._dur)},m3={_start:0,endTime:Mc,totalDuration:Mc},os=function i(e,t,n){var s=e.labels,r=e._recent||m3,a=e.duration()>=us?r.endTime(!1):e._dur,o,l,c;return ei(t)&&(isNaN(t)||t in s)?(l=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?r:n).totalDuration()/100:1)):o<0?(t in s||(s[t]=a),s[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&n&&(l=l/100*(mi(n)?n[0]:n).totalDuration()),o>1?i(e,t.substr(0,o-1),n)+l:a+l)):t==null?a:+t},nc=function(e,t,n){var s=Rr(t[1]),r=(s?2:1)+(e<2?0:1),a=t[r],o,l;if(s&&(a.duration=t[1]),a.parent=n,e){for(o=a,l=n;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=ki(l.vars.inherit)&&l.parent;a.immediateRender=ki(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[r-1]}return new zn(t[0],a,t[r+1])},xa=function(e,t){return e||e===0?t(e):t},$c=function(e,t,n){return n<e?e:n>t?t:n},hi=function(e,t){return!ei(e)||!(t=s3.exec(e))?"":t[1]},_3=function(e,t,n){return xa(n,function(s){return $c(e,t,s)})},$p=[].slice,Yb=function(e,t){return e&&Js(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Js(e[0]))&&!e.nodeType&&e!==Vs},v3=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(s){var r;return ei(s)&&!t||Yb(s,1)?(r=n).push.apply(r,ds(s)):n.push(s)})||n},ds=function(e,t,n){return bn&&!t&&bn.selector?bn.selector(e):ei(e)&&!n&&(Vp||!ml())?$p.call((t||t_).querySelectorAll(e),0):mi(e)?v3(e,n):Yb(e)?$p.call(e,0):e?[e]:[]},Xp=function(e){return e=ds(e)[0]||Ec("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return ds(t,n.querySelectorAll?n:n===e?Ec("Invalid scope")||t_.createElement("div"):e)}},jb=function(e){return e.sort(function(){return .5-Math.random()})},Kb=function(e){if(Pn(e))return e;var t=Js(e)?e:{each:e},n=eo(t.ease),s=t.from||0,r=parseFloat(t.base)||0,a={},o=s>0&&s<1,l=isNaN(s)||o,c=t.axis,u=s,d=s;return ei(s)?u=d={center:.5,edges:.5,end:1}[s]||0:!o&&l&&(u=s[0],d=s[1]),function(h,f,p){var m=(p||t).length,_=a[m],v,x,y,g,w,b,T,E,S;if(!_){if(S=t.grid==="auto"?0:(t.grid||[1,us])[1],!S){for(T=-us;T<(T=p[S++].getBoundingClientRect().left)&&S<m;);S<m&&S--}for(_=a[m]=[],v=l?Math.min(S,m)*u-.5:s%S,x=S===us?0:l?m*d/S-.5:s/S|0,T=0,E=us,b=0;b<m;b++)y=b%S-v,g=x-(b/S|0),_[b]=w=c?Math.abs(c==="y"?g:y):Lb(y*y+g*g),w>T&&(T=w),w<E&&(E=w);s==="random"&&jb(_),_.max=T-E,_.min=E,_.v=m=(parseFloat(t.amount)||parseFloat(t.each)*(S>m?m-1:c?c==="y"?m/S:S:Math.max(S,m/S))||0)*(s==="edges"?-1:1),_.b=m<0?r-m:r,_.u=hi(t.amount||t.each)||0,n=n&&m<0?aw(n):n}return m=(_[h]-_.min)/_.max||0,Vn(_.b+(n?n(m):m)*_.v)+_.u}},qp=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var s=Vn(Math.round(parseFloat(n)/e)*e*t);return(s-s%1)/t+(Rr(n)?0:hi(n))}},Zb=function(e,t){var n=mi(e),s,r;return!n&&Js(e)&&(s=n=e.radius||us,e.values?(e=ds(e.values),(r=!Rr(e[0]))&&(s*=s)):e=qp(e.increment)),xa(t,n?Pn(e)?function(a){return r=e(a),Math.abs(r-a)<=s?r:a}:function(a){for(var o=parseFloat(r?a.x:a),l=parseFloat(r?a.y:0),c=us,u=0,d=e.length,h,f;d--;)r?(h=e[d].x-o,f=e[d].y-l,h=h*h+f*f):h=Math.abs(e[d]-o),h<c&&(c=h,u=d);return u=!s||c<=s?e[u]:a,r||u===a||Rr(a)?u:u+hi(a)}:qp(e))},Jb=function(e,t,n,s){return xa(mi(e)?!t:n===!0?!!(n=0):!s,function(){return mi(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(s=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*s)/s})},g3=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){return t.reduce(function(r,a){return a(r)},s)}},y3=function(e,t){return function(n){return e(parseFloat(n))+(t||hi(n))}},x3=function(e,t,n){return ew(e,t,0,1,n)},Qb=function(e,t,n){return xa(n,function(s){return e[~~t(s)]})},b3=function i(e,t,n){var s=t-e;return mi(e)?Qb(e,i(0,e.length),t):xa(n,function(r){return(s+(r-e)%s)%s+e})},w3=function i(e,t,n){var s=t-e,r=s*2;return mi(e)?Qb(e,i(0,e.length-1),t):xa(n,function(a){return a=(r+(a-e)%r)%r||0,e+(a>s?r-a:a)})},Tc=function(e){for(var t=0,n="",s,r,a,o;~(s=e.indexOf("random(",t));)a=e.indexOf(")",s),o=e.charAt(s+7)==="[",r=e.substr(s+7,a-s-7).match(o?Bb:zp),n+=e.substr(t,s-t)+Jb(o?r:+r[0],o?0:+r[1],+r[2]||1e-5),t=a+1;return n+e.substr(t,e.length-t)},ew=function(e,t,n,s,r){var a=t-e,o=s-n;return xa(r,function(l){return n+((l-e)/a*o||0)})},S3=function i(e,t,n,s){var r=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!r){var a=ei(e),o={},l,c,u,d,h;if(n===!0&&(s=1)&&(n=null),a)e={p:e},t={p:t};else if(mi(e)&&!mi(t)){for(u=[],d=e.length,h=d-2,c=1;c<d;c++)u.push(i(e[c-1],e[c]));d--,r=function(p){p*=d;var m=Math.min(h,~~p);return u[m](p-m)},n=t}else s||(e=hl(mi(e)?[]:{},e));if(!u){for(l in t)o_.call(o,e,l,"get",t[l]);r=function(p){return d_(p,o)||(a?e.p:e)}}}return xa(n,r)},ry=function(e,t,n){var s=e.labels,r=us,a,o,l;for(a in s)o=s[a]-t,o<0==!!n&&o&&r>(o=Math.abs(o))&&(l=a,r=o);return l},Yi=function(e,t,n){var s=e.vars,r=s[t],a=bn,o=e._ctx,l,c,u;if(r)return l=s[t+"Params"],c=s.callbackScope||e,n&&ea.length&&Sd(),o&&(bn=o),u=l?r.apply(c,l):r.call(c),bn=a,u},Hl=function(e){return ua(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ri),e.progress()<1&&Yi(e,"onInterrupt"),e},Ho,tw=[],nw=function(e){if(e)if(e=!e.name&&e.default||e,e_()||e.headless){var t=e.name,n=Pn(e),s=t&&!n&&e.init?function(){this._props=[]}:e,r={init:Mc,render:d_,add:o_,kill:U3,modifier:F3,rawVars:0},a={targetTest:0,get:0,getSetter:u_,aliases:{},register:0};if(ml(),e!==s){if(Wi[t])return;Qi(s,Qi(Ed(e,r),a)),hl(s.prototype,hl(r,Ed(e,a))),Wi[s.prop=t]=s,e.targetTest&&(ju.push(s),i_[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Fb(t,s),e.register&&e.register(Fi,s,Oi)}else tw.push(e)},dn=255,Wl={aqua:[0,dn,dn],lime:[0,dn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,dn],navy:[0,0,128],white:[dn,dn,dn],olive:[128,128,0],yellow:[dn,dn,0],orange:[dn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[dn,0,0],pink:[dn,192,203],cyan:[0,dn,dn],transparent:[dn,dn,dn,0]},hf=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*dn+.5|0},iw=function(e,t,n){var s=e?Rr(e)?[e>>16,e>>8&dn,e&dn]:0:Wl.black,r,a,o,l,c,u,d,h,f,p;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Wl[e])s=Wl[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+r+r+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&dn,s&dn,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&dn,e&dn]}else if(e.substr(0,3)==="hsl"){if(s=p=e.match(zp),!t)l=+s[0]%360/360,c=+s[1]/100,u=+s[2]/100,a=u<=.5?u*(c+1):u+c-u*c,r=u*2-a,s.length>3&&(s[3]*=1),s[0]=hf(l+1/3,r,a),s[1]=hf(l,r,a),s[2]=hf(l-1/3,r,a);else if(~e.indexOf("="))return s=e.match(Db),n&&s.length<4&&(s[3]=1),s}else s=e.match(zp)||Wl.transparent;s=s.map(Number)}return t&&!p&&(r=s[0]/dn,a=s[1]/dn,o=s[2]/dn,d=Math.max(r,a,o),h=Math.min(r,a,o),u=(d+h)/2,d===h?l=c=0:(f=d-h,c=u>.5?f/(2-d-h):f/(d+h),l=d===r?(a-o)/f+(a<o?6:0):d===a?(o-r)/f+2:(r-a)/f+4,l*=60),s[0]=~~(l+.5),s[1]=~~(c*100+.5),s[2]=~~(u*100+.5)),n&&s.length<4&&(s[3]=1),s},sw=function(e){var t=[],n=[],s=-1;return e.split(ta).forEach(function(r){var a=r.match(Go)||[];t.push.apply(t,a),n.push(s+=a.length+1)}),t.c=n,t},ay=function(e,t,n){var s="",r=(e+s).match(ta),a=t?"hsla(":"rgba(",o=0,l,c,u,d;if(!r)return e;if(r=r.map(function(h){return(h=iw(h,t,1))&&a+(t?h[0]+","+h[1]+"%,"+h[2]+"%,"+h[3]:h.join(","))+")"}),n&&(u=sw(e),l=n.c,l.join(s)!==u.c.join(s)))for(c=e.replace(ta,"1").split(Go),d=c.length-1;o<d;o++)s+=c[o]+(~l.indexOf(o)?r.shift()||a+"0,0,0,0)":(u.length?u:r.length?r:n).shift());if(!c)for(c=e.split(ta),d=c.length-1;o<d;o++)s+=c[o]+r[o];return s+c[d]},ta=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Wl)i+="|"+e+"\\b";return new RegExp(i+")","gi")}(),E3=/hsl[a]?\(/,rw=function(e){var t=e.join(" "),n;if(ta.lastIndex=0,ta.test(t))return n=E3.test(t),e[1]=ay(e[1],n),e[0]=ay(e[0],n,sw(e[1])),!0},Ac,Xi=function(){var i=Date.now,e=500,t=33,n=i(),s=n,r=1e3/240,a=r,o=[],l,c,u,d,h,f,p=function m(_){var v=i()-s,x=_===!0,y,g,w,b;if((v>e||v<0)&&(n+=v-t),s+=v,w=s-n,y=w-a,(y>0||x)&&(b=++d.frame,h=w-d.time*1e3,d.time=w=w/1e3,a+=y+(y>=r?4:r-y),g=1),x||(l=c(m)),g)for(f=0;f<o.length;f++)o[f](w,h,b,_)};return d={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(_){return h/(1e3/(_||60))},wake:function(){Ob&&(!Vp&&e_()&&(Vs=Vp=window,t_=Vs.document||{},Ji.gsap=Fi,(Vs.gsapVersions||(Vs.gsapVersions=[])).push(Fi.version),Nb(wd||Vs.GreenSockGlobals||!Vs.gsap&&Vs||{}),tw.forEach(nw)),u=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&d.sleep(),c=u||function(_){return setTimeout(_,a-d.time*1e3+1|0)},Ac=1,p(2))},sleep:function(){(u?cancelAnimationFrame:clearTimeout)(l),Ac=0,c=Mc},lagSmoothing:function(_,v){e=_||1/0,t=Math.min(v||33,e)},fps:function(_){r=1e3/(_||240),a=d.time*1e3+r},add:function(_,v,x){var y=v?function(g,w,b,T){_(g,w,b,T),d.remove(y)}:_;return d.remove(_),o[x?"unshift":"push"](y),ml(),y},remove:function(_,v){~(v=o.indexOf(_))&&o.splice(v,1)&&f>=v&&f--},_listeners:o},d}(),ml=function(){return!Ac&&Xi.wake()},Kt={},M3=/^[\d.\-M][\d.\-,\s]/,T3=/["']/g,A3=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),s=n[0],r=1,a=n.length,o,l,c;r<a;r++)l=n[r],o=r!==a-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),t[s]=isNaN(c)?c.replace(T3,"").trim():+c,s=l.substr(o+1).trim();return t},C3=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<n?e.indexOf(")",n+1):n)},P3=function(e){var t=(e+"").split("("),n=Kt[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[A3(t[1])]:C3(e).split(",").map(Gb)):Kt._CE&&M3.test(e)?Kt._CE("",e):n},aw=function(e){return function(t){return 1-e(1-t)}},ow=function i(e,t){for(var n=e._first,s;n;)n instanceof bi?i(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?i(n.timeline,t):(s=n._ease,n._ease=n._yEase,n._yEase=s,n._yoyo=t)),n=n._next},eo=function(e,t){return e&&(Pn(e)?e:Kt[e]||P3(e))||t},fo=function(e,t,n,s){n===void 0&&(n=function(l){return 1-t(1-l)}),s===void 0&&(s=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:s},a;return Bi(e,function(o){Kt[o]=Ji[o]=r,Kt[a=o.toLowerCase()]=n;for(var l in r)Kt[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=Kt[o+"."+l]=r[l]}),r},lw=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},ff=function i(e,t,n){var s=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),a=r/Up*(Math.asin(1/s)||0),o=function(u){return u===1?1:s*Math.pow(2,-10*u)*i3((u-a)*r)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:lw(o);return r=Up/r,l.config=function(c,u){return i(e,c,u)},l},pf=function i(e,t){t===void 0&&(t=1.70158);var n=function(a){return a?--a*a*((t+1)*a+t)+1:0},s=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:lw(n);return s.config=function(r){return i(e,r)},s};Bi("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;fo(i+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});Kt.Linear.easeNone=Kt.none=Kt.Linear.easeIn;fo("Elastic",ff("in"),ff("out"),ff());(function(i,e){var t=1/e,n=2*t,s=2.5*t,r=function(o){return o<t?i*o*o:o<n?i*Math.pow(o-1.5/e,2)+.75:o<s?i*(o-=2.25/e)*o+.9375:i*Math.pow(o-2.625/e,2)+.984375};fo("Bounce",function(a){return 1-r(1-a)},r)})(7.5625,2.75);fo("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});fo("Circ",function(i){return-(Lb(1-i*i)-1)});fo("Sine",function(i){return i===1?1:-n3(i*e3)+1});fo("Back",pf("in"),pf("out"),pf());Kt.SteppedEase=Kt.steps=Ji.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,s=e+(t?0:1),r=t?1:0,a=1-hn;return function(o){return((s*$c(0,a,o)|0)+r)*n}}};dl.ease=Kt["quad.out"];Bi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return s_+=i+","+i+"Params,"});var cw=function(e,t){this.id=t3++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:zb,this.set=t?t.getSetter:u_},Cc=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,pl(this,+t.duration,1,1),this.data=t.data,bn&&(this._ctx=bn,bn.data.push(this)),Ac||Xi.wake()}var e=i.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,pl(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,s){if(ml(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(rh(this,n),!r._dp||r.parent||$b(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Ws(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===hn||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),Vb(this,n,s)),this},e.time=function(n,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+iy(this))%(this._dur+this._rDelay)||(n?this._dur:0),s):this._time},e.totalProgress=function(n,s){return arguments.length?this.totalTime(this.totalDuration()*n,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+iy(this),s):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,s){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,s):this._repeat?fl(this._tTime,r)+1:1},e.timeScale=function(n,s){if(!arguments.length)return this._rts===-hn?0:this._rts;if(this._rts===n)return this;var r=this.parent&&this._ts?Md(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-hn?0:this._rts,this.totalTime($c(-Math.abs(this._delay),this.totalDuration(),r),s!==!1),sh(this),u3(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ml(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==hn&&(this._tTime-=hn)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&Ws(s,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(ki(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var s=this.parent||this._dp;return s?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Md(s.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=a3);var s=ri;return ri=n,a_(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),ri=s,this},e.globalTime=function(n){for(var s=this,r=arguments.length?n:s.rawTime();s;)r=s._start+r/(Math.abs(s._ts)||1),s=s._dp;return!this.parent&&this._sat?this._sat.globalTime(n):r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,sy(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var s=this._time;return this._rDelay=n,sy(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,s){return this.totalTime(os(this,n),ki(s))},e.restart=function(n,s){return this.play().totalTime(n?-this._delay:0,ki(s)),this._dur||(this._zTime=-hn),this},e.play=function(n,s){return n!=null&&this.seek(n,s),this.reversed(!1).paused(!1)},e.reverse=function(n,s){return n!=null&&this.seek(n||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(n,s){return n!=null&&this.seek(n,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-hn:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-hn,this},e.isActive=function(){var n=this.parent||this._dp,s=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=s&&r<this.endTime(!0)-hn)},e.eventCallback=function(n,s,r){var a=this.vars;return arguments.length>1?(s?(a[n]=s,r&&(a[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=s)):delete a[n],this):a[n]},e.then=function(n){var s=this;return new Promise(function(r){var a=Pn(n)?n:Hb,o=function(){var c=s.then;s.then=null,Pn(a)&&(a=a(s))&&(a.then||a===s)&&(s.then=c),r(a),s.then=c};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?o():s._prom=o})},e.kill=function(){Hl(this)},i}();Qi(Cc.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-hn,_prom:0,_ps:!1,_rts:1});var bi=function(i){Rb(e,i);function e(n,s){var r;return n===void 0&&(n={}),r=i.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=ki(n.sortChildren),En&&Ws(n.parent||En,vr(r),s),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&Xb(vr(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(s,r,a){return nc(0,arguments,this),this},t.from=function(s,r,a){return nc(1,arguments,this),this},t.fromTo=function(s,r,a,o){return nc(2,arguments,this),this},t.set=function(s,r,a){return r.duration=0,r.parent=this,tc(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new zn(s,r,os(this,a),1),this},t.call=function(s,r,a){return Ws(this,zn.delayedCall(0,s,r),a)},t.staggerTo=function(s,r,a,o,l,c,u){return a.duration=r,a.stagger=a.stagger||o,a.onComplete=c,a.onCompleteParams=u,a.parent=this,new zn(s,a,os(this,l)),this},t.staggerFrom=function(s,r,a,o,l,c,u){return a.runBackwards=1,tc(a).immediateRender=ki(a.immediateRender),this.staggerTo(s,r,a,o,l,c,u)},t.staggerFromTo=function(s,r,a,o,l,c,u,d){return o.startAt=a,tc(o).immediateRender=ki(o.immediateRender),this.staggerTo(s,r,o,l,c,u,d)},t.render=function(s,r,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,u=s<=0?0:Vn(s),d=this._zTime<0!=s<0&&(this._initted||!c),h,f,p,m,_,v,x,y,g,w,b,T;if(this!==En&&u>l&&s>=0&&(u=l),u!==this._tTime||a||d){if(o!==this._time&&c&&(u+=this._time-o,s+=this._time-o),h=u,g=this._start,y=this._ts,v=!y,d&&(c||(o=this._zTime),(s||!r)&&(this._zTime=s)),this._repeat){if(b=this._yoyo,_=c+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(_*100+s,r,a);if(h=Vn(u%_),u===l?(m=this._repeat,h=c):(w=Vn(u/_),m=~~w,m&&m===w&&(h=c,m--),h>c&&(h=c)),w=fl(this._tTime,_),!o&&this._tTime&&w!==m&&this._tTime-w*_-this._dur<=0&&(w=m),b&&m&1&&(h=c-h,T=1),m!==w&&!this._lock){var E=b&&w&1,S=E===(b&&m&1);if(m<w&&(E=!E),o=E?0:u%c?c:u,this._lock=1,this.render(o||(T?0:Vn(m*_)),r,!c)._lock=0,this._tTime=u,!r&&this.parent&&Yi(this,"onRepeat"),this.vars.repeatRefresh&&!T&&(this.invalidate()._lock=1),o&&o!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,S&&(this._lock=2,o=E?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!T&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;ow(this,T)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(x=p3(this,Vn(o),Vn(h)),x&&(u-=h-(h=x._start))),this._tTime=u,this._time=h,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,o=0),!o&&u&&!r&&!w&&(Yi(this,"onStart"),this._tTime!==u))return this;if(h>=o&&s>=0)for(f=this._first;f;){if(p=f._next,(f._act||h>=f._start)&&f._ts&&x!==f){if(f.parent!==this)return this.render(s,r,a);if(f.render(f._ts>0?(h-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(h-f._start)*f._ts,r,a),h!==this._time||!this._ts&&!v){x=0,p&&(u+=this._zTime=-hn);break}}f=p}else{f=this._last;for(var M=s<0?s:h;f;){if(p=f._prev,(f._act||M<=f._end)&&f._ts&&x!==f){if(f.parent!==this)return this.render(s,r,a);if(f.render(f._ts>0?(M-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(M-f._start)*f._ts,r,a||ri&&a_(f)),h!==this._time||!this._ts&&!v){x=0,p&&(u+=this._zTime=M?-hn:hn);break}}f=p}}if(x&&!r&&(this.pause(),x.render(h>=o?0:-hn)._zTime=h>=o?1:-1,this._ts))return this._start=g,sh(this),this.render(s,r,a);this._onUpdate&&!r&&Yi(this,"onUpdate",!0),(u===l&&this._tTime>=this.totalDuration()||!u&&o)&&(g===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((s||!c)&&(u===l&&this._ts>0||!u&&this._ts<0)&&ua(this,1),!r&&!(s<0&&!o)&&(u||o||!l)&&(Yi(this,u===l&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,r){var a=this;if(Rr(r)||(r=os(this,r,s)),!(s instanceof Cc)){if(mi(s))return s.forEach(function(o){return a.add(o,r)}),this;if(ei(s))return this.addLabel(s,r);if(Pn(s))s=zn.delayedCall(0,s);else return this}return this!==s?Ws(this,s,r):this},t.getChildren=function(s,r,a,o){s===void 0&&(s=!0),r===void 0&&(r=!0),a===void 0&&(a=!0),o===void 0&&(o=-us);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof zn?r&&l.push(c):(a&&l.push(c),s&&l.push.apply(l,c.getChildren(!0,r,a)))),c=c._next;return l},t.getById=function(s){for(var r=this.getChildren(1,1,1),a=r.length;a--;)if(r[a].vars.id===s)return r[a]},t.remove=function(s){return ei(s)?this.removeLabel(s):Pn(s)?this.killTweensOf(s):(s.parent===this&&ih(this,s),s===this._recent&&(this._recent=this._last),Qa(this))},t.totalTime=function(s,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Vn(Xi.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),i.prototype.totalTime.call(this,s,r),this._forcing=0,this):this._tTime},t.addLabel=function(s,r){return this.labels[s]=os(this,r),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,r,a){var o=zn.delayedCall(0,r||Mc,a);return o.data="isPause",this._hasPause=1,Ws(this,o,os(this,s))},t.removePause=function(s){var r=this._first;for(s=os(this,s);r;)r._start===s&&r.data==="isPause"&&ua(r),r=r._next},t.killTweensOf=function(s,r,a){for(var o=this.getTweensOf(s,a),l=o.length;l--;)Yr!==o[l]&&o[l].kill(s,r);return this},t.getTweensOf=function(s,r){for(var a=[],o=ds(s),l=this._first,c=Rr(r),u;l;)l instanceof zn?o3(l._targets,o)&&(c?(!Yr||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&a.push(l):(u=l.getTweensOf(o,r)).length&&a.push.apply(a,u),l=l._next;return a},t.tweenTo=function(s,r){r=r||{};var a=this,o=os(a,s),l=r,c=l.startAt,u=l.onStart,d=l.onStartParams,h=l.immediateRender,f,p=zn.to(a,Qi({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:r.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale())||hn,onStart:function(){if(a.pause(),!f){var _=r.duration||Math.abs((o-(c&&"time"in c?c.time:a._time))/a.timeScale());p._dur!==_&&pl(p,_,0,1).render(p._time,!0,!0),f=1}u&&u.apply(p,d||[])}},r));return h?p.render(0):p},t.tweenFromTo=function(s,r,a){return this.tweenTo(r,Qi({startAt:{time:os(this,s)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),ry(this,os(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),ry(this,os(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+hn)},t.shiftChildren=function(s,r,a){a===void 0&&(a=0);for(var o=this._first,l=this.labels,c;o;)o._start>=a&&(o._start+=s,o._end+=s),o=o._next;if(r)for(c in l)l[c]>=a&&(l[c]+=s);return Qa(this)},t.invalidate=function(s){var r=this._first;for(this._lock=0;r;)r.invalidate(s),r=r._next;return i.prototype.invalidate.call(this,s)},t.clear=function(s){s===void 0&&(s=!0);for(var r=this._first,a;r;)a=r._next,this.remove(r),r=a;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),Qa(this)},t.totalDuration=function(s){var r=0,a=this,o=a._last,l=us,c,u,d;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-s:s));if(a._dirty){for(d=a.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),u=o._start,u>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,Ws(a,o,u-o._delay,1)._lock=0):l=u,u<0&&o._ts&&(r-=u,(!d&&!a._dp||d&&d.smoothChildTiming)&&(a._start+=u/a._ts,a._time-=u,a._tTime-=u),a.shiftChildren(-u,!1,-1/0),l=0),o._end>r&&o._ts&&(r=o._end),o=c;pl(a,a===En&&a._time>r?a._time:r,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(s){if(En._ts&&(Vb(En,Md(s,En)),Ub=Xi.frame),Xi.frame>=ty){ty+=Ki.autoSleep||120;var r=En._first;if((!r||!r._ts)&&Ki.autoSleep&&Xi._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||Xi.sleep()}}},e}(Cc);Qi(bi.prototype,{_lock:0,_hasPause:0,_forcing:0});var R3=function(e,t,n,s,r,a,o){var l=new Oi(this._pt,e,t,0,1,mw,null,r),c=0,u=0,d,h,f,p,m,_,v,x;for(l.b=n,l.e=s,n+="",s+="",(v=~s.indexOf("random("))&&(s=Tc(s)),a&&(x=[n,s],a(x,e,t),n=x[0],s=x[1]),h=n.match(uf)||[];d=uf.exec(s);)p=d[0],m=s.substring(c,d.index),f?f=(f+1)%5:m.substr(-5)==="rgba("&&(f=1),p!==h[u++]&&(_=parseFloat(h[u-1])||0,l._pt={_next:l._pt,p:m||u===1?m:",",s:_,c:p.charAt(1)==="="?el(_,p)-_:parseFloat(p)-_,m:f&&f<4?Math.round:0},c=uf.lastIndex);return l.c=c<s.length?s.substring(c,s.length):"",l.fp=o,(kb.test(s)||v)&&(l.e=0),this._pt=l,l},o_=function(e,t,n,s,r,a,o,l,c,u){Pn(s)&&(s=s(r||0,e,a));var d=e[t],h=n!=="get"?n:Pn(d)?c?e[t.indexOf("set")||!Pn(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():d,f=Pn(d)?c?B3:fw:c_,p;if(ei(s)&&(~s.indexOf("random(")&&(s=Tc(s)),s.charAt(1)==="="&&(p=el(h,s)+(hi(h)||0),(p||p===0)&&(s=p))),!u||h!==s||Yp)return!isNaN(h*s)&&s!==""?(p=new Oi(this._pt,e,t,+h||0,s-(h||0),typeof d=="boolean"?N3:pw,0,f),c&&(p.fp=c),o&&p.modifier(o,this,e),this._pt=p):(!d&&!(t in e)&&n_(t,s),R3.call(this,e,t,h,s,f,l||Ki.stringFilter,c))},L3=function(e,t,n,s,r){if(Pn(e)&&(e=ic(e,r,t,n,s)),!Js(e)||e.style&&e.nodeType||mi(e)||Ib(e))return ei(e)?ic(e,r,t,n,s):e;var a={},o;for(o in e)a[o]=ic(e[o],r,t,n,s);return a},uw=function(e,t,n,s,r,a){var o,l,c,u;if(Wi[e]&&(o=new Wi[e]).init(r,o.rawVars?t[e]:L3(t[e],s,r,a,n),n,s,a)!==!1&&(n._pt=l=new Oi(n._pt,r,e,0,1,o.render,o,0,o.priority),n!==Ho))for(c=n._ptLookup[n._targets.indexOf(r)],u=o._props.length;u--;)c[o._props[u]]=l;return o},Yr,Yp,l_=function i(e,t,n){var s=e.vars,r=s.ease,a=s.startAt,o=s.immediateRender,l=s.lazy,c=s.onUpdate,u=s.runBackwards,d=s.yoyoEase,h=s.keyframes,f=s.autoRevert,p=e._dur,m=e._startAt,_=e._targets,v=e.parent,x=v&&v.data==="nested"?v.vars.targets:_,y=e._overwrite==="auto"&&!Jm,g=e.timeline,w,b,T,E,S,M,A,C,I,H,W,z,q;if(g&&(!h||!r)&&(r="none"),e._ease=eo(r,dl.ease),e._yEase=d?aw(eo(d===!0?r:d,dl.ease)):0,d&&e._yoyo&&!e._repeat&&(d=e._yEase,e._yEase=e._ease,e._ease=d),e._from=!g&&!!s.runBackwards,!g||h&&!s.stagger){if(C=_[0]?Ja(_[0]).harness:0,z=C&&s[C.prop],w=Ed(s,i_),m&&(m._zTime<0&&m.progress(1),t<0&&u&&o&&!f?m.render(-1,!0):m.revert(u&&p?Yu:r3),m._lazy=0),a){if(ua(e._startAt=zn.set(_,Qi({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!m&&ki(l),startAt:null,delay:0,onUpdate:c&&function(){return Yi(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ri||!o&&!f)&&e._startAt.revert(Yu),o&&p&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(u&&p&&!m){if(t&&(o=!1),T=Qi({overwrite:!1,data:"isFromStart",lazy:o&&!m&&ki(l),immediateRender:o,stagger:0,parent:v},w),z&&(T[C.prop]=z),ua(e._startAt=zn.set(_,T)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ri?e._startAt.revert(Yu):e._startAt.render(-1,!0)),e._zTime=t,!o)i(e._startAt,hn,hn);else if(!t)return}for(e._pt=e._ptCache=0,l=p&&ki(l)||l&&!p,b=0;b<_.length;b++){if(S=_[b],A=S._gsap||r_(_)[b]._gsap,e._ptLookup[b]=H={},Gp[A.id]&&ea.length&&Sd(),W=x===_?b:x.indexOf(S),C&&(I=new C).init(S,z||w,e,W,x)!==!1&&(e._pt=E=new Oi(e._pt,S,I.name,0,1,I.render,I,0,I.priority),I._props.forEach(function(O){H[O]=E}),I.priority&&(M=1)),!C||z)for(T in w)Wi[T]&&(I=uw(T,w,e,W,S,x))?I.priority&&(M=1):H[T]=E=o_.call(e,S,T,"get",w[T],W,x,0,s.stringFilter);e._op&&e._op[b]&&e.kill(S,e._op[b]),y&&e._pt&&(Yr=e,En.killTweensOf(S,H,e.globalTime(t)),q=!e.parent,Yr=0),e._pt&&l&&(Gp[A.id]=1)}M&&_w(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!q,h&&t<=0&&g.render(us,!0,!0)},I3=function(e,t,n,s,r,a,o,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,d,h,f;if(!c)for(c=e._ptCache[t]=[],h=e._ptLookup,f=e._targets.length;f--;){if(u=h[f][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return Yp=1,e.vars[t]="+=0",l_(e,o),Yp=0,l?Ec(t+" not eligible for reset"):1;c.push(u)}for(f=c.length;f--;)d=c[f],u=d._pt||d,u.s=(s||s===0)&&!r?s:u.s+(s||0)+a*u.c,u.c=n-u.s,d.e&&(d.e=Dn(n)+hi(d.e)),d.b&&(d.b=u.s+hi(d.b))},D3=function(e,t){var n=e[0]?Ja(e[0]).harness:0,s=n&&n.aliases,r,a,o,l;if(!s)return t;r=hl({},t);for(a in s)if(a in r)for(l=s[a].split(","),o=l.length;o--;)r[l[o]]=r[a];return r},k3=function(e,t,n,s){var r=t.ease||s||"power1.inOut",a,o;if(mi(t))o=n[e]||(n[e]=[]),t.forEach(function(l,c){return o.push({t:c/(t.length-1)*100,v:l,e:r})});else for(a in t)o=n[a]||(n[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:r})},ic=function(e,t,n,s,r){return Pn(e)?e.call(t,n,s,r):ei(e)&&~e.indexOf("random(")?Tc(e):e},dw=s_+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",hw={};Bi(dw+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return hw[i]=1});var zn=function(i){Rb(e,i);function e(n,s,r,a){var o;typeof s=="number"&&(r.duration=s,s=r,r=null),o=i.call(this,a?s:tc(s))||this;var l=o.vars,c=l.duration,u=l.delay,d=l.immediateRender,h=l.stagger,f=l.overwrite,p=l.keyframes,m=l.defaults,_=l.scrollTrigger,v=l.yoyoEase,x=s.parent||En,y=(mi(n)||Ib(n)?Rr(n[0]):"length"in s)?[n]:ds(n),g,w,b,T,E,S,M,A;if(o._targets=y.length?r_(y):Ec("GSAP target "+n+" not found. https://gsap.com",!Ki.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=f,p||h||Cu(c)||Cu(u)){if(s=o.vars,g=o.timeline=new bi({data:"nested",defaults:m||{},targets:x&&x.data==="nested"?x.vars.targets:y}),g.kill(),g.parent=g._dp=vr(o),g._start=0,h||Cu(c)||Cu(u)){if(T=y.length,M=h&&Kb(h),Js(h))for(E in h)~dw.indexOf(E)&&(A||(A={}),A[E]=h[E]);for(w=0;w<T;w++)b=Ed(s,hw),b.stagger=0,v&&(b.yoyoEase=v),A&&hl(b,A),S=y[w],b.duration=+ic(c,vr(o),w,S,y),b.delay=(+ic(u,vr(o),w,S,y)||0)-o._delay,!h&&T===1&&b.delay&&(o._delay=u=b.delay,o._start+=u,b.delay=0),g.to(S,b,M?M(w,S,y):0),g._ease=Kt.none;g.duration()?c=u=0:o.timeline=0}else if(p){tc(Qi(g.vars.defaults,{ease:"none"})),g._ease=eo(p.ease||s.ease||"none");var C=0,I,H,W;if(mi(p))p.forEach(function(z){return g.to(y,z,">")}),g.duration();else{b={};for(E in p)E==="ease"||E==="easeEach"||k3(E,p[E],b,p.easeEach);for(E in b)for(I=b[E].sort(function(z,q){return z.t-q.t}),C=0,w=0;w<I.length;w++)H=I[w],W={ease:H.e,duration:(H.t-(w?I[w-1].t:0))/100*c},W[E]=H.v,g.to(y,W,C),C+=W.duration;g.duration()<c&&g.to({},{duration:c-g.duration()})}}c||o.duration(c=g.duration())}else o.timeline=0;return f===!0&&!Jm&&(Yr=vr(o),En.killTweensOf(y),Yr=0),Ws(x,vr(o),r),s.reversed&&o.reverse(),s.paused&&o.paused(!0),(d||!c&&!p&&o._start===Vn(x._time)&&ki(d)&&d3(vr(o))&&x.data!=="nested")&&(o._tTime=-hn,o.render(Math.max(0,-u)||0)),_&&Xb(vr(o),_),o}var t=e.prototype;return t.render=function(s,r,a){var o=this._time,l=this._tDur,c=this._dur,u=s<0,d=s>l-hn&&!u?l:s<hn?0:s,h,f,p,m,_,v,x,y,g;if(!c)f3(this,s,r,a);else if(d!==this._tTime||!s||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u||this._lazy){if(h=d,y=this.timeline,this._repeat){if(m=c+this._rDelay,this._repeat<-1&&u)return this.totalTime(m*100+s,r,a);if(h=Vn(d%m),d===l?(p=this._repeat,h=c):(_=Vn(d/m),p=~~_,p&&p===_?(h=c,p--):h>c&&(h=c)),v=this._yoyo&&p&1,v&&(g=this._yEase,h=c-h),_=fl(this._tTime,m),h===o&&!a&&this._initted&&p===_)return this._tTime=d,this;p!==_&&(y&&this._yEase&&ow(y,v),this.vars.repeatRefresh&&!v&&!this._lock&&h!==m&&this._initted&&(this._lock=a=1,this.render(Vn(m*p),!0).invalidate()._lock=0))}if(!this._initted){if(qb(this,u?s:h,a,r,d))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&p!==_))return this;if(c!==this._dur)return this.render(s,r,a)}if(this._tTime=d,this._time=h,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=x=(g||this._ease)(h/c),this._from&&(this.ratio=x=1-x),!o&&d&&!r&&!_&&(Yi(this,"onStart"),this._tTime!==d))return this;for(f=this._pt;f;)f.r(x,f.d),f=f._next;y&&y.render(s<0?s:y._dur*y._ease(h/this._dur),r,a)||this._startAt&&(this._zTime=s),this._onUpdate&&!r&&(u&&Hp(this,s,r,a),Yi(this,"onUpdate")),this._repeat&&p!==_&&this.vars.onRepeat&&!r&&this.parent&&Yi(this,"onRepeat"),(d===this._tDur||!d)&&this._tTime===d&&(u&&!this._onUpdate&&Hp(this,s,!0,!0),(s||!c)&&(d===this._tDur&&this._ts>0||!d&&this._ts<0)&&ua(this,1),!r&&!(u&&!o)&&(d||o||v)&&(Yi(this,d===l?"onComplete":"onReverseComplete",!0),this._prom&&!(d<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),i.prototype.invalidate.call(this,s)},t.resetTo=function(s,r,a,o,l){Ac||Xi.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||l_(this,c),u=this._ease(c/this._dur),I3(this,s,r,a,o,u,c,l)?this.resetTo(s,r,a,o,1):(rh(this,0),this.parent||Wb(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,r){if(r===void 0&&(r="all"),!s&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Hl(this):this.scrollTrigger&&this.scrollTrigger.kill(!!ri),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(s,r,Yr&&Yr.vars.overwrite!==!0)._first||Hl(this),this.parent&&a!==this.timeline.totalDuration()&&pl(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=s?ds(s):o,c=this._ptLookup,u=this._pt,d,h,f,p,m,_,v;if((!r||r==="all")&&c3(o,l))return r==="all"&&(this._pt=0),Hl(this);for(d=this._op=this._op||[],r!=="all"&&(ei(r)&&(m={},Bi(r,function(x){return m[x]=1}),r=m),r=D3(o,r)),v=o.length;v--;)if(~l.indexOf(o[v])){h=c[v],r==="all"?(d[v]=r,p=h,f={}):(f=d[v]=d[v]||{},p=r);for(m in p)_=h&&h[m],_&&((!("kill"in _.d)||_.d.kill(m)===!0)&&ih(this,_,"_pt"),delete h[m]),f!=="all"&&(f[m]=1)}return this._initted&&!this._pt&&u&&Hl(this),this},e.to=function(s,r){return new e(s,r,arguments[2])},e.from=function(s,r){return nc(1,arguments)},e.delayedCall=function(s,r,a,o){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:r,onReverseComplete:r,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(s,r,a){return nc(2,arguments)},e.set=function(s,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(s,r)},e.killTweensOf=function(s,r,a){return En.killTweensOf(s,r,a)},e}(Cc);Qi(zn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Bi("staggerTo,staggerFrom,staggerFromTo",function(i){zn[i]=function(){var e=new bi,t=$p.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var c_=function(e,t,n){return e[t]=n},fw=function(e,t,n){return e[t](n)},B3=function(e,t,n,s){return e[t](s.fp,n)},O3=function(e,t,n){return e.setAttribute(t,n)},u_=function(e,t){return Pn(e[t])?fw:Qm(e[t])&&e.setAttribute?O3:c_},pw=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},N3=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},mw=function(e,t){var n=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;n;)s=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+s,n=n._next;s+=t.c}t.set(t.t,t.p,s,t)},d_=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},F3=function(e,t,n,s){for(var r=this._pt,a;r;)a=r._next,r.p===s&&r.modifier(e,t,n),r=a},U3=function(e){for(var t=this._pt,n,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?ih(this,t,"_pt"):t.dep||(n=1),t=s;return!n},z3=function(e,t,n,s){s.mSet(e,t,s.m.call(s.tween,n,s.mt),s)},_w=function(e){for(var t=e._pt,n,s,r,a;t;){for(n=t._next,s=r;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:a)?t._prev._next=t:r=t,(t._next=s)?s._prev=t:a=t,t=n}e._pt=r},Oi=function(){function i(t,n,s,r,a,o,l,c,u){this.t=n,this.s=r,this.c=a,this.p=s,this.r=o||pw,this.d=l||this,this.set=c||c_,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=i.prototype;return e.modifier=function(n,s,r){this.mSet=this.mSet||this.set,this.set=z3,this.m=n,this.mt=r,this.tween=s},i}();Bi(s_+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return i_[i]=1});Ji.TweenMax=Ji.TweenLite=zn;Ji.TimelineLite=Ji.TimelineMax=bi;En=new bi({sortChildren:!1,defaults:dl,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ki.stringFilter=rw;var to=[],Ku={},V3=[],oy=0,G3=0,mf=function(e){return(Ku[e]||V3).map(function(t){return t()})},jp=function(){var e=Date.now(),t=[];e-oy>2&&(mf("matchMediaInit"),to.forEach(function(n){var s=n.queries,r=n.conditions,a,o,l,c;for(o in s)a=Vs.matchMedia(s[o]).matches,a&&(l=1),a!==r[o]&&(r[o]=a,c=1);c&&(n.revert(),l&&t.push(n))}),mf("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(s){return n.add(null,s)})}),oy=e,mf("matchMedia"))},vw=function(){function i(t,n){this.selector=n&&Xp(n),this.data=[],this._r=[],this.isReverted=!1,this.id=G3++,t&&this.add(t)}var e=i.prototype;return e.add=function(n,s,r){Pn(n)&&(r=s,s=n,n=Pn);var a=this,o=function(){var c=bn,u=a.selector,d;return c&&c!==a&&c.data.push(a),r&&(a.selector=Xp(r)),bn=a,d=s.apply(a,arguments),Pn(d)&&a._r.push(d),bn=c,a.selector=u,a.isReverted=!1,d};return a.last=o,n===Pn?o(a,function(l){return a.add(null,l)}):n?a[n]=o:o},e.ignore=function(n){var s=bn;bn=null,n(this),bn=s},e.getTweens=function(){var n=[];return this.data.forEach(function(s){return s instanceof i?n.push.apply(n,s.getTweens()):s instanceof zn&&!(s.parent&&s.parent.data==="nested")&&n.push(s)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,s){var r=this;if(n?function(){for(var o=r.getTweens(),l=r.data.length,c;l--;)c=r.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(u){return o.splice(o.indexOf(u),1)}));for(o.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,d){return d.g-u.g||-1/0}).forEach(function(u){return u.t.revert(n)}),l=r.data.length;l--;)c=r.data[l],c instanceof bi?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof zn)&&c.revert&&c.revert(n);r._r.forEach(function(u){return u(n,r)}),r.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),s)for(var a=to.length;a--;)to[a].id===this.id&&to.splice(a,1)},e.revert=function(n){this.kill(n||{})},i}(),H3=function(){function i(t){this.contexts=[],this.scope=t,bn&&bn.data.push(this)}var e=i.prototype;return e.add=function(n,s,r){Js(n)||(n={matches:n});var a=new vw(0,r||this.scope),o=a.conditions={},l,c,u;bn&&!a.selector&&(a.selector=bn.selector),this.contexts.push(a),s=a.add("onMatch",s),a.queries=n;for(c in n)c==="all"?u=1:(l=Vs.matchMedia(n[c]),l&&(to.indexOf(a)<0&&to.push(a),(o[c]=l.matches)&&(u=1),l.addListener?l.addListener(jp):l.addEventListener("change",jp)));return u&&s(a,function(d){return a.add(null,d)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(s){return s.kill(n,!0)})},i}(),Td={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(s){return nw(s)})},timeline:function(e){return new bi(e)},getTweensOf:function(e,t){return En.getTweensOf(e,t)},getProperty:function(e,t,n,s){ei(e)&&(e=ds(e)[0]);var r=Ja(e||{}).get,a=n?Hb:Gb;return n==="native"&&(n=""),e&&(t?a((Wi[t]&&Wi[t].get||r)(e,t,n,s)):function(o,l,c){return a((Wi[o]&&Wi[o].get||r)(e,o,l,c))})},quickSetter:function(e,t,n){if(e=ds(e),e.length>1){var s=e.map(function(u){return Fi.quickSetter(u,t,n)}),r=s.length;return function(u){for(var d=r;d--;)s[d](u)}}e=e[0]||{};var a=Wi[t],o=Ja(e),l=o.harness&&(o.harness.aliases||{})[t]||t,c=a?function(u){var d=new a;Ho._pt=0,d.init(e,n?u+n:u,Ho,0,[e]),d.render(1,d),Ho._pt&&d_(1,Ho)}:o.set(e,l);return a?c:function(u){return c(e,l,n?u+n:u,o,1)}},quickTo:function(e,t,n){var s,r=Fi.to(e,Qi((s={},s[t]="+=0.1",s.paused=!0,s.stagger=0,s),n||{})),a=function(l,c,u){return r.resetTo(t,l,c,u)};return a.tween=r,a},isTweening:function(e){return En.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=eo(e.ease,dl.ease)),ny(dl,e||{})},config:function(e){return ny(Ki,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,s=e.plugins,r=e.defaults,a=e.extendTimeline;(s||"").split(",").forEach(function(o){return o&&!Wi[o]&&!Ji[o]&&Ec(t+" effect requires "+o+" plugin.")}),df[t]=function(o,l,c){return n(ds(o),Qi(l||{},r),c)},a&&(bi.prototype[t]=function(o,l,c){return this.add(df[t](o,Js(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){Kt[e]=eo(t)},parseEase:function(e,t){return arguments.length?eo(e,t):Kt},getById:function(e){return En.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new bi(e),s,r;for(n.smoothChildTiming=ki(e.smoothChildTiming),En.remove(n),n._dp=0,n._time=n._tTime=En._time,s=En._first;s;)r=s._next,(t||!(!s._dur&&s instanceof zn&&s.vars.onComplete===s._targets[0]))&&Ws(n,s,s._start-s._delay),s=r;return Ws(En,n,0),n},context:function(e,t){return e?new vw(e,t):bn},matchMedia:function(e){return new H3(e)},matchMediaRefresh:function(){return to.forEach(function(e){var t=e.conditions,n,s;for(s in t)t[s]&&(t[s]=!1,n=1);n&&e.revert()})||jp()},addEventListener:function(e,t){var n=Ku[e]||(Ku[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Ku[e],s=n&&n.indexOf(t);s>=0&&n.splice(s,1)},utils:{wrap:b3,wrapYoyo:w3,distribute:Kb,random:Jb,snap:Zb,normalize:x3,getUnit:hi,clamp:_3,splitColor:iw,toArray:ds,selector:Xp,mapRange:ew,pipe:g3,unitize:y3,interpolate:S3,shuffle:jb},install:Nb,effects:df,ticker:Xi,updateRoot:bi.updateRoot,plugins:Wi,globalTimeline:En,core:{PropTween:Oi,globals:Fb,Tween:zn,Timeline:bi,Animation:Cc,getCache:Ja,_removeLinkedListItem:ih,reverting:function(){return ri},context:function(e){return e&&bn&&(bn.data.push(e),e._ctx=bn),bn},suppressOverwrites:function(e){return Jm=e}}};Bi("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return Td[i]=zn[i]});Xi.add(bi.updateRoot);Ho=Td.to({},{duration:0});var W3=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},$3=function(e,t){var n=e._targets,s,r,a;for(s in t)for(r=n.length;r--;)a=e._ptLookup[r][s],a&&(a=a.d)&&(a._pt&&(a=W3(a,s)),a&&a.modifier&&a.modifier(t[s],e,n[r],s))},_f=function(e,t){return{name:e,headless:1,rawVars:1,init:function(s,r,a){a._onInit=function(o){var l,c;if(ei(r)&&(l={},Bi(r,function(u){return l[u]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}$3(o,r)}}}},Fi=Td.registerPlugin({name:"attr",init:function(e,t,n,s,r){var a,o,l;this.tween=n;for(a in t)l=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(l||0)+"",t[a],s,r,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(e,t){for(var n=t._pt;n;)ri?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},_f("roundProps",qp),_f("modifiers"),_f("snap",Zb))||Td;zn.version=bi.version=Fi.version="3.13.0";Ob=1;e_()&&ml();Kt.Power0;Kt.Power1;Kt.Power2;Kt.Power3;Kt.Power4;Kt.Linear;Kt.Quad;Kt.Cubic;Kt.Quart;Kt.Quint;Kt.Strong;Kt.Elastic;Kt.Back;Kt.SteppedEase;Kt.Bounce;Kt.Sine;Kt.Expo;Kt.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ly,jr,tl,h_,Ka,cy,f_,X3=function(){return typeof window<"u"},Lr={},za=180/Math.PI,nl=Math.PI/180,Io=Math.atan2,uy=1e8,p_=/([A-Z])/g,q3=/(left|right|width|margin|padding|x)/i,Y3=/[\s,\(]\S/,Ys={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Kp=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},j3=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},K3=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Z3=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},gw=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},yw=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},J3=function(e,t,n){return e.style[t]=n},Q3=function(e,t,n){return e.style.setProperty(t,n)},eU=function(e,t,n){return e._gsap[t]=n},tU=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},nU=function(e,t,n,s,r){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(r,a)},iU=function(e,t,n,s,r){var a=e._gsap;a[t]=n,a.renderTransform(r,a)},Mn="transform",Ni=Mn+"Origin",sU=function i(e,t){var n=this,s=this.target,r=s.style,a=s._gsap;if(e in Lr&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Ys[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=yr(s,o)}):this.tfm[e]=a.x?a[e]:yr(s,e),e===Ni&&(this.tfm.zOrigin=a.zOrigin);else return Ys.transform.split(",").forEach(function(o){return i.call(n,o,t)});if(this.props.indexOf(Mn)>=0)return;a.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(Ni,t,"")),e=Mn}(r||t)&&this.props.push(e,t,r[e])},xw=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},rU=function(){var e=this.props,t=this.target,n=t.style,s=t._gsap,r,a;for(r=0;r<e.length;r+=3)e[r+1]?e[r+1]===2?t[e[r]](e[r+2]):t[e[r]]=e[r+2]:e[r+2]?n[e[r]]=e[r+2]:n.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(p_,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)s[a]=this.tfm[a];s.svg&&(s.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=f_(),(!r||!r.isStart)&&!n[Mn]&&(xw(n),s.zOrigin&&n[Ni]&&(n[Ni]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},bw=function(e,t){var n={target:e,props:[],revert:rU,save:sU};return e._gsap||Fi.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(s){return n.save(s)}),n},ww,Zp=function(e,t){var n=jr.createElementNS?jr.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):jr.createElement(e);return n&&n.style?n:jr.createElement(e)},hs=function i(e,t,n){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(p_,"-$1").toLowerCase())||s.getPropertyValue(t)||!n&&i(e,_l(t)||t,1)||""},dy="O,Moz,ms,Ms,Webkit".split(","),_l=function(e,t,n){var s=t||Ka,r=s.style,a=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(dy[a]+e in r););return a<0?null:(a===3?"ms":a>=0?dy[a]:"")+e},Jp=function(){X3()&&window.document&&(ly=window,jr=ly.document,tl=jr.documentElement,Ka=Zp("div")||{style:{}},Zp("div"),Mn=_l(Mn),Ni=Mn+"Origin",Ka.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",ww=!!_l("perspective"),f_=Fi.core.reverting,h_=1)},hy=function(e){var t=e.ownerSVGElement,n=Zp("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=e.cloneNode(!0),r;s.style.display="block",n.appendChild(s),tl.appendChild(n);try{r=s.getBBox()}catch{}return n.removeChild(s),tl.removeChild(n),r},fy=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Sw=function(e){var t,n;try{t=e.getBBox()}catch{t=hy(e),n=1}return t&&(t.width||t.height)||n||(t=hy(e)),t&&!t.width&&!t.x&&!t.y?{x:+fy(e,["x","cx","x1"])||0,y:+fy(e,["y","cy","y1"])||0,width:0,height:0}:t},Ew=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Sw(e))},lo=function(e,t){if(t){var n=e.style,s;t in Lr&&t!==Ni&&(t=Mn),n.removeProperty?(s=t.substr(0,2),(s==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(s==="--"?t:t.replace(p_,"-$1").toLowerCase())):n.removeAttribute(t)}},Kr=function(e,t,n,s,r,a){var o=new Oi(e._pt,t,n,0,1,a?yw:gw);return e._pt=o,o.b=s,o.e=r,e._props.push(n),o},py={deg:1,rad:1,turn:1},aU={grid:1,flex:1},da=function i(e,t,n,s){var r=parseFloat(n)||0,a=(n+"").trim().substr((r+"").length)||"px",o=Ka.style,l=q3.test(t),c=e.tagName.toLowerCase()==="svg",u=(c?"client":"offset")+(l?"Width":"Height"),d=100,h=s==="px",f=s==="%",p,m,_,v;if(s===a||!r||py[s]||py[a])return r;if(a!=="px"&&!h&&(r=i(e,t,n,"px")),v=e.getCTM&&Ew(e),(f||a==="%")&&(Lr[t]||~t.indexOf("adius")))return p=v?e.getBBox()[l?"width":"height"]:e[u],Dn(f?r/p*d:r/100*p);if(o[l?"width":"height"]=d+(h?a:s),m=s!=="rem"&&~t.indexOf("adius")||s==="em"&&e.appendChild&&!c?e:e.parentNode,v&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===jr||!m.appendChild)&&(m=jr.body),_=m._gsap,_&&f&&_.width&&l&&_.time===Xi.time&&!_.uncache)return Dn(r/_.width*d);if(f&&(t==="height"||t==="width")){var x=e.style[t];e.style[t]=d+s,p=e[u],x?e.style[t]=x:lo(e,t)}else(f||a==="%")&&!aU[hs(m,"display")]&&(o.position=hs(e,"position")),m===e&&(o.position="static"),m.appendChild(Ka),p=Ka[u],m.removeChild(Ka),o.position="absolute";return l&&f&&(_=Ja(m),_.time=Xi.time,_.width=m[u]),Dn(h?p*r/d:p&&r?d/p*r:0)},yr=function(e,t,n,s){var r;return h_||Jp(),t in Ys&&t!=="transform"&&(t=Ys[t],~t.indexOf(",")&&(t=t.split(",")[0])),Lr[t]&&t!=="transform"?(r=Rc(e,s),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Cd(hs(e,Ni))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||s||~(r+"").indexOf("calc("))&&(r=Ad[t]&&Ad[t](e,t,n)||hs(e,t)||zb(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?da(e,t,r,n)+n:r},oU=function(e,t,n,s){if(!n||n==="none"){var r=_l(t,e,1),a=r&&hs(e,r,1);a&&a!==n?(t=r,n=a):t==="borderColor"&&(n=hs(e,"borderTopColor"))}var o=new Oi(this._pt,e.style,t,0,1,mw),l=0,c=0,u,d,h,f,p,m,_,v,x,y,g,w;if(o.b=n,o.e=s,n+="",s+="",s.substring(0,6)==="var(--"&&(s=hs(e,s.substring(4,s.indexOf(")")))),s==="auto"&&(m=e.style[t],e.style[t]=s,s=hs(e,t)||s,m?e.style[t]=m:lo(e,t)),u=[n,s],rw(u),n=u[0],s=u[1],h=n.match(Go)||[],w=s.match(Go)||[],w.length){for(;d=Go.exec(s);)_=d[0],x=s.substring(l,d.index),p?p=(p+1)%5:(x.substr(-5)==="rgba("||x.substr(-5)==="hsla(")&&(p=1),_!==(m=h[c++]||"")&&(f=parseFloat(m)||0,g=m.substr((f+"").length),_.charAt(1)==="="&&(_=el(f,_)+g),v=parseFloat(_),y=_.substr((v+"").length),l=Go.lastIndex-y.length,y||(y=y||Ki.units[t]||g,l===s.length&&(s+=y,o.e+=y)),g!==y&&(f=da(e,t,m,y)||0),o._pt={_next:o._pt,p:x||c===1?x:",",s:f,c:v-f,m:p&&p<4||t==="zIndex"?Math.round:0});o.c=l<s.length?s.substring(l,s.length):""}else o.r=t==="display"&&s==="none"?yw:gw;return kb.test(s)&&(o.e=0),this._pt=o,o},my={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},lU=function(e){var t=e.split(" "),n=t[0],s=t[1]||"50%";return(n==="top"||n==="bottom"||s==="left"||s==="right")&&(e=n,n=s,s=e),t[0]=my[n]||n,t[1]=my[s]||s,t.join(" ")},cU=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,s=n.style,r=t.u,a=n._gsap,o,l,c;if(r==="all"||r===!0)s.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)o=r[c],Lr[o]&&(l=1,o=o==="transformOrigin"?Ni:Mn),lo(n,o);l&&(lo(n,Mn),a&&(a.svg&&n.removeAttribute("transform"),s.scale=s.rotate=s.translate="none",Rc(n,1),a.uncache=1,xw(s)))}},Ad={clearProps:function(e,t,n,s,r){if(r.data!=="isFromStart"){var a=e._pt=new Oi(e._pt,t,n,0,0,cU);return a.u=s,a.pr=-10,a.tween=r,e._props.push(n),1}}},Pc=[1,0,0,1,0,0],Mw={},Tw=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},_y=function(e){var t=hs(e,Mn);return Tw(t)?Pc:t.substr(7).match(Db).map(Dn)},m_=function(e,t){var n=e._gsap||Ja(e),s=e.style,r=_y(e),a,o,l,c;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?Pc:r):(r===Pc&&!e.offsetParent&&e!==tl&&!n.svg&&(l=s.display,s.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,o=e.nextElementSibling,tl.appendChild(e)),r=_y(e),l?s.display=l:lo(e,"display"),c&&(o?a.insertBefore(e,o):a?a.appendChild(e):tl.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},Qp=function(e,t,n,s,r,a){var o=e._gsap,l=r||m_(e,!0),c=o.xOrigin||0,u=o.yOrigin||0,d=o.xOffset||0,h=o.yOffset||0,f=l[0],p=l[1],m=l[2],_=l[3],v=l[4],x=l[5],y=t.split(" "),g=parseFloat(y[0])||0,w=parseFloat(y[1])||0,b,T,E,S;n?l!==Pc&&(T=f*_-p*m)&&(E=g*(_/T)+w*(-m/T)+(m*x-_*v)/T,S=g*(-p/T)+w*(f/T)-(f*x-p*v)/T,g=E,w=S):(b=Sw(e),g=b.x+(~y[0].indexOf("%")?g/100*b.width:g),w=b.y+(~(y[1]||y[0]).indexOf("%")?w/100*b.height:w)),s||s!==!1&&o.smooth?(v=g-c,x=w-u,o.xOffset=d+(v*f+x*m)-v,o.yOffset=h+(v*p+x*_)-x):o.xOffset=o.yOffset=0,o.xOrigin=g,o.yOrigin=w,o.smooth=!!s,o.origin=t,o.originIsAbsolute=!!n,e.style[Ni]="0px 0px",a&&(Kr(a,o,"xOrigin",c,g),Kr(a,o,"yOrigin",u,w),Kr(a,o,"xOffset",d,o.xOffset),Kr(a,o,"yOffset",h,o.yOffset)),e.setAttribute("data-svg-origin",g+" "+w)},Rc=function(e,t){var n=e._gsap||new cw(e);if("x"in n&&!t&&!n.uncache)return n;var s=e.style,r=n.scaleX<0,a="px",o="deg",l=getComputedStyle(e),c=hs(e,Ni)||"0",u,d,h,f,p,m,_,v,x,y,g,w,b,T,E,S,M,A,C,I,H,W,z,q,O,re,le,Z,ne,j,ee,F;return u=d=h=m=_=v=x=y=g=0,f=p=1,n.svg=!!(e.getCTM&&Ew(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(s[Mn]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Mn]!=="none"?l[Mn]:"")),s.scale=s.rotate=s.translate="none"),T=m_(e,n.svg),n.svg&&(n.uncache?(O=e.getBBox(),c=n.xOrigin-O.x+"px "+(n.yOrigin-O.y)+"px",q=""):q=!t&&e.getAttribute("data-svg-origin"),Qp(e,q||c,!!q||n.originIsAbsolute,n.smooth!==!1,T)),w=n.xOrigin||0,b=n.yOrigin||0,T!==Pc&&(A=T[0],C=T[1],I=T[2],H=T[3],u=W=T[4],d=z=T[5],T.length===6?(f=Math.sqrt(A*A+C*C),p=Math.sqrt(H*H+I*I),m=A||C?Io(C,A)*za:0,x=I||H?Io(I,H)*za+m:0,x&&(p*=Math.abs(Math.cos(x*nl))),n.svg&&(u-=w-(w*A+b*I),d-=b-(w*C+b*H))):(F=T[6],j=T[7],le=T[8],Z=T[9],ne=T[10],ee=T[11],u=T[12],d=T[13],h=T[14],E=Io(F,ne),_=E*za,E&&(S=Math.cos(-E),M=Math.sin(-E),q=W*S+le*M,O=z*S+Z*M,re=F*S+ne*M,le=W*-M+le*S,Z=z*-M+Z*S,ne=F*-M+ne*S,ee=j*-M+ee*S,W=q,z=O,F=re),E=Io(-I,ne),v=E*za,E&&(S=Math.cos(-E),M=Math.sin(-E),q=A*S-le*M,O=C*S-Z*M,re=I*S-ne*M,ee=H*M+ee*S,A=q,C=O,I=re),E=Io(C,A),m=E*za,E&&(S=Math.cos(E),M=Math.sin(E),q=A*S+C*M,O=W*S+z*M,C=C*S-A*M,z=z*S-W*M,A=q,W=O),_&&Math.abs(_)+Math.abs(m)>359.9&&(_=m=0,v=180-v),f=Dn(Math.sqrt(A*A+C*C+I*I)),p=Dn(Math.sqrt(z*z+F*F)),E=Io(W,z),x=Math.abs(E)>2e-4?E*za:0,g=ee?1/(ee<0?-ee:ee):0),n.svg&&(q=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Tw(hs(e,Mn)),q&&e.setAttribute("transform",q))),Math.abs(x)>90&&Math.abs(x)<270&&(r?(f*=-1,x+=m<=0?180:-180,m+=m<=0?180:-180):(p*=-1,x+=x<=0?180:-180)),t=t||n.uncache,n.x=u-((n.xPercent=u&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+a,n.y=d-((n.yPercent=d&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-d)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+a,n.z=h+a,n.scaleX=Dn(f),n.scaleY=Dn(p),n.rotation=Dn(m)+o,n.rotationX=Dn(_)+o,n.rotationY=Dn(v)+o,n.skewX=x+o,n.skewY=y+o,n.transformPerspective=g+a,(n.zOrigin=parseFloat(c.split(" ")[2])||!t&&n.zOrigin||0)&&(s[Ni]=Cd(c)),n.xOffset=n.yOffset=0,n.force3D=Ki.force3D,n.renderTransform=n.svg?dU:ww?Aw:uU,n.uncache=0,n},Cd=function(e){return(e=e.split(" "))[0]+" "+e[1]},vf=function(e,t,n){var s=hi(t);return Dn(parseFloat(t)+parseFloat(da(e,"x",n+"px",s)))+s},uU=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Aw(e,t)},Ba="0deg",Ol="0px",Oa=") ",Aw=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,a=n.x,o=n.y,l=n.z,c=n.rotation,u=n.rotationY,d=n.rotationX,h=n.skewX,f=n.skewY,p=n.scaleX,m=n.scaleY,_=n.transformPerspective,v=n.force3D,x=n.target,y=n.zOrigin,g="",w=v==="auto"&&e&&e!==1||v===!0;if(y&&(d!==Ba||u!==Ba)){var b=parseFloat(u)*nl,T=Math.sin(b),E=Math.cos(b),S;b=parseFloat(d)*nl,S=Math.cos(b),a=vf(x,a,T*S*-y),o=vf(x,o,-Math.sin(b)*-y),l=vf(x,l,E*S*-y+y)}_!==Ol&&(g+="perspective("+_+Oa),(s||r)&&(g+="translate("+s+"%, "+r+"%) "),(w||a!==Ol||o!==Ol||l!==Ol)&&(g+=l!==Ol||w?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+Oa),c!==Ba&&(g+="rotate("+c+Oa),u!==Ba&&(g+="rotateY("+u+Oa),d!==Ba&&(g+="rotateX("+d+Oa),(h!==Ba||f!==Ba)&&(g+="skew("+h+", "+f+Oa),(p!==1||m!==1)&&(g+="scale("+p+", "+m+Oa),x.style[Mn]=g||"translate(0, 0)"},dU=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,a=n.x,o=n.y,l=n.rotation,c=n.skewX,u=n.skewY,d=n.scaleX,h=n.scaleY,f=n.target,p=n.xOrigin,m=n.yOrigin,_=n.xOffset,v=n.yOffset,x=n.forceCSS,y=parseFloat(a),g=parseFloat(o),w,b,T,E,S;l=parseFloat(l),c=parseFloat(c),u=parseFloat(u),u&&(u=parseFloat(u),c+=u,l+=u),l||c?(l*=nl,c*=nl,w=Math.cos(l)*d,b=Math.sin(l)*d,T=Math.sin(l-c)*-h,E=Math.cos(l-c)*h,c&&(u*=nl,S=Math.tan(c-u),S=Math.sqrt(1+S*S),T*=S,E*=S,u&&(S=Math.tan(u),S=Math.sqrt(1+S*S),w*=S,b*=S)),w=Dn(w),b=Dn(b),T=Dn(T),E=Dn(E)):(w=d,E=h,b=T=0),(y&&!~(a+"").indexOf("px")||g&&!~(o+"").indexOf("px"))&&(y=da(f,"x",a,"px"),g=da(f,"y",o,"px")),(p||m||_||v)&&(y=Dn(y+p-(p*w+m*T)+_),g=Dn(g+m-(p*b+m*E)+v)),(s||r)&&(S=f.getBBox(),y=Dn(y+s/100*S.width),g=Dn(g+r/100*S.height)),S="matrix("+w+","+b+","+T+","+E+","+y+","+g+")",f.setAttribute("transform",S),x&&(f.style[Mn]=S)},hU=function(e,t,n,s,r){var a=360,o=ei(r),l=parseFloat(r)*(o&&~r.indexOf("rad")?za:1),c=l-s,u=s+c+"deg",d,h;return o&&(d=r.split("_")[1],d==="short"&&(c%=a,c!==c%(a/2)&&(c+=c<0?a:-a)),d==="cw"&&c<0?c=(c+a*uy)%a-~~(c/a)*a:d==="ccw"&&c>0&&(c=(c-a*uy)%a-~~(c/a)*a)),e._pt=h=new Oi(e._pt,t,n,s,c,j3),h.e=u,h.u="deg",e._props.push(n),h},vy=function(e,t){for(var n in t)e[n]=t[n];return e},fU=function(e,t,n){var s=vy({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",a=n.style,o,l,c,u,d,h,f,p;s.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),a[Mn]=t,o=Rc(n,1),lo(n,Mn),n.setAttribute("transform",c)):(c=getComputedStyle(n)[Mn],a[Mn]=t,o=Rc(n,1),a[Mn]=c);for(l in Lr)c=s[l],u=o[l],c!==u&&r.indexOf(l)<0&&(f=hi(c),p=hi(u),d=f!==p?da(n,l,c,p):parseFloat(c),h=parseFloat(u),e._pt=new Oi(e._pt,o,l,d,h-d,Kp),e._pt.u=p||0,e._props.push(l));vy(o,s)};Bi("padding,margin,Width,Radius",function(i,e){var t="Top",n="Right",s="Bottom",r="Left",a=(e<3?[t,n,s,r]:[t+r,t+n,s+n,s+r]).map(function(o){return e<2?i+o:"border"+o+i});Ad[e>1?"border"+i:i]=function(o,l,c,u,d){var h,f;if(arguments.length<4)return h=a.map(function(p){return yr(o,p,c)}),f=h.join(" "),f.split(h[0]).length===5?h[0]:f;h=(u+"").split(" "),f={},a.forEach(function(p,m){return f[p]=h[m]=h[m]||h[(m-1)/2|0]}),o.init(l,f,d)}});var Cw={name:"css",register:Jp,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,s,r){var a=this._props,o=e.style,l=n.vars.startAt,c,u,d,h,f,p,m,_,v,x,y,g,w,b,T,E;h_||Jp(),this.styles=this.styles||bw(e),E=this.styles.props,this.tween=n;for(m in t)if(m!=="autoRound"&&(u=t[m],!(Wi[m]&&uw(m,t,n,s,e,r)))){if(f=typeof u,p=Ad[m],f==="function"&&(u=u.call(n,s,e,r),f=typeof u),f==="string"&&~u.indexOf("random(")&&(u=Tc(u)),p)p(this,e,m,u,n)&&(T=1);else if(m.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(m)+"").trim(),u+="",ta.lastIndex=0,ta.test(c)||(_=hi(c),v=hi(u)),v?_!==v&&(c=da(e,m,c,v)+v):_&&(u+=_),this.add(o,"setProperty",c,u,s,r,0,0,m),a.push(m),E.push(m,0,o[m]);else if(f!=="undefined"){if(l&&m in l?(c=typeof l[m]=="function"?l[m].call(n,s,e,r):l[m],ei(c)&&~c.indexOf("random(")&&(c=Tc(c)),hi(c+"")||c==="auto"||(c+=Ki.units[m]||hi(yr(e,m))||""),(c+"").charAt(1)==="="&&(c=yr(e,m))):c=yr(e,m),h=parseFloat(c),x=f==="string"&&u.charAt(1)==="="&&u.substr(0,2),x&&(u=u.substr(2)),d=parseFloat(u),m in Ys&&(m==="autoAlpha"&&(h===1&&yr(e,"visibility")==="hidden"&&d&&(h=0),E.push("visibility",0,o.visibility),Kr(this,o,"visibility",h?"inherit":"hidden",d?"inherit":"hidden",!d)),m!=="scale"&&m!=="transform"&&(m=Ys[m],~m.indexOf(",")&&(m=m.split(",")[0]))),y=m in Lr,y){if(this.styles.save(m),f==="string"&&u.substring(0,6)==="var(--"&&(u=hs(e,u.substring(4,u.indexOf(")"))),d=parseFloat(u)),g||(w=e._gsap,w.renderTransform&&!t.parseTransform||Rc(e,t.parseTransform),b=t.smoothOrigin!==!1&&w.smooth,g=this._pt=new Oi(this._pt,o,Mn,0,1,w.renderTransform,w,0,-1),g.dep=1),m==="scale")this._pt=new Oi(this._pt,w,"scaleY",w.scaleY,(x?el(w.scaleY,x+d):d)-w.scaleY||0,Kp),this._pt.u=0,a.push("scaleY",m),m+="X";else if(m==="transformOrigin"){E.push(Ni,0,o[Ni]),u=lU(u),w.svg?Qp(e,u,0,b,0,this):(v=parseFloat(u.split(" ")[2])||0,v!==w.zOrigin&&Kr(this,w,"zOrigin",w.zOrigin,v),Kr(this,o,m,Cd(c),Cd(u)));continue}else if(m==="svgOrigin"){Qp(e,u,1,b,0,this);continue}else if(m in Mw){hU(this,w,m,h,x?el(h,x+u):u);continue}else if(m==="smoothOrigin"){Kr(this,w,"smooth",w.smooth,u);continue}else if(m==="force3D"){w[m]=u;continue}else if(m==="transform"){fU(this,u,e);continue}}else m in o||(m=_l(m)||m);if(y||(d||d===0)&&(h||h===0)&&!Y3.test(u)&&m in o)_=(c+"").substr((h+"").length),d||(d=0),v=hi(u)||(m in Ki.units?Ki.units[m]:_),_!==v&&(h=da(e,m,c,v)),this._pt=new Oi(this._pt,y?w:o,m,h,(x?el(h,x+d):d)-h,!y&&(v==="px"||m==="zIndex")&&t.autoRound!==!1?Z3:Kp),this._pt.u=v||0,_!==v&&v!=="%"&&(this._pt.b=c,this._pt.r=K3);else if(m in o)oU.call(this,e,m,c,x?x+u:u);else if(m in e)this.add(e,m,c||e[m],x?x+u:u,s,r);else if(m!=="parseTransform"){n_(m,u);continue}y||(m in o?E.push(m,0,o[m]):typeof e[m]=="function"?E.push(m,2,e[m]()):E.push(m,1,c||e[m])),a.push(m)}}T&&_w(this)},render:function(e,t){if(t.tween._time||!f_())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:yr,aliases:Ys,getSetter:function(e,t,n){var s=Ys[t];return s&&s.indexOf(",")<0&&(t=s),t in Lr&&t!==Ni&&(e._gsap.x||yr(e,"x"))?n&&cy===n?t==="scale"?tU:eU:(cy=n||{})&&(t==="scale"?nU:iU):e.style&&!Qm(e.style[t])?J3:~t.indexOf("-")?Q3:u_(e,t)},core:{_removeProperty:lo,_getMatrix:m_}};Fi.utils.checkPrefix=_l;Fi.core.getStyleSaver=bw;(function(i,e,t,n){var s=Bi(i+","+e+","+t,function(r){Lr[r]=1});Bi(e,function(r){Ki.units[r]="deg",Mw[r]=1}),Ys[s[13]]=i+","+e,Bi(n,function(r){var a=r.split(":");Ys[a[1]]=s[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Bi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){Ki.units[i]="px"});Fi.registerPlugin(Cw);var Zu=Fi.registerPlugin(Cw)||Fi;Zu.core.Tween;class Cs{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new G);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new G);const n=this.elements,s=e.x,r=e.y,a=e.z;return t.x=n[0]*s+n[1]*r+n[2]*a,t.y=n[3]*s+n[4]*r+n[5]*a,t.z=n[6]*s+n[7]*r+n[8]*a,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Cs);const n=this.elements,s=e.elements,r=t.elements,a=n[0],o=n[1],l=n[2],c=n[3],u=n[4],d=n[5],h=n[6],f=n[7],p=n[8],m=s[0],_=s[1],v=s[2],x=s[3],y=s[4],g=s[5],w=s[6],b=s[7],T=s[8];return r[0]=a*m+o*x+l*w,r[1]=a*_+o*y+l*b,r[2]=a*v+o*g+l*T,r[3]=c*m+u*x+d*w,r[4]=c*_+u*y+d*b,r[5]=c*v+u*g+d*T,r[6]=h*m+f*x+p*w,r[7]=h*_+f*y+p*b,r[8]=h*v+f*g+p*T,t}scale(e,t){t===void 0&&(t=new Cs);const n=this.elements,s=t.elements;for(let r=0;r!==3;r++)s[3*r+0]=e.x*n[3*r+0],s[3*r+1]=e.y*n[3*r+1],s[3*r+2]=e.z*n[3*r+2];return t}solve(e,t){t===void 0&&(t=new G);const n=3,s=4,r=[];let a,o;for(a=0;a<n*s;a++)r.push(0);for(a=0;a<3;a++)for(o=0;o<3;o++)r[a+s*o]=this.elements[a+3*o];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let l=3;const c=l;let u;const d=4;let h;do{if(a=c-l,r[a+s*a]===0){for(o=a+1;o<c;o++)if(r[a+s*o]!==0){u=d;do h=d-u,r[h+s*a]+=r[h+s*o];while(--u);break}}if(r[a+s*a]!==0)for(o=a+1;o<c;o++){const f=r[a+s*o]/r[a+s*a];u=d;do h=d-u,r[h+s*o]=h<=a?0:r[h+s*o]-r[h+s*a]*f;while(--u)}}while(--l);if(t.z=r[2*s+3]/r[2*s+2],t.y=(r[1*s+3]-r[1*s+2]*t.z)/r[1*s+1],t.x=(r[0*s+3]-r[0*s+2]*t.z-r[0*s+1]*t.y)/r[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new Cs);const t=3,n=6,s=pU;let r,a;for(r=0;r<3;r++)for(a=0;a<3;a++)s[r+n*a]=this.elements[r+3*a];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let o=3;const l=o;let c;const u=n;let d;do{if(r=l-o,s[r+n*r]===0){for(a=r+1;a<l;a++)if(s[r+n*a]!==0){c=u;do d=u-c,s[d+n*r]+=s[d+n*a];while(--c);break}}if(s[r+n*r]!==0)for(a=r+1;a<l;a++){const h=s[r+n*a]/s[r+n*r];c=u;do d=u-c,s[d+n*a]=d<=r?0:s[d+n*a]-s[d+n*r]*h;while(--c)}}while(--o);r=2;do{a=r-1;do{const h=s[r+n*a]/s[r+n*r];c=n;do d=n-c,s[d+n*a]=s[d+n*a]-s[d+n*r]*h;while(--c)}while(a--)}while(--r);r=2;do{const h=1/s[r+n*r];c=n;do d=n-c,s[d+n*r]=s[d+n*r]*h;while(--c)}while(r--);r=2;do{a=2;do{if(d=s[t+a+n*r],isNaN(d)||d===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(r,a,d)}while(a--)}while(r--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,s=e.z,r=e.w,a=t+t,o=n+n,l=s+s,c=t*a,u=t*o,d=t*l,h=n*o,f=n*l,p=s*l,m=r*a,_=r*o,v=r*l,x=this.elements;return x[3*0+0]=1-(h+p),x[3*0+1]=u-v,x[3*0+2]=d+_,x[3*1+0]=u+v,x[3*1+1]=1-(c+p),x[3*1+2]=f-m,x[3*2+0]=d-_,x[3*2+1]=f+m,x[3*2+2]=1-(c+h),this}transpose(e){e===void 0&&(e=new Cs);const t=this.elements,n=e.elements;let s;return n[0]=t[0],n[4]=t[4],n[8]=t[8],s=t[1],n[1]=t[3],n[3]=s,s=t[2],n[2]=t[6],n[6]=s,s=t[5],n[5]=t[7],n[7]=s,e}}const pU=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class G{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new G);const n=e.x,s=e.y,r=e.z,a=this.x,o=this.y,l=this.z;return t.x=o*r-l*s,t.y=l*n-a*r,t.z=a*s-o*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new G(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new G(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Cs([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,s=Math.sqrt(e*e+t*t+n*n);if(s>0){const r=1/s;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new G);const t=this.x,n=this.y,s=this.z;let r=Math.sqrt(t*t+n*n+s*s);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=s*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,o=e.z;return Math.sqrt((r-t)*(r-t)+(a-n)*(a-n)+(o-s)*(o-s))}distanceSquared(e){const t=this.x,n=this.y,s=this.z,r=e.x,a=e.y,o=e.z;return(r-t)*(r-t)+(a-n)*(a-n)+(o-s)*(o-s)}scale(e,t){t===void 0&&(t=new G);const n=this.x,s=this.y,r=this.z;return t.x=e*n,t.y=e*s,t.z=e*r,t}vmul(e,t){return t===void 0&&(t=new G),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new G),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new G),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const s=mU,r=1/n;s.set(this.x*r,this.y*r,this.z*r);const a=_U;Math.abs(s.x)<.9?(a.set(1,0,0),s.cross(a,e)):(a.set(0,1,0),s.cross(a,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const s=this.x,r=this.y,a=this.z;n.x=s+(e.x-s)*t,n.y=r+(e.y-r)*t,n.z=a+(e.z-a)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(gy),gy.almostEquals(e,t)}clone(){return new G(this.x,this.y,this.z)}}G.ZERO=new G(0,0,0);G.UNIT_X=new G(1,0,0);G.UNIT_Y=new G(0,1,0);G.UNIT_Z=new G(0,0,1);const mU=new G,_U=new G,gy=new G;class ts{constructor(e){e===void 0&&(e={}),this.lowerBound=new G,this.upperBound=new G,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,s){const r=this.lowerBound,a=this.upperBound,o=n;r.copy(e[0]),o&&o.vmult(r,r),a.copy(r);for(let l=1;l<e.length;l++){let c=e[l];o&&(o.vmult(c,yy),c=yy),c.x>a.x&&(a.x=c.x),c.x<r.x&&(r.x=c.x),c.y>a.y&&(a.y=c.y),c.y<r.y&&(r.y=c.y),c.z>a.z&&(a.z=c.z),c.z<r.z&&(r.z=c.z)}return t&&(t.vadd(r,r),t.vadd(a,a)),s&&(r.x-=s,r.y-=s,r.z-=s,a.x+=s,a.y+=s,a.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new ts().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,r=e.upperBound,a=s.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,o=s.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,l=s.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return a&&o&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,r=e.upperBound;return t.x<=s.x&&n.x>=r.x&&t.y<=s.y&&n.y>=r.y&&t.z<=s.z&&n.z>=r.z}getCorners(e,t,n,s,r,a,o,l){const c=this.lowerBound,u=this.upperBound;e.copy(c),t.set(u.x,c.y,c.z),n.set(u.x,u.y,c.z),s.set(c.x,u.y,u.z),r.set(u.x,c.y,u.z),a.set(c.x,u.y,c.z),o.set(c.x,c.y,u.z),l.copy(u)}toLocalFrame(e,t){const n=xy,s=n[0],r=n[1],a=n[2],o=n[3],l=n[4],c=n[5],u=n[6],d=n[7];this.getCorners(s,r,a,o,l,c,u,d);for(let h=0;h!==8;h++){const f=n[h];e.pointToLocal(f,f)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=xy,s=n[0],r=n[1],a=n[2],o=n[3],l=n[4],c=n[5],u=n[6],d=n[7];this.getCorners(s,r,a,o,l,c,u,d);for(let h=0;h!==8;h++){const f=n[h];e.pointToWorld(f,f)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,s=1/t.x,r=1/t.y,a=1/t.z,o=(this.lowerBound.x-n.x)*s,l=(this.upperBound.x-n.x)*s,c=(this.lowerBound.y-n.y)*r,u=(this.upperBound.y-n.y)*r,d=(this.lowerBound.z-n.z)*a,h=(this.upperBound.z-n.z)*a,f=Math.max(Math.max(Math.min(o,l),Math.min(c,u)),Math.min(d,h)),p=Math.min(Math.min(Math.max(o,l),Math.max(c,u)),Math.max(d,h));return!(p<0||f>p)}}const yy=new G,xy=[new G,new G,new G,new G,new G,new G,new G,new G];class by{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:s}=t;if(s>n){const r=s;s=n,n=r}return this.matrix[(n*(n+1)>>1)+s-1]}set(e,t,n){let{index:s}=e,{index:r}=t;if(r>s){const a=r;r=s,s=a}this.matrix[(s*(s+1)>>1)+r-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class Pw{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!!(n[e]!==void 0&&n[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const s=n[e].indexOf(t);return s!==-1&&n[e].splice(s,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){e.target=this;for(let s=0,r=n.length;s<r;s++)n[s].call(this,e)}return this}}class Gn{constructor(e,t,n,s){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new G),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=vU,s=gU;e.tangents(n,s),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Gn);const n=this.x,s=this.y,r=this.z,a=this.w,o=e.x,l=e.y,c=e.z,u=e.w;return t.x=n*u+a*o+s*c-r*l,t.y=s*u+a*l+r*o-n*c,t.z=r*u+a*c+n*l-s*o,t.w=a*u-n*o-s*l-r*c,t}inverse(e){e===void 0&&(e=new Gn);const t=this.x,n=this.y,s=this.z,r=this.w;this.conjugate(e);const a=1/(t*t+n*n+s*s+r*r);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e}conjugate(e){return e===void 0&&(e=new Gn),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new G);const n=e.x,s=e.y,r=e.z,a=this.x,o=this.y,l=this.z,c=this.w,u=c*n+o*r-l*s,d=c*s+l*n-a*r,h=c*r+a*s-o*n,f=-a*n-o*s-l*r;return t.x=u*c+f*-a+d*-l-h*-o,t.y=d*c+f*-o+h*-a-u*-l,t.z=h*c+f*-l+u*-o-d*-a,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,s,r;const a=this.x,o=this.y,l=this.z,c=this.w;switch(t){case"YZX":const u=a*o+l*c;if(u>.499&&(n=2*Math.atan2(a,c),s=Math.PI/2,r=0),u<-.499&&(n=-2*Math.atan2(a,c),s=-Math.PI/2,r=0),n===void 0){const d=a*a,h=o*o,f=l*l;n=Math.atan2(2*o*c-2*a*l,1-2*h-2*f),s=Math.asin(2*u),r=Math.atan2(2*a*c-2*o*l,1-2*d-2*f)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=s,e.x=r}setFromEuler(e,t,n,s){s===void 0&&(s="XYZ");const r=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),l=Math.sin(e/2),c=Math.sin(t/2),u=Math.sin(n/2);return s==="XYZ"?(this.x=l*a*o+r*c*u,this.y=r*c*o-l*a*u,this.z=r*a*u+l*c*o,this.w=r*a*o-l*c*u):s==="YXZ"?(this.x=l*a*o+r*c*u,this.y=r*c*o-l*a*u,this.z=r*a*u-l*c*o,this.w=r*a*o+l*c*u):s==="ZXY"?(this.x=l*a*o-r*c*u,this.y=r*c*o+l*a*u,this.z=r*a*u+l*c*o,this.w=r*a*o-l*c*u):s==="ZYX"?(this.x=l*a*o-r*c*u,this.y=r*c*o+l*a*u,this.z=r*a*u-l*c*o,this.w=r*a*o+l*c*u):s==="YZX"?(this.x=l*a*o+r*c*u,this.y=r*c*o+l*a*u,this.z=r*a*u-l*c*o,this.w=r*a*o-l*c*u):s==="XZY"&&(this.x=l*a*o-r*c*u,this.y=r*c*o-l*a*u,this.z=r*a*u+l*c*o,this.w=r*a*o+l*c*u),this}clone(){return new Gn(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Gn);const s=this.x,r=this.y,a=this.z,o=this.w;let l=e.x,c=e.y,u=e.z,d=e.w,h,f,p,m,_;return f=s*l+r*c+a*u+o*d,f<0&&(f=-f,l=-l,c=-c,u=-u,d=-d),1-f>1e-6?(h=Math.acos(f),p=Math.sin(h),m=Math.sin((1-t)*h)/p,_=Math.sin(t*h)/p):(m=1-t,_=t),n.x=m*s+_*l,n.y=m*r+_*c,n.z=m*a+_*u,n.w=m*o+_*d,n}integrate(e,t,n,s){s===void 0&&(s=new Gn);const r=e.x*n.x,a=e.y*n.y,o=e.z*n.z,l=this.x,c=this.y,u=this.z,d=this.w,h=t*.5;return s.x+=h*(r*d+a*u-o*c),s.y+=h*(a*d+o*l-r*u),s.z+=h*(o*d+r*c-a*l),s.w+=h*(-r*l-a*c-o*u),s}}const vU=new G,gU=new G,yU={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class mt{constructor(e){e===void 0&&(e={}),this.id=mt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}mt.idCounter=0;mt.types=yU;class rn{constructor(e){e===void 0&&(e={}),this.position=new G,this.quaternion=new Gn,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return rn.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return rn.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new G),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,s){return s===void 0&&(s=new G),n.vsub(e,s),t.conjugate(wy),wy.vmult(s,s),s}static pointToWorldFrame(e,t,n,s){return s===void 0&&(s=new G),t.vmult(n,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new G),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,s){return s===void 0&&(s=new G),t.w*=-1,t.vmult(n,s),t.w*=-1,s}}const wy=new Gn;class sc extends mt{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:n=[],normals:s=[],axes:r,boundingSphereRadius:a}=e;super({type:mt.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=s,this.faceNormals.length===0&&this.computeNormals(),a?this.boundingSphereRadius=a:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const s=new G;for(let r=0;r!==e.length;r++){const a=e[r],o=a.length;for(let l=0;l!==o;l++){const c=(l+1)%o;t[a[l]].vsub(t[a[c]],s),s.normalize();let u=!1;for(let d=0;d!==n.length;d++)if(n[d].almostEquals(s)||n[d].almostEquals(s)){u=!0;break}u||n.push(s.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let s=0;s<this.faces[e].length;s++)if(!this.vertices[this.faces[e][s]])throw new Error(`Vertex ${this.faces[e][s]} not found!`);const t=this.faceNormals[e]||new G;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let s=0;s<this.faces[e].length;s++)console.warn(`.vertices[${this.faces[e][s]}] = Vec3(${this.vertices[this.faces[e][s]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],s=this.vertices[n[0]],r=this.vertices[n[1]],a=this.vertices[n[2]];sc.computeNormal(s,r,a,t)}static computeNormal(e,t,n,s){const r=new G,a=new G;t.vsub(e,a),n.vsub(t,r),r.cross(a,s),s.isZero()||s.normalize()}clipAgainstHull(e,t,n,s,r,a,o,l,c){const u=new G;let d=-1,h=-Number.MAX_VALUE;for(let p=0;p<n.faces.length;p++){u.copy(n.faceNormals[p]),r.vmult(u,u);const m=u.dot(a);m>h&&(h=m,d=p)}const f=[];for(let p=0;p<n.faces[d].length;p++){const m=n.vertices[n.faces[d][p]],_=new G;_.copy(m),r.vmult(_,_),s.vadd(_,_),f.push(_)}d>=0&&this.clipFaceAgainstHull(a,e,t,f,o,l,c)}findSeparatingAxis(e,t,n,s,r,a,o,l){const c=new G,u=new G,d=new G,h=new G,f=new G,p=new G;let m=Number.MAX_VALUE;const _=this;if(_.uniqueAxes)for(let v=0;v!==_.uniqueAxes.length;v++){n.vmult(_.uniqueAxes[v],c);const x=_.testSepAxis(c,e,t,n,s,r);if(x===!1)return!1;x<m&&(m=x,a.copy(c))}else{const v=o?o.length:_.faces.length;for(let x=0;x<v;x++){const y=o?o[x]:x;c.copy(_.faceNormals[y]),n.vmult(c,c);const g=_.testSepAxis(c,e,t,n,s,r);if(g===!1)return!1;g<m&&(m=g,a.copy(c))}}if(e.uniqueAxes)for(let v=0;v!==e.uniqueAxes.length;v++){r.vmult(e.uniqueAxes[v],u);const x=_.testSepAxis(u,e,t,n,s,r);if(x===!1)return!1;x<m&&(m=x,a.copy(u))}else{const v=l?l.length:e.faces.length;for(let x=0;x<v;x++){const y=l?l[x]:x;u.copy(e.faceNormals[y]),r.vmult(u,u);const g=_.testSepAxis(u,e,t,n,s,r);if(g===!1)return!1;g<m&&(m=g,a.copy(u))}}for(let v=0;v!==_.uniqueEdges.length;v++){n.vmult(_.uniqueEdges[v],h);for(let x=0;x!==e.uniqueEdges.length;x++)if(r.vmult(e.uniqueEdges[x],f),h.cross(f,p),!p.almostZero()){p.normalize();const y=_.testSepAxis(p,e,t,n,s,r);if(y===!1)return!1;y<m&&(m=y,a.copy(p))}}return s.vsub(t,d),d.dot(a)>0&&a.negate(a),!0}testSepAxis(e,t,n,s,r,a){const o=this;sc.project(o,e,n,s,gf),sc.project(t,e,r,a,yf);const l=gf[0],c=gf[1],u=yf[0],d=yf[1];if(l<d||u<c)return!1;const h=l-d,f=u-c;return h<f?h:f}calculateLocalInertia(e,t){const n=new G,s=new G;this.computeLocalAABB(s,n);const r=n.x-s.x,a=n.y-s.y,o=n.z-s.z;t.x=1/12*e*(2*a*2*a+2*o*2*o),t.y=1/12*e*(2*r*2*r+2*o*2*o),t.z=1/12*e*(2*a*2*a+2*r*2*r)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],s=this.vertices[t[0]];return-n.dot(s)}clipFaceAgainstHull(e,t,n,s,r,a,o){const l=new G,c=new G,u=new G,d=new G,h=new G,f=new G,p=new G,m=new G,_=this,v=[],x=s,y=v;let g=-1,w=Number.MAX_VALUE;for(let M=0;M<_.faces.length;M++){l.copy(_.faceNormals[M]),n.vmult(l,l);const A=l.dot(e);A<w&&(w=A,g=M)}if(g<0)return;const b=_.faces[g];b.connectedFaces=[];for(let M=0;M<_.faces.length;M++)for(let A=0;A<_.faces[M].length;A++)b.indexOf(_.faces[M][A])!==-1&&M!==g&&b.connectedFaces.indexOf(M)===-1&&b.connectedFaces.push(M);const T=b.length;for(let M=0;M<T;M++){const A=_.vertices[b[M]],C=_.vertices[b[(M+1)%T]];A.vsub(C,c),u.copy(c),n.vmult(u,u),t.vadd(u,u),d.copy(this.faceNormals[g]),n.vmult(d,d),t.vadd(d,d),u.cross(d,h),h.negate(h),f.copy(A),n.vmult(f,f),t.vadd(f,f);const I=b.connectedFaces[M];p.copy(this.faceNormals[I]);const H=this.getPlaneConstantOfFace(I);m.copy(p),n.vmult(m,m);const W=H-m.dot(t);for(this.clipFaceAgainstPlane(x,y,m,W);x.length;)x.shift();for(;y.length;)x.push(y.shift())}p.copy(this.faceNormals[g]);const E=this.getPlaneConstantOfFace(g);m.copy(p),n.vmult(m,m);const S=E-m.dot(t);for(let M=0;M<x.length;M++){let A=m.dot(x[M])+S;if(A<=r&&(console.log(`clamped: depth=${A} to minDist=${r}`),A=r),A<=a){const C=x[M];if(A<=1e-6){const I={point:C,normal:m,depth:A};o.push(I)}}}}clipFaceAgainstPlane(e,t,n,s){let r,a;const o=e.length;if(o<2)return t;let l=e[e.length-1],c=e[0];r=n.dot(l)+s;for(let u=0;u<o;u++){if(c=e[u],a=n.dot(c)+s,r<0)if(a<0){const d=new G;d.copy(c),t.push(d)}else{const d=new G;l.lerp(c,r/(r-a),d),t.push(d)}else if(a<0){const d=new G;l.lerp(c,r/(r-a),d),t.push(d),t.push(c)}l=c,r=a}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new G);const n=this.vertices,s=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(n[r],s[r]),e.vadd(s[r],s[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let s=0;s<this.vertices.length;s++){const r=n[s];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new G);const n=this.faceNormals,s=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(n[r],s[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const s=t[n].lengthSquared();s>e&&(e=s)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,s){const r=this.vertices;let a,o,l,c,u,d,h=new G;for(let f=0;f<r.length;f++){h.copy(r[f]),t.vmult(h,h),e.vadd(h,h);const p=h;(a===void 0||p.x<a)&&(a=p.x),(c===void 0||p.x>c)&&(c=p.x),(o===void 0||p.y<o)&&(o=p.y),(u===void 0||p.y>u)&&(u=p.y),(l===void 0||p.z<l)&&(l=p.z),(d===void 0||p.z>d)&&(d=p.z)}n.set(a,o,l),s.set(c,u,d)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new G);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,s=this.vertices;if(t){for(let r=0;r<n;r++){const a=s[r];t.vmult(a,a)}for(let r=0;r<this.faceNormals.length;r++){const a=this.faceNormals[r];t.vmult(a,a)}}if(e)for(let r=0;r<n;r++){const a=s[r];a.vadd(e,a)}}pointIsInside(e){const t=this.vertices,n=this.faces,s=this.faceNormals,r=new G;this.getAveragePointLocal(r);for(let a=0;a<this.faces.length;a++){let o=s[a];const l=t[n[a][0]],c=new G;e.vsub(l,c);const u=o.dot(c),d=new G;r.vsub(l,d);const h=o.dot(d);if(u<0&&h>0||u>0&&h<0)return!1}return-1}static project(e,t,n,s,r){const a=e.vertices.length,o=xU;let l=0,c=0;const u=bU,d=e.vertices;u.setZero(),rn.vectorToLocalFrame(n,s,t,o),rn.pointToLocalFrame(n,s,u,u);const h=u.dot(o);c=l=d[0].dot(o);for(let f=1;f<a;f++){const p=d[f].dot(o);p>l&&(l=p),p<c&&(c=p)}if(c-=h,l-=h,c>l){const f=c;c=l,l=f}r[0]=l,r[1]=c}}const gf=[],yf=[];new G;const xU=new G,bU=new G;class ah extends mt{constructor(e){super({type:mt.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,s=G,r=[new s(-e,-t,-n),new s(e,-t,-n),new s(e,t,-n),new s(-e,t,-n),new s(-e,-t,n),new s(e,-t,n),new s(e,t,n),new s(-e,t,n)],a=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],o=[new s(0,0,1),new s(0,1,0),new s(1,0,0)],l=new sc({vertices:r,faces:a,axes:o});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new G),ah.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const s=e;n.x=1/12*t*(2*s.y*2*s.y+2*s.z*2*s.z),n.y=1/12*t*(2*s.x*2*s.x+2*s.z*2*s.z),n.z=1/12*t*(2*s.y*2*s.y+2*s.x*2*s.x)}getSideNormals(e,t){const n=e,s=this.halfExtents;if(n[0].set(s.x,0,0),n[1].set(0,s.y,0),n[2].set(0,0,s.z),n[3].set(-s.x,0,0),n[4].set(0,-s.y,0),n[5].set(0,0,-s.z),t!==void 0)for(let r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const s=this.halfExtents,r=[[s.x,s.y,s.z],[-s.x,s.y,s.z],[-s.x,-s.y,s.z],[-s.x,-s.y,-s.z],[s.x,-s.y,-s.z],[s.x,s.y,-s.z],[-s.x,s.y,-s.z],[s.x,-s.y,s.z]];for(let a=0;a<r.length;a++)Hr.set(r[a][0],r[a][1],r[a][2]),t.vmult(Hr,Hr),e.vadd(Hr,Hr),n(Hr.x,Hr.y,Hr.z)}calculateWorldAABB(e,t,n,s){const r=this.halfExtents;Ns[0].set(r.x,r.y,r.z),Ns[1].set(-r.x,r.y,r.z),Ns[2].set(-r.x,-r.y,r.z),Ns[3].set(-r.x,-r.y,-r.z),Ns[4].set(r.x,-r.y,-r.z),Ns[5].set(r.x,r.y,-r.z),Ns[6].set(-r.x,r.y,-r.z),Ns[7].set(r.x,-r.y,r.z);const a=Ns[0];t.vmult(a,a),e.vadd(a,a),s.copy(a),n.copy(a);for(let o=1;o<8;o++){const l=Ns[o];t.vmult(l,l),e.vadd(l,l);const c=l.x,u=l.y,d=l.z;c>s.x&&(s.x=c),u>s.y&&(s.y=u),d>s.z&&(s.z=d),c<n.x&&(n.x=c),u<n.y&&(n.y=u),d<n.z&&(n.z=d)}}}const Hr=new G,Ns=[new G,new G,new G,new G,new G,new G,new G,new G],__={DYNAMIC:1,STATIC:2,KINEMATIC:4},v_={AWAKE:0,SLEEPY:1,SLEEPING:2};class _t extends Pw{constructor(e){e===void 0&&(e={}),super(),this.id=_t.idCounter++,this.index=-1,this.world=null,this.vlambda=new G,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new G,this.previousPosition=new G,this.interpolatedPosition=new G,this.initPosition=new G,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new G,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new G,this.force=new G;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?_t.STATIC:_t.DYNAMIC,typeof e.type==typeof _t.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep<"u"?e.allowSleep:!0,this.sleepState=_t.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit<"u"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit<"u"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new G,this.quaternion=new Gn,this.initQuaternion=new Gn,this.previousQuaternion=new Gn,this.interpolatedQuaternion=new Gn,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new G,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new G,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new G,this.invInertia=new G,this.invInertiaWorld=new Cs,this.invMassSolve=0,this.invInertiaSolve=new G,this.invInertiaWorldSolve=new Cs,this.fixedRotation=typeof e.fixedRotation<"u"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping<"u"?e.angularDamping:.01,this.linearFactor=new G(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new G(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new ts,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new G,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=_t.AWAKE,this.wakeUpAfterNarrowphase=!1,e===_t.SLEEPING&&this.dispatchEvent(_t.wakeupEvent)}sleep(){this.sleepState=_t.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),s=this.sleepSpeedLimit**2;t===_t.AWAKE&&n<s?(this.sleepState=_t.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(_t.sleepyEvent)):t===_t.SLEEPY&&n>s?this.wakeUp():t===_t.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(_t.sleepEvent))}}updateSolveMassProperties(){this.sleepState===_t.SLEEPING||this.type===_t.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new G),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new G),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new G),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new G),this.quaternion.vmult(e,t),t}addShape(e,t,n){const s=new G,r=new Gn;return t&&s.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(s),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let s=0;for(let r=0;r!==n;r++){const a=e[r];a.updateBoundingSphereRadius();const o=t[r].length(),l=a.boundingSphereRadius;o+l>s&&(s=o+l)}this.boundingRadius=s}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,s=e.length,r=wU,a=SU,o=this.quaternion,l=this.aabb,c=EU;for(let u=0;u!==s;u++){const d=e[u];o.vmult(t[u],r),r.vadd(this.position,r),o.mult(n[u],a),d.calculateWorldAABB(r,a,c.lowerBound,c.upperBound),u===0?l.copy(c):l.extend(c)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){const n=MU,s=TU;n.setRotationFromQuaternion(this.quaternion),n.transpose(s),n.scale(t,n),n.mmult(s,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new G),this.type!==_t.DYNAMIC)return;this.sleepState===_t.SLEEPING&&this.wakeUp();const n=AU;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new G),this.type!==_t.DYNAMIC)return;const n=CU,s=PU;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,s),this.applyForce(n,s)}applyTorque(e){this.type===_t.DYNAMIC&&(this.sleepState===_t.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new G),this.type!==_t.DYNAMIC)return;this.sleepState===_t.SLEEPING&&this.wakeUp();const n=t,s=RU;s.copy(e),s.scale(this.invMass,s),this.velocity.vadd(s,this.velocity);const r=LU;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new G),this.type!==_t.DYNAMIC)return;const n=IU,s=DU;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,s),this.applyImpulse(n,s)}updateMassProperties(){const e=kU;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),ah.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new G;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===_t.DYNAMIC||this.type===_t.KINEMATIC)||this.sleepState===_t.SLEEPING)return;const s=this.velocity,r=this.angularVelocity,a=this.position,o=this.force,l=this.torque,c=this.quaternion,u=this.invMass,d=this.invInertiaWorld,h=this.linearFactor,f=u*e;s.x+=o.x*f*h.x,s.y+=o.y*f*h.y,s.z+=o.z*f*h.z;const p=d.elements,m=this.angularFactor,_=l.x*m.x,v=l.y*m.y,x=l.z*m.z;r.x+=e*(p[0]*_+p[1]*v+p[2]*x),r.y+=e*(p[3]*_+p[4]*v+p[5]*x),r.z+=e*(p[6]*_+p[7]*v+p[8]*x),a.x+=s.x*e,a.y+=s.y*e,a.z+=s.z*e,c.integrate(this.angularVelocity,e,this.angularFactor,c),t&&(n?c.normalizeFast():c.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}_t.idCounter=0;_t.COLLIDE_EVENT_NAME="collide";_t.DYNAMIC=__.DYNAMIC;_t.STATIC=__.STATIC;_t.KINEMATIC=__.KINEMATIC;_t.AWAKE=v_.AWAKE;_t.SLEEPY=v_.SLEEPY;_t.SLEEPING=v_.SLEEPING;_t.wakeupEvent={type:"wakeup"};_t.sleepyEvent={type:"sleepy"};_t.sleepEvent={type:"sleep"};const wU=new G,SU=new Gn,EU=new ts,MU=new Cs,TU=new Cs;new Cs;const AU=new G,CU=new G,PU=new G,RU=new G,LU=new G,IU=new G,DU=new G,kU=new G;class BU{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!(!(e.collisionFilterGroup&t.collisionFilterMask)||!(t.collisionFilterGroup&e.collisionFilterMask)||(e.type&_t.STATIC||e.sleepState===_t.SLEEPING)&&(t.type&_t.STATIC||t.sleepState===_t.SLEEPING))}intersectionTest(e,t,n,s){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,s):this.doBoundingSphereBroadphase(e,t,n,s)}doBoundingSphereBroadphase(e,t,n,s){const r=OU;t.position.vsub(e.position,r);const a=(e.boundingRadius+t.boundingRadius)**2;r.lengthSquared()<a&&(n.push(e),s.push(t))}doBoundingBoxBroadphase(e,t,n,s){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),s.push(t))}makePairsUnique(e,t){const n=NU,s=FU,r=UU,a=e.length;for(let o=0;o!==a;o++)s[o]=e[o],r[o]=t[o];e.length=0,t.length=0;for(let o=0;o!==a;o++){const l=s[o].id,c=r[o].id,u=l<c?`${l},${c}`:`${c},${l}`;n[u]=o,n.keys.push(u)}for(let o=0;o!==n.keys.length;o++){const l=n.keys.pop(),c=n[l];e.push(s[c]),t.push(r[c]),delete n[l]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new G;e.position.vsub(t.position,n);const s=e.shapes[0],r=t.shapes[0];return Math.pow(s.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const OU=new G;new G;new Gn;new G;const NU={keys:[]},FU=[],UU=[];new G;new G;new G;class Rw extends BU{constructor(){super()}collisionPairs(e,t,n){const s=e.bodies,r=s.length;let a,o;for(let l=0;l!==r;l++)for(let c=0;c!==l;c++)a=s[l],o=s[c],this.needBroadphaseCollision(a,o)&&this.intersectionTest(a,o,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let s=0;s<e.bodies.length;s++){const r=e.bodies[s];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}}class Pd{constructor(){this.rayFromWorld=new G,this.rayToWorld=new G,this.hitNormalWorld=new G,this.hitPointWorld=new G,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,s,r,a,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(s),this.shape=r,this.body=a,this.distance=o}}let Lw,Iw,Dw,kw,Bw,Ow,Nw;const g_={CLOSEST:1,ANY:2,ALL:4};Lw=mt.types.SPHERE;Iw=mt.types.PLANE;Dw=mt.types.BOX;kw=mt.types.CYLINDER;Bw=mt.types.CONVEXPOLYHEDRON;Ow=mt.types.HEIGHTFIELD;Nw=mt.types.TRIMESH;class Un{get[Lw](){return this._intersectSphere}get[Iw](){return this._intersectPlane}get[Dw](){return this._intersectBox}get[kw](){return this._intersectConvex}get[Bw](){return this._intersectConvex}get[Ow](){return this._intersectHeightfield}get[Nw](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new G),t===void 0&&(t=new G),this.from=e.clone(),this.to=t.clone(),this.direction=new G,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Un.ANY,this.result=new Pd,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Un.ANY,this.result=t.result||new Pd,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Sy),xf.length=0,e.broadphase.aabbQuery(e,Sy,xf),this.intersectBodies(xf),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const s=zU,r=VU;for(let a=0,o=e.shapes.length;a<o;a++){const l=e.shapes[a];if(!(n&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],r),e.quaternion.vmult(e.shapeOffsets[a],s),s.vadd(e.position,s),this.intersectShape(l,r,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,s=e.length;!this.result.shouldStop&&n<s;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,s){const r=this.from;if(tz(r,this.direction,n)>e.boundingSphereRadius)return;const o=this[e.type];o&&o.call(this,e,t,n,s,e)}_intersectBox(e,t,n,s,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,s,r)}_intersectPlane(e,t,n,s,r){const a=this.from,o=this.to,l=this.direction,c=new G(0,0,1);t.vmult(c,c);const u=new G;a.vsub(n,u);const d=u.dot(c);o.vsub(n,u);const h=u.dot(c);if(d*h>0||a.distanceTo(o)<d)return;const f=c.dot(l);if(Math.abs(f)<this.precision)return;const p=new G,m=new G,_=new G;a.vsub(n,p);const v=-c.dot(p)/f;l.scale(v,m),a.vadd(m,_),this.reportIntersection(c,_,r,s,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,s=this.to,r=this.from;t.x=Math.min(s.x,r.x),t.y=Math.min(s.y,r.y),t.z=Math.min(s.z,r.z),n.x=Math.max(s.x,r.x),n.y=Math.max(s.y,r.y),n.z=Math.max(s.z,r.z)}_intersectHeightfield(e,t,n,s,r){e.data,e.elementSize;const a=GU;a.from.copy(this.from),a.to.copy(this.to),rn.pointToLocalFrame(n,t,a.from,a.from),rn.pointToLocalFrame(n,t,a.to,a.to),a.updateDirection();const o=HU;let l,c,u,d;l=c=0,u=d=e.data.length-1;const h=new ts;a.getAABB(h),e.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,o,!0),l=Math.max(l,o[0]),c=Math.max(c,o[1]),e.getIndexOfPosition(h.upperBound.x,h.upperBound.y,o,!0),u=Math.min(u,o[0]+1),d=Math.min(d,o[1]+1);for(let f=l;f<u;f++)for(let p=c;p<d;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(f,p,h),!!h.overlapsRay(a)){if(e.getConvexTrianglePillar(f,p,!1),rn.pointToWorldFrame(n,t,e.pillarOffset,Pu),this._intersectConvex(e.pillarConvex,t,Pu,s,r,Ey),this.result.shouldStop)return;e.getConvexTrianglePillar(f,p,!0),rn.pointToWorldFrame(n,t,e.pillarOffset,Pu),this._intersectConvex(e.pillarConvex,t,Pu,s,r,Ey)}}}_intersectSphere(e,t,n,s,r){const a=this.from,o=this.to,l=e.radius,c=(o.x-a.x)**2+(o.y-a.y)**2+(o.z-a.z)**2,u=2*((o.x-a.x)*(a.x-n.x)+(o.y-a.y)*(a.y-n.y)+(o.z-a.z)*(a.z-n.z)),d=(a.x-n.x)**2+(a.y-n.y)**2+(a.z-n.z)**2-l**2,h=u**2-4*c*d,f=WU,p=$U;if(!(h<0))if(h===0)a.lerp(o,h,f),f.vsub(n,p),p.normalize(),this.reportIntersection(p,f,r,s,-1);else{const m=(-u-Math.sqrt(h))/(2*c),_=(-u+Math.sqrt(h))/(2*c);if(m>=0&&m<=1&&(a.lerp(o,m,f),f.vsub(n,p),p.normalize(),this.reportIntersection(p,f,r,s,-1)),this.result.shouldStop)return;_>=0&&_<=1&&(a.lerp(o,_,f),f.vsub(n,p),p.normalize(),this.reportIntersection(p,f,r,s,-1))}}_intersectConvex(e,t,n,s,r,a){const o=XU,l=My,c=a&&a.faceList||null,u=e.faces,d=e.vertices,h=e.faceNormals,f=this.direction,p=this.from,m=this.to,_=p.distanceTo(m),v=c?c.length:u.length,x=this.result;for(let y=0;!x.shouldStop&&y<v;y++){const g=c?c[y]:y,w=u[g],b=h[g],T=t,E=n;l.copy(d[w[0]]),T.vmult(l,l),l.vadd(E,l),l.vsub(p,l),T.vmult(b,o);const S=f.dot(o);if(Math.abs(S)<this.precision)continue;const M=o.dot(l)/S;if(!(M<0)){f.scale(M,Pi),Pi.vadd(p,Pi),ys.copy(d[w[0]]),T.vmult(ys,ys),E.vadd(ys,ys);for(let A=1;!x.shouldStop&&A<w.length-1;A++){Fs.copy(d[w[A]]),Us.copy(d[w[A+1]]),T.vmult(Fs,Fs),T.vmult(Us,Us),E.vadd(Fs,Fs),E.vadd(Us,Us);const C=Pi.distanceTo(p);!(Un.pointInTriangle(Pi,ys,Fs,Us)||Un.pointInTriangle(Pi,Fs,ys,Us))||C>_||this.reportIntersection(o,Pi,r,s,g)}}}}_intersectTrimesh(e,t,n,s,r,a){const o=qU,l=QU,c=ez,u=My,d=YU,h=jU,f=KU,p=JU,m=ZU,_=e.indices;e.vertices;const v=this.from,x=this.to,y=this.direction;c.position.copy(n),c.quaternion.copy(t),rn.vectorToLocalFrame(n,t,y,d),rn.pointToLocalFrame(n,t,v,h),rn.pointToLocalFrame(n,t,x,f),f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,f.vsub(h,d),d.normalize();const g=h.distanceSquared(f);e.tree.rayQuery(this,c,l);for(let w=0,b=l.length;!this.result.shouldStop&&w!==b;w++){const T=l[w];e.getNormal(T,o),e.getVertex(_[T*3],ys),ys.vsub(h,u);const E=d.dot(o),S=o.dot(u)/E;if(S<0)continue;d.scale(S,Pi),Pi.vadd(h,Pi),e.getVertex(_[T*3+1],Fs),e.getVertex(_[T*3+2],Us);const M=Pi.distanceSquared(h);!(Un.pointInTriangle(Pi,Fs,ys,Us)||Un.pointInTriangle(Pi,ys,Fs,Us))||M>g||(rn.vectorToWorldFrame(t,o,m),rn.pointToWorldFrame(n,t,Pi,p),this.reportIntersection(m,p,r,s,T))}l.length=0}reportIntersection(e,t,n,s,r){const a=this.from,o=this.to,l=a.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Un.ALL:this.hasHit=!0,c.set(a,o,e,t,n,s,l),c.hasHit=!0,this.callback(c);break;case Un.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(a,o,e,t,n,s,l));break;case Un.ANY:this.hasHit=!0,c.hasHit=!0,c.set(a,o,e,t,n,s,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,n,s){s.vsub(t,$a),n.vsub(t,Nl),e.vsub(t,bf);const r=$a.dot($a),a=$a.dot(Nl),o=$a.dot(bf),l=Nl.dot(Nl),c=Nl.dot(bf);let u,d;return(u=l*o-a*c)>=0&&(d=r*c-a*o)>=0&&u+d<r*l-a*a}}Un.CLOSEST=g_.CLOSEST;Un.ANY=g_.ANY;Un.ALL=g_.ALL;const Sy=new ts,xf=[],Nl=new G,bf=new G,zU=new G,VU=new Gn,Pi=new G,ys=new G,Fs=new G,Us=new G;new G;new Pd;const Ey={faceList:[0]},Pu=new G,GU=new Un,HU=[],WU=new G,$U=new G,XU=new G;new G;new G;const My=new G,qU=new G,YU=new G,jU=new G,KU=new G,ZU=new G,JU=new G;new ts;const QU=[],ez=new rn,$a=new G,Ru=new G;function tz(i,e,t){t.vsub(i,$a);const n=$a.dot(e);return e.scale(n,Ru),Ru.vadd(i,Ru),t.distanceTo(Ru)}class nz{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class Ty{constructor(){this.spatial=new G,this.rotational=new G}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Xc{constructor(e,t,n,s){n===void 0&&(n=-1e6),s===void 0&&(s=1e6),this.id=Xc.idCounter++,this.minForce=n,this.maxForce=s,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Ty,this.jacobianElementB=new Ty,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const s=t,r=e,a=n;this.a=4/(a*(1+4*s)),this.b=4*s/(1+4*s),this.eps=4/(a*a*r*(1+4*s))}computeB(e,t,n){const s=this.computeGW(),r=this.computeGq(),a=this.computeGiMf();return-r*e-s*t-a*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,r=n.position,a=s.position;return e.spatial.dot(r)+t.spatial.dot(a)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,r=n.velocity,a=s.velocity,o=n.angularVelocity,l=s.angularVelocity;return e.multiplyVectors(r,o)+t.multiplyVectors(a,l)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,r=n.vlambda,a=s.vlambda,o=n.wlambda,l=s.wlambda;return e.multiplyVectors(r,o)+t.multiplyVectors(a,l)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,r=n.force,a=n.torque,o=s.force,l=s.torque,c=n.invMassSolve,u=s.invMassSolve;return r.scale(c,Ay),o.scale(u,Cy),n.invInertiaWorldSolve.vmult(a,Py),s.invInertiaWorldSolve.vmult(l,Ry),e.multiplyVectors(Ay,Py)+t.multiplyVectors(Cy,Ry)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,s=this.bj,r=n.invMassSolve,a=s.invMassSolve,o=n.invInertiaWorldSolve,l=s.invInertiaWorldSolve;let c=r+a;return o.vmult(e.rotational,Lu),c+=Lu.dot(e.rotational),l.vmult(t.rotational,Lu),c+=Lu.dot(t.rotational),c}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,s=this.bi,r=this.bj,a=iz;s.vlambda.addScaledVector(s.invMassSolve*e,t.spatial,s.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,n.spatial,r.vlambda),s.invInertiaWorldSolve.vmult(t.rotational,a),s.wlambda.addScaledVector(e,a,s.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,a),r.wlambda.addScaledVector(e,a,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Xc.idCounter=0;const Ay=new G,Cy=new G,Py=new G,Ry=new G,Lu=new G,iz=new G;class sz extends Xc{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new G,this.rj=new G,this.ni=new G}computeB(e){const t=this.a,n=this.b,s=this.bi,r=this.bj,a=this.ri,o=this.rj,l=rz,c=az,u=s.velocity,d=s.angularVelocity;s.force,s.torque;const h=r.velocity,f=r.angularVelocity;r.force,r.torque;const p=oz,m=this.jacobianElementA,_=this.jacobianElementB,v=this.ni;a.cross(v,l),o.cross(v,c),v.negate(m.spatial),l.negate(m.rotational),_.spatial.copy(v),_.rotational.copy(c),p.copy(r.position),p.vadd(o,p),p.vsub(s.position,p),p.vsub(a,p);const x=v.dot(p),y=this.restitution+1,g=y*h.dot(v)-y*u.dot(v)+f.dot(c)-d.dot(l),w=this.computeGiMf();return-x*t-g*n-e*w}getImpactVelocityAlongNormal(){const e=lz,t=cz,n=uz,s=dz,r=hz;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,s),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(s,t),e.vsub(t,r),this.ni.dot(r)}}const rz=new G,az=new G,oz=new G,lz=new G,cz=new G,uz=new G,dz=new G,hz=new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;class Ly extends Xc{constructor(e,t,n){super(e,t,-n,n),this.ri=new G,this.rj=new G,this.t=new G}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,s=this.rj,r=fz,a=pz,o=this.t;n.cross(o,r),s.cross(o,a);const l=this.jacobianElementA,c=this.jacobianElementB;o.negate(l.spatial),r.negate(l.rotational),c.spatial.copy(o),c.rotational.copy(a);const u=this.computeGW(),d=this.computeGiMf();return-u*t-e*d}}const fz=new G,pz=new G;class oh{constructor(e,t,n){n=nz.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=oh.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}oh.idCounter=0;class vl{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=vl.idCounter++,this.friction=typeof e.friction<"u"?e.friction:-1,this.restitution=typeof e.restitution<"u"?e.restitution:-1}}vl.idCounter=0;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new Un;new G;new G;new G;new G(1,0,0),new G(0,1,0),new G(0,0,1);new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;class mz extends mt{constructor(){super({type:mt.types.PLANE}),this.worldNormal=new G,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new G),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,s){ur.set(0,0,1),t.vmult(ur,ur);const r=Number.MAX_VALUE;n.set(-r,-r,-r),s.set(r,r,r),ur.x===1?s.x=e.x:ur.x===-1&&(n.x=e.x),ur.y===1?s.y=e.y:ur.y===-1&&(n.y=e.y),ur.z===1?s.z=e.z:ur.z===-1&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const ur=new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new G;new ts;new G;new ts;new G;new G;new G;new G;new G;new G;new G;new ts;new G;new rn;new ts;class _z{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class vz extends _z{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const s=this.iterations,r=this.tolerance*this.tolerance,a=this.equations,o=a.length,l=t.bodies,c=l.length,u=e;let d,h,f,p,m,_;if(o!==0)for(let g=0;g!==c;g++)l[g].updateSolveMassProperties();const v=yz,x=xz,y=gz;v.length=o,x.length=o,y.length=o;for(let g=0;g!==o;g++){const w=a[g];y[g]=0,x[g]=w.computeB(u),v[g]=1/w.computeC()}if(o!==0){for(let b=0;b!==c;b++){const T=l[b],E=T.vlambda,S=T.wlambda;E.set(0,0,0),S.set(0,0,0)}for(n=0;n!==s;n++){p=0;for(let b=0;b!==o;b++){const T=a[b];d=x[b],h=v[b],_=y[b],m=T.computeGWlambda(),f=h*(d-m-T.eps*_),_+f<T.minForce?f=T.minForce-_:_+f>T.maxForce&&(f=T.maxForce-_),y[b]+=f,p+=f>0?f:-f,T.addToWlambda(f)}if(p*p<r)break}for(let b=0;b!==c;b++){const T=l[b],E=T.velocity,S=T.angularVelocity;T.vlambda.vmul(T.linearFactor,T.vlambda),E.vadd(T.vlambda,E),T.wlambda.vmul(T.angularFactor,T.wlambda),S.vadd(T.wlambda,S)}let g=a.length;const w=1/u;for(;g--;)a[g].multiplier=y[g]*w}return n}}const gz=[],yz=[],xz=[];class bz{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class wz extends bz{constructor(){super(...arguments),this.type=G}constructObject(){return new G}}const gn={sphereSphere:mt.types.SPHERE,spherePlane:mt.types.SPHERE|mt.types.PLANE,boxBox:mt.types.BOX|mt.types.BOX,sphereBox:mt.types.SPHERE|mt.types.BOX,planeBox:mt.types.PLANE|mt.types.BOX,convexConvex:mt.types.CONVEXPOLYHEDRON,sphereConvex:mt.types.SPHERE|mt.types.CONVEXPOLYHEDRON,planeConvex:mt.types.PLANE|mt.types.CONVEXPOLYHEDRON,boxConvex:mt.types.BOX|mt.types.CONVEXPOLYHEDRON,sphereHeightfield:mt.types.SPHERE|mt.types.HEIGHTFIELD,boxHeightfield:mt.types.BOX|mt.types.HEIGHTFIELD,convexHeightfield:mt.types.CONVEXPOLYHEDRON|mt.types.HEIGHTFIELD,sphereParticle:mt.types.PARTICLE|mt.types.SPHERE,planeParticle:mt.types.PLANE|mt.types.PARTICLE,boxParticle:mt.types.BOX|mt.types.PARTICLE,convexParticle:mt.types.PARTICLE|mt.types.CONVEXPOLYHEDRON,cylinderCylinder:mt.types.CYLINDER,sphereCylinder:mt.types.SPHERE|mt.types.CYLINDER,planeCylinder:mt.types.PLANE|mt.types.CYLINDER,boxCylinder:mt.types.BOX|mt.types.CYLINDER,convexCylinder:mt.types.CONVEXPOLYHEDRON|mt.types.CYLINDER,heightfieldCylinder:mt.types.HEIGHTFIELD|mt.types.CYLINDER,particleCylinder:mt.types.PARTICLE|mt.types.CYLINDER,sphereTrimesh:mt.types.SPHERE|mt.types.TRIMESH,planeTrimesh:mt.types.PLANE|mt.types.TRIMESH};class Sz{get[gn.sphereSphere](){return this.sphereSphere}get[gn.spherePlane](){return this.spherePlane}get[gn.boxBox](){return this.boxBox}get[gn.sphereBox](){return this.sphereBox}get[gn.planeBox](){return this.planeBox}get[gn.convexConvex](){return this.convexConvex}get[gn.sphereConvex](){return this.sphereConvex}get[gn.planeConvex](){return this.planeConvex}get[gn.boxConvex](){return this.boxConvex}get[gn.sphereHeightfield](){return this.sphereHeightfield}get[gn.boxHeightfield](){return this.boxHeightfield}get[gn.convexHeightfield](){return this.convexHeightfield}get[gn.sphereParticle](){return this.sphereParticle}get[gn.planeParticle](){return this.planeParticle}get[gn.boxParticle](){return this.boxParticle}get[gn.convexParticle](){return this.convexParticle}get[gn.cylinderCylinder](){return this.convexConvex}get[gn.sphereCylinder](){return this.sphereConvex}get[gn.planeCylinder](){return this.planeConvex}get[gn.boxCylinder](){return this.boxConvex}get[gn.convexCylinder](){return this.convexConvex}get[gn.heightfieldCylinder](){return this.heightfieldCylinder}get[gn.particleCylinder](){return this.particleCylinder}get[gn.sphereTrimesh](){return this.sphereTrimesh}get[gn.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new wz,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,s,r,a){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=e,o.bj=t):o=new sz(e,t),o.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&s.collisionResponse;const l=this.currentContactMaterial;o.restitution=l.restitution,o.setSpookParams(l.contactEquationStiffness,l.contactEquationRelaxation,this.world.dt);const c=n.material||e.material,u=s.material||t.material;return c&&u&&c.restitution>=0&&u.restitution>=0&&(o.restitution=c.restitution*u.restitution),o.si=r||n,o.sj=a||s,o}createFrictionEquationsFromContact(e,t){const n=e.bi,s=e.bj,r=e.si,a=e.sj,o=this.world,l=this.currentContactMaterial;let c=l.friction;const u=r.material||n.material,d=a.material||s.material;if(u&&d&&u.friction>=0&&d.friction>=0&&(c=u.friction*d.friction),c>0){const h=c*(o.frictionGravity||o.gravity).length();let f=n.invMass+s.invMass;f>0&&(f=1/f);const p=this.frictionEquationPool,m=p.length?p.pop():new Ly(n,s,h*f),_=p.length?p.pop():new Ly(n,s,h*f);return m.bi=_.bi=n,m.bj=_.bj=s,m.minForce=_.minForce=-h*f,m.maxForce=_.maxForce=h*f,m.ri.copy(e.ri),m.rj.copy(e.rj),_.ri.copy(e.ri),_.rj.copy(e.rj),e.ni.tangents(m.t,_.t),m.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,o.dt),_.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,o.dt),m.enabled=_.enabled=e.enabled,t.push(m,_),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],s=this.frictionResult[this.frictionResult.length-1];Na.setZero(),Do.setZero(),ko.setZero();const r=t.bi;t.bj;for(let o=0;o!==e;o++)t=this.result[this.result.length-1-o],t.bi!==r?(Na.vadd(t.ni,Na),Do.vadd(t.ri,Do),ko.vadd(t.rj,ko)):(Na.vsub(t.ni,Na),Do.vadd(t.rj,Do),ko.vadd(t.ri,ko));const a=1/e;Do.scale(a,n.ri),ko.scale(a,n.rj),s.ri.copy(n.ri),s.rj.copy(n.rj),Na.normalize(),Na.tangents(n.t,s.t)}getContacts(e,t,n,s,r,a,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=s,this.frictionResult=a;const l=Tz,c=Az,u=Ez,d=Mz;for(let h=0,f=e.length;h!==f;h++){const p=e[h],m=t[h];let _=null;p.material&&m.material&&(_=n.getContactMaterial(p.material,m.material)||null);const v=p.type&_t.KINEMATIC&&m.type&_t.STATIC||p.type&_t.STATIC&&m.type&_t.KINEMATIC||p.type&_t.KINEMATIC&&m.type&_t.KINEMATIC;for(let x=0;x<p.shapes.length;x++){p.quaternion.mult(p.shapeOrientations[x],l),p.quaternion.vmult(p.shapeOffsets[x],u),u.vadd(p.position,u);const y=p.shapes[x];for(let g=0;g<m.shapes.length;g++){m.quaternion.mult(m.shapeOrientations[g],c),m.quaternion.vmult(m.shapeOffsets[g],d),d.vadd(m.position,d);const w=m.shapes[g];if(!(y.collisionFilterMask&w.collisionFilterGroup&&w.collisionFilterMask&y.collisionFilterGroup)||u.distanceTo(d)>y.boundingSphereRadius+w.boundingSphereRadius)continue;let b=null;y.material&&w.material&&(b=n.getContactMaterial(y.material,w.material)||null),this.currentContactMaterial=b||_||n.defaultContactMaterial;const T=y.type|w.type,E=this[T];if(E){let S=!1;y.type<w.type?S=E.call(this,y,w,u,d,l,c,p,m,y,w,v):S=E.call(this,w,y,d,u,c,l,m,p,y,w,v),S&&v&&(n.shapeOverlapKeeper.set(y.id,w.id),n.bodyOverlapKeeper.set(p.id,m.id))}}}}}sphereSphere(e,t,n,s,r,a,o,l,c,u,d){if(d)return n.distanceSquared(s)<(e.radius+t.radius)**2;const h=this.createContactEquation(o,l,e,t,c,u);s.vsub(n,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.scale(e.radius,h.ri),h.rj.scale(-t.radius,h.rj),h.ri.vadd(n,h.ri),h.ri.vsub(o.position,h.ri),h.rj.vadd(s,h.rj),h.rj.vsub(l.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}spherePlane(e,t,n,s,r,a,o,l,c,u,d){const h=this.createContactEquation(o,l,e,t,c,u);if(h.ni.set(0,0,1),a.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.scale(e.radius,h.ri),n.vsub(s,Iu),h.ni.scale(h.ni.dot(Iu),Iy),Iu.vsub(Iy,h.rj),-Iu.dot(h.ni)<=e.radius){if(d)return!0;const f=h.ri,p=h.rj;f.vadd(n,f),f.vsub(o.position,f),p.vadd(s,p),p.vsub(l.position,p),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}}boxBox(e,t,n,s,r,a,o,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,s,r,a,o,l,e,t,d)}sphereBox(e,t,n,s,r,a,o,l,c,u,d){const h=this.v3pool,f=Qz;n.vsub(s,Du),t.getSideNormals(f,a);const p=e.radius;let m=!1;const _=tV,v=nV,x=iV;let y=null,g=0,w=0,b=0,T=null;for(let z=0,q=f.length;z!==q&&m===!1;z++){const O=Kz;O.copy(f[z]);const re=O.length();O.normalize();const le=Du.dot(O);if(le<re+p&&le>0){const Z=Zz,ne=Jz;Z.copy(f[(z+1)%3]),ne.copy(f[(z+2)%3]);const j=Z.length(),ee=ne.length();Z.normalize(),ne.normalize();const F=Du.dot(Z),X=Du.dot(ne);if(F<j&&F>-j&&X<ee&&X>-ee){const Q=Math.abs(le-re-p);if((T===null||Q<T)&&(T=Q,w=F,b=X,y=re,_.copy(O),v.copy(Z),x.copy(ne),g++,d))return!0}}}if(g){m=!0;const z=this.createContactEquation(o,l,e,t,c,u);_.scale(-p,z.ri),z.ni.copy(_),z.ni.negate(z.ni),_.scale(y,_),v.scale(w,v),_.vadd(v,_),x.scale(b,x),_.vadd(x,z.rj),z.ri.vadd(n,z.ri),z.ri.vsub(o.position,z.ri),z.rj.vadd(s,z.rj),z.rj.vsub(l.position,z.rj),this.result.push(z),this.createFrictionEquationsFromContact(z,this.frictionResult)}let E=h.get();const S=eV;for(let z=0;z!==2&&!m;z++)for(let q=0;q!==2&&!m;q++)for(let O=0;O!==2&&!m;O++)if(E.set(0,0,0),z?E.vadd(f[0],E):E.vsub(f[0],E),q?E.vadd(f[1],E):E.vsub(f[1],E),O?E.vadd(f[2],E):E.vsub(f[2],E),s.vadd(E,S),S.vsub(n,S),S.lengthSquared()<p*p){if(d)return!0;m=!0;const re=this.createContactEquation(o,l,e,t,c,u);re.ri.copy(S),re.ri.normalize(),re.ni.copy(re.ri),re.ri.scale(p,re.ri),re.rj.copy(E),re.ri.vadd(n,re.ri),re.ri.vsub(o.position,re.ri),re.rj.vadd(s,re.rj),re.rj.vsub(l.position,re.rj),this.result.push(re),this.createFrictionEquationsFromContact(re,this.frictionResult)}h.release(E),E=null;const M=h.get(),A=h.get(),C=h.get(),I=h.get(),H=h.get(),W=f.length;for(let z=0;z!==W&&!m;z++)for(let q=0;q!==W&&!m;q++)if(z%3!==q%3){f[q].cross(f[z],M),M.normalize(),f[z].vadd(f[q],A),C.copy(n),C.vsub(A,C),C.vsub(s,C);const O=C.dot(M);M.scale(O,I);let re=0;for(;re===z%3||re===q%3;)re++;H.copy(n),H.vsub(I,H),H.vsub(A,H),H.vsub(s,H);const le=Math.abs(O),Z=H.length();if(le<f[re].length()&&Z<p){if(d)return!0;m=!0;const ne=this.createContactEquation(o,l,e,t,c,u);A.vadd(I,ne.rj),ne.rj.copy(ne.rj),H.negate(ne.ni),ne.ni.normalize(),ne.ri.copy(ne.rj),ne.ri.vadd(s,ne.ri),ne.ri.vsub(n,ne.ri),ne.ri.normalize(),ne.ri.scale(p,ne.ri),ne.ri.vadd(n,ne.ri),ne.ri.vsub(o.position,ne.ri),ne.rj.vadd(s,ne.rj),ne.rj.vsub(l.position,ne.rj),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult)}}h.release(M,A,C,I,H)}planeBox(e,t,n,s,r,a,o,l,c,u,d){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,s,r,a,o,l,e,t,d)}convexConvex(e,t,n,s,r,a,o,l,c,u,d,h,f){const p=gV;if(!(n.distanceTo(s)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,s,a,p,h,f)){const m=[],_=yV;e.clipAgainstHull(n,r,t,s,a,p,-100,100,m);let v=0;for(let x=0;x!==m.length;x++){if(d)return!0;const y=this.createContactEquation(o,l,e,t,c,u),g=y.ri,w=y.rj;p.negate(y.ni),m[x].normal.negate(_),_.scale(m[x].depth,_),m[x].point.vadd(_,g),w.copy(m[x].point),g.vsub(n,g),w.vsub(s,w),g.vadd(n,g),g.vsub(o.position,g),w.vadd(s,w),w.vsub(l.position,w),this.result.push(y),v++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(y,this.frictionResult)}this.enableFrictionReduction&&v&&this.createFrictionFromAverage(v)}}sphereConvex(e,t,n,s,r,a,o,l,c,u,d){const h=this.v3pool;n.vsub(s,sV);const f=t.faceNormals,p=t.faces,m=t.vertices,_=e.radius;let v=!1;for(let x=0;x!==m.length;x++){const y=m[x],g=lV;a.vmult(y,g),s.vadd(g,g);const w=oV;if(g.vsub(n,w),w.lengthSquared()<_*_){if(d)return!0;v=!0;const b=this.createContactEquation(o,l,e,t,c,u);b.ri.copy(w),b.ri.normalize(),b.ni.copy(b.ri),b.ri.scale(_,b.ri),g.vsub(s,b.rj),b.ri.vadd(n,b.ri),b.ri.vsub(o.position,b.ri),b.rj.vadd(s,b.rj),b.rj.vsub(l.position,b.rj),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult);return}}for(let x=0,y=p.length;x!==y&&v===!1;x++){const g=f[x],w=p[x],b=cV;a.vmult(g,b);const T=uV;a.vmult(m[w[0]],T),T.vadd(s,T);const E=dV;b.scale(-_,E),n.vadd(E,E);const S=hV;E.vsub(T,S);const M=S.dot(b),A=fV;if(n.vsub(T,A),M<0&&A.dot(b)>0){const C=[];for(let I=0,H=w.length;I!==H;I++){const W=h.get();a.vmult(m[w[I]],W),s.vadd(W,W),C.push(W)}if(jz(C,b,n)){if(d)return!0;v=!0;const I=this.createContactEquation(o,l,e,t,c,u);b.scale(-_,I.ri),b.negate(I.ni);const H=h.get();b.scale(-M,H);const W=h.get();b.scale(-_,W),n.vsub(s,I.rj),I.rj.vadd(W,I.rj),I.rj.vadd(H,I.rj),I.rj.vadd(s,I.rj),I.rj.vsub(l.position,I.rj),I.ri.vadd(n,I.ri),I.ri.vsub(o.position,I.ri),h.release(H),h.release(W),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult);for(let z=0,q=C.length;z!==q;z++)h.release(C[z]);return}else for(let I=0;I!==w.length;I++){const H=h.get(),W=h.get();a.vmult(m[w[(I+1)%w.length]],H),a.vmult(m[w[(I+2)%w.length]],W),s.vadd(H,H),s.vadd(W,W);const z=rV;W.vsub(H,z);const q=aV;z.unit(q);const O=h.get(),re=h.get();n.vsub(H,re);const le=re.dot(q);q.scale(le,O),O.vadd(H,O);const Z=h.get();if(O.vsub(n,Z),le>0&&le*le<z.lengthSquared()&&Z.lengthSquared()<_*_){if(d)return!0;const ne=this.createContactEquation(o,l,e,t,c,u);O.vsub(s,ne.rj),O.vsub(n,ne.ni),ne.ni.normalize(),ne.ni.scale(_,ne.ri),ne.rj.vadd(s,ne.rj),ne.rj.vsub(l.position,ne.rj),ne.ri.vadd(n,ne.ri),ne.ri.vsub(o.position,ne.ri),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult);for(let j=0,ee=C.length;j!==ee;j++)h.release(C[j]);h.release(H),h.release(W),h.release(O),h.release(Z),h.release(re);return}h.release(H),h.release(W),h.release(O),h.release(Z),h.release(re)}for(let I=0,H=C.length;I!==H;I++)h.release(C[I])}}}planeConvex(e,t,n,s,r,a,o,l,c,u,d){const h=pV,f=mV;f.set(0,0,1),r.vmult(f,f);let p=0;const m=_V;for(let _=0;_!==t.vertices.length;_++)if(h.copy(t.vertices[_]),a.vmult(h,h),s.vadd(h,h),h.vsub(n,m),f.dot(m)<=0){if(d)return!0;const x=this.createContactEquation(o,l,e,t,c,u),y=vV;f.scale(f.dot(m),y),h.vsub(y,y),y.vsub(n,x.ri),x.ni.copy(f),h.vsub(s,x.rj),x.ri.vadd(n,x.ri),x.ri.vsub(o.position,x.ri),x.rj.vadd(s,x.rj),x.rj.vsub(l.position,x.rj),this.result.push(x),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(x,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(e,t,n,s,r,a,o,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,s,r,a,o,l,e,t,d)}sphereHeightfield(e,t,n,s,r,a,o,l,c,u,d){const h=t.data,f=e.radius,p=t.elementSize,m=LV,_=RV;rn.pointToLocalFrame(s,a,n,_);let v=Math.floor((_.x-f)/p)-1,x=Math.ceil((_.x+f)/p)+1,y=Math.floor((_.y-f)/p)-1,g=Math.ceil((_.y+f)/p)+1;if(x<0||g<0||v>h.length||y>h[0].length)return;v<0&&(v=0),x<0&&(x=0),y<0&&(y=0),g<0&&(g=0),v>=h.length&&(v=h.length-1),x>=h.length&&(x=h.length-1),g>=h[0].length&&(g=h[0].length-1),y>=h[0].length&&(y=h[0].length-1);const w=[];t.getRectMinMax(v,y,x,g,w);const b=w[0],T=w[1];if(_.z-f>T||_.z+f<b)return;const E=this.result;for(let S=v;S<x;S++)for(let M=y;M<g;M++){const A=E.length;let C=!1;if(t.getConvexTrianglePillar(S,M,!1),rn.pointToWorldFrame(s,a,t.pillarOffset,m),n.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(C=this.sphereConvex(e,t.pillarConvex,n,m,r,a,o,l,e,t,d)),d&&C||(t.getConvexTrianglePillar(S,M,!0),rn.pointToWorldFrame(s,a,t.pillarOffset,m),n.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(C=this.sphereConvex(e,t.pillarConvex,n,m,r,a,o,l,e,t,d)),d&&C))return!0;if(E.length-A>2)return}}boxHeightfield(e,t,n,s,r,a,o,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,s,r,a,o,l,e,t,d)}convexHeightfield(e,t,n,s,r,a,o,l,c,u,d){const h=t.data,f=t.elementSize,p=e.boundingSphereRadius,m=CV,_=PV,v=AV;rn.pointToLocalFrame(s,a,n,v);let x=Math.floor((v.x-p)/f)-1,y=Math.ceil((v.x+p)/f)+1,g=Math.floor((v.y-p)/f)-1,w=Math.ceil((v.y+p)/f)+1;if(y<0||w<0||x>h.length||g>h[0].length)return;x<0&&(x=0),y<0&&(y=0),g<0&&(g=0),w<0&&(w=0),x>=h.length&&(x=h.length-1),y>=h.length&&(y=h.length-1),w>=h[0].length&&(w=h[0].length-1),g>=h[0].length&&(g=h[0].length-1);const b=[];t.getRectMinMax(x,g,y,w,b);const T=b[0],E=b[1];if(!(v.z-p>E||v.z+p<T))for(let S=x;S<y;S++)for(let M=g;M<w;M++){let A=!1;if(t.getConvexTrianglePillar(S,M,!1),rn.pointToWorldFrame(s,a,t.pillarOffset,m),n.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(A=this.convexConvex(e,t.pillarConvex,n,m,r,a,o,l,null,null,d,_,null)),d&&A||(t.getConvexTrianglePillar(S,M,!0),rn.pointToWorldFrame(s,a,t.pillarOffset,m),n.distanceTo(m)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(A=this.convexConvex(e,t.pillarConvex,n,m,r,a,o,l,null,null,d,_,null)),d&&A))return!0}}sphereParticle(e,t,n,s,r,a,o,l,c,u,d){const h=SV;if(h.set(0,0,1),s.vsub(n,h),h.lengthSquared()<=e.radius*e.radius){if(d)return!0;const p=this.createContactEquation(l,o,t,e,c,u);h.normalize(),p.rj.copy(h),p.rj.scale(e.radius,p.rj),p.ni.copy(h),p.ni.negate(p.ni),p.ri.set(0,0,0),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}planeParticle(e,t,n,s,r,a,o,l,c,u,d){const h=xV;h.set(0,0,1),o.quaternion.vmult(h,h);const f=bV;if(s.vsub(o.position,f),h.dot(f)<=0){if(d)return!0;const m=this.createContactEquation(l,o,t,e,c,u);m.ni.copy(h),m.ni.negate(m.ni),m.ri.set(0,0,0);const _=wV;h.scale(h.dot(s),_),s.vsub(_,_),m.rj.copy(_),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}boxParticle(e,t,n,s,r,a,o,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,s,r,a,o,l,e,t,d)}convexParticle(e,t,n,s,r,a,o,l,c,u,d){let h=-1;const f=MV,p=TV;let m=null;const _=EV;if(_.copy(s),_.vsub(n,_),r.conjugate(Dy),Dy.vmult(_,_),e.pointIsInside(_)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let v=0,x=e.faces.length;v!==x;v++){const y=[e.worldVertices[e.faces[v][0]]],g=e.worldFaceNormals[v];s.vsub(y[0],ky);const w=-g.dot(ky);if(m===null||Math.abs(w)<Math.abs(m)){if(d)return!0;m=w,h=v,f.copy(g)}}if(h!==-1){const v=this.createContactEquation(l,o,t,e,c,u);f.scale(m,p),p.vadd(s,p),p.vsub(n,p),v.rj.copy(p),f.negate(v.ni),v.ri.set(0,0,0);const x=v.ri,y=v.rj;x.vadd(s,x),x.vsub(l.position,x),y.vadd(n,y),y.vsub(o.position,y),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,s,r,a,o,l,c,u,d){return this.convexHeightfield(t,e,s,n,a,r,l,o,c,u,d)}particleCylinder(e,t,n,s,r,a,o,l,c,u,d){return this.convexParticle(t,e,s,n,a,r,l,o,c,u,d)}sphereTrimesh(e,t,n,s,r,a,o,l,c,u,d){const h=Bz,f=Oz,p=Nz,m=Fz,_=Uz,v=zz,x=Wz,y=kz,g=Iz,w=$z;rn.pointToLocalFrame(s,a,n,_);const b=e.radius;x.lowerBound.set(_.x-b,_.y-b,_.z-b),x.upperBound.set(_.x+b,_.y+b,_.z+b),t.getTrianglesInAABB(x,w);const T=Dz,E=e.radius*e.radius;for(let I=0;I<w.length;I++)for(let H=0;H<3;H++)if(t.getVertex(t.indices[w[I]*3+H],T),T.vsub(_,g),g.lengthSquared()<=E){if(y.copy(T),rn.pointToWorldFrame(s,a,y,T),T.vsub(n,g),d)return!0;let W=this.createContactEquation(o,l,e,t,c,u);W.ni.copy(g),W.ni.normalize(),W.ri.copy(W.ni),W.ri.scale(e.radius,W.ri),W.ri.vadd(n,W.ri),W.ri.vsub(o.position,W.ri),W.rj.copy(T),W.rj.vsub(l.position,W.rj),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}for(let I=0;I<w.length;I++)for(let H=0;H<3;H++){t.getVertex(t.indices[w[I]*3+H],h),t.getVertex(t.indices[w[I]*3+(H+1)%3],f),f.vsub(h,p),_.vsub(f,v);const W=v.dot(p);_.vsub(h,v);let z=v.dot(p);if(z>0&&W<0&&(_.vsub(h,v),m.copy(p),m.normalize(),z=v.dot(m),m.scale(z,v),v.vadd(h,v),v.distanceTo(_)<e.radius)){if(d)return!0;const O=this.createContactEquation(o,l,e,t,c,u);v.vsub(_,O.ni),O.ni.normalize(),O.ni.scale(e.radius,O.ri),O.ri.vadd(n,O.ri),O.ri.vsub(o.position,O.ri),rn.pointToWorldFrame(s,a,v,v),v.vsub(l.position,O.rj),rn.vectorToWorldFrame(a,O.ni,O.ni),rn.vectorToWorldFrame(a,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}const S=Vz,M=Gz,A=Hz,C=Lz;for(let I=0,H=w.length;I!==H;I++){t.getTriangleVertices(w[I],S,M,A),t.getNormal(w[I],C),_.vsub(S,v);let W=v.dot(C);if(C.scale(W,v),_.vsub(v,v),W=v.distanceTo(_),Un.pointInTriangle(v,S,M,A)&&W<e.radius){if(d)return!0;let z=this.createContactEquation(o,l,e,t,c,u);v.vsub(_,z.ni),z.ni.normalize(),z.ni.scale(e.radius,z.ri),z.ri.vadd(n,z.ri),z.ri.vsub(o.position,z.ri),rn.pointToWorldFrame(s,a,v,v),v.vsub(l.position,z.rj),rn.vectorToWorldFrame(a,z.ni,z.ni),rn.vectorToWorldFrame(a,z.ri,z.ri),this.result.push(z),this.createFrictionEquationsFromContact(z,this.frictionResult)}}w.length=0}planeTrimesh(e,t,n,s,r,a,o,l,c,u,d){const h=new G,f=Cz;f.set(0,0,1),r.vmult(f,f);for(let p=0;p<t.vertices.length/3;p++){t.getVertex(p,h);const m=new G;m.copy(h),rn.pointToWorldFrame(s,a,m,h);const _=Pz;if(h.vsub(n,_),f.dot(_)<=0){if(d)return!0;const x=this.createContactEquation(o,l,e,t,c,u);x.ni.copy(f);const y=Rz;f.scale(_.dot(f),y),h.vsub(y,y),x.ri.copy(y),x.ri.vsub(o.position,x.ri),x.rj.copy(h),x.rj.vsub(l.position,x.rj),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}}}}const Na=new G,Do=new G,ko=new G,Ez=new G,Mz=new G,Tz=new Gn,Az=new Gn,Cz=new G,Pz=new G,Rz=new G,Lz=new G,Iz=new G;new G;const Dz=new G,kz=new G,Bz=new G,Oz=new G,Nz=new G,Fz=new G,Uz=new G,zz=new G,Vz=new G,Gz=new G,Hz=new G,Wz=new ts,$z=[],Iu=new G,Iy=new G,Xz=new G,qz=new G,Yz=new G;function jz(i,e,t){let n=null;const s=i.length;for(let r=0;r!==s;r++){const a=i[r],o=Xz;i[(r+1)%s].vsub(a,o);const l=qz;o.cross(e,l);const c=Yz;t.vsub(a,c);const u=l.dot(c);if(n===null||u>0&&n===!0||u<=0&&n===!1){n===null&&(n=u>0);continue}else return!1}return!0}const Du=new G,Kz=new G,Zz=new G,Jz=new G,Qz=[new G,new G,new G,new G,new G,new G],eV=new G,tV=new G,nV=new G,iV=new G,sV=new G,rV=new G,aV=new G,oV=new G,lV=new G,cV=new G,uV=new G,dV=new G,hV=new G,fV=new G;new G;new G;const pV=new G,mV=new G,_V=new G,vV=new G,gV=new G,yV=new G,xV=new G,bV=new G,wV=new G,SV=new G,Dy=new Gn,EV=new G;new G;const MV=new G,ky=new G,TV=new G,AV=new G,CV=new G,PV=[0],RV=new G,LV=new G;class By{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),s=this.current;let r=0;for(;n>s[r];)r++;if(n!==s[r]){for(let a=s.length-1;a>=r;a--)s[a+1]=s[a];s[r]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,s=this.previous,r=n.length,a=s.length;let o=0;for(let l=0;l<r;l++){let c=!1;const u=n[l];for(;u>s[o];)o++;c=u===s[o],c||Oy(e,u)}o=0;for(let l=0;l<a;l++){let c=!1;const u=s[l];for(;u>n[o];)o++;c=n[o]===u,c||Oy(t,u)}}}function Oy(i,e){i.push((e&4294901760)>>16,e&65535)}const wf=(i,e)=>i<e?`${i}-${e}`:`${e}-${i}`;class IV{constructor(){this.data={keys:[]}}get(e,t){const n=wf(e,t);return this.data[n]}set(e,t,n){const s=wf(e,t);this.get(e,t)||this.data.keys.push(s),this.data[s]=n}delete(e,t){const n=wf(e,t),s=this.data.keys.indexOf(n);s!==-1&&this.data.keys.splice(s,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;){const n=t.pop();delete e[n]}}}class DV extends Pw{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new G,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new G,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=e.broadphase!==void 0?e.broadphase:new Rw,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new vz,this.constraints=[],this.narrowphase=new Sz(this),this.collisionMatrix=new by,this.collisionMatrixPrevious=new by,this.bodyOverlapKeeper=new By,this.shapeOverlapKeeper=new By,this.contactmaterials=[],this.contactMaterialTable=new IV,this.defaultMaterial=new vl("default"),this.defaultContactMaterial=new oh(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof Pd?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,s){return n===void 0&&(n={}),n.mode=Un.ALL,n.from=e,n.to=t,n.callback=s,Sf.intersectWorld(this,n)}raycastAny(e,t,n,s){return n===void 0&&(n={}),n.mode=Un.ANY,n.from=e,n.to=t,n.result=s,Sf.intersectWorld(this,n)}raycastClosest(e,t,n,s){return n===void 0&&(n={}),n.mode=Un.CLOSEST,n.from=e,n.to=t,n.result=s,Sf.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof _t&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,s=n.indexOf(e);if(s!==-1){n.splice(s,1);for(let r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const s=t[n].shapes;for(let r=0;r<s.length;r++){const a=s[r];if(a.id===e)return a}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const n=Xn.now()/1e3;if(!this.lastCallTime)this.step(e,void 0,t);else{const s=n-this.lastCallTime;this.step(e,s,t)}this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const s=Xn.now();let r=0;for(;this.accumulator>=e&&r<n&&(this.internalStep(e),this.accumulator-=e,r++,!(Xn.now()-s>e*1e3)););this.accumulator=this.accumulator%e;const a=this.accumulator/e;for(let o=0;o!==this.bodies.length;o++){const l=this.bodies[o];l.previousPosition.lerp(l.position,a,l.interpolatedPosition),l.previousQuaternion.slerp(l.quaternion,a,l.interpolatedQuaternion),l.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=FV,s=UV,r=this.bodies.length,a=this.bodies,o=this.solver,l=this.gravity,c=this.doProfiling,u=this.profile,d=_t.DYNAMIC;let h=-1/0;const f=this.constraints,p=NV;l.length();const m=l.x,_=l.y,v=l.z;let x=0;for(c&&(h=Xn.now()),x=0;x!==r;x++){const I=a[x];if(I.type===d){const H=I.force,W=I.mass;H.x+=W*m,H.y+=W*_,H.z+=W*v}}for(let I=0,H=this.subsystems.length;I!==H;I++)this.subsystems[I].update();c&&(h=Xn.now()),n.length=0,s.length=0,this.broadphase.collisionPairs(this,n,s),c&&(u.broadphase=Xn.now()-h);let y=f.length;for(x=0;x!==y;x++){const I=f[x];if(!I.collideConnected)for(let H=n.length-1;H>=0;H-=1)(I.bodyA===n[H]&&I.bodyB===s[H]||I.bodyB===n[H]&&I.bodyA===s[H])&&(n.splice(H,1),s.splice(H,1))}this.collisionMatrixTick(),c&&(h=Xn.now());const g=OV,w=t.length;for(x=0;x!==w;x++)g.push(t[x]);t.length=0;const b=this.frictionEquations.length;for(x=0;x!==b;x++)p.push(this.frictionEquations[x]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,s,this,t,g,this.frictionEquations,p),c&&(u.narrowphase=Xn.now()-h),c&&(h=Xn.now()),x=0;x<this.frictionEquations.length;x++)o.addEquation(this.frictionEquations[x]);const T=t.length;for(let I=0;I!==T;I++){const H=t[I],W=H.bi,z=H.bj,q=H.si,O=H.sj;let re;if(W.material&&z.material?re=this.getContactMaterial(W.material,z.material)||this.defaultContactMaterial:re=this.defaultContactMaterial,re.friction,W.material&&z.material&&(W.material.friction>=0&&z.material.friction>=0&&W.material.friction*z.material.friction,W.material.restitution>=0&&z.material.restitution>=0&&(H.restitution=W.material.restitution*z.material.restitution)),o.addEquation(H),W.allowSleep&&W.type===_t.DYNAMIC&&W.sleepState===_t.SLEEPING&&z.sleepState===_t.AWAKE&&z.type!==_t.STATIC){const le=z.velocity.lengthSquared()+z.angularVelocity.lengthSquared(),Z=z.sleepSpeedLimit**2;le>=Z*2&&(W.wakeUpAfterNarrowphase=!0)}if(z.allowSleep&&z.type===_t.DYNAMIC&&z.sleepState===_t.SLEEPING&&W.sleepState===_t.AWAKE&&W.type!==_t.STATIC){const le=W.velocity.lengthSquared()+W.angularVelocity.lengthSquared(),Z=W.sleepSpeedLimit**2;le>=Z*2&&(z.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(W,z,!0),this.collisionMatrixPrevious.get(W,z)||(Fl.body=z,Fl.contact=H,W.dispatchEvent(Fl),Fl.body=W,z.dispatchEvent(Fl)),this.bodyOverlapKeeper.set(W.id,z.id),this.shapeOverlapKeeper.set(q.id,O.id)}for(this.emitContactEvents(),c&&(u.makeContactConstraints=Xn.now()-h,h=Xn.now()),x=0;x!==r;x++){const I=a[x];I.wakeUpAfterNarrowphase&&(I.wakeUp(),I.wakeUpAfterNarrowphase=!1)}for(y=f.length,x=0;x!==y;x++){const I=f[x];I.update();for(let H=0,W=I.equations.length;H!==W;H++){const z=I.equations[H];o.addEquation(z)}}o.solve(e,this),c&&(u.solve=Xn.now()-h),o.removeAllEquations();const E=Math.pow;for(x=0;x!==r;x++){const I=a[x];if(I.type&d){const H=E(1-I.linearDamping,e),W=I.velocity;W.scale(H,W);const z=I.angularVelocity;if(z){const q=E(1-I.angularDamping,e);z.scale(q,z)}}}this.dispatchEvent(BV),c&&(h=Xn.now());const M=this.stepnumber%(this.quatNormalizeSkip+1)===0,A=this.quatNormalizeFast;for(x=0;x!==r;x++)a[x].integrate(e,M,A);this.clearForces(),this.broadphase.dirty=!0,c&&(u.integrate=Xn.now()-h),this.stepnumber+=1,this.dispatchEvent(kV);let C=!0;if(this.allowSleep)for(C=!1,x=0;x!==r;x++){const I=a[x];I.sleepTick(this.time),I.sleepState!==_t.SLEEPING&&(C=!0)}this.hasActiveBodies=C}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(dr,hr),e){for(let r=0,a=dr.length;r<a;r+=2)Ul.bodyA=this.getBodyById(dr[r]),Ul.bodyB=this.getBodyById(dr[r+1]),this.dispatchEvent(Ul);Ul.bodyA=Ul.bodyB=null}if(t){for(let r=0,a=hr.length;r<a;r+=2)zl.bodyA=this.getBodyById(hr[r]),zl.bodyB=this.getBodyById(hr[r+1]),this.dispatchEvent(zl);zl.bodyA=zl.bodyB=null}dr.length=hr.length=0;const n=this.hasAnyEventListener("beginShapeContact"),s=this.hasAnyEventListener("endShapeContact");if((n||s)&&this.shapeOverlapKeeper.getDiff(dr,hr),n){for(let r=0,a=dr.length;r<a;r+=2){const o=this.getShapeById(dr[r]),l=this.getShapeById(dr[r+1]);fr.shapeA=o,fr.shapeB=l,o&&(fr.bodyA=o.body),l&&(fr.bodyB=l.body),this.dispatchEvent(fr)}fr.bodyA=fr.bodyB=fr.shapeA=fr.shapeB=null}if(s){for(let r=0,a=hr.length;r<a;r+=2){const o=this.getShapeById(hr[r]),l=this.getShapeById(hr[r+1]);pr.shapeA=o,pr.shapeB=l,o&&(pr.bodyA=o.body),l&&(pr.bodyB=l.body),this.dispatchEvent(pr)}pr.bodyA=pr.bodyB=pr.shapeA=pr.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const s=e[n];s.force,s.torque,s.force.set(0,0,0),s.torque.set(0,0,0)}}}new ts;const Sf=new Un,Xn=globalThis.performance||{};if(!Xn.now){let i=Date.now();Xn.timing&&Xn.timing.navigationStart&&(i=Xn.timing.navigationStart),Xn.now=()=>Date.now()-i}new G;const kV={type:"postStep"},BV={type:"preStep"},Fl={type:_t.COLLIDE_EVENT_NAME,body:null,contact:null},OV=[],NV=[],FV=[],UV=[],dr=[],hr=[],Ul={type:"beginContact",bodyA:null,bodyB:null},zl={type:"endContact",bodyA:null,bodyB:null},fr={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},pr={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},ct=.8,Ri=.96,Sn=.32,$l={"brick-1x1":{width:ct,length:ct,height:Ri,blockType:"brick"},"brick-1x2":{width:ct,length:ct*2,height:Ri,blockType:"brick"},"brick-1x3":{width:ct,length:ct*3,height:Ri,blockType:"brick"},"brick-1x4":{width:ct,length:ct*4,height:Ri,blockType:"brick"},"brick-1x6":{width:ct,length:ct*6,height:Ri,blockType:"brick"},"brick-1x8":{width:ct,length:ct*8,height:Ri,blockType:"brick"},"brick-1x12":{width:ct,length:ct*12,height:Ri,blockType:"brick"},"brick-2x2":{width:ct*2,length:ct*2,height:Ri,blockType:"brick"},"brick-2x3":{width:ct*2,length:ct*3,height:Ri,blockType:"brick"},"brick-2x4":{width:ct*2,length:ct*4,height:Ri,blockType:"brick"},"brick-2x6":{width:ct*2,length:ct*6,height:Ri,blockType:"brick"},"brick-2x8":{width:ct*2,length:ct*8,height:Ri,blockType:"brick"},"plate-1x1":{width:ct,length:ct,height:Sn,blockType:"plate"},"plate-1x2":{width:ct,length:ct*2,height:Sn,blockType:"plate"},"plate-1x3":{width:ct,length:ct*3,height:Sn,blockType:"plate"},"plate-1x4":{width:ct,length:ct*4,height:Sn,blockType:"plate"},"plate-1x6":{width:ct,length:ct*6,height:Sn,blockType:"plate"},"plate-1x8":{width:ct,length:ct*8,height:Sn,blockType:"plate"},"plate-2x2":{width:ct*2,length:ct*2,height:Sn,blockType:"plate"},"plate-2x3":{width:ct*2,length:ct*3,height:Sn,blockType:"plate"},"plate-2x4":{width:ct*2,length:ct*4,height:Sn,blockType:"plate"},"plate-2x6":{width:ct*2,length:ct*6,height:Sn,blockType:"plate"},"plate-2x8":{width:ct*2,length:ct*8,height:Sn,blockType:"plate"},"plate-4x4":{width:ct*4,length:ct*4,height:Sn,blockType:"plate"},"plate-4x8":{width:ct*4,length:ct*8,height:Sn,blockType:"plate"},"plate-8x8":{width:ct*8,length:ct*8,height:Sn,blockType:"plate"},"plate-16x16":{width:ct*16,length:ct*16,height:Sn,blockType:"plate"},"plate-20x20":{width:ct*20,length:ct*20,height:Sn,blockType:"plate"},"plate-32x32":{width:ct*32,length:ct*32,height:Sn,blockType:"plate"},"cylinder-1x1":{width:ct,length:ct,height:Ri,blockType:"brick",specialType:"cylinder-1x1"},"cylinder-plate-1x1":{width:ct,length:ct,height:Sn,blockType:"plate",specialType:"cylinder-plate-1x1"},"cylinder-plate-2x2":{width:ct*2,length:ct*2,height:Sn,blockType:"plate",specialType:"cylinder-plate-2x2"},"flat-plate-1x1":{width:ct,length:ct,height:Sn,blockType:"plate",specialType:"flat-plate-1x1"},"flat-plate-1x2":{width:ct,length:ct*2,height:Sn,blockType:"plate",specialType:"flat-plate-1x2"},"flat-plate-1x2-center-stud":{width:ct,length:ct*2,height:Sn,blockType:"plate",specialType:"flat-plate-1x2-center-stud"},"flat-plate-1x4":{width:ct,length:ct*4,height:Sn,blockType:"plate",specialType:"flat-plate-1x4"},minifigure:{width:ct,length:ct,height:Ri*2,blockType:"special",specialType:"minifigure"}};function Fw(i){return $l[i]||null}function em(i,e=null,t="brick"){if(e&&$l[e])return $l[e];if(i&&!i.includes("-")){const n=`${t}-${i}`;if($l[n])return $l[n]}return Fw(i)}function Lc(i){const{type:e,specialType:t,blockType:n}=i;return t||(e&&!e.includes("-")?`${n||"brick"}-${e}`:e)}let zV=class{constructor(e){this.container=e,this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.box=null,this.boxLid=null,this.blocks=[],this.animationId=null,this.isAnimating=!1,this.onComplete=null,this.world=null,this.floor=null,this.clickHandler=null,this.init()}init(){this.scene=new Qs,this.scene.background=new Mt(16770484),this.scene.fog=new Um(16770484,10,50),this.camera=new An(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(8,6,8),this.renderer=new er({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Rm,this.container.appendChild(this.renderer.domElement),this.controls=new Vc(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enableZoom=!0,this.controls.enablePan=!1,this.controls.autoRotate=!1,this.controls.target.set(0,6,0),this.setupLighting(),this.setupPhysics(),this.createGround(),this.clickHandler=e=>this.handleBoxClick(e),this.renderer.domElement.addEventListener("click",this.clickHandler),this.animate(),this.onWindowResizeThrottled=ya(()=>this.onWindowResize(),200),window.addEventListener("resize",this.onWindowResizeThrottled)}setupLighting(){const e=new bl(16777215,1.2);this.scene.add(e);const t=new Bn(16777215,1.5);t.position.set(10,15,5),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=50,t.shadow.camera.left=-15,t.shadow.camera.right=15,t.shadow.camera.top=15,t.shadow.camera.bottom=-15,this.scene.add(t);const n=new Bn(16766720,.8);n.position.set(-10,10,-5),this.scene.add(n);const s=new Bn(8900331,.6);s.position.set(5,10,-10),this.scene.add(s);const r=new oP(16777215,16766720,.8);this.scene.add(r)}setupPhysics(){this.world=new DV,this.world.gravity.set(0,-9.82,0),this.world.broadphase=new Rw,this.world.solver.iterations=10}createGround(){const e=new va(20,20),t=new md({color:9498256,transparent:!0,opacity:.3});this.floor=new yn(e,t),this.floor.rotation.x=-Math.PI/2,this.floor.position.y=-.1,this.floor.receiveShadow=!0,this.scene.add(this.floor);const n=new mz,s=new _t({mass:0,shape:n,material:new vl({restitution:.4})});s.quaternion.setFromAxisAngle(new G(1,0,0),-Math.PI/2),this.world.addBody(s)}async loadBoxTextures(e){const t=new fb,n=[];for(let r=1;r<=6;r++)n.push(`/images/boxes/${e}/${r}.webp`);const s=[];for(let r=0;r<6;r++)try{const a=await t.loadAsync(n[r]);s.push(a)}catch{const o=await t.loadAsync("/images/boxes/test.webp");s.push(o)}return s}async createBox(e){if(!e)return;const t=await this.loadBoxTextures(e.boxTexture||"test"),n=e.boxDimensions||{width:3,height:5,depth:2};this.box=new Zn,this.box.position.set(0,6,0),[{name:"front",size:[n.width,n.height,.1],pos:[0,0,n.depth/2],mat:0},{name:"back",size:[n.width,n.height,.1],pos:[0,0,-n.depth/2],mat:1},{name:"left",size:[.1,n.height,n.depth],pos:[-n.width/2,0,0],mat:2},{name:"right",size:[.1,n.height,n.depth],pos:[n.width/2,0,0],mat:3},{name:"bottom",size:[n.width,.1,n.depth],pos:[0,-n.height/2,0],mat:5}].forEach(l=>{const c=new ji(...l.size),u=new xu({map:t[l.mat],roughness:.1,metalness:.2,envMapIntensity:2,emissive:16777215,emissiveIntensity:.1}),d=new yn(c,u);d.position.set(...l.pos),d.castShadow=!0,this.box.add(d)}),this.boxLid=new Zn,this.boxLid.position.set(0,n.height/2,-n.depth/2);const r=new ji(n.width,.1,n.depth),a=new xu({map:t[4],roughness:.1,metalness:.2,envMapIntensity:2,emissive:16777215,emissiveIntensity:.1}),o=new yn(r,a);o.position.set(0,0,n.depth/2),o.castShadow=!0,this.boxLid.add(o),this.box.add(this.boxLid),this.scene.add(this.box),this.boxDimensions=n,this.box.userData={hoverable:!0}}handleBoxClick(e){if(this.isAnimating)return;const t=new Lt;t.x=e.clientX/this.renderer.domElement.clientWidth*2-1,t.y=-(e.clientY/this.renderer.domElement.clientHeight)*2+1;const n=new Gm;n.setFromCamera(t,this.camera),n.intersectObject(this.box).length>0&&this.startBoxOpening()}startBoxOpening(){this.isAnimating||(this.isAnimating=!0,this.animateBoxFlip(),setTimeout(()=>{this.createAndScatterBlocks()},1500),setTimeout(()=>{this.completeAnimation()},8e3))}animateBoxFlip(){if(!this.box||!this.boxLid)return;const e={intensity:0};Zu.to(e,{intensity:1,duration:1,ease:"power2.inOut",onUpdate:()=>{const t=(Math.random()-.5)*.3*e.intensity,n=(Math.random()-.5)*.3*e.intensity,s=(Math.random()-.5)*.3*e.intensity;this.box.position.set(0+t,6+n,0+s)},onComplete:()=>{this.animateLidOpening(),this.animateBoxRotation()}})}animateLidOpening(){this.boxLid&&Zu.to(this.boxLid.rotation,{x:-Math.PI*2/3,duration:1.5,ease:"back.out(1.7)"})}animateBoxRotation(){this.box&&Zu.to(this.box.rotation,{x:Math.PI,duration:2,ease:"back.out(1.7)"})}createAndScatterBlocks(){this.clearBlocks();const e=this.currentSet||{blocks:[]},t=e.boxDimensions||{width:3,height:5,depth:2};e.blocks.forEach((n,s)=>{const r=this.createBlock(n);r&&(r.position.set((Math.random()-.5)*(t.width*.8),6-t.height*.3,(Math.random()-.5)*(t.depth*.8)),r.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),this.blocks.push(r),this.scene.add(r),this.addBlockPhysics(r,n))})}createBlock(e){const{type:t,color:n,specialType:s,blockType:r}=e,a=Lc(e),o=em(a,s,r);if(!o)return console.warn(`Unknown block type: ${t}${s?` (special: ${s})`:""}`),null;const l=new Zn,c=.1,u=new ji(o.width*c,o.height*c,o.length*c),d=new xu({color:this.getColorValue(n),roughness:.3,metalness:.1}),h=new yn(u,d);return h.castShadow=!0,l.add(h),this.addStuds(l,o,n,c),l}addBlockPhysics(e,t){const{type:n,specialType:s,blockType:r}=t,a=Lc(t),o=em(a,s,r);if(!o)return;const l=.1,c=new ah(new G(o.width*l/2,o.height*l/2,o.length*l/2)),u=new _t({mass:.001,shape:c,material:new vl({restitution:.3})});u.position.set(e.position.x,e.position.y,e.position.z),u.quaternion.set(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w),u.velocity.set((Math.random()-.5)*1,0,(Math.random()-.5)*1),u.angularVelocity.set((Math.random()-.5)*2,(Math.random()-.5)*2,(Math.random()-.5)*2),this.world.addBody(u),e.body=u}getBlockDimensions(e){const t=Fw(e);return t?{width:t.width,length:t.length}:null}addStuds(e,t,n,s=1){const r=new ul(.3*s,.3*s,.2*s,8),a=new xu({color:this.getColorValue(n),roughness:.3,metalness:.1}),o=Math.floor(t.width/.8),l=Math.floor(t.length/.8);for(let c=0;c<o;c++)for(let u=0;u<l;u++){const d=new yn(r,a);d.position.set((c-(o-1)/2)*.8*s,.58*s,(u-(l-1)/2)*.8*s),d.castShadow=!0,e.add(d)}}getColorValue(e){return{red:16711680,blue:255,green:65280,yellow:16776960,white:16777215,black:0,gray:8421504,silver:12632256,pink:16761035,purple:8388736,orange:16753920,brown:9127187}[e]||16711680}clearBlocks(){this.blocks.forEach(e=>{this.scene.remove(e),e.body&&this.world.removeBody(e.body)}),this.blocks=[]}completeAnimation(){this.isAnimating=!1,this.onComplete&&this.onComplete()}openBox(e,t){this.currentSet=e,this.onComplete=t,this.createBox(e)}startBoxOpeningAnimation(){this.startBoxOpening()}animate(){this.animationId=requestAnimationFrame(()=>this.animate()),this.world.step(1/60),this.blocks.forEach(e=>{e.body&&(e.position.copy(e.body.position),e.quaternion.copy(e.body.quaternion))}),this.controls.update(),this.renderer.render(this.scene,this.camera)}onWindowResize(){this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}dispose(){this.animationId&&cancelAnimationFrame(this.animationId),this.renderer&&this.renderer.dispose(),this.controls&&this.controls.dispose(),this.clickHandler&&this.renderer.domElement.removeEventListener("click",this.clickHandler),this.onWindowResizeThrottled&&window.removeEventListener("resize",this.onWindowResizeThrottled),this.world&&this.world.bodies.forEach(e=>{this.world.removeBody(e)})}};const VV={class:"box-opening-scene"},GV={class:"minimal-header"},HV={key:0,class:"no-set-message"},WV={key:1,class:"bottom-action-panel"},$V={__name:"BoxOpening",setup(i){const e=es(),{t}=wn(),n=ze(null),s=ze(null),r=ze(!1),a=ze(!1),o=ze(null),l=tt(()=>e.state.sets.currentSet);In(()=>{n.value&&(s.value=new zV(n.value),l.value&&s.value.openBox(l.value,()=>{}))}),Wn(l,async(d,h)=>{d&&s.value?(d!==h&&(r.value=!1,a.value=!1,o.value=null),await Cr(),s.value&&s.value.openBox(d,()=>{})):!d&&h&&(r.value=!1,a.value=!1)});const c=()=>{s.value&&!r.value&&(r.value=!0,s.value.startBoxOpeningAnimation(),l.value&&l.value.blocks&&o.value!==l.value.id&&(e.dispatch("inventory/addSetBlocks",l.value.blocks),o.value=l.value.id),setTimeout(()=>{a.value=!0},8e3))},u=()=>{l.value&&e.dispatch("sets/startBuilding"),e.dispatch("navigateToScene","assembly")};return Ds(()=>{s.value&&s.value.dispose()}),(d,h)=>{var f;return oe(),ge("div",VV,[B("div",GV,[B("h1",null,se(((f=l.value)==null?void 0:f.name)||Ii(t)("boxOpening.title")),1)]),l.value?Ve("",!0):(oe(),ge("div",HV,[B("p",null,se(Ii(t)("boxOpening.noSetSelected")),1),B("button",{onClick:u,class:"action-btn back-btn"},"  "+se(Ii(t)("common.back")),1)])),B("div",{ref_key:"sceneContainer",ref:n,class:"scene-container",style:fi({display:l.value?"block":"none"})},null,4),l.value?(oe(),ge("div",WV,[!r.value&&!a.value?(oe(),ge("button",{key:0,onClick:c,class:"action-btn open-btn"},"  "+se(Ii(t)("boxOpening.openBox")),1)):a.value?(oe(),ge("button",{key:1,onClick:u,class:"action-btn assemble-btn"},"  "+se(Ii(t)("boxOpening.assembleSet")),1)):Ve("",!0)])):Ve("",!0)])}}},XV=Ht($V,[["__scopeId","data-v-cecc46cf"]]);let qV=class{constructor(e){this.container=e,this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.ghostBlock=null,this.placedBlocks=[],this.availableBlocks=[],this.currentSet=null,this.currentGhostIndex=0,this.animationId=null,this.onProgressUpdate=null,this.onComplete=null,this.onBlockPlaced=null,this.basePlate=null,this.platformSize=16,this.visualizer=null,this.dragController=null,this.draggedBlock=null,this.lastPlacedBlock=null,this.placementCount=0,this.init()}init(){this.scene=new Qs,this.scene.background=new Mt(11591910),this.camera=new An(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.renderer=new er({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),la(this.renderer),this.container.appendChild(this.renderer.domElement),this.controls=new Vc(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enableZoom=!0,this.controls.enablePan=!0,this.controls.maxPolarAngle=Math.PI/2,this.visualizer=new nh(this.scene),this.dragController=new th(this.camera,this.scene,this.renderer),this.dragController.assemblyScene=this,this.setupLighting(),this.createPlatform(16),this.animate(),this.onWindowResizeThrottled=ya(()=>this.onWindowResize(),200),window.addEventListener("resize",this.onWindowResizeThrottled)}setupLighting(){Fc(this.scene),Uc(this.scene),zc(this.scene)}createGround(){}createPlatform(e=16){this.basePlate&&this.scene.remove(this.basePlate);let t;switch(e){case 4:t=Sl.create("green");break;case 8:t=Gc.create("green");break;case 16:t=El.create("green");break;case 32:t=Hc.create("green");break;default:t=Wc.create("green")}t.position.set(0,-.32/2,0),t.userData.isBrick=!0,t.userData.isBasePlate=!0,t.userData.isImmobile=!0,t.userData.isGround=!0,t.castShadow=!1,t.receiveShadow=!0,t.traverse(n=>{n.isMesh&&(n.castShadow=!1,n.receiveShadow=!0)}),this.scene.add(t),this.basePlate=t,this.platformSize=e}loadSet(e,t){this.currentSet=e,this.availableBlocks=t,this.currentGhostIndex=0,this.placedBlocks=[];const n=e.platformSize||16;n!==this.platformSize&&this.createPlatform(n),this.clearAllBlocks(),this.showNextGhost()}showNextGhost(){if(!this.currentSet||this.currentGhostIndex>=this.currentSet.blocks.length)return;const e=this.currentSet.blocks[this.currentGhostIndex];this.createGhostBlock(e),this.onProgressUpdate&&this.onProgressUpdate(this.currentGhostIndex+1,this.currentSet.blocks.length)}createGhostBlock(e){this.ghostBlock&&(this.visualizer.hideGhost(this.ghostBlock),this.scene.remove(this.ghostBlock));const{type:t,color:n,position:s,rotation:r,specialType:a,blockType:o}=e,l=Lc({type:t,specialType:a,blockType:o}),c=a||l;this.createBlockFromType(c,n,!1,a||null).then(u=>{if(u){this.ghostBlock=u,this.ghostBlock.position.set(s.x,s.y,s.z),this.ghostBlock.rotation.set(r.x||0,r.y||0,r.z||0);const d=a||l;this.ghostBlock.userData.type=d,this.ghostBlock.userData.color=n,a&&(this.ghostBlock.userData.specialType=a),this.ghostBlock.userData.isGhost=!0,this.ghostBlock.userData.isImmobile=!0,this.ghostBlock.userData.isBrick=!0,this.scene.add(this.ghostBlock),this.visualizer.showGhost(this.ghostBlock,this.ghostBlock.position,!0)}}).catch(u=>{console.error("Failed to create ghost block:",u)})}createBlock(e,t,n=!1){const s=this.getBlockDimensions(e);if(!s)return null;const r=new Zn,a=new ji(s.width,.96,s.length),o=new md({color:this.getColorValue(t)}),l=new yn(a,o);return l.castShadow=!0,r.add(l),this.addStuds(r,s,t),r}getBlockDimensions(e){const t=em(e);return t?{width:t.width,length:t.length}:{width:.8,length:.8}}addStuds(e,t,n){const s=new ul(.24,.24,.18,8),r=new md({color:this.getColorValue(n)}),a=Math.round(t.width/.8),o=Math.round(t.length/.8);for(let l=0;l<a;l++)for(let c=0;c<o;c++){const u=new yn(s,r);u.position.set((l-(a-1)/2)*.8,.48+.09,(c-(o-1)/2)*.8),u.castShadow=!0,e.add(u)}}getColorValue(e){return{red:16711680,blue:255,green:65280,yellow:16776960,white:16777215,black:0,gray:8421504,silver:12632256,pink:16761035,purple:8388736,orange:16753920,brown:9127187}[e]||16711680}async createBlockFromType(e,t,n=!1,s=null){const r=s||e;let a=null;try{switch(r){case"brick-1x1":a=(await ae(async()=>{const{Brick1x1:o}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:o}},[],import.meta.url)).Brick1x1;break;case"brick-1x2":a=(await ae(async()=>{const{Brick1x2:o}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:o}},[],import.meta.url)).Brick1x2;break;case"brick-1x3":a=(await ae(async()=>{const{Brick1x3:o}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:o}},[],import.meta.url)).Brick1x3;break;case"brick-1x4":a=(await ae(async()=>{const{Brick1x4:o}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:o}},[],import.meta.url)).Brick1x4;break;case"brick-1x6":a=(await ae(async()=>{const{Brick1x6:o}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:o}},[],import.meta.url)).Brick1x6;break;case"brick-1x8":a=(await ae(async()=>{const{Brick1x8:o}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:o}},[],import.meta.url)).Brick1x8;break;case"brick-1x12":a=(await ae(async()=>{const{Brick1x12:o}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:o}},[],import.meta.url)).Brick1x12;break;case"brick-2x2":a=(await ae(async()=>{const{Brick2x2:o}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:o}},[],import.meta.url)).Brick2x2;break;case"brick-2x3":a=(await ae(async()=>{const{Brick2x3:o}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:o}},[],import.meta.url)).Brick2x3;break;case"brick-2x4":a=(await ae(async()=>{const{Brick2x4:o}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:o}},[],import.meta.url)).Brick2x4;break;case"brick-2x6":a=(await ae(async()=>{const{Brick2x6:o}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:o}},[],import.meta.url)).Brick2x6;break;case"brick-2x8":a=(await ae(async()=>{const{Brick2x8:o}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:o}},[],import.meta.url)).Brick2x8;break;case"plate-1x1":a=(await ae(async()=>{const{Plate1x1:o}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:o}},[],import.meta.url)).Plate1x1;break;case"plate-1x2":a=(await ae(async()=>{const{Plate1x2:o}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:o}},[],import.meta.url)).Plate1x2;break;case"plate-1x3":a=(await ae(async()=>{const{Plate1x3:o}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:o}},[],import.meta.url)).Plate1x3;break;case"plate-1x4":a=(await ae(async()=>{const{Plate1x4:o}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:o}},[],import.meta.url)).Plate1x4;break;case"plate-1x6":a=(await ae(async()=>{const{Plate1x6:o}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:o}},[],import.meta.url)).Plate1x6;break;case"plate-1x8":a=(await ae(async()=>{const{Plate1x8:o}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:o}},[],import.meta.url)).Plate1x8;break;case"plate-2x2":a=(await ae(async()=>{const{Plate2x2:o}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:o}},[],import.meta.url)).Plate2x2;break;case"plate-2x3":a=(await ae(async()=>{const{Plate2x3:o}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:o}},[],import.meta.url)).Plate2x3;break;case"plate-2x4":a=(await ae(async()=>{const{Plate2x4:o}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:o}},[],import.meta.url)).Plate2x4;break;case"plate-2x6":a=(await ae(async()=>{const{Plate2x6:o}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:o}},[],import.meta.url)).Plate2x6;break;case"plate-2x8":a=(await ae(async()=>{const{Plate2x8:o}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:o}},[],import.meta.url)).Plate2x8;break;case"plate-4x4":a=(await ae(async()=>{const{Plate4x4:o}=await Promise.resolve().then(()=>ro);return{Plate4x4:o}},void 0,import.meta.url)).Plate4x4;break;case"plate-4x8":a=(await ae(async()=>{const{Plate4x8:o}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:o}},[],import.meta.url)).Plate4x8;break;case"cylinder-1x1":a=(await ae(async()=>{const{Cylinder1x1:o}=await import("./Cylinder1x1-CatK-O-Q.js");return{Cylinder1x1:o}},[],import.meta.url)).Cylinder1x1;break;case"cylinder-plate-1x1":a=(await ae(async()=>{const{CylinderPlate1x1:o}=await import("./CylinderPlate1x1-C9BKk24L.js");return{CylinderPlate1x1:o}},[],import.meta.url)).CylinderPlate1x1;break;case"cylinder-plate-2x2":a=(await ae(async()=>{const{CylinderPlate2x2:o}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:o}},[],import.meta.url)).CylinderPlate2x2;break;case"flat-plate-1x1":a=(await ae(async()=>{const{FlatPlate1x1:o}=await import("./FlatPlate1x1-COVjvhfm.js");return{FlatPlate1x1:o}},[],import.meta.url)).FlatPlate1x1;break;case"flat-plate-1x2":a=(await ae(async()=>{const{FlatPlate1x2:o}=await import("./FlatPlate1x2-WO8sp-SC.js");return{FlatPlate1x2:o}},[],import.meta.url)).FlatPlate1x2;break;case"flat-plate-1x2-center-stud":a=(await ae(async()=>{const{FlatPlate1x2CenterStud:o}=await import("./FlatPlate1x2CenterStud-CgU774Nu.js");return{FlatPlate1x2CenterStud:o}},__vite__mapDeps([0,1]),import.meta.url)).FlatPlate1x2CenterStud;break;case"flat-plate-1x4":a=(await ae(async()=>{const{FlatPlate1x4:o}=await import("./FlatPlate1x4-BhPvU6tM.js");return{FlatPlate1x4:o}},[],import.meta.url)).FlatPlate1x4;break;case"minifigure":a=(await ae(async()=>{const{Minifigure:o}=await Promise.resolve().then(()=>Ml);return{Minifigure:o}},void 0,import.meta.url)).Minifigure;break;case"side-stud-brick-1x1":a=(await ae(async()=>{const{SideStudBrick1x1:o}=await import("./SideStudBrick1x1-Bw5mv8V9.js");return{SideStudBrick1x1:o}},__vite__mapDeps([2,3]),import.meta.url)).SideStudBrick1x1;break;case"corner-brick-1x1":a=(await ae(async()=>{const{CornerBrick1x1:o}=await import("./CornerBrick1x1-2hjvabOl.js");return{CornerBrick1x1:o}},[],import.meta.url)).CornerBrick1x1;break;case"stepped-brick-2x2":a=(await ae(async()=>{const{SteppedBrick2x2:o}=await import("./SteppedBrick2x2-DHsbtfck.js");return{SteppedBrick2x2:o}},[],import.meta.url)).SteppedBrick2x2;break;default:return console.warn(`Unknown block type: ${r}`),null}if(a){const o=await a.create(t,n);if(o&&(o.castShadow=!0,o.receiveShadow=!0,o.traverse(l=>{l.isMesh&&(l.castShadow=!0,l.receiveShadow=!0)}),s&&(o.userData.specialType=s),r==="minifigure"&&o.userData.minifigureInstance))try{await o.userData.minifigureInstance.applySkin("/images/skins/steve.png")}catch(l){console.error("Failed to load skin for minifigure:",l)}return o}}catch(o){return console.error(`Failed to load block type ${r}:`,o),null}return null}addBlockForDrag(e,t=null){this.draggedBlock&&this.scene.remove(this.draggedBlock),this.draggedBlock=e,this.scene.add(e),t?e.position.copy(t):e.position.set(0,5,0),this.dragController&&(this.dragController.draggedObject=e)}checkGhostCollision(e,t){return!e||!t?!1:e.position.distanceTo(t.position)<.5?(e.position.copy(t.position),e.rotation.copy(t.rotation),!0):!1}async tryPlaceBlock(e,t){var p,m,_,v;if(!this.ghostBlock||!this.currentSet)return!1;const n=this.currentSet.blocks[this.currentGhostIndex],s=Lc(n),r=n.specialType||null,a=((m=(p=this.draggedBlock)==null?void 0:p.userData)==null?void 0:m.type)||e,o=((v=(_=this.draggedBlock)==null?void 0:_.userData)==null?void 0:v.specialType)||null,l=a===s,c=!r||o===r,u=n.color===t;if(!l||!c||!u)return this.draggedBlock&&(this.scene.remove(this.draggedBlock),this.draggedBlock=null),!1;this.draggedBlock&&(this.scene.remove(this.draggedBlock),this.draggedBlock=null);const d=await this.createBlockFromType(s,t,!1,r);if(!d)return!1;const h=new fe(n.position.x,n.position.y,n.position.z),f=new Zi(n.rotation.x||0,n.rotation.y||0,n.rotation.z||0);return d.position.copy(h),d.rotation.copy(f),d.userData.type=s,d.userData.color=t,r&&(d.userData.specialType=r),d.traverse(x=>{x.isMesh&&x.material&&(x.material.transparent=!1,x.material.opacity=1)}),this.scene.children.includes(d)||this.scene.add(d),d.userData.isPlaced=!0,d.userData.isImmobile=!0,d.userData.isBrick=!0,this.placedBlocks.push(d),this.lastPlacedBlock=d,this.placementCount=(this.placementCount||0)+1,this.onBlockPlaced&&this.onBlockPlaced(d),this.visualizer.hideGhost(this.ghostBlock),this.scene.remove(this.ghostBlock),this.ghostBlock=null,this.currentGhostIndex++,this.currentGhostIndex<this.currentSet.blocks.length?this.showNextGhost():this.onComplete&&this.onComplete(),!0}getCurrentGhostBlock(){return!this.currentSet||this.currentGhostIndex>=this.currentSet.blocks.length?null:this.currentSet.blocks[this.currentGhostIndex]}isComplete(){return this.currentSet&&this.currentGhostIndex>=this.currentSet.blocks.length}getProgress(){if(!this.currentSet)return{current:0,total:0,percentage:0};const e=this.currentGhostIndex,t=this.currentSet.blocks.length,n=Math.round(e/t*100);return{current:e,total:t,percentage:n}}clearAllBlocks(){this.placedBlocks.forEach(e=>{this.scene.remove(e)}),this.placedBlocks=[],this.ghostBlock&&(this.scene.remove(this.ghostBlock),this.ghostBlock=null)}reset(){this.clearAllBlocks(),this.currentSet=null,this.currentGhostIndex=0,this.availableBlocks=[]}animate(){this.animationId=requestAnimationFrame(()=>this.animate()),this.controls.update(),this.draggedBlock&&this.ghostBlock&&this.visualizer&&this.visualizer.showGhost(this.draggedBlock,this.draggedBlock.position,!0),this.renderer.render(this.scene,this.camera)}onWindowResize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}dispose(){this.animationId&&cancelAnimationFrame(this.animationId),this.onWindowResizeThrottled&&window.removeEventListener("resize",this.onWindowResizeThrottled),this.renderer&&this.renderer.dispose(),this.controls&&this.controls.dispose(),this.container&&this.renderer&&this.container.removeChild(this.renderer.domElement)}};const YV={class:"block-palette"},jV={class:"block-palette__content"},KV={key:0,class:"block-palette__section"},ZV={class:"block-palette__section-title"},JV={class:"block-palette__grid"},QV=["onMousedown","onTouchstart"],e4={key:1,class:"block-palette__empty"},t4={__name:"AssemblyInventory",props:{availableBlocks:{type:Array,required:!0}},emits:["create-block"],setup(i,{emit:e}){const t=i,n=e,{t:s}=wn(),r=tt(()=>!t.availableBlocks||t.availableBlocks.length===0?[]:t.availableBlocks.filter(y=>y&&y.count>0).map(y=>({...y,type:y.type,color:y.color||"red",isGlass:y.isGlass||!1,specialType:y.specialType||null,blockType:y.blockType||null}))),a=x=>{const y=x.type.split("-");if(y.length>=2){const g=y[1],w=y[0];return`${g} ${s(`blocks.${w}`)}`}return x.type},o=async(x,y,g,w=null)=>{const b=w||x;let T=null;try{switch(b){case"brick-1x1":T=(await ae(async()=>{const{Brick1x1:E}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:E}},[],import.meta.url)).Brick1x1;break;case"brick-1x2":T=(await ae(async()=>{const{Brick1x2:E}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:E}},[],import.meta.url)).Brick1x2;break;case"brick-1x3":T=(await ae(async()=>{const{Brick1x3:E}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:E}},[],import.meta.url)).Brick1x3;break;case"brick-1x4":T=(await ae(async()=>{const{Brick1x4:E}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:E}},[],import.meta.url)).Brick1x4;break;case"brick-1x6":T=(await ae(async()=>{const{Brick1x6:E}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:E}},[],import.meta.url)).Brick1x6;break;case"brick-1x8":T=(await ae(async()=>{const{Brick1x8:E}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:E}},[],import.meta.url)).Brick1x8;break;case"brick-1x12":T=(await ae(async()=>{const{Brick1x12:E}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:E}},[],import.meta.url)).Brick1x12;break;case"brick-2x2":T=(await ae(async()=>{const{Brick2x2:E}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:E}},[],import.meta.url)).Brick2x2;break;case"brick-2x3":T=(await ae(async()=>{const{Brick2x3:E}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:E}},[],import.meta.url)).Brick2x3;break;case"brick-2x4":T=(await ae(async()=>{const{Brick2x4:E}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:E}},[],import.meta.url)).Brick2x4;break;case"brick-2x6":T=(await ae(async()=>{const{Brick2x6:E}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:E}},[],import.meta.url)).Brick2x6;break;case"brick-2x8":T=(await ae(async()=>{const{Brick2x8:E}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:E}},[],import.meta.url)).Brick2x8;break;case"plate-1x1":T=(await ae(async()=>{const{Plate1x1:E}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:E}},[],import.meta.url)).Plate1x1;break;case"plate-1x2":T=(await ae(async()=>{const{Plate1x2:E}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:E}},[],import.meta.url)).Plate1x2;break;case"plate-1x3":T=(await ae(async()=>{const{Plate1x3:E}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:E}},[],import.meta.url)).Plate1x3;break;case"plate-1x4":T=(await ae(async()=>{const{Plate1x4:E}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:E}},[],import.meta.url)).Plate1x4;break;case"plate-1x6":T=(await ae(async()=>{const{Plate1x6:E}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:E}},[],import.meta.url)).Plate1x6;break;case"plate-1x8":T=(await ae(async()=>{const{Plate1x8:E}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:E}},[],import.meta.url)).Plate1x8;break;case"plate-2x2":T=(await ae(async()=>{const{Plate2x2:E}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:E}},[],import.meta.url)).Plate2x2;break;case"plate-2x3":T=(await ae(async()=>{const{Plate2x3:E}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:E}},[],import.meta.url)).Plate2x3;break;case"plate-2x4":T=(await ae(async()=>{const{Plate2x4:E}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:E}},[],import.meta.url)).Plate2x4;break;case"plate-2x6":T=(await ae(async()=>{const{Plate2x6:E}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:E}},[],import.meta.url)).Plate2x6;break;case"plate-2x8":T=(await ae(async()=>{const{Plate2x8:E}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:E}},[],import.meta.url)).Plate2x8;break;case"plate-4x4":T=(await ae(async()=>{const{Plate4x4:E}=await Promise.resolve().then(()=>ro);return{Plate4x4:E}},void 0,import.meta.url)).Plate4x4;break;case"plate-4x8":T=(await ae(async()=>{const{Plate4x8:E}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:E}},[],import.meta.url)).Plate4x8;break;case"cylinder-1x1":T=(await ae(async()=>{const{Cylinder1x1:E}=await import("./Cylinder1x1-CatK-O-Q.js");return{Cylinder1x1:E}},[],import.meta.url)).Cylinder1x1;break;case"cylinder-plate-1x1":T=(await ae(async()=>{const{CylinderPlate1x1:E}=await import("./CylinderPlate1x1-C9BKk24L.js");return{CylinderPlate1x1:E}},[],import.meta.url)).CylinderPlate1x1;break;case"cylinder-plate-2x2":T=(await ae(async()=>{const{CylinderPlate2x2:E}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:E}},[],import.meta.url)).CylinderPlate2x2;break;case"flat-plate-1x1":T=(await ae(async()=>{const{FlatPlate1x1:E}=await import("./FlatPlate1x1-COVjvhfm.js");return{FlatPlate1x1:E}},[],import.meta.url)).FlatPlate1x1;break;case"flat-plate-1x2":T=(await ae(async()=>{const{FlatPlate1x2:E}=await import("./FlatPlate1x2-WO8sp-SC.js");return{FlatPlate1x2:E}},[],import.meta.url)).FlatPlate1x2;break;case"flat-plate-1x2-center-stud":T=(await ae(async()=>{const{FlatPlate1x2CenterStud:E}=await import("./FlatPlate1x2CenterStud-CgU774Nu.js");return{FlatPlate1x2CenterStud:E}},__vite__mapDeps([0,1]),import.meta.url)).FlatPlate1x2CenterStud;break;case"flat-plate-1x4":T=(await ae(async()=>{const{FlatPlate1x4:E}=await import("./FlatPlate1x4-BhPvU6tM.js");return{FlatPlate1x4:E}},[],import.meta.url)).FlatPlate1x4;break;case"minifigure":T=(await ae(async()=>{const{Minifigure:E}=await Promise.resolve().then(()=>Ml);return{Minifigure:E}},void 0,import.meta.url)).Minifigure;break;case"side-stud-brick-1x1":T=(await ae(async()=>{const{SideStudBrick1x1:E}=await import("./SideStudBrick1x1-Bw5mv8V9.js");return{SideStudBrick1x1:E}},__vite__mapDeps([2,3]),import.meta.url)).SideStudBrick1x1;break;case"corner-brick-1x1":T=(await ae(async()=>{const{CornerBrick1x1:E}=await import("./CornerBrick1x1-2hjvabOl.js");return{CornerBrick1x1:E}},[],import.meta.url)).CornerBrick1x1;break;case"stepped-brick-2x2":T=(await ae(async()=>{const{SteppedBrick2x2:E}=await import("./SteppedBrick2x2-DHsbtfck.js");return{SteppedBrick2x2:E}},[],import.meta.url)).SteppedBrick2x2;break;default:return null}if(T){const E=await T.create(y,g,!1);if(E&&(E.userData.type=x,E.userData.color=y,E.userData.isGlass=g,w?E.userData.specialType=w:(b.startsWith("cylinder-")||b.startsWith("flat-plate-"))&&(E.userData.specialType=b),b==="minifigure"&&E.userData.minifigureInstance))try{await E.userData.minifigureInstance.applySkin("/images/skins/steve.png")}catch(S){console.error("Failed to load skin for minifigure:",S)}return E}}catch(E){return console.error(`Failed to load block type ${b}:`,E),null}return null};let l=!1,c=null,u=null,d=null;const h=(x,y)=>{x.button!==0||!y||y.count<=0||(x.preventDefault(),x.stopPropagation(),l=!0,c=y,u=x.clientX,d=x.clientY,document.addEventListener("mousemove",p),document.addEventListener("mouseup",m))},f=(x,y)=>{if(x.touches.length!==1||y.count<=0)return;x.preventDefault(),x.stopPropagation(),l=!0,c=y;const g=x.touches[0];u=g.clientX,d=g.clientY,document.addEventListener("touchmove",_,{passive:!1}),document.addEventListener("touchend",v)},p=async x=>{if(!l||!c)return;const y=5,g=Math.abs(x.clientX-u),w=Math.abs(x.clientY-d);if(g<y&&w<y)return;const b=c.isGlass||!1,T=await o(c.type,c.color,b,c.specialType);if(!T){l=!1,c=null,document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m);return}T.userData.type=c.type,T.userData.color=c.color,c.specialType&&(T.userData.specialType=c.specialType),n("create-block",T,x.clientX,x.clientY),l=!1,c=null,document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m)},m=x=>{l&&(l=!1,c=null,document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m))},_=async x=>{if(!l||!c||x.touches.length!==1)return;x.preventDefault();const y=x.touches[0],g=5,w=Math.abs(y.clientX-u),b=Math.abs(y.clientY-d);if(w<g&&b<g)return;const T=c.isGlass||!1,E=await o(c.type,c.color,T,c.specialType);E&&(E.userData.type=c.type,E.userData.color=c.color,c.specialType&&(E.userData.specialType=c.specialType),n("create-block",E,y.clientX,y.clientY),l=!1,c=null,document.removeEventListener("touchmove",_),document.removeEventListener("touchend",v))},v=x=>{l&&(l=!1,c=null,document.removeEventListener("touchmove",_),document.removeEventListener("touchend",v))};return(x,y)=>(oe(),ge("div",YV,[B("div",jV,[r.value.length>0?(oe(),ge("div",KV,[B("h4",ZV,se(x.$t("assembly.inventory")),1),B("div",JV,[(oe(!0),ge(At,null,Zt(r.value,g=>(oe(),ge("div",{key:`${g.type}-${g.color}`,class:"block-palette__block-card",onMousedown:w=>h(w,g),onTouchstart:w=>f(w,g),draggable:"false"},[we(qr,{label:a(g),"block-type":g.type,color:g.color,"is-glass":g.isGlass||!1,"create-block-fn":async()=>{const w=await o(g.type,g.color,g.isGlass||!1,g.specialType);return w&&w.userData&&(w.userData.color=g.color),w}},{extra:Le(()=>[we(_n,{variant:"success",size:"sm"},{default:Le(()=>[Oe(se(g.count)+"x ",1)]),_:2},1024)]),_:2},1032,["label","block-type","color","is-glass","create-block-fn"])],40,QV))),128))])])):(oe(),ge("div",e4,[B("p",null,se(x.$t("assembly.noBlocksAvailable")),1)]))])]))}},n4=Ht(t4,[["__scopeId","data-v-de12925e"]]),i4={class:"assembly-sidebar"},s4={class:"assembly-sidebar__content"},r4={__name:"AssemblySidebar",props:{availableBlocks:{type:Array,required:!0}},emits:["create-block"],setup(i){return(e,t)=>(oe(),ge("div",i4,[B("div",s4,[we(n4,{"available-blocks":i.availableBlocks,onCreateBlock:t[0]||(t[0]=(n,s,r)=>e.$emit("create-block",n,s,r))},null,8,["available-blocks"])])]))}},Ny=Ht(r4,[["__scopeId","data-v-623999b6"]]),a4={class:"assembly-scene"},o4={key:0,class:"assembly-scene__sidebar"},l4={key:0,class:"assembly-scene__mobile-toolbar"},c4={class:"completion-content"},u4={class:"completion-message"},d4={class:"reward-info"},h4={class:"completion-actions"},f4={__name:"Assembly",setup(i){const e=es(),{t}=wn(),n=ze(null),s=ze(null),r=ze(null),a=ze(!1),o=ze(null),l=ze(null),c=ze(window.innerWidth<=768),u=tt(()=>e.state.sets.currentSet),d=tt(()=>e.getters["inventory/inventoryArray"]),h=tt(()=>s.value?s.value.isComplete():!1),f=tt(()=>!d.value||d.value.length===0?[]:d.value.filter(x=>x&&x.count>0)),p=ya(()=>{c.value=window.innerWidth<=768},200),m=()=>{e.dispatch("sets/stopBuilding"),e.commit("sets/SET_CURRENT_SET",null),e.dispatch("navigateToScene","set-selection")},_=(x,y,g)=>{var A,C;if(!s.value||!x)return;x.userData.type=x.userData.type||x.userData.blockType,x.userData.color=x.userData.color||x.userData.blockColor;const b=(((C=(A=s.value)==null?void 0:A.renderer)==null?void 0:C.domElement)||l.value).getBoundingClientRect(),T=y-b.left,E=g-b.top,S={x:T/b.width*2-1,y:-(E/b.height*2)+1};let M=null;if(s.value.dragController){s.value.dragController.mouse.set(S.x,S.y),s.value.dragController.raycaster.setFromCamera(s.value.dragController.mouse,s.value.dragController.camera);const I=s.value.ghostBlock?s.value.ghostBlock.position.y:.5,H=new xs(new fe(0,1,0),-I),W=new fe;if(s.value.dragController.raycaster.ray.intersectPlane(H,W),W&&W.y!==void 0)if(M=W.clone(),s.value.ghostBlock)M.y=s.value.ghostBlock.position.y;else{const z=s.value.dragController.threeScene.children.filter(O=>O.userData.isGround||O.userData.isBasePlate),q=s.value.dragController.raycaster.intersectObjects(z,!0);q.length>0?M.y=Math.max(q[0].point.y+.5,.5):M.y=I}else M=new fe(0,I,0)}else M=new fe(0,.5,0);s.value.addBlockForDrag(x,M),o.value=x,s.value.dragController&&s.value.dragController.startDraggingFromPalette(x)};Wn(u,x=>{x&&s.value&&s.value.loadSet(x,d.value)}),Wn(h,x=>{x&&u.value&&(e.dispatch("player/completeSet",{id:u.value.id,reward:u.value.reward||50}),e.dispatch("player/trackEvent",{event:"set_completed",data:{setId:u.value.id,pieces:u.value.blocks.length}}),r.value&&r.value.addToast({type:"success",message:t("assembly.setCompleted"),duration:3e3}))});const v=x=>{if(!x||!x.userData)return;const y=x.userData.type,g=x.userData.color,w=x.userData.specialType||null;if(y&&g){const T=d.value.find(E=>{const S=E.type,M=E.specialType||null,A=E.color;let C=!1;return w&&M?C=M===w:!w&&!M&&(C=S===y),C&&A===g&&E.count>0});T&&e.dispatch("inventory/removeBlock",{type:T.type,color:T.color,specialType:T.specialType||null,count:1})}o.value=null,e.dispatch("player/trackEvent",{event:"block_placed",data:{type:y,color:g}}),r.value&&r.value.addToast({type:"success",message:t("assembly.blockPlaced"),duration:2e3})};return Wn(()=>{var x,y;return[(x=s.value)==null?void 0:x.lastPlacedBlock,(y=s.value)==null?void 0:y.placementCount]},([x,y],[g,w])=>{if(x&&x!==g){const b=x.userData.type,T=x.userData.color,E=x.userData.specialType||null;if(b&&T){const M=d.value.find(A=>{const C=A.type,I=A.specialType||null,H=A.color;let W=!1;return E&&I?W=I===E:!E&&!I&&(W=C===b),W&&H===T&&A.count>0});M&&e.dispatch("inventory/removeBlock",{type:M.type,color:M.color,specialType:M.specialType||null,count:1})}o.value=null,e.dispatch("player/trackEvent",{event:"block_placed",data:{type:b,color:T}}),r.value&&r.value.addToast({type:"success",message:t("assembly.blockPlaced"),duration:2e3})}}),In(()=>{if(!u.value){e.dispatch("navigateToScene","set-selection");return}if(n.value)try{s.value=new qV(n.value),s.value.containerElement=l.value,s.value.onComplete=()=>{},s.value.onBlockPlaced=v,s.value.loadSet(u.value,d.value)}catch(x){console.error("Failed to initialize assembly scene:",x),r.value&&r.value.addToast({type:"error",message:t("common.error"),duration:4e3})}window.addEventListener("resize",p)}),Ds(()=>{window.removeEventListener("resize",p),s.value&&s.value.dispose()}),(x,y)=>(oe(),ge("div",a4,[c.value?Ve("",!0):(oe(),ge("div",o4,[we(Ny,{"available-blocks":f.value,onCreateBlock:_},null,8,["available-blocks"])])),B("div",{ref_key:"threeContainer",ref:l,class:"assembly-scene__canvas"},[B("div",{ref_key:"sceneContainer",ref:n,class:"assembly-scene__canvas-inner"},null,512),c.value?(oe(),ge("div",l4,[we(wt,{variant:"ghost",size:"md",onClick:y[0]||(y[0]=g=>a.value=!0),class:"mobile-toolbar__btn"},{"icon-left":Le(()=>[...y[2]||(y[2]=[Oe("",-1)])]),default:Le(()=>[Oe(" "+se(x.$t("assembly.inventory")),1)]),_:1})])):Ve("",!0)],512),c.value?(oe(),jt(Pr,{key:1,"model-value":a.value,title:x.$t("assembly.inventory"),size:"lg",position:"bottom","onUpdate:modelValue":y[1]||(y[1]=g=>a.value=g)},{default:Le(()=>[we(Ny,{"available-blocks":f.value,onCreateBlock:_},null,8,["available-blocks"])]),_:1},8,["model-value","title"])):Ve("",!0),u.value?(oe(),jt(Pr,{key:2,"model-value":h.value,title:x.$t("assembly.assemblyComplete"),size:"md",position:"center","close-on-overlay":!1,"close-on-esc":!1},{footer:Le(()=>[B("div",h4,[we(wt,{variant:"primary",onClick:m},{default:Le(()=>[Oe(se(x.$t("assembly.changeSet")),1)]),_:1})])]),default:Le(()=>[B("div",c4,[y[4]||(y[4]=B("div",{class:"completion-icon"},"",-1)),B("p",u4,se(x.$t("assembly.congratulations"))+" "+se(u.value.name)+"! ",1),B("div",d4,[we(_n,{variant:"warning",size:"lg"},{default:Le(()=>{var g;return[y[3]||(y[3]=B("span",{class:"reward-icon"},"",-1)),Oe(" +"+se(((g=u.value)==null?void 0:g.reward)||50)+" "+se(x.$t("assembly.coinsEarned")),1)]}),_:1})])])]),_:1},8,["model-value","title"])):Ve("",!0),we(ga,{position:"top-center",ref_key:"toastContainer",ref:r},null,512)]))}},p4=Ht(f4,[["__scopeId","data-v-9751f81c"]]);let m4=class{constructor(e){this.container=e,this.scene=null,this.camera=null,this.renderer=null,this.minifigure=null,this.minifigureInstance=null,this.platform=null,this.animationId=null,this.lastTime=0,this.keys={w:!1,a:!1,s:!1,d:!1,space:!1,shift:!1},this.velocity=new fe,this.position=new fe(0,0,0),this.rotation=0,this.currentRotation=0,this.rotationSpeed=.15,this.speed=4,this.runSpeed=7,this.jumpForce=5,this.isGrounded=!0,this.cameraHeight=6,this.cameraDistance=4,this.cameraFollowSpeed=.08,this.cameraPositionLerp=.6,this.cameraGoal=null,this.cameraFollowPoint=null,this.cameraTempPos=new fe,this.cameraLerpPos=new fe,this.init()}init(){this.scene=new Qs,this.scene.background=new Mt(11591910),this.camera=new An(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.renderer=new er({antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),la(this.renderer),this.container.appendChild(this.renderer.domElement),this.setupLighting(),this.createPlatform(),this.createMinifigure().then(()=>{this.setupCameraFollowing(),this.updateCamera(),this.lastTime=performance.now()/1e3,this.animate()}).catch(e=>{console.error("Failed to create minifigure:",e),this.setupCameraFollowing(),this.updateCamera(),this.lastTime=performance.now()/1e3,this.animate()}),this.setupKeyboardControls(),this.onWindowResizeThrottled=ya(()=>this.onWindowResize(),200),window.addEventListener("resize",this.onWindowResizeThrottled)}setupLighting(){Fc(this.scene),Uc(this.scene),zc(this.scene)}createPlatform(){const e=El.create("gray",!1);e.position.set(0,0,0),e.receiveShadow=!0,this.scene.add(e),this.platform=e}async createMinifigure(){this.minifigure=new ao("red",!1);const e=await this.minifigure.createBrick();e.position.set(0,1.2,0),e.castShadow=!0,this.scene.add(e),this.minifigureInstance=e;try{await this.minifigure.applySkin("/images/skins/steve.png")}catch(t){console.error("Failed to load skin:",t)}e.userData.minifigureInstance=this.minifigure,this.position.set(0,1.2,0)}setupCameraFollowing(){this.cameraGoal=new Rn,this.scene.add(this.cameraGoal),this.cameraFollowPoint=new Rn,this.cameraFollowPoint.position.set(0,this.cameraHeight,-this.cameraDistance),this.minifigureInstance&&this.minifigureInstance.add(this.cameraFollowPoint),this.cameraGoal.add(this.camera),this.camera.position.set(0,0,0),this.minifigureInstance&&this.minifigureInstance.getWorldPosition(this.cameraLerpPos)}updateCamera(){if(!this.camera||!this.minifigureInstance||!this.cameraGoal||!this.cameraFollowPoint)return;this.minifigureInstance.children.includes(this.cameraFollowPoint)||(this.cameraFollowPoint.position.set(0,this.cameraHeight,-this.cameraDistance),this.minifigureInstance.add(this.cameraFollowPoint));const e=new fe;this.minifigureInstance.getWorldPosition(e),this.cameraLerpPos.lerp(e,this.cameraPositionLerp),this.cameraFollowPoint.getWorldPosition(this.cameraTempPos),new fe().subVectors(this.cameraTempPos,this.cameraLerpPos).normalize(),this.cameraLerpPos.distanceTo(this.cameraTempPos),this.cameraDistance*.1;const n=new fe;n.copy(this.cameraTempPos),this.cameraGoal.position.lerp(n,this.cameraFollowSpeed),this.camera.lookAt(this.cameraLerpPos)}setupKeyboardControls(){this.handleKeyDown=e=>{const t=e.code,n=e.key.toLowerCase();let s=!1,r=null;t==="KeyW"||n==="w"?(s=!0,r="w"):t==="KeyA"||n==="a"?(s=!0,r="a"):t==="KeyS"||n==="s"?(s=!0,r="s"):t==="KeyD"||n==="d"?(s=!0,r="d"):t==="Space"||n===" "?(s=!0,r="space"):t==="ShiftLeft"||t==="ShiftRight"||n==="shift"?(s=!0,r="shift"):(t==="KeyE"||n==="e")&&(s=!0,r="e"),s&&(e.stopPropagation(),e.preventDefault(),r==="w"?this.keys.w=!0:r==="a"?this.keys.a=!0:r==="s"?this.keys.s=!0:r==="d"?this.keys.d=!0:r==="space"?this.keys.space=!0:r==="shift"&&(this.keys.shift=!0))},this.handleKeyUp=e=>{const t=e.code,n=e.key.toLowerCase();let s=!1,r=null;t==="KeyW"||n==="w"?(s=!0,r="w"):t==="KeyA"||n==="a"?(s=!0,r="a"):t==="KeyS"||n==="s"?(s=!0,r="s"):t==="KeyD"||n==="d"?(s=!0,r="d"):t==="Space"||n===" "?(s=!0,r="space"):(t==="ShiftLeft"||t==="ShiftRight"||n==="shift")&&(s=!0,r="shift"),s&&(e.stopPropagation(),r==="w"?this.keys.w=!1:r==="a"?this.keys.a=!1:r==="s"?this.keys.s=!1:r==="d"?this.keys.d=!1:r==="space"?this.keys.space=!1:r==="shift"&&(this.keys.shift=!1))},window.addEventListener("keydown",this.handleKeyDown,!0),window.addEventListener("keyup",this.handleKeyUp,!0),document.addEventListener("keydown",this.handleKeyDown,!0),document.addEventListener("keyup",this.handleKeyUp,!0)}updateMovement(e){const t=this.keys.shift?this.runSpeed:this.speed,n=3.5;this.keys.a&&(this.keys.s?this.currentRotation-=n*e:this.currentRotation+=n*e),this.keys.d&&(this.keys.s?this.currentRotation+=n*e:this.currentRotation-=n*e),this.minifigureInstance&&(this.minifigureInstance.rotation.y=this.currentRotation);const s=new fe;this.keys.w&&(s.x=Math.sin(this.currentRotation),s.z=Math.cos(this.currentRotation)),this.keys.s&&(s.x=-Math.sin(this.currentRotation),s.z=-Math.cos(this.currentRotation)),s.length()>0?(s.normalize(),s.multiplyScalar(t*e),this.position.add(s),this.minifigure&&(this.minifigure.walkDirection=-1),this.minifigure&&!this.minifigure.isWalking&&this.minifigure.startWalking()):this.minifigure&&this.minifigure.isWalking&&this.minifigure.stopWalking(),this.keys.space&&this.isGrounded&&(this.velocity.y=this.jumpForce,this.isGrounded=!1),this.velocity.y-=9.8*e,this.position.y+=this.velocity.y*e;const r=1.56;this.position.y<r&&(this.position.y=r,this.velocity.y=0,this.isGrounded=!0),this.minifigureInstance&&this.minifigureInstance.position.copy(this.position)}animate(){this.animationId=requestAnimationFrame(()=>this.animate());const e=performance.now()/1e3,t=e-this.lastTime;this.lastTime=e,this.updateMovement(t),this.minifigure&&this.minifigureInstance&&this.minifigure.updateAnimation(t),this.updateCamera(),this.renderer.render(this.scene,this.camera)}onWindowResize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}dispose(){this.animationId&&cancelAnimationFrame(this.animationId),this.onWindowResizeThrottled&&window.removeEventListener("resize",this.onWindowResizeThrottled),this.handleKeyDown&&(window.removeEventListener("keydown",this.handleKeyDown,!0),document.removeEventListener("keydown",this.handleKeyDown,!0)),this.handleKeyUp&&(window.removeEventListener("keyup",this.handleKeyUp,!0),document.removeEventListener("keyup",this.handleKeyUp,!0)),this.handleMouseMove&&document.removeEventListener("mousemove",this.handleMouseMove),this.handlePointerLockKey&&document.removeEventListener("keydown",this.handlePointerLockKey),this.isMouseLocked&&document.exitPointerLock(),this.renderer&&this.renderer.dispose(),this.container&&this.renderer&&this.container.removeChild(this.renderer.domElement)}};const _4={class:"character-scene"},v4={class:"character-controls"},g4={class:"character-stats"},y4={class:"stat-item"},x4={class:"stat-value"},b4={class:"stat-item"},w4={class:"stat-value"},S4={class:"stat-item"},E4={class:"stat-value"},M4={class:"world-preview"},T4={__name:"Character",setup(i){const e=ze(1),t=ze(0),n=ze(100),s=ze(null);let r=null;const a=()=>{},o=()=>{},l=()=>{};return In(()=>{s.value&&(r=new m4(s.value))}),Ds(()=>{r&&(r.dispose(),r=null)}),(c,u)=>(oe(),ge("div",_4,[u[5]||(u[5]=B("div",{class:"scene-header"},[B("h2",null," Character Adventure"),B("p",null,"Run around and explore your LEGO world!")],-1)),B("div",v4,[u[4]||(u[4]=EE('<div class="control-panel" data-v-9ac39abe><h3 data-v-9ac39abe>Controls</h3><div class="control-grid" data-v-9ac39abe><div class="control-item" data-v-9ac39abe><span class="key" data-v-9ac39abe>WASD</span><span class="action" data-v-9ac39abe>Move</span></div><div class="control-item" data-v-9ac39abe><span class="key" data-v-9ac39abe>Space</span><span class="action" data-v-9ac39abe>Jump</span></div><div class="control-item" data-v-9ac39abe><span class="key" data-v-9ac39abe>Shift</span><span class="action" data-v-9ac39abe>Run</span></div><div class="control-item" data-v-9ac39abe><span class="key" data-v-9ac39abe>E</span><span class="action" data-v-9ac39abe>Interact</span></div></div></div>',1)),B("div",g4,[u[3]||(u[3]=B("h3",null,"Character Stats",-1)),B("div",y4,[u[0]||(u[0]=B("span",{class:"stat-label"},"Level:",-1)),B("span",x4,se(e.value),1)]),B("div",b4,[u[1]||(u[1]=B("span",{class:"stat-label"},"XP:",-1)),B("span",w4,se(t.value),1)]),B("div",S4,[u[2]||(u[2]=B("span",{class:"stat-label"},"Coins:",-1)),B("span",E4," "+se(n.value),1)])])]),B("div",M4,[B("div",{class:"preview-area",ref_key:"sceneContainer",ref:s},null,512)]),B("div",{class:"action-buttons"},[B("button",{onClick:a,class:"action-btn primary"},"  Start Adventure "),B("button",{onClick:o,class:"action-btn secondary"},"  Customize "),B("button",{onClick:l,class:"action-btn secondary"},"  Inventory ")])]))}},A4=Ht(T4,[["__scopeId","data-v-9ac39abe"]]),C4={class:"collections"},P4={class:"collections__content"},R4={class:"collections__header"},L4={class:"collections__title"},I4={key:0,class:"collections__subtitle"},D4={key:0,class:"collections__loading"},k4={key:1,class:"collections__empty"},B4={class:"empty-state"},O4={key:2,class:"collections__grid"},N4={class:"collection-card__image"},F4={class:"collection-card__date"},U4={class:"collection-card__info"},z4={class:"collection-card__name"},V4={class:"collection-card__stats"},G4={class:"collection-card__actions"},H4={key:0,class:"delete-modal__content"},W4={__name:"Collections",setup(i){const{t:e}=wn(),t=es(),n=ze(!0),s=ze(null),r=ze(!1),a=ze(null),o=tt(()=>t.getters["collections/allCollections"]);In(async()=>{try{await t.dispatch("collections/loadCollections")}catch(p){console.error("Failed to load collections:",p)}finally{n.value=!1}});const l=p=>{var m;return{id:p.id,name:p.name,blocks:p.buildData.blocks||[],pieces:((m=p.buildData.blocks)==null?void 0:m.length)||0}},c=p=>p?new Date(p).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"",u=p=>{sessionStorage.setItem("loadCollectionId",p.id),t.dispatch("navigateToScene","builder")},d=async p=>{try{await navigator.clipboard.writeText(p.encodedCode),s.value&&s.value.addToast({type:"success",title:e("collections.codeCopied"),message:e("collections.codeCopied"),duration:2e3})}catch(m){console.error("Failed to copy code:",m),s.value&&s.value.addToast({type:"error",title:e("common.error"),message:"Failed to copy code",duration:3e3})}},h=p=>{a.value=p,r.value=!0},f=async()=>{if(!a.value)return;const p=a.value.name,m=a.value.id;try{await t.dispatch("collections/deleteCollection",m),r.value=!1,a.value=null,s.value&&s.value.addToast({type:"success",title:e("collections.setDeleted"),message:e("collections.setDeletedMessage",{name:p}),duration:3e3})}catch(_){console.error("Failed to delete collection:",_),s.value&&s.value.addToast({type:"error",title:e("common.error"),message:"Failed to delete collection",duration:3e3})}};return(p,m)=>(oe(),ge("div",C4,[B("div",P4,[B("div",R4,[B("h1",L4,se(p.$t("collections.title")),1),o.value.length===0?(oe(),ge("p",I4,se(p.$t("collections.emptyCollectionsMessage")),1)):Ve("",!0)]),n.value?(oe(),ge("div",D4,[we(ca,{variant:"spinner",size:"lg",text:p.$t("common.loading"),overlay:""},null,8,["text"])])):o.value.length===0?(oe(),ge("div",k4,[B("div",B4,[m[3]||(m[3]=B("div",{class:"empty-state__icon"},"",-1)),B("h3",null,se(p.$t("collections.noCollections")),1),B("p",null,se(p.$t("collections.emptyCollectionsMessage")),1)])])):(oe(),ge("div",O4,[(oe(!0),ge(At,null,Zt(o.value,_=>(oe(),ge("div",{key:_.id,class:"collection-card"},[B("div",N4,[we(oo,{set:l(_)},{extra:Le(()=>[B("div",F4,se(c(_.createdAt)),1)]),_:2},1032,["set"])]),B("div",U4,[B("h3",z4,se(_.name),1),B("div",V4,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>{var v;return[Oe("  "+se(((v=_.buildData.blocks)==null?void 0:v.length)||0)+" "+se(p.$t("assembly.pieces")),1)]}),_:2},1024)])]),B("div",G4,[we(wt,{variant:"primary",size:"sm","full-width":"",onClick:v=>u(_)},{default:Le(()=>[Oe("  "+se(p.$t("collections.edit")),1)]),_:1},8,["onClick"]),we(wt,{variant:"secondary",size:"sm","full-width":"",onClick:v=>d(_)},{default:Le(()=>[Oe("  "+se(p.$t("collections.copyCode")),1)]),_:1},8,["onClick"]),we(wt,{variant:"danger",size:"sm","full-width":"",onClick:v=>h(_)},{default:Le(()=>[Oe("  "+se(p.$t("collections.delete")),1)]),_:1},8,["onClick"])])]))),128))]))]),we(ga,{position:"top-center",ref_key:"toastContainer",ref:s},null,512),we(Pr,{modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=_=>r.value=_),title:p.$t("collections.confirmDelete"),size:"sm",onClose:m[2]||(m[2]=_=>r.value=!1)},{footer:Le(()=>[we(wt,{variant:"secondary",size:"md",onClick:m[0]||(m[0]=_=>r.value=!1)},{default:Le(()=>[Oe(se(p.$t("collections.cancel")),1)]),_:1}),we(wt,{variant:"danger",size:"md",onClick:f},{default:Le(()=>[Oe(se(p.$t("collections.delete")),1)]),_:1})]),default:Le(()=>[a.value?(oe(),ge("div",H4,[B("p",null,se(p.$t("collections.confirmDeleteMessage",{name:a.value.name})),1)])):Ve("",!0)]),_:1},8,["modelValue","title"])]))}},$4=Ht(W4,[["__scopeId","data-v-9b9ed34d"]]);class Uw{constructor(e,t,n=null){this.renderer=e,this.container=t,this.scene=n,this.statsElement=null,this.frameCount=0,this.lastTime=performance.now(),this.fps=0,this.lastFpsUpdate=performance.now(),this.createStatsDisplay()}setScene(e){this.scene=e}createStatsDisplay(){this.statsElement=document.createElement("div"),this.statsElement.style.cssText=`
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      border-radius: 4px;
      z-index: 1000;
      min-width: 200px;
      line-height: 1.6;
    `,this.container.appendChild(this.statsElement)}update(){var l;this.frameCount++;const e=performance.now(),t=e-this.lastTime;e-this.lastFpsUpdate>=1e3&&(this.fps=Math.round(this.frameCount*1e3/(e-this.lastFpsUpdate)),this.frameCount=0,this.lastFpsUpdate=e);const n=this.renderer.info;let s=0,r=0,a=0;this.scene&&this.scene.traverse(c=>{s++,c.isMesh&&r++,c.geometry,c.material&&a++});const o=`
      <div style="font-weight: bold; margin-bottom: 5px;">Renderer Stats</div>
      <div>FPS: <span style="color: ${this.fps>=55?"#0f0":this.fps>=30?"#ff0":"#f00"}">${this.fps}</span></div>
      <div>Frame Time: ${t.toFixed(2)}ms</div>
      <div style="margin-top: 8px; border-top: 1px solid #555; padding-top: 5px;">
        <div>Draw Calls: <span style="color: #0ff">${n.render.calls}</span></div>
        <div>Triangles: <span style="color: #0ff">${n.render.triangles.toLocaleString()}</span></div>
        <div>Points: <span style="color: #0ff">${n.render.points}</span></div>
        <div>Lines: <span style="color: #0ff">${n.render.lines}</span></div>
      </div>
      <div style="margin-top: 8px; border-top: 1px solid #555; padding-top: 5px;">
        <div>Geometries: <span style="color: #ff0">${n.memory.geometries}</span></div>
        <div>Textures: <span style="color: #ff0">${n.memory.textures}</span></div>
        <div>Programs: <span style="color: #ff0">${((l=n.programs)==null?void 0:l.length)||0}</span></div>
      </div>
      <div style="margin-top: 8px; border-top: 1px solid #555; padding-top: 5px;">
        <div>Total Objects: <span style="color: #f0f">${s}</span></div>
        <div>Meshes: <span style="color: #f0f">${r}</span></div>
        <div>Materials: <span style="color: #f0f">${a}</span></div>
      </div>
    `;this.statsElement.innerHTML=o,this.lastTime=e}dispose(){this.statsElement&&this.statsElement.parentNode&&this.statsElement.parentNode.removeChild(this.statsElement)}}class y_ extends ho{constructor(e="green"){super(256,256,e,!1),this.blockHeight=Mr,this.blockType="plate"}static create(e="green",t=!1,n=!0){return new y_(e).createBrick(n)}}let X4=class{constructor(e){this.container=e,this.scene=new Qs,this.camera=null,this.renderer=null,this.controls=null,this.animationId=null,this.dragController=null,this.snapController=new Ym,this.selectionManager=new jm,this.placementManager=new Km(this.scene),this.visualizer=new nh(this.scene),this.rendererStats=null,this.placedSets=new Map,this.platformSize=256,this.basePlate=null,this.onSetSelected=null,this.onSetMoved=null,this.onSetRemoved=null,this.loadingPromise=new Promise(t=>{this.resolveLoading=t}),this.init()}init(){this.setupRenderer(),this.setupCamera(),this.setupLights(),this.setupControls(),this.setupInteraction(),this.setupGrid(),this.updateGraphics(),this.animate()}setupRenderer(){this.renderer=new er({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),la(this.renderer),this.container.appendChild(this.renderer.domElement),this.rendererStats=new Uw(this.renderer,this.container,this.scene)}setupCamera(){this.camera=new An(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(15,15,15),this.camera.lookAt(0,0,0)}setupLights(){Fc(this.scene),Uc(this.scene),zc(this.scene)}setupControls(){this.controls=new Vc(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enableZoom=!0,this.controls.enablePan=!0,this.controls.maxPolarAngle=Math.PI/2;const e=qm(()=>{this.updateShadowCameras()},1e3);this.controls.addEventListener("change",e)}setupInteraction(){this.dragController=new th(this.camera,this.scene,this.renderer),this.dragController.legoScene=this,this.dragController.selectionManager=this.selectionManager;const e=this.dragController.stopDragging.bind(this.dragController);this.dragController.stopDragging=async()=>{const s=this.dragController.draggedObject;if(await e(),s&&s.userData.isSet){const r=s.userData.setId,a=this.placedSets.get(r);a&&(a.position={x:s.position.x,y:s.position.y,z:s.position.z},a.rotation=s.rotation.y,this.onSetMoved&&this.onSetMoved(r,a.position,a.rotation))}};const t=this.selectionManager.selectBrick.bind(this.selectionManager);this.selectionManager.selectBrick=(s,r=[])=>s&&s.userData.isSet?(this.selectionManager.clearSelection(),this.selectionManager.selectedBrick=s,this.selectionManager.onSelectionChange&&this.selectionManager.onSelectionChange(s),!0):t(s,r);const n=this.selectionManager.onSelectionChange;this.selectionManager.onSelectionChange=s=>{if(n&&n(s),s&&s.userData.isSet){const r=s.userData.setId;this.onSetSelected&&this.onSetSelected(r)}else s||this.onSetSelected&&this.onSetSelected(null)},document.addEventListener("keydown",this.onKeyDown.bind(this))}updateShadowCameras(){Wm()(this.scene)}setupGrid(){this.createPlatform()}createPlatform(){if(this.basePlate){this.scene.remove(this.basePlate);const o=this.placementManager.blocks.indexOf(this.basePlate);o>-1&&this.placementManager.blocks.splice(o,1)}const e=y_.create("green");e.position.set(0,-.32/2,0),e.userData.isBrick=!0,e.userData.isBasePlate=!0,e.userData.isImmobile=!0,e.userData.doNotModify=!0,e.userData.platformSize=this.platformSize,e.castShadow=!1,e.receiveShadow=!0,e.traverse(o=>{o.isMesh&&(o.castShadow=!1,o.receiveShadow=!0)}),this.scene.add(e),this.basePlate=e,this.placementManager.blocks.push(e),this.placementManager.setPlatformSize(this.platformSize);const t=this.scene.children.find(o=>o.userData.isGround);t&&this.scene.remove(t);const n=this.platformSize*.8*2,s=new va(n,n),r=new xl({color:9498256,transparent:!0,opacity:.1}),a=new yn(s,r);a.rotation.x=-Math.PI/2,a.position.y=-1,a.userData.isGround=!0,this.scene.add(a)}onKeyDown(e){const t=this.getSelectedSet();if(t)switch(e.key.toLowerCase()){case"r":t.group.rotation.y+=Math.PI/2,t.rotation=t.group.rotation.y,this.onSetMoved&&this.onSetMoved(t.id,t.position,t.rotation);break;case"delete":case"backspace":this.removeSet(t.id);break}}getSelectedSet(){const e=this.selectionManager.getSelectedBrick();if(!e)return null;for(const[t,n]of this.placedSets.entries()){if(n.group===e)return{id:t,...n};let s=e;for(;s.parent;){if(s.parent===n.group)return{id:t,...n};s=s.parent}}return null}async placeSet(e,t,n,s=0){try{const r=new Zn;r.userData.isSet=!0;const a=this.placementManager.findPlacementHeight(r,n),o=a!==null?a:0,l=new Zn;l.position.set(n.x,o,n.z),l.rotation.y=s,l.userData.isSet=!0,l.userData.isBrick=!0,l.userData.setId=e,l.userData.isImmobile=!1,l.userData.isBasePlate=!1;let c;if(t.buildData)c=t.buildData;else if(t.blocks)c={blocks:t.blocks,platformSize:t.platformSize||20};else throw new Error("Invalid set data");if(!c.blocks||!Array.isArray(c.blocks))throw new Error("Invalid build data: missing blocks array");const u=[],d={scene:l,bricks:u,placementManager:{getAllBlocks:()=>u,clear:()=>{},blocks:u},removeBrick:m=>{const _=u.indexOf(m);_>-1&&u.splice(_,1),l.remove(m)},addBrick:(m,_=!1)=>{m.userData.isBrick=!0,m.castShadow=!0,m.receiveShadow=!0,m.traverse(v=>{v.isMesh&&(v.castShadow=!0,v.receiveShadow=!0)}),l.add(m),u.push(m)}},h=new gd(d),f=5,p=16;this.scene.add(l);for(let m=0;m<c.blocks.length;m+=f){const _=c.blocks.slice(m,m+f);for(const v of _)await h.createBlockFromData(v);m+f<c.blocks.length&&await new Promise(v=>setTimeout(v,p))}l.traverse(m=>{m.isMesh&&m.userData.isBrick&&!m.userData.isBasePlate&&(this.placementManager.blocks.includes(m)||this.placementManager.blocks.push(m))}),this.placementManager.blocks.includes(l)||this.placementManager.blocks.push(l),this.placedSets.set(e,{id:e,group:l,setId:t.id||null,collectionId:t.collectionId||null,position:{x:n.x,y:o,z:n.z},rotation:s,buildData:c})}catch(r){throw console.error("Failed to place set:",r),r}}removeSet(e){const t=this.placedSets.get(e);t&&(t.group.traverse(n=>{if(n.isMesh&&this.placementManager.blocks.includes(n)){const s=this.placementManager.blocks.indexOf(n);s>-1&&this.placementManager.blocks.splice(s,1)}}),this.selectionManager.isSelected(t.group)&&this.selectionManager.clearSelection(),this.scene.remove(t.group),t.group.traverse(n=>{n.isMesh&&(n.geometry.dispose(),Array.isArray(n.material)?n.material.forEach(s=>s.dispose()):n.material.dispose())}),this.placedSets.delete(e),this.onSetRemoved&&this.onSetRemoved(e))}moveSet(e,t,n){const s=this.placedSets.get(e);s&&(s.group.position.set(t.x,t.y,t.z),s.group.rotation.y=n,s.position={...t},s.rotation=n)}async loadPlacedSets(e,t,n={}){const{async:s=!0,batchSize:r=3,batchDelay:a=50}=n;for(const l of this.placedSets.keys())this.removeSet(l);if(!s||e.length===0){for(const l of e){let c;l.buildData?c={id:l.setId||l.collectionId,setId:l.setId||null,collectionId:l.collectionId||null,buildData:l.buildData}:c=await t(l.setId,l.collectionId),c&&await this.placeSet(l.id,c,l.position,l.rotation)}return}const o=async l=>{try{let c;l.buildData?c={id:l.setId||l.collectionId,setId:l.setId||null,collectionId:l.collectionId||null,buildData:l.buildData}:c=await t(l.setId,l.collectionId),c&&await this.placeSet(l.id,c,l.position,l.rotation)}catch(c){console.error(`Failed to load set ${l.id}:`,c)}};for(let l=0;l<e.length;l+=r){const c=e.slice(l,l+r);await Promise.all(c.map(o)),l+r<e.length&&await new Promise(u=>setTimeout(u,a))}}animate(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.controls.update(),this.renderer.info.reset(),this.renderer.render(this.scene,this.camera),this.rendererStats&&this.rendererStats.update(),this.resolveLoading&&(this.resolveLoading(),this.resolveLoading=null)}resize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}updateGraphics(){la(this.renderer),$m(this.scene)}dispose(){this.animationId&&cancelAnimationFrame(this.animationId),document.removeEventListener("keydown",this.onKeyDown.bind(this));for(const e of this.placedSets.keys())this.removeSet(e);this.rendererStats&&this.rendererStats.dispose(),this.renderer.dispose(),this.controls.dispose()}};const q4={class:"set-builder"},Y4={class:"set-builder__sidebar"},j4={class:"set-builder-sidebar"},K4={class:"set-builder-sidebar__header"},Z4={class:"set-builder-sidebar__title"},J4={class:"set-builder-sidebar__content"},Q4={key:0,class:"set-builder-sidebar__section"},eG={class:"set-builder-sidebar__section-title"},tG={class:"set-builder-sidebar__sets"},nG=["onClick"],iG={class:"set-item__preview"},sG={class:"set-item__info"},rG={class:"set-item__name"},aG={class:"set-item__details"},oG={key:1,class:"set-builder-sidebar__section"},lG={class:"set-builder-sidebar__section-title"},cG={class:"set-builder-sidebar__sets"},uG=["onClick"],dG={class:"set-item__preview"},hG={class:"set-item__info"},fG={class:"set-item__name"},pG={class:"set-item__details"},mG={key:2,class:"set-builder-sidebar__empty"},_G={key:0,class:"set-builder__selection-info"},vG={class:"selection-info"},gG={class:"selection-info__title"},yG={class:"selection-info__details"},xG={class:"selection-info__detail"},bG={class:"selection-info__label"},wG={__name:"SetBuilder",setup(i){const{t:e}=wn(),t=es(),n=ze(null),s=ze(null),r=ze(!0),a=ze(!1),o=ze(null),l=ze(null);let c=null;const u=tt(()=>(t.getters["player/purchasedSets"],t.getters["sets/purchasedSets"])),d=tt(()=>t.getters["collections/allCollections"]),h=b=>{var T;return{id:b.id,name:b.name,blocks:b.buildData.blocks||[],platformSize:b.buildData.platformSize||20,pieces:((T=b.buildData.blocks)==null?void 0:T.length)||0}},f=b=>{l.value=b},p=()=>{t.dispatch("navigateToScene","mainMenu")},m=async()=>{if(!(!s.value||!c))try{const b=s.value.id;c.removeSet(b),await t.dispatch("setBuilder/removeSet",b),s.value=null,o.value&&o.value.addToast({type:"success",title:e("setBuilder.setRemoved"),message:e("setBuilder.setRemovedMessage"),duration:3e3})}catch(b){console.error("Failed to remove set:",b),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:b.message||e("setBuilder.setRemoveFailed"),duration:3e3})}},_=tt(()=>{if(!s.value)return"";const b=c==null?void 0:c.placedSets.get(s.value.id);if(!b)return"";if(b.setId){const T=u.value.find(E=>E.id===b.setId);return(T==null?void 0:T.name)||"Unknown Set"}else if(b.collectionId){const T=d.value.find(E=>E.id===b.collectionId);return(T==null?void 0:T.name)||"Unknown Collection"}return"Unknown"}),v=()=>{c&&(c.onSetSelected=b=>{b?s.value={id:b}:s.value=null},c.onSetMoved=async(b,T,E)=>{try{await t.dispatch("setBuilder/moveSet",{id:b,position:T,rotation:E})}catch(S){console.error("Failed to move set:",S)}},c.onSetRemoved=async b=>{try{await t.dispatch("setBuilder/removeSet",b),s.value&&s.value.id===b&&(s.value=null)}catch(T){console.error("Failed to remove set:",T)}})},x=async()=>{if(!c)return;const b=t.getters["setBuilder/allPlacedSets"],T=async(E,S)=>{if(E){const M=u.value.find(A=>A.id===E);if(M)return{id:M.id,blocks:M.blocks,platformSize:M.platformSize||20}}if(S){const M=d.value.find(A=>A.id===S);if(M)return{id:M.id,collectionId:M.id,buildData:M.buildData}}return null};await c.loadPlacedSets(b,T)},y=b=>{if(!c||!l.value)return;const T=n.value.getBoundingClientRect(),E=b.clientX-T.left,S=b.clientY-T.top;setTimeout(()=>{const M={x:E/T.width*2-1,y:-(S/T.height*2)+1},A=c.placementManager.raycaster;A.setFromCamera(M,c.camera);const C=Array.from(c.placedSets.values()).map(z=>z.group);if(A.intersectObjects(C,!0).length>0)return;const H=c.scene.children.filter(z=>z.userData.isGround),W=A.intersectObjects(H,!0);if(W.length>0){const z=W[0].point,q=c.placementManager.snapToGrid(z,1,1);g(q).catch(O=>{console.error("Failed to place set:",O)})}},0)},g=async b=>{if(!(!l.value||!c||a.value)){a.value=!0;try{let T;if(l.value.type==="purchased"){const A=u.value.find(C=>C.id===l.value.setId);if(!A)return;T={id:A.id,blocks:A.blocks,platformSize:A.platformSize||20}}else if(l.value.type==="collection"){const A=d.value.find(C=>C.id===l.value.collectionId);if(!A)return;T={id:A.id,collectionId:A.id,buildData:A.buildData}}if(!T)return;const E=`temp-${Date.now()}`;await c.placeSet(E,T,b,0);const S=c.placedSets.get(E);if(!S)throw new Error("Failed to place set");const M=await t.dispatch("setBuilder/placeSet",{setId:l.value.type==="purchased"?l.value.setId:null,collectionId:l.value.type==="collection"?l.value.collectionId:null,buildData:T.buildData||{blocks:T.blocks,platformSize:T.platformSize||20},position:S.position,rotation:S.rotation});c.removeSet(E),await c.placeSet(M.id,T,M.position,M.rotation),l.value=null,o.value&&o.value.addToast({type:"success",title:e("setBuilder.setPlaced"),message:e("setBuilder.setPlacedMessage"),duration:3e3})}catch(T){console.error("Failed to place set:",T),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:T.message||e("setBuilder.setPlaceFailed"),duration:3e3})}finally{a.value=!1}}};In(async()=>{n.value&&(c=new X4(n.value),await c.loadingPromise,v(),r.value=!1,t.dispatch("setBuilder/loadBuilderState").then(()=>{x()}),n.value.addEventListener("click",y),window.addEventListener("resize",w))}),Ds(()=>{c&&(n.value&&n.value.removeEventListener("click",y),c.dispose()),window.removeEventListener("resize",w)});const w=ya(()=>{c&&c.resize()},200);return(b,T)=>(oe(),ge("div",q4,[B("div",Y4,[B("div",j4,[B("div",K4,[B("h2",Z4,se(b.$t("setBuilder.title")),1),we(wt,{variant:"ghost",size:"sm",onClick:p},{default:Le(()=>[Oe("  "+se(b.$t("common.back")),1)]),_:1})]),B("div",J4,[u.value.length>0?(oe(),ge("div",Q4,[B("h3",eG,se(b.$t("setBuilder.purchasedSets")),1),B("div",tG,[(oe(!0),ge(At,null,Zt(u.value,E=>(oe(),ge("div",{key:E.id,class:"set-item",onClick:S=>f({setId:E.id,type:"purchased"})},[B("div",iG,[we(oo,{set:E},null,8,["set"])]),B("div",sG,[B("h4",rG,se(E.name),1),B("div",aG,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>{var S;return[Oe("  "+se(E.pieces||((S=E.blocks)==null?void 0:S.length)||0),1)]}),_:2},1024),we(_n,{variant:"info",size:"sm"},{default:Le(()=>[Oe("  "+se(b.$t("setBuilder.platformSize"))+": "+se(E.platformSize||20),1)]),_:2},1024)])])],8,nG))),128))])])):Ve("",!0),d.value.length>0?(oe(),ge("div",oG,[B("h3",lG,se(b.$t("setBuilder.collections")),1),B("div",cG,[(oe(!0),ge(At,null,Zt(d.value,E=>(oe(),ge("div",{key:E.id,class:"set-item",onClick:S=>f({collectionId:E.id,type:"collection"})},[B("div",dG,[we(oo,{set:h(E)},null,8,["set"])]),B("div",hG,[B("h4",fG,se(E.name),1),B("div",pG,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>{var S,M;return[Oe("  "+se(((M=(S=E.buildData)==null?void 0:S.blocks)==null?void 0:M.length)||0),1)]}),_:2},1024),we(_n,{variant:"info",size:"sm"},{default:Le(()=>{var S;return[Oe("  "+se(b.$t("setBuilder.platformSize"))+": "+se(((S=E.buildData)==null?void 0:S.platformSize)||20),1)]}),_:2},1024)])])],8,uG))),128))])])):Ve("",!0),u.value.length===0&&d.value.length===0?(oe(),ge("div",mG,[B("p",null,se(b.$t("setBuilder.noSetsAvailable")),1)])):Ve("",!0)])])]),B("div",{ref_key:"threeContainer",ref:n,class:"set-builder__canvas"},[s.value?(oe(),ge("div",_G,[B("div",vG,[B("h4",gG,se(b.$t("setBuilder.selectedSet")),1),B("div",yG,[B("p",xG,[B("span",bG,se(b.$t("setBuilder.setName"))+":",1),Oe(" "+se(_.value),1)]),we(wt,{variant:"danger",size:"sm",onClick:m,class:"selection-info__button"},{default:Le(()=>[Oe("  "+se(b.$t("setBuilder.delete")),1)]),_:1})])])])):Ve("",!0),r.value?(oe(),jt(ca,{key:1,variant:"spinner",size:"lg",text:b.$t("common.loading"),overlay:""},null,8,["text"])):Ve("",!0),a.value?(oe(),jt(ca,{key:2,variant:"spinner",size:"lg",text:" ...",overlay:""})):Ve("",!0)],512),we(ga,{position:"top-center",ref_key:"toastContainer",ref:o},null,512)]))}},SG=Ht(wG,[["__scopeId","data-v-912aed85"]]);class EG extends Km{}let MG=class{constructor(e){this.container=e,this.scene=new Qs,this.camera=null,this.renderer=null,this.controls=null,this.animationId=null,this.dragController=null,this.snapController=new Ym,this.selectionManager=new jm,this.placementManager=new EG(this.scene),this.visualizer=new nh(this.scene),this.rendererStats=null,this.saveLoadManager=new gd(this),this.bricks=[],this.placedSets=new Map,this.platformSize=16,this.basePlate=null,this.onSetSelected=null,this.onSetMoved=null,this.onSetRemoved=null,this.loadingPromise=new Promise(t=>{this.resolveLoading=t}),this.init()}init(){this.setupRenderer(),this.setupCamera(),this.setupLights(),this.setupControls(),this.setupInteraction(),this.setupGrid(),this.updateGraphics(),this.animate()}setupRenderer(){this.renderer=new er({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),la(this.renderer),this.container.appendChild(this.renderer.domElement),this.rendererStats=new Uw(this.renderer,this.container,this.scene)}setupCamera(){this.camera=new An(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.camera.position.set(15,15,15),this.camera.lookAt(0,0,0)}setupLights(){Fc(this.scene),Uc(this.scene),zc(this.scene)}setupControls(){this.controls=new Vc(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enableZoom=!0,this.controls.enablePan=!0,this.controls.maxPolarAngle=Math.PI/2;const e=qm(()=>{this.updateShadowCameras()},1e3);this.controls.addEventListener("change",e)}setupInteraction(){this.dragController=new th(this.camera,this.scene,this.renderer),this.dragController.legoScene=this,this.dragController.selectionManager=this.selectionManager;const e=this.dragController.stopDragging.bind(this.dragController);this.dragController.stopDragging=async()=>{const s=this.dragController.draggedObject;if(await e(),s&&s.userData.isSet){const r=s.userData.setId,a=this.placedSets.get(r);a&&(a.position={x:s.position.x,y:s.position.y,z:s.position.z},a.rotation=s.rotation.y,this.onSetMoved&&this.onSetMoved(r,a.position,a.rotation))}};const t=this.selectionManager.selectBrick.bind(this.selectionManager);this.selectionManager.selectBrick=(s,r=[])=>s&&s.userData.isSet?(this.selectionManager.clearSelection(),this.selectionManager.selectedBrick=s,this.selectionManager.onSelectionChange&&this.selectionManager.onSelectionChange(s),!0):t(s,r);const n=this.selectionManager.onSelectionChange;this.selectionManager.onSelectionChange=s=>{if(n&&n(s),s&&s.userData.isSet){const r=s.userData.setId;this.onSetSelected&&this.onSetSelected(r)}else s||this.onSetSelected&&this.onSetSelected(null)},document.addEventListener("keydown",this.onKeyDown.bind(this))}updateShadowCameras(){Wm()(this.scene)}setupGrid(){this.createPlatform(this.platformSize)}createPlatform(e){if(this.basePlate){this.scene.remove(this.basePlate);const l=this.placementManager.blocks.indexOf(this.basePlate);l>-1&&this.placementManager.blocks.splice(l,1)}let t;switch(e){case 4:t=Sl.create("green");break;case 8:t=Gc.create("green");break;case 16:t=El.create("green");break;case 32:t=Hc.create("green");break;default:t=Wc.create("green")}t.position.set(0,-Mr/2,0),t.userData.isBrick=!0,t.userData.isBasePlate=!0,t.userData.isImmobile=!0,t.userData.doNotModify=!0,t.userData.platformSize=e,t.castShadow=!1,t.receiveShadow=!0,t.frustumCulled=!0,t.traverse(l=>{l.isMesh&&(l.castShadow=!1,l.receiveShadow=!0,l.frustumCulled=!0)}),this.scene.add(t),this.basePlate=t,this.placementManager.blocks.push(t),this.placementManager.setPlatformSize(e);const n=this.scene.children.find(l=>l.userData.isGround);n&&this.scene.remove(n);const s=Math.max(e*.8*2,40),r=new va(s,s),a=new xl({color:9498256,transparent:!0,opacity:.1}),o=new yn(r,a);o.rotation.x=-Math.PI/2,o.position.y=-1,o.userData.isGround=!0,this.scene.add(o),this.platformSize=e}onKeyDown(e){const t=this.selectionManager.getSelectedBrick(),n=this.getSelectedSet();if(t||n){let s=null;if(n?s=n.group:t&&!t.userData.isImmobile&&!t.userData.isBasePlate&&(s=t),s){if(e.code==="Numpad1"||e.key==="1"){e.preventDefault(),e.stopPropagation(),this.raiseBlockToPlateHeight(s);return}else if(e.code==="Numpad2"||e.key==="2"){e.preventDefault(),e.stopPropagation(),this.lowerBlockToPlateHeight(s);return}}}if(t||n){let s=null;if(n?s=n.group:t&&!t.userData.isImmobile&&!t.userData.isBasePlate&&(s=t),s)switch(e.key.toLowerCase()){case"arrowup":case"w":e.preventDefault(),e.stopPropagation(),this.moveBlock(s,"forward");return;case"arrowdown":case"s":e.preventDefault(),e.stopPropagation(),this.moveBlock(s,"backward");return;case"arrowleft":case"a":e.preventDefault(),e.stopPropagation(),this.moveBlock(s,"left");return;case"arrowright":case"d":e.preventDefault(),e.stopPropagation(),this.moveBlock(s,"right");return}}if(t||n){let s=null;if(n?s=n.group:t&&!t.userData.isImmobile&&!t.userData.isBasePlate&&(s=t),s)switch(e.key.toLowerCase()){case"e":e.preventDefault(),e.stopPropagation(),this.raiseBlockToPlateHeight(s);return;case"q":e.preventDefault(),e.stopPropagation(),this.lowerBlockToPlateHeight(s);return}}if(t&&!n)switch(e.key.toLowerCase()){case"r":if(t.userData.isImmobile||t.userData.isBasePlate)return;e.stopPropagation(),t.rotation.y+=Math.PI/2;const s=t.userData.width,r=t.userData.length;t.userData.width=r,t.userData.length=s;break;case"delete":case"backspace":if(t.userData.isImmobile||t.userData.isBasePlate)return;e.stopPropagation(),this.removeBrick(t);break}else if(n)switch(e.key.toLowerCase()){case"r":e.stopPropagation(),n.group.rotation.y+=Math.PI/2,n.rotation={...n.rotation,y:n.group.rotation.y},this.onSetMoved&&this.onSetMoved(n.id,n.position,n.rotation);break;case"delete":case"backspace":e.stopPropagation(),this.removeSet(n.id);break}}getSelectedSet(){const e=this.selectionManager.getSelectedBrick();if(!e)return null;for(const[t,n]of this.placedSets.entries()){if(n.group===e)return{id:t,...n};let s=e;for(;s.parent;){if(s.parent===n.group)return{id:t,...n};s=s.parent}}return null}moveBlock(e,t,n=Ft/3){if(!e)return;const s=new fe;switch(t){case"forward":s.set(0,0,n);break;case"backward":s.set(0,0,-n);break;case"left":s.set(n,0,0);break;case"right":s.set(-n,0,0);break;default:return}if(e.position.add(s),e.userData.isSet){const r=e.userData.setId,a=this.placedSets.get(r);a&&(a.position={x:e.position.x,y:e.position.y,z:e.position.z},this.onSetMoved&&this.onSetMoved(r,a.position,a.rotation))}}rotateBlock(e,t,n=Math.PI/2){if(e){switch(t.toLowerCase()){case"x":e.rotation.x+=n,e.rotation.x>=Math.PI*2?e.rotation.x-=Math.PI*2:e.rotation.x<0&&(e.rotation.x+=Math.PI*2);break;case"y":e.rotation.y+=n,e.rotation.y>=Math.PI*2?e.rotation.y-=Math.PI*2:e.rotation.y<0&&(e.rotation.y+=Math.PI*2);break;case"z":e.rotation.z+=n,e.rotation.z>=Math.PI*2?e.rotation.z-=Math.PI*2:e.rotation.z<0&&(e.rotation.z+=Math.PI*2);break;default:return}if(e.userData.isSet){const s=e.userData.setId,r=this.placedSets.get(s);r&&(r.rotation={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},this.onSetMoved&&this.onSetMoved(s,r.position,r.rotation))}}}raiseBlockToPlateHeight(e){if(!e)return;const n=e.position.y+Mr;if(e.position.y=n,e.userData.isSet){const s=e.userData.setId,r=this.placedSets.get(s);r&&(r.position={x:e.position.x,y:e.position.y,z:e.position.z},this.onSetMoved&&this.onSetMoved(s,r.position,r.rotation))}}lowerBlockToPlateHeight(e){if(!e)return;const t=e.position.y,n=Math.max(0,t-Mr);if(e.position.y=n,e.userData.isSet){const s=e.userData.setId,r=this.placedSets.get(s);r&&(r.position={x:e.position.x,y:e.position.y,z:e.position.z},this.onSetMoved&&this.onSetMoved(s,r.position,r.rotation))}}async placeSet(e,t,n,s={x:0,y:0,z:0}){try{const r=new Zn;r.userData.isSet=!0;const a=this.placementManager.findPlacementHeight(r,n),o=a!==null?a:n.y||0,l=new Zn;l.position.set(n.x,o,n.z),l.rotation.set(s.x,s.y,s.z),l.userData.isSet=!0,l.userData.isBrick=!0,l.userData.setId=e,l.userData.isImmobile=!1,l.userData.isBasePlate=!1;let c;if(t.buildData)c=t.buildData;else if(t.blocks)c={blocks:t.blocks,platformSize:t.platformSize||20};else throw new Error("Invalid set data");if(!c.blocks||!Array.isArray(c.blocks))throw new Error("Invalid build data: missing blocks array");const u=[],d={scene:l,bricks:u,placementManager:{getAllBlocks:()=>u,clear:()=>{},blocks:u},removeBrick:m=>{const _=u.indexOf(m);_>-1&&u.splice(_,1),l.remove(m)},addBrick:(m,_=!1)=>{m.userData.isBrick=!0,m.castShadow=!0,m.receiveShadow=!0,m.frustumCulled=!0,m.traverse(v=>{v.isMesh&&(v.castShadow=!0,v.receiveShadow=!0,v.frustumCulled=!0)}),l.add(m),u.push(m)}},h=new gd(d),f=5,p=16;this.scene.add(l);for(let m=0;m<c.blocks.length;m+=f){const _=c.blocks.slice(m,m+f);for(const v of _)await h.createBlockFromData(v);m+f<c.blocks.length&&await new Promise(v=>setTimeout(v,p))}l.traverse(m=>{m.isMesh&&m.userData.isBrick&&!m.userData.isBasePlate&&(this.placementManager.blocks.includes(m)||this.placementManager.blocks.push(m),m.frustumCulled=!0)}),this.placementManager.blocks.includes(l)||this.placementManager.blocks.push(l),l.frustumCulled=!0,this.placedSets.set(e,{id:e,group:l,setId:t.id||null,collectionId:t.collectionId||null,position:{x:n.x,y:o,z:n.z},rotation:{x:s.x,y:s.y,z:s.z},buildData:c})}catch(r){throw console.error("Failed to place set:",r),r}}removeSet(e){const t=this.placedSets.get(e);t&&(t.group.traverse(n=>{if(n.isMesh&&this.placementManager.blocks.includes(n)){const s=this.placementManager.blocks.indexOf(n);s>-1&&this.placementManager.blocks.splice(s,1)}}),this.selectionManager.isSelected(t.group)&&this.selectionManager.clearSelection(),this.scene.remove(t.group),t.group.traverse(n=>{n.isMesh&&(n.geometry.dispose(),Array.isArray(n.material)?n.material.forEach(s=>s.dispose()):n.material.dispose())}),this.placedSets.delete(e),this.onSetRemoved&&this.onSetRemoved(e))}moveSet(e,t,n){const s=this.placedSets.get(e);s&&(s.group.position.set(t.x,t.y,t.z),typeof n=="object"?(s.group.rotation.set(n.x,n.y,n.z),s.rotation={...n}):(s.group.rotation.y=n,s.rotation={x:s.group.rotation.x,y:n,z:s.group.rotation.z}),s.position={...t})}async loadPlacedSets(e,t,n={}){const{async:s=!0,batchSize:r=3,batchDelay:a=50}=n;for(const l of this.placedSets.keys())this.removeSet(l);if(!s||e.length===0){for(const l of e){let c;if(l.buildData?c={id:l.setId||l.collectionId,setId:l.setId||null,collectionId:l.collectionId||null,buildData:l.buildData}:c=await t(l.setId,l.collectionId),c){const u=typeof l.rotation=="object"?l.rotation:{x:0,y:l.rotation||0,z:0};await this.placeSet(l.id,c,l.position,u)}}return}const o=async l=>{try{let c;if(l.buildData?c={id:l.setId||l.collectionId,setId:l.setId||null,collectionId:l.collectionId||null,buildData:l.buildData}:c=await t(l.setId,l.collectionId),c){const u=typeof l.rotation=="object"?l.rotation:{x:0,y:l.rotation||0,z:0};await this.placeSet(l.id,c,l.position,u)}}catch(c){console.error(`Failed to load set ${l.id}:`,c)}};for(let l=0;l<e.length;l+=r){const c=e.slice(l,l+r);await Promise.all(c.map(o)),l+r<e.length&&await new Promise(u=>setTimeout(u,a))}}animate(){this.animationId=requestAnimationFrame(this.animate.bind(this)),this.controls.update(),this.renderer.info.reset(),this.renderer.render(this.scene,this.camera),this.rendererStats&&this.rendererStats.update(),this.resolveLoading&&(this.resolveLoading(),this.resolveLoading=null)}resize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}updateGraphics(){la(this.renderer),$m(this.scene)}addBrick(e,t=!1){e.userData.isBrick=!0,e.castShadow=!0,e.receiveShadow=!0,e.frustumCulled=!0,e.traverse(n=>{n.isMesh&&(n.castShadow=!0,n.receiveShadow=!0,n.frustumCulled=!0)}),(e.userData.isMinifigure||e.userData.specialType==="minifigure")&&(e.position.y+=As),this.scene.add(e),this.bricks.push(e),t?this.placementManager.blocks.includes(e)||this.placementManager.blocks.push(e):this.placementManager.blocks.includes(e)||this.placementManager.blocks.push(e)}removeBrick(e){if(e.userData&&(e.userData.isImmobile||e.userData.isBasePlate))return;const t=this.bricks.indexOf(e);t>-1&&this.bricks.splice(t,1),this.selectionManager.isSelected(e)&&this.selectionManager.clearSelection(),this.placementManager.removeBlock(e,!1),this.scene.remove(e),e.traverse(n=>{n.isMesh&&(n.geometry.dispose(),Array.isArray(n.material)?n.material.forEach(s=>s.dispose()):n.material.dispose())})}setPlatformSize(e){this.platformSize!==e&&(this.platformSize=e,this.createPlatform(e))}dispose(){this.animationId&&cancelAnimationFrame(this.animationId),document.removeEventListener("keydown",this.onKeyDown.bind(this)),[...this.bricks].forEach(t=>this.removeBrick(t));for(const t of this.placedSets.keys())this.removeSet(t);this.rendererStats&&this.rendererStats.dispose(),this.renderer.dispose(),this.controls.dispose()}};const TG={class:"block-palette"},AG={class:"block-palette__content"},CG={class:"block-palette__section"},PG={class:"block-palette__section-title"},RG={class:"block-palette__colors"},LG=["onClick","title"],IG=["onClick","title"],DG=["onClick","title"],kG={class:"block-palette__section"},BG={class:"block-palette__section"},OG={class:"block-palette__section-title"},NG={class:"block-palette__grid"},FG=["onMousedown","onTouchstart"],UG={class:"block-palette__section"},zG={class:"block-palette__section-title"},VG={class:"block-palette__grid"},GG=["onMousedown","onTouchstart"],HG={class:"block-palette__section"},WG={class:"block-palette__section-title"},$G={class:"block-palette__grid"},XG=["onMousedown","onTouchstart"],qG={class:"block-palette__section"},YG={class:"block-palette__grid"},jG=["onMousedown","onTouchstart"],KG={__name:"DevBlockPalette",props:{onCreateBlock:{type:Function,required:!0}},setup(i){const e=i,{t}=wn(),n=ze("red"),s=ze(!1),r=["red","blue","yellow","green"],a=["orange","purple","pink","white"],o=["brightGreen","brown","black","gray"],l=ze([{type:"brick-1x1",label:"1x1",width:1,length:1},{type:"brick-1x2",label:"1x2",width:1,length:2},{type:"brick-1x3",label:"1x3",width:1,length:3},{type:"brick-1x4",label:"1x4",width:1,length:4},{type:"brick-1x6",label:"1x6",width:1,length:6},{type:"brick-1x8",label:"1x8",width:1,length:8},{type:"brick-1x12",label:"1x12",width:1,length:12},{type:"brick-2x2",label:"2x2",width:2,length:2},{type:"brick-2x3",label:"2x3",width:2,length:3},{type:"brick-2x4",label:"2x4",width:2,length:4},{type:"brick-2x6",label:"2x6",width:2,length:6},{type:"brick-2x8",label:"2x8",width:2,length:8}]),c=ze([{type:"plate-1x1",label:"1x1",width:1,length:1},{type:"plate-1x2",label:"1x2",width:1,length:2},{type:"plate-1x3",label:"1x3",width:1,length:3},{type:"plate-1x4",label:"1x4",width:1,length:4},{type:"plate-1x6",label:"1x6",width:1,length:6},{type:"plate-1x8",label:"1x8",width:1,length:8},{type:"plate-2x2",label:"2x2",width:2,length:2},{type:"plate-2x3",label:"2x3",width:2,length:3},{type:"plate-2x4",label:"2x4",width:2,length:4},{type:"plate-2x6",label:"2x6",width:2,length:6},{type:"plate-2x8",label:"2x8",width:2,length:8},{type:"plate-4x4",label:"4x4",width:4,length:4}]),u=ze([{type:"cylinder-1x1",label:"Cylinder 1x1",width:1,length:1},{type:"cylinder-plate-1x1",label:"Cylinder Plate 1x1",width:1,length:1},{type:"flat-plate-1x1",label:"Flat Plate 1x1",width:1,length:1},{type:"flat-plate-1x2",label:"Flat Plate 1x2",width:1,length:2},{type:"flat-plate-1x2-center-stud",label:"Flat Plate 1x2 Center Stud",width:1,length:2},{type:"flat-plate-1x4",label:"Flat Plate 1x4",width:1,length:4},{type:"cylinder-plate-2x2",label:"Cylinder Plate 2x2",width:2,length:2},{type:"minifigure",label:"Minifigure",width:1,length:1}]),d=ze([{type:"corner-brick-1x1",label:"Corner 1x1",width:1,length:1},{type:"side-stud-brick-1x1",label:"Side Stud 1x1",width:1,length:1},{type:"stepped-brick-2x2",label:"Stepped 2x2",width:2,length:2}]),h=v=>{n.value=v},f=async v=>{const x=s.value===!0;return await p(v,n.value,x)},p=async(v,x,y)=>{let g=null;try{switch(v){case"brick-1x1":g=(await ae(async()=>{const{Brick1x1:b}=await import("./Brick1x1-EdxTdz51.js");return{Brick1x1:b}},[],import.meta.url)).Brick1x1;break;case"brick-1x2":g=(await ae(async()=>{const{Brick1x2:b}=await import("./Brick1x2-DnAOJOkq.js");return{Brick1x2:b}},[],import.meta.url)).Brick1x2;break;case"brick-1x3":g=(await ae(async()=>{const{Brick1x3:b}=await import("./Brick1x3-B8u3bN4B.js");return{Brick1x3:b}},[],import.meta.url)).Brick1x3;break;case"brick-1x4":g=(await ae(async()=>{const{Brick1x4:b}=await import("./Brick1x4-DwLCjnXL.js");return{Brick1x4:b}},[],import.meta.url)).Brick1x4;break;case"brick-1x6":g=(await ae(async()=>{const{Brick1x6:b}=await import("./Brick1x6-CwMdwT5n.js");return{Brick1x6:b}},[],import.meta.url)).Brick1x6;break;case"brick-1x8":g=(await ae(async()=>{const{Brick1x8:b}=await import("./Brick1x8-Bc6Y_LR4.js");return{Brick1x8:b}},[],import.meta.url)).Brick1x8;break;case"brick-1x12":g=(await ae(async()=>{const{Brick1x12:b}=await import("./Brick1x12-BkGvi3JW.js");return{Brick1x12:b}},[],import.meta.url)).Brick1x12;break;case"brick-2x2":g=(await ae(async()=>{const{Brick2x2:b}=await import("./Brick2x2-CtnXevaB.js");return{Brick2x2:b}},[],import.meta.url)).Brick2x2;break;case"brick-2x3":g=(await ae(async()=>{const{Brick2x3:b}=await import("./Brick2x3-Bi4oKMK1.js");return{Brick2x3:b}},[],import.meta.url)).Brick2x3;break;case"brick-2x4":g=(await ae(async()=>{const{Brick2x4:b}=await import("./Brick2x4-BzjY8aPs.js");return{Brick2x4:b}},[],import.meta.url)).Brick2x4;break;case"brick-2x6":g=(await ae(async()=>{const{Brick2x6:b}=await import("./Brick2x6-DyXmTNPs.js");return{Brick2x6:b}},[],import.meta.url)).Brick2x6;break;case"brick-2x8":g=(await ae(async()=>{const{Brick2x8:b}=await import("./Brick2x8-D7W6dT0A.js");return{Brick2x8:b}},[],import.meta.url)).Brick2x8;break;case"plate-1x1":g=(await ae(async()=>{const{Plate1x1:b}=await import("./Plate1x1-Bq6qxEsz.js");return{Plate1x1:b}},[],import.meta.url)).Plate1x1;break;case"plate-1x2":g=(await ae(async()=>{const{Plate1x2:b}=await import("./Plate1x2-HxVPAcGh.js");return{Plate1x2:b}},[],import.meta.url)).Plate1x2;break;case"plate-1x3":g=(await ae(async()=>{const{Plate1x3:b}=await import("./Plate1x3-B1SEKM4g.js");return{Plate1x3:b}},[],import.meta.url)).Plate1x3;break;case"plate-1x4":g=(await ae(async()=>{const{Plate1x4:b}=await import("./Plate1x4-DJi5J3Re.js");return{Plate1x4:b}},[],import.meta.url)).Plate1x4;break;case"plate-1x6":g=(await ae(async()=>{const{Plate1x6:b}=await import("./Plate1x6-wb7bs3Wi.js");return{Plate1x6:b}},[],import.meta.url)).Plate1x6;break;case"plate-1x8":g=(await ae(async()=>{const{Plate1x8:b}=await import("./Plate1x8-CP9hT_uq.js");return{Plate1x8:b}},[],import.meta.url)).Plate1x8;break;case"plate-2x2":g=(await ae(async()=>{const{Plate2x2:b}=await import("./Plate2x2-RUlUvXcd.js");return{Plate2x2:b}},[],import.meta.url)).Plate2x2;break;case"plate-2x3":g=(await ae(async()=>{const{Plate2x3:b}=await import("./Plate2x3-C1MDkfD3.js");return{Plate2x3:b}},[],import.meta.url)).Plate2x3;break;case"plate-2x4":g=(await ae(async()=>{const{Plate2x4:b}=await import("./Plate2x4-DfLVQO9a.js");return{Plate2x4:b}},[],import.meta.url)).Plate2x4;break;case"plate-2x6":g=(await ae(async()=>{const{Plate2x6:b}=await import("./Plate2x6-tiexhIOv.js");return{Plate2x6:b}},[],import.meta.url)).Plate2x6;break;case"plate-2x8":g=(await ae(async()=>{const{Plate2x8:b}=await import("./Plate2x8-FxHHZWtZ.js");return{Plate2x8:b}},[],import.meta.url)).Plate2x8;break;case"plate-4x4":g=(await ae(async()=>{const{Plate4x4:b}=await Promise.resolve().then(()=>ro);return{Plate4x4:b}},void 0,import.meta.url)).Plate4x4;break;case"plate-4x8":g=(await ae(async()=>{const{Plate4x8:b}=await import("./Plate4x8-DFzIDcP1.js");return{Plate4x8:b}},[],import.meta.url)).Plate4x8;break;case"cylinder-1x1":g=(await ae(async()=>{const{Cylinder1x1:b}=await import("./Cylinder1x1-CatK-O-Q.js");return{Cylinder1x1:b}},[],import.meta.url)).Cylinder1x1;break;case"cylinder-plate-1x1":g=(await ae(async()=>{const{CylinderPlate1x1:b}=await import("./CylinderPlate1x1-C9BKk24L.js");return{CylinderPlate1x1:b}},[],import.meta.url)).CylinderPlate1x1;break;case"flat-plate-1x1":g=(await ae(async()=>{const{FlatPlate1x1:b}=await import("./FlatPlate1x1-COVjvhfm.js");return{FlatPlate1x1:b}},[],import.meta.url)).FlatPlate1x1;break;case"flat-plate-1x2":g=(await ae(async()=>{const{FlatPlate1x2:b}=await import("./FlatPlate1x2-WO8sp-SC.js");return{FlatPlate1x2:b}},[],import.meta.url)).FlatPlate1x2;break;case"flat-plate-1x2-center-stud":g=(await ae(async()=>{const{FlatPlate1x2CenterStud:b}=await import("./FlatPlate1x2CenterStud-CgU774Nu.js");return{FlatPlate1x2CenterStud:b}},__vite__mapDeps([0,1]),import.meta.url)).FlatPlate1x2CenterStud;break;case"flat-plate-1x4":g=(await ae(async()=>{const{FlatPlate1x4:b}=await import("./FlatPlate1x4-BhPvU6tM.js");return{FlatPlate1x4:b}},[],import.meta.url)).FlatPlate1x4;break;case"cylinder-plate-2x2":g=(await ae(async()=>{const{CylinderPlate2x2:b}=await import("./CylinderPlate2x2-C3FZo06O.js");return{CylinderPlate2x2:b}},[],import.meta.url)).CylinderPlate2x2;break;case"minifigure":g=(await ae(async()=>{const{Minifigure:b}=await Promise.resolve().then(()=>Ml);return{Minifigure:b}},void 0,import.meta.url)).Minifigure;break;case"corner-brick-1x1":g=(await ae(async()=>{const{CornerBrick1x1:b}=await import("./CornerBrick1x1-2hjvabOl.js");return{CornerBrick1x1:b}},[],import.meta.url)).CornerBrick1x1;break;case"side-stud-brick-1x1":g=(await ae(async()=>{const{SideStudBrick1x1:b}=await import("./SideStudBrick1x1-Bw5mv8V9.js");return{SideStudBrick1x1:b}},__vite__mapDeps([2,3]),import.meta.url)).SideStudBrick1x1;break;case"stepped-brick-2x2":g=(await ae(async()=>{const{SteppedBrick2x2:b}=await import("./SteppedBrick2x2-DHsbtfck.js");return{SteppedBrick2x2:b}},[],import.meta.url)).SteppedBrick2x2;break;default:return console.warn(`Unknown block type: ${v}`),null}return g?g.create(x,y,!1):(console.warn(`Block class not found for type: ${v}`),null)}catch(w){return console.error(`Error creating block ${v}:`,w),null}},m=async(v,x)=>{v.preventDefault();const y=await f(x);y&&e.onCreateBlock(y,v.clientX,v.clientY)},_=async(v,x)=>{v.preventDefault();const y=v.touches[0],g=await f(x);g&&e.onCreateBlock(g,y.clientX,y.clientY)};return In(()=>{[...l.value,...c.value,...u.value,...d.value].forEach(x=>{const y=()=>p(x.type,ey,!1);KB(x.type,ey,!1,y)})}),(v,x)=>(oe(),ge("div",TG,[B("div",AG,[B("div",CG,[B("h4",PG,se(v.$t("builder.colors")),1),B("div",RG,[(oe(),ge(At,null,Zt(r,y=>B("button",{key:y,onClick:g=>h(y),class:qt(["color-button",{"color-button--active":n.value===y,[`color-button--${y}`]:!0}]),title:v.$t(`colors.${y}`)},null,10,LG)),64)),(oe(),ge(At,null,Zt(a,y=>B("button",{key:y,onClick:g=>h(y),class:qt(["color-button",{"color-button--active":n.value===y,[`color-button--${y}`]:!0}]),title:v.$t(`colors.${y}`)},null,10,IG)),64)),(oe(),ge(At,null,Zt(o,y=>B("button",{key:y,onClick:g=>h(y),class:qt(["color-button",{"color-button--active":n.value===y,[`color-button--${y}`]:!0}]),title:v.$t(`colors.${y}`)},null,10,DG)),64))]),n.value?(oe(),jt(_n,{key:0,variant:"primary",size:"sm",class:"block-palette__color-badge"},{default:Le(()=>[Oe(se(v.$t(`colors.${n.value}`)),1)]),_:1})):Ve("",!0)]),B("div",kG,[we(Tb,{modelValue:s.value,"onUpdate:modelValue":x[0]||(x[0]=y=>s.value=y),label:v.$t("builder.glass"),size:"md"},null,8,["modelValue","label"])]),B("div",BG,[B("h4",OG,se(v.$t("builder.standardBricks")),1),B("div",NG,[(oe(!0),ge(At,null,Zt(l.value,y=>(oe(),ge("div",{key:y.type,class:"block-palette__block-card",onMousedown:g=>m(g,y.type),onTouchstart:g=>_(g,y.type),draggable:"false"},[we(qr,{label:y.label,"block-type":y.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>f(y.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,FG))),128))])]),B("div",UG,[B("h4",zG,se(v.$t("builder.plates")),1),B("div",VG,[(oe(!0),ge(At,null,Zt(c.value,y=>(oe(),ge("div",{key:y.type,class:"block-palette__block-card",onMousedown:g=>m(g,y.type),onTouchstart:g=>_(g,y.type),draggable:"false"},[we(qr,{label:y.label,"block-type":y.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>f(y.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,GG))),128))])]),B("div",HG,[B("h4",WG,se(v.$t("builder.specialBlocks")),1),B("div",$G,[(oe(!0),ge(At,null,Zt(u.value,y=>(oe(),ge("div",{key:y.type,class:"block-palette__block-card",onMousedown:g=>m(g,y.type),onTouchstart:g=>_(g,y.type),draggable:"false"},[we(qr,{label:y.label,"block-type":y.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>f(y.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,XG))),128))])]),B("div",qG,[x[1]||(x[1]=B("h4",{class:"block-palette__section-title"},"Dev Builder Special",-1)),B("div",YG,[(oe(!0),ge(At,null,Zt(d.value,y=>(oe(),ge("div",{key:y.type,class:"block-palette__block-card",onMousedown:g=>m(g,y.type),onTouchstart:g=>_(g,y.type),draggable:"false"},[we(qr,{label:y.label,"block-type":y.type,color:n.value,"is-glass":s.value,"create-block-fn":()=>f(y.type)},null,8,["label","block-type","color","is-glass","create-block-fn"])],40,jG))),128))])])])]))}},ZG=Ht(KG,[["__scopeId","data-v-ff4c86cb"]]),JG={class:"set-creation-form"},QG={class:"set-creation-form__section"},eH={class:"set-creation-form__section-title"},tH={key:0,class:"set-creation-form__empty"},nH={class:"hint-text"},iH={key:1,class:"set-creation-form__blocks-list"},sH={class:"set-creation-form__block-info"},rH={class:"set-creation-form__block-order"},aH={class:"set-creation-form__block-details"},oH={class:"set-creation-form__block-type"},lH={class:"set-creation-form__block-color"},cH={class:"set-creation-form__section"},uH={class:"set-creation-form__section-title"},dH={class:"set-creation-form__box-dimensions"},hH={class:"set-creation-form__subsection-title"},fH={class:"set-creation-form__dimensions-row"},pH={class:"set-creation-form__section"},mH={class:"set-creation-form__actions"},_H={key:0,class:"set-creation-form__json-output"},vH={class:"set-creation-form__subsection-title"},gH={__name:"SetCreationForm",props:{setBlocks:{type:Array,required:!0},platformSize:{type:Number,default:20}},emits:["remove-block","clear-set"],setup(i,{emit:e}){const t=i,n=e,{t:s}=wn(),r=ze({id:"",name:"",description:"",price:0,image:"",pieces:0,difficulty:"easy",reward:0,boxTexture:"",boxDimensions:{width:0,height:0,depth:0},platformSize:t.platformSize}),a=ze(""),o=tt(()=>{try{return[{value:"easy",label:s("devBuilder.difficultyEasy")},{value:"medium",label:s("devBuilder.difficultyMedium")},{value:"hard",label:s("devBuilder.difficultyHard")}]}catch(h){return console.error("Error computing difficulty options:",h),[{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}]}});Wn(()=>t.setBlocks.length,h=>{r.value.pieces=h},{immediate:!0}),Wn(()=>t.platformSize,h=>{r.value.platformSize=h},{immediate:!0});const l=()=>{const h={id:r.value.id||"unnamed-set",name:r.value.name||"Unnamed Set",description:r.value.description||"",price:r.value.price||0,image:r.value.image||"",pieces:t.setBlocks.length,difficulty:r.value.difficulty||"easy",reward:r.value.reward||0,boxTexture:r.value.boxTexture||"",boxDimensions:{width:r.value.boxDimensions.width||0,height:r.value.boxDimensions.height||0,depth:r.value.boxDimensions.depth||0},platformSize:r.value.platformSize||t.platformSize,blocks:t.setBlocks.map((f,p)=>({...f,order:p+1}))};return JSON.stringify(h,null,2)},c=()=>{a.value=l()},u=async()=>{const h=l();a.value=h;try{await navigator.clipboard.writeText(h),alert(s("devBuilder.jsonCopied"))}catch(f){console.error("Failed to copy JSON:",f),alert(s("devBuilder.jsonCopyFailed"))}},d=()=>{confirm(s("devBuilder.confirmClearSet"))&&(n("clear-set"),r.value={id:"",name:"",description:"",price:0,image:"",pieces:0,difficulty:"easy",reward:0,boxTexture:"",boxDimensions:{width:0,height:0,depth:0},platformSize:t.platformSize},a.value="")};return(h,f)=>(oe(),ge("div",JG,[B("div",QG,[B("h3",eH,se(h.$t("devBuilder.setBlocks")),1),i.setBlocks.length===0?(oe(),ge("div",tH,[B("p",null,se(h.$t("devBuilder.noBlocksInSet")),1),B("p",nH,se(h.$t("devBuilder.addBlocksHint")),1)])):(oe(),ge("div",iH,[(oe(!0),ge(At,null,Zt(i.setBlocks,(p,m)=>(oe(),ge("div",{key:`block-${m}-${p.type||"unknown"}`,class:"set-creation-form__block-item"},[B("div",sH,[B("span",rH,se(m+1),1),B("div",aH,[B("span",oH,se(p.type),1),B("span",lH,se(p.color?h.$t(`colors.${p.color}`):"N/A"),1)])]),we(wt,{variant:"outline",size:"sm",onClick:_=>h.$emit("remove-block",m),class:"set-creation-form__remove-btn"},{default:Le(()=>[Oe(se(h.$t("devBuilder.removeFromSet")),1)]),_:1},8,["onClick"])]))),128))]))]),B("div",cH,[B("h3",uH,se(h.$t("devBuilder.setMetadata")),1),we(as,{modelValue:r.value.id,"onUpdate:modelValue":f[0]||(f[0]=p=>r.value.id=p),label:h.$t("devBuilder.setId"),placeholder:"test-tower",class:"set-creation-form__input"},null,8,["modelValue","label"]),we(as,{modelValue:r.value.name,"onUpdate:modelValue":f[1]||(f[1]=p=>r.value.name=p),label:h.$t("devBuilder.setName"),placeholder:"Test Tower",class:"set-creation-form__input"},null,8,["modelValue","label"]),we(yd,{modelValue:r.value.description,"onUpdate:modelValue":f[2]||(f[2]=p=>r.value.description=p),label:h.$t("devBuilder.setDescription"),rows:3,placeholder:"A simple three-block tower",class:"set-creation-form__input"},null,8,["modelValue","label"]),we(as,{"model-value":r.value.price,"onUpdate:modelValue":f[3]||(f[3]=p=>r.value.price=Number(p)||0),type:"number",label:h.$t("devBuilder.setPrice"),placeholder:"300",min:0,class:"set-creation-form__input"},null,8,["model-value","label"]),we(as,{modelValue:r.value.image,"onUpdate:modelValue":f[4]||(f[4]=p=>r.value.image=p),label:h.$t("devBuilder.setImage"),placeholder:"/images/sets/tower.svg",class:"set-creation-form__input"},null,8,["modelValue","label"]),we(as,{"model-value":r.value.pieces,type:"number",label:h.$t("devBuilder.setPieces"),min:0,readonly:"",class:"set-creation-form__input"},null,8,["model-value","label"]),we(Sc,{modelValue:r.value.difficulty,"onUpdate:modelValue":f[5]||(f[5]=p=>r.value.difficulty=p),label:h.$t("devBuilder.setDifficulty"),options:o.value||[],class:"set-creation-form__input"},null,8,["modelValue","label","options"]),we(as,{"model-value":r.value.reward,"onUpdate:modelValue":f[6]||(f[6]=p=>r.value.reward=Number(p)||0),type:"number",label:h.$t("devBuilder.setReward"),placeholder:"50",min:0,class:"set-creation-form__input"},null,8,["model-value","label"]),we(as,{modelValue:r.value.boxTexture,"onUpdate:modelValue":f[7]||(f[7]=p=>r.value.boxTexture=p),label:h.$t("devBuilder.setBoxTexture"),placeholder:"test-tower",class:"set-creation-form__input"},null,8,["modelValue","label"]),B("div",dH,[B("h4",hH,se(h.$t("devBuilder.setBoxDimensions")),1),B("div",fH,[we(as,{"model-value":r.value.boxDimensions.width,"onUpdate:modelValue":f[8]||(f[8]=p=>r.value.boxDimensions.width=Number(p)||0),type:"number",label:h.$t("devBuilder.width"),placeholder:"2",min:0,class:"set-creation-form__input"},null,8,["model-value","label"]),we(as,{"model-value":r.value.boxDimensions.height,"onUpdate:modelValue":f[9]||(f[9]=p=>r.value.boxDimensions.height=Number(p)||0),type:"number",label:h.$t("devBuilder.height"),placeholder:"4",min:0,class:"set-creation-form__input"},null,8,["model-value","label"]),we(as,{"model-value":r.value.boxDimensions.depth,"onUpdate:modelValue":f[10]||(f[10]=p=>r.value.boxDimensions.depth=Number(p)||0),type:"number",label:h.$t("devBuilder.depth"),placeholder:"1",min:0,class:"set-creation-form__input"},null,8,["model-value","label"])])]),we(as,{"model-value":r.value.platformSize,"onUpdate:modelValue":f[11]||(f[11]=p=>r.value.platformSize=Number(p)||4),type:"number",label:h.$t("devBuilder.setPlatformSize"),min:4,class:"set-creation-form__input"},null,8,["model-value","label"])]),B("div",pH,[B("div",mH,[we(wt,{variant:"primary",size:"sm",onClick:u,disabled:i.setBlocks.length===0,class:"set-creation-form__action-btn"},{default:Le(()=>[Oe(se(h.$t("devBuilder.generateAndCopyJSON")),1)]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:c,disabled:i.setBlocks.length===0,class:"set-creation-form__action-btn"},{default:Le(()=>[Oe(se(h.$t("devBuilder.generateJSON")),1)]),_:1},8,["disabled"]),we(wt,{variant:"danger",size:"sm",onClick:d,disabled:i.setBlocks.length===0,class:"set-creation-form__action-btn"},{default:Le(()=>[Oe(se(h.$t("devBuilder.clearSet")),1)]),_:1},8,["disabled"])]),a.value?(oe(),ge("div",_H,[B("h4",vH,se(h.$t("devBuilder.generatedJSON")),1),we(yd,{"model-value":a.value,rows:15,readonly:"",class:"set-creation-form__json-textarea"},null,8,["model-value"])])):Ve("",!0)])]))}},yH=Ht(gH,[["__scopeId","data-v-77188ab0"]]),xH={class:"dev-builder"},bH={class:"dev-builder__sidebar"},wH={class:"dev-builder-sidebar"},SH={class:"dev-builder-sidebar__header"},EH={class:"dev-builder-sidebar__title"},MH={class:"dev-builder-sidebar__content"},TH={class:"dev-builder-sidebar__tabs"},AH=["onClick"],CH={class:"dev-builder-sidebar__tab-content"},PH={key:0,class:"dev-builder-sidebar__tab-panel"},RH={class:"dev-builder-sidebar__section"},LH={class:"dev-builder-sidebar__section-title"},IH={class:"button-group"},DH={class:"dev-builder-sidebar__section"},kH={class:"dev-builder-sidebar__section-title"},BH={class:"button-group"},OH={class:"dev-builder-sidebar__section"},NH={class:"dev-builder-sidebar__section-title"},FH={class:"button-group"},UH={class:"dev-builder-sidebar__section"},zH={class:"dev-builder-sidebar__section-title"},VH={class:"hint-text"},GH={key:1,class:"dev-builder-sidebar__tab-panel"},HH={key:2,class:"dev-builder-sidebar__tab-panel"},WH={key:3,class:"dev-builder-sidebar__tab-panel"},$H={key:4,class:"dev-builder-sidebar__tab-panel"},XH={key:0,class:"dev-builder-sidebar__section"},qH={class:"dev-builder-sidebar__section-title"},YH={class:"dev-builder-sidebar__sets"},jH=["onClick"],KH={class:"set-item__preview"},ZH={class:"set-item__info"},JH={class:"set-item__name"},QH={class:"set-item__details"},eW={key:1,class:"dev-builder-sidebar__section"},tW={class:"dev-builder-sidebar__section-title"},nW={class:"dev-builder-sidebar__sets"},iW=["onClick"],sW={class:"set-item__preview"},rW={class:"set-item__info"},aW={class:"set-item__name"},oW={class:"set-item__details"},lW={key:2,class:"dev-builder-sidebar__empty"},cW={key:0,class:"dev-builder__selection-info"},uW={class:"selection-info"},dW={class:"selection-info__title"},hW={class:"selection-info__details"},fW={key:0,class:"selection-info__detail"},pW={class:"selection-info__label"},mW={key:1,class:"selection-info__detail"},_W={class:"selection-info__label"},vW={class:"selection-info__controls"},gW={class:"control-panel"},yW={class:"control-panel__section"},xW={class:"control-panel__buttons"},bW={class:"control-panel__section"},wW={class:"control-panel__buttons"},SW={class:"control-panel__section"},EW={class:"control-panel__buttons"},MW={__name:"DevBuilder",setup(i){const{t:e}=wn(),t=es(),n=ze(null),s=ze(null),r=ze(!0),a=ze(!1),o=ze(null),l=ze(null),c=ze(""),u=ze(16),d=[4,8,16,32],h=ze("general"),f=ze(null),p=ze([]),m=tt(()=>[{id:"general",label:e("builder.tabs.general")},{id:"blocks",label:e("builder.tabs.blocks")},{id:"minifigures",label:e("builder.tabs.minifigures")},{id:"createSet",label:e("devBuilder.tabs.createSet")},{id:"info",label:e("builder.tabs.info")}]);let _=null;const v=tt(()=>(t.getters["player/purchasedSets"],t.getters["sets/purchasedSets"])),x=tt(()=>t.getters["collections/allCollections"]),y=tt(()=>{if(!s.value)return"";const R=_==null?void 0:_.placedSets.get(s.value.id);if(!R)return"";if(R.setId){const N=v.value.find($=>$.id===R.setId);return(N==null?void 0:N.name)||"Unknown Set"}else if(R.collectionId){const N=x.value.find($=>$.id===R.collectionId);return(N==null?void 0:N.name)||"Unknown Collection"}return"Unknown"}),g=R=>{var N;return{id:R.id,name:R.name,blocks:R.buildData.blocks||[],platformSize:R.buildData.platformSize||20,pieces:((N=R.buildData.blocks)==null?void 0:N.length)||0}},w=R=>{l.value=R},b=()=>{t.dispatch("navigateToScene","mainMenu")},T=async()=>{if(!(!s.value||!_))try{const R=s.value.id;_.removeSet(R),await t.dispatch("setBuilder/removeSet",R),s.value=null,o.value&&o.value.addToast({type:"success",title:e("setBuilder.setRemoved"),message:e("setBuilder.setRemovedMessage"),duration:3e3})}catch(R){console.error("Failed to remove set:",R),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:R.message||e("setBuilder.setRemoveFailed"),duration:3e3})}},E=R=>{if(_){if(s.value){const N=_.placedSets.get(s.value.id);if(N){_.moveBlock(N.group,R);return}}f.value&&!f.value.userData.isSet&&_.moveBlock(f.value,R)}},S=R=>{if(_){if(s.value){const N=_.placedSets.get(s.value.id);if(N){_.rotateBlock(N.group,R);return}}f.value&&!f.value.userData.isSet&&_.rotateBlock(f.value,R)}},M=()=>{if(_){if(s.value){const R=_.placedSets.get(s.value.id);if(R){_.raiseBlockToPlateHeight(R.group);return}}f.value&&!f.value.userData.isSet&&_.raiseBlockToPlateHeight(f.value)}},A=()=>{if(_){if(s.value){const R=_.placedSets.get(s.value.id);if(R){_.lowerBlockToPlateHeight(R.group);return}}f.value&&!f.value.userData.isSet&&_.lowerBlockToPlateHeight(f.value)}},C=tt(()=>{var N;if(!f.value&&!s.value)return!1;const R=f.value||(s.value?(N=_==null?void 0:_.getSelectedSet())==null?void 0:N.group:null);return!(R&&R.userData&&(R.userData.isBasePlate||R.userData.isImmobile))}),I=R=>{let N=R.userData.specialType;if(!N){const ie=R.userData.type||"2x2";N=`${R.userData.blockType||"brick"}-${ie}`}const $={type:N,color:R.userData.color||"red",position:{x:Math.round(R.position.x*1e3)/1e3,y:Math.round(R.position.y*1e3)/1e3,z:Math.round(R.position.z*1e3)/1e3},rotation:{x:Math.round(R.rotation.x*100)/100,y:Math.round(R.rotation.y*100)/100,z:Math.round(R.rotation.z*100)/100}};return R.userData.specialType&&($.specialType=R.userData.specialType),R.userData.blockType&&R.userData.blockType!=="brick"&&($.blockType=R.userData.blockType),R.userData.width&&R.userData.width!==1&&($.width=R.userData.width),R.userData.length&&R.userData.length!==1&&($.length=R.userData.length),R.userData.blockHeight&&R.userData.blockHeight!==.96&&($.blockHeight=R.userData.blockHeight),R.userData.isGlass&&($.isGlass=!0),$},H=()=>{if(!_)return;const R=_.selectionManager.getSelectedBrick(),N=_.getSelectedSet();let $=null,ie=null;if(N){const ve=_.placedSets.get(N.id);if(ve){const k=[];ve.group.traverse(V=>{V.userData&&V.userData.isBrick&&!V.userData.isBasePlate&&k.push(I(V))}),k.reverse().forEach(V=>{p.value.unshift(V)}),ie=N.id,_.removeSet(ie),t.dispatch("setBuilder/removeSet",ie).catch(V=>{console.error("Failed to remove set:",V)}),s.value=null,f.value=null,o.value&&o.value.addToast({type:"success",title:e("devBuilder.blockAddedToSet"),message:e("devBuilder.setAddedToSetMessage"),duration:2e3});return}}if(R&&!R.userData.isSet?$=R:f.value&&!f.value.userData.isSet&&($=f.value),!$||$.userData&&($.userData.isBasePlate||$.userData.isImmobile))return;const ye=I($);_.removeBrick($),p.value.unshift(ye),f.value=null,o.value&&o.value.addToast({type:"success",title:e("devBuilder.blockAddedToSet"),message:e("devBuilder.blockAddedToSetMessage"),duration:2e3})},W=async R=>{if(!_||R<0||R>=p.value.length)return;const N=p.value[R];p.value.splice(R,1);try{await _.saveLoadManager.createBlockFromData(N),o.value&&o.value.addToast({type:"success",title:e("devBuilder.blockRemovedFromSet"),message:e("devBuilder.blockRestoredToScene"),duration:2e3})}catch($){console.error("Failed to restore block to scene:",$),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:e("devBuilder.failedToRestoreBlock"),duration:3e3})}},z=()=>{p.value=[],o.value&&o.value.addToast({type:"info",title:e("devBuilder.setCleared"),message:e("devBuilder.setClearedMessage"),duration:2e3})},q=()=>{if(!_)return;const R=_.selectionManager.getSelectedBrick(),N=_.getSelectedSet();if(N){const ie=N.id;_.removeSet(ie),t.dispatch("setBuilder/removeSet",ie).catch(ye=>{console.error("Failed to remove set:",ye)}),s.value=null,f.value=null;return}if(s.value){T();return}const $=R||f.value;if($){if($.userData&&($.userData.isImmobile||$.userData.isBasePlate))return;_.removeBrick($),f.value=null}},O=()=>{_&&(_.selectionManager.onSelectionChange=R=>{if(f.value=R,R&&R.userData.isSet){const N=R.userData.setId;N?s.value={id:N}:s.value=null}else s.value=null},_.onSetSelected=R=>{R?s.value={id:R}:s.value=null},_.onSetMoved=async(R,N,$)=>{try{await t.dispatch("setBuilder/moveSet",{id:R,position:N,rotation:$})}catch(ie){console.error("Failed to move set:",ie)}},_.onSetRemoved=async R=>{try{await t.dispatch("setBuilder/removeSet",R),s.value&&s.value.id===R&&(s.value=null)}catch(N){console.error("Failed to remove set:",N)}})},re=async()=>{if(!_)return;const R=t.getters["setBuilder/allPlacedSets"],N=async($,ie)=>{if($){const ye=v.value.find(ve=>ve.id===$);if(ye)return{id:ye.id,blocks:ye.blocks,platformSize:ye.platformSize||20}}if(ie){const ye=x.value.find(ve=>ve.id===ie);if(ye)return{id:ye.id,collectionId:ye.id,buildData:ye.buildData}}return null};await _.loadPlacedSets(R,N)},le=R=>{if(!_||!l.value)return;const N=n.value.getBoundingClientRect(),$=R.clientX-N.left,ie=R.clientY-N.top;setTimeout(()=>{const ye={x:$/N.width*2-1,y:-(ie/N.height*2)+1},ve=_.placementManager.raycaster;ve.setFromCamera(ye,_.camera);const k=Array.from(_.placedSets.values()).map(L=>L.group);if(ve.intersectObjects(k,!0).length>0)return;const de=_.scene.children.filter(L=>L.userData.isGround),D=ve.intersectObjects(de,!0);if(D.length>0){const L=D[0].point;Z(L).catch(J=>{console.error("Failed to place set:",J)})}},0)},Z=async R=>{if(!(!l.value||!_||a.value)){a.value=!0;try{let N;if(l.value.type==="purchased"){const ve=v.value.find(k=>k.id===l.value.setId);if(!ve)return;N={id:ve.id,blocks:ve.blocks,platformSize:ve.platformSize||20}}else if(l.value.type==="collection"){const ve=x.value.find(k=>k.id===l.value.collectionId);if(!ve)return;N={id:ve.id,collectionId:ve.id,buildData:ve.buildData}}if(!N)return;const $=`temp-${Date.now()}`;await _.placeSet($,N,R,{x:0,y:0,z:0});const ie=_.placedSets.get($);if(!ie)throw new Error("Failed to place set");const ye=await t.dispatch("setBuilder/placeSet",{setId:l.value.type==="purchased"?l.value.setId:null,collectionId:l.value.type==="collection"?l.value.collectionId:null,buildData:N.buildData||{blocks:N.blocks,platformSize:N.platformSize||20},position:ie.position,rotation:ie.rotation});_.removeSet($),await _.placeSet(ye.id,N,ye.position,typeof ye.rotation=="object"?ye.rotation:{x:0,y:ye.rotation||0,z:0}),l.value=null,o.value&&o.value.addToast({type:"success",title:e("devBuilder.setPlaced"),message:e("devBuilder.setPlacedMessage"),duration:3e3})}catch(N){console.error("Failed to place set:",N),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:N.message||e("devBuilder.setPlaceFailed"),duration:3e3})}finally{a.value=!1}}},ne=R=>{u.value=R,_&&_.createPlatform(R)},j=()=>{if(!_)return;const R=_.saveLoadManager.exportBuild();c.value=R,navigator.clipboard.writeText(R).catch(()=>{}),o.value&&o.value.addToast({type:"success",title:e("builder.buildSaved"),message:e("builder.buildSaved"),duration:2e3})},ee=()=>{if(_)try{const R=_.saveLoadManager.exportBuild(),N=JSON.parse(R),$=Zm(N);navigator.clipboard.writeText($).catch(()=>{}),o.value&&o.value.addToast({type:"success",title:e("collections.codeCopied"),message:e("collections.codeCopied"),duration:2e3})}catch(R){console.error("Failed to export as code:",R),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:"Failed to export as code",duration:3e3})}},F=async()=>{if(!(!_||!c.value.trim()))try{await _.saveLoadManager.importBuild(c.value),o.value&&o.value.addToast({type:"success",title:e("builder.buildLoaded"),message:e("builder.buildLoaded"),duration:2e3})}catch(R){console.error("Import error:",R),o.value&&o.value.addToast({type:"error",title:e("common.error"),message:R.message||e("builder.importFailed"),duration:3e3})}},X=async()=>{if(!_)return;const R=`{
  "version": "2.0",
  "timestamp": "2025-11-02T06:06:14.891Z",
  "blocks": [
    {
      "type": "2x6",
      "blockType": "brick",
      "width": 2,
      "length": 6,
      "blockHeight": 0.96,
      "color": "red",
      "isGlass": false,
      "position": {
        "x": 0.8,
        "y": 0.481,
        "z": 0.8
      },
      "rotation": {
        "x": 0,
        "y": 0,
        "z": 0
      }
    },
    {
      "type": "2x6",
      "blockType": "brick",
      "width": 2,
      "length": 6,
      "blockHeight": 0.96,
      "color": "blue",
      "isGlass": false,
      "position": {
        "x": 0.8,
        "y": 1.442,
        "z": 0.8
      },
      "rotation": {
        "x": 0,
        "y": 0,
        "z": 0
      }
    }
  ]
}`;c.value=R,await F()},Q=()=>{_&&(_.saveLoadManager.clearAllBlocks(),c.value="",o.value&&o.value.addToast({type:"success",title:e("builder.buildCleared"),message:e("builder.buildCleared"),duration:2e3}))},ue=async R=>{R!==void 0&&(c.value=R),c.value.trim()&&c.value.includes('"blocks"')&&setTimeout(async()=>{c.value.trim()&&await F()},1e3)},ce=(R,N,$)=>{if(!_||!R)return;_.addBrick(R),_.selectionManager&&_.selectionManager.selectBrick(R);const ie=n.value.getBoundingClientRect(),ye=N-ie.left,ve=$-ie.top,k={x:ye/ie.width*2-1,y:-(ve/ie.height*2)+1};if(_.dragController){_.dragController.mouse.set(k.x,k.y),_.dragController.raycaster.setFromCamera(_.dragController.mouse,_.dragController.camera);const V=_.dragController.threeScene.children.filter(D=>D.userData.isGround),de=_.dragController.raycaster.intersectObjects(V,!0);if(de.length>0){const D=de[0].point;(R.userData.isMinifigure||R.userData.specialType==="minifigure")&&(D.y+=As),R.position.copy(D)}_.dragController.startDraggingFromPalette(R)}},xe=()=>{if(!_||!_.renderer||!_.scene||!_.camera){o.value&&o.value.addToast({type:"error",title:e("builder.screenshotError"),message:e("builder.sceneNotReady"),duration:3e3});return}try{_.controls&&_.controls.update(),requestAnimationFrame(()=>{try{_.renderer.render(_.scene,_.camera),requestAnimationFrame(()=>{try{const R=_.renderer.domElement;if(!R||R.width===0||R.height===0)throw new Error("Canvas is not ready");const N=_.renderer.getContext(),$=R.width,ie=R.height;let ye;try{if(ye=R.toDataURL("image/png",1),!ye||ye==="data:,")throw new Error("toDataURL returned empty data")}catch(V){console.warn("toDataURL failed, using readPixels fallback:",V);const de=new Uint8Array($*ie*4);N.readPixels(0,0,$,ie,N.RGBA,N.UNSIGNED_BYTE,de);const D=new Uint8Array($*ie*4);for(let te=0;te<ie;te++){const me=te*$*4,Ie=(ie-1-te)*$*4;D.set(de.subarray(me,me+$*4),Ie)}const L=document.createElement("canvas");L.width=$,L.height=ie;const J=L.getContext("2d"),K=J.createImageData($,ie);K.data.set(D),J.putImageData(K,0,0),ye=L.toDataURL("image/png",1)}const ve=Me(ye),k=`dev-builder-screenshot-${Date.now()}.png`;Y(k,ve),o.value&&o.value.addToast({type:"success",title:e("builder.screenshotSaved"),message:e("builder.screenshotSaved"),duration:2e3})}catch(R){console.error("Screenshot capture failed:",R),o.value&&o.value.addToast({type:"error",title:e("builder.screenshotError"),message:R.message||"Failed to capture screenshot",duration:3e3})}})}catch(R){console.error("Screenshot render failed:",R),o.value&&o.value.addToast({type:"error",title:e("builder.screenshotError"),message:R.message||"Failed to render screenshot",duration:3e3})}})}catch(R){console.error("Screenshot failed:",R),o.value&&o.value.addToast({type:"error",title:e("builder.screenshotError"),message:R.message||"Failed to take screenshot",duration:3e3})}},Me=R=>{const N=R.split(","),$=N[0].match(/:(.*?);/)[1],ie=atob(N[1]);let ye=ie.length;const ve=new Uint8Array(ye);for(;ye--;)ve[ye]=ie.charCodeAt(ye);return new Blob([ve],{type:$})},Y=(R,N)=>{const $=URL.createObjectURL(N),ie=document.createElement("a");ie.href=$,ie.download=R,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL($)};In(async()=>{n.value&&(_=new MG(n.value),await _.loadingPromise,O(),r.value=!1,t.dispatch("setBuilder/loadBuilderState").then(()=>{re()}),n.value.addEventListener("click",le),window.addEventListener("resize",P))}),Ds(()=>{_&&(n.value&&n.value.removeEventListener("click",le),_.dispose()),window.removeEventListener("resize",P)});const P=ya(()=>{_&&_.resize()},200);return(R,N)=>(oe(),ge("div",xH,[B("div",bH,[B("div",wH,[B("div",SH,[B("h2",EH,se(R.$t("devBuilder.title")),1),we(wt,{variant:"ghost",size:"sm",onClick:b},{default:Le(()=>[Oe("  "+se(R.$t("common.back")),1)]),_:1})]),B("div",MH,[B("div",TH,[(oe(!0),ge(At,null,Zt(m.value,$=>(oe(),ge("button",{key:$.id,onClick:ie=>h.value=$.id,class:qt(["dev-builder-sidebar__tab",{"dev-builder-sidebar__tab--active":h.value===$.id}])},se($.label),11,AH))),128))]),B("div",CH,[h.value==="general"?(oe(),ge("div",PH,[B("div",RH,[B("h3",LH,se(R.$t("builder.platformSize")),1),B("div",IH,[(oe(),ge(At,null,Zt(d,$=>we(wt,{key:$,variant:u.value===$?"primary":"outline",size:"sm",class:"button",onClick:ie=>ne($)},{default:Le(()=>[Oe(se($)+"x"+se($),1)]),_:2},1032,["variant","onClick"])),64))])]),B("div",DH,[B("h3",kH,se(R.$t("builder.saveLoad")),1),B("div",BH,[we(wt,{variant:"primary",size:"sm",class:"button",onClick:j},{default:Le(()=>[Oe(se(R.$t("builder.exportBuild")),1)]),_:1}),we(wt,{variant:"outline",size:"sm",class:"button",onClick:ee},{default:Le(()=>[Oe("  "+se(R.$t("collections.copyCode")),1)]),_:1}),we(wt,{variant:"secondary",size:"sm",class:"button",onClick:F},{default:Le(()=>[Oe(se(R.$t("builder.importBuild")),1)]),_:1}),we(wt,{variant:"outline",size:"sm",class:"button",onClick:X},{default:Le(()=>[Oe(se(R.$t("builder.loadTestBuild")),1)]),_:1}),we(wt,{variant:"danger",size:"sm",class:"button",onClick:Q},{default:Le(()=>[Oe(se(R.$t("builder.clearAll")),1)]),_:1})])]),B("div",OH,[B("h3",NH,se(R.$t("builder.screenshot")),1),B("div",FH,[we(wt,{variant:"primary",size:"sm",class:"button",onClick:xe},{default:Le(()=>[Oe("  "+se(R.$t("builder.takeScreenshot")),1)]),_:1})])]),B("div",UH,[B("h3",zH,se(R.$t("builder.buildData")),1),we(yd,{"model-value":c.value,placeholder:R.$t("builder.jsonPlaceholder"),rows:8,"onUpdate:modelValue":ue},null,8,["model-value","placeholder"]),B("p",VH,se(R.$t("builder.jsonHint")),1)])])):Ve("",!0),h.value==="blocks"?(oe(),ge("div",GH,[we(ZG,{"on-create-block":ce})])):Ve("",!0),h.value==="minifigures"?(oe(),ge("div",HH,[we(Cb,{"on-create-block":ce})])):Ve("",!0),h.value==="info"?(oe(),ge("div",WH,[we(Pb)])):Ve("",!0),h.value==="createSet"?(oe(),ge("div",$H,[we(yH,{"set-blocks":p.value,"platform-size":u.value,onRemoveBlock:W,onClearSet:z},null,8,["set-blocks","platform-size"])])):Ve("",!0)]),v.value.length>0&&h.value!=="createSet"?(oe(),ge("div",XH,[B("h3",qH,se(R.$t("setBuilder.purchasedSets")),1),B("div",YH,[(oe(!0),ge(At,null,Zt(v.value,$=>(oe(),ge("div",{key:$.id,class:"set-item",onClick:ie=>w({setId:$.id,type:"purchased"})},[B("div",KH,[we(oo,{set:$},null,8,["set"])]),B("div",ZH,[B("h4",JH,se($.name),1),B("div",QH,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>{var ie;return[Oe("  "+se($.pieces||((ie=$.blocks)==null?void 0:ie.length)||0),1)]}),_:2},1024)])])],8,jH))),128))])])):Ve("",!0),x.value.length>0&&h.value!=="createSet"?(oe(),ge("div",eW,[B("h3",tW,se(R.$t("setBuilder.collections")),1),B("div",nW,[(oe(!0),ge(At,null,Zt(x.value,$=>(oe(),ge("div",{key:$.id,class:"set-item",onClick:ie=>w({collectionId:$.id,type:"collection"})},[B("div",sW,[we(oo,{set:g($)},null,8,["set"])]),B("div",rW,[B("h4",aW,se($.name),1),B("div",oW,[we(_n,{variant:"default",size:"sm"},{default:Le(()=>{var ie,ye;return[Oe("  "+se(((ye=(ie=$.buildData)==null?void 0:ie.blocks)==null?void 0:ye.length)||0),1)]}),_:2},1024)])])],8,iW))),128))])])):Ve("",!0),v.value.length===0&&x.value.length===0?(oe(),ge("div",lW,[B("p",null,se(R.$t("setBuilder.noSetsAvailable")),1)])):Ve("",!0)])])]),B("div",{ref_key:"threeContainer",ref:n,class:"dev-builder__canvas"},[s.value||f.value?(oe(),ge("div",cW,[B("div",uW,[B("h4",dW,se(s.value?R.$t("devBuilder.selectedSet"):R.$t("builder.selectedBlock")),1),B("div",hW,[s.value?(oe(),ge("p",fW,[B("span",pW,se(R.$t("setBuilder.setName"))+":",1),Oe(" "+se(y.value),1)])):f.value?(oe(),ge("p",mW,[B("span",_W,se(R.$t("blocks.size"))+":",1),Oe(" "+se(f.value.userData.width)+"x"+se(f.value.userData.length),1)])):Ve("",!0),B("div",vW,[Hn(R.$slots,"controls",{selectedSet:s.value,selectedBrick:f.value},()=>[B("div",gW,[B("div",yW,[B("div",xW,[we(wt,{variant:"outline",size:"sm",onClick:N[0]||(N[0]=$=>E("forward")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[7]||(N[7]=[Oe("  ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:N[1]||(N[1]=$=>E("backward")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[8]||(N[8]=[Oe("  ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:N[2]||(N[2]=$=>E("left")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[9]||(N[9]=[Oe("  ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:N[3]||(N[3]=$=>E("right")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[10]||(N[10]=[Oe("  ",-1)])]),_:1},8,["disabled"])])]),B("div",bW,[B("div",wW,[we(wt,{variant:"outline",size:"sm",onClick:N[4]||(N[4]=$=>S("x")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[11]||(N[11]=[Oe(" X+90 ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:N[5]||(N[5]=$=>S("y")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[12]||(N[12]=[Oe(" Y+90 ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:N[6]||(N[6]=$=>S("z")),disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[13]||(N[13]=[Oe(" Z+90 ",-1)])]),_:1},8,["disabled"])])]),B("div",SW,[B("div",EW,[we(wt,{variant:"primary",size:"sm",onClick:M,disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[14]||(N[14]=[Oe("  ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"outline",size:"sm",onClick:A,disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[15]||(N[15]=[Oe("  ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"danger",size:"sm",onClick:q,disabled:!s.value&&!f.value,class:"control-panel__button"},{default:Le(()=>[...N[16]||(N[16]=[Oe("  ",-1)])]),_:1},8,["disabled"]),we(wt,{variant:"primary",size:"sm",onClick:H,disabled:!C.value,class:"control-panel__button"},{default:Le(()=>[Oe(se(R.$t("devBuilder.addToSet")),1)]),_:1},8,["disabled"])])])])])])])])])):Ve("",!0),r.value?(oe(),jt(ca,{key:1,variant:"spinner",size:"lg",text:R.$t("common.loading"),overlay:""},null,8,["text"])):Ve("",!0),a.value?(oe(),jt(ca,{key:2,variant:"spinner",size:"lg",text:R.$t("devBuilder.placingSet"),overlay:""},null,8,["text"])):Ve("",!0)],512),we(ga,{position:"top-center",ref_key:"toastContainer",ref:o},null,512)]))}},TW=Ht(MW,[["__scopeId","data-v-6a529a3f"]]),AW={class:"game-router"},CW={__name:"GameRouter",setup(i){const e=es(),t=tt(()=>e.getters.currentScene),n=async()=>{t.value==="builder"&&await $i.showInterstitialAd(),e.dispatch("navigateToScene","mainMenu")},s=async r=>{switch(r.key){case"Escape":t.value!=="mainMenu"&&n();break;case"t":case"T":r.preventDefault(),await jB();break}};return In(()=>{window.addEventListener("keydown",s)}),Ds(()=>{window.removeEventListener("keydown",s)}),(r,a)=>(oe(),ge("div",AW,[t.value==="mainMenu"?(oe(),jt(Jk,{key:0})):Ve("",!0),t.value==="builder"?(oe(),jt(jN,{key:1})):Ve("",!0),t.value==="shop"?(oe(),jt(BF,{key:2})):Ve("",!0),t.value==="set-selection"?(oe(),jt(QF,{key:3})):Ve("",!0),t.value==="box-opening"?(oe(),jt(XV,{key:4})):Ve("",!0),t.value==="assembly"?(oe(),jt(p4,{key:5})):Ve("",!0),t.value==="character"?(oe(),jt(A4,{key:6})):Ve("",!0),t.value==="collections"?(oe(),jt($4,{key:7})):Ve("",!0),t.value==="set-builder"?(oe(),jt(SG,{key:8})):Ve("",!0),t.value==="dev-builder"?(oe(),jt(TW,{key:9})):Ve("",!0)]))}},PW=Ht(CW,[["__scopeId","data-v-97353d9a"]]),RW={name:"App",components:{Layout:ik,GameRouter:PW}},LW={id:"app"};function IW(i,e,t,n,s,r){const a=If("GameRouter"),o=If("Layout");return oe(),ge("div",LW,[we(o,null,{default:Le(()=>[we(a)]),_:1})])}const DW=Ht(RW,[["render",IW]]),kW={namespaced:!0,state:{name:"Player",avatar:1,coins:1e3,purchasedSets:[],totalSetsBuilt:0,totalCoinsEarned:0,playTime:0,soundEnabled:!0,musicEnabled:!0},mutations:{SET_NAME(i,e){typeof e=="string"&&e.trim().length>0&&(i.name=e.trim())},SET_AVATAR(i,e){typeof e=="number"&&e>=1&&e<=10&&(i.avatar=e)},ADD_COINS(i,e){typeof e=="number"&&e>0&&(i.coins+=e,i.totalCoinsEarned+=e)},REMOVE_COINS(i,e){typeof e=="number"&&e>0&&(i.coins=Math.max(0,i.coins-e))},SET_COINS(i,e){typeof e=="number"&&e>=0&&(i.coins=e)},ADD_PURCHASED_SET(i,e){typeof e=="string"&&!i.purchasedSets.includes(e)&&i.purchasedSets.push(e)},SET_PURCHASED_SETS(i,e){Array.isArray(e)&&(i.purchasedSets=[...e])},INCREMENT_SETS_BUILT(i){i.totalSetsBuilt++},ADD_PLAY_TIME(i,e){typeof e=="number"&&e>0&&(i.playTime+=e)},TOGGLE_SOUND(i){i.soundEnabled=!i.soundEnabled},TOGGLE_MUSIC(i){i.musicEnabled=!i.musicEnabled},LOAD_PLAYER_DATA(i,e){e&&typeof e=="object"&&(e.name&&(i.name=e.name),e.avatar&&(i.avatar=e.avatar),e.coins!==void 0&&(i.coins=e.coins),e.purchasedSets&&(i.purchasedSets=e.purchasedSets),e.totalSetsBuilt&&(i.totalSetsBuilt=e.totalSetsBuilt),e.totalCoinsEarned&&(i.totalCoinsEarned=e.totalCoinsEarned),e.playTime&&(i.playTime=e.playTime),e.soundEnabled!==void 0&&(i.soundEnabled=e.soundEnabled),e.musicEnabled!==void 0&&(i.musicEnabled=e.musicEnabled))}},actions:{async buySet({commit:i,state:e,dispatch:t},n){try{const{id:s,price:r}=n;if(!s||typeof r!="number"||r<=0)throw new Error("Invalid set data");if(e.coins<r)throw new Error("Insufficient funds");if(e.purchasedSets.includes(s))throw new Error("Set already purchased");return i("REMOVE_COINS",r),i("ADD_PURCHASED_SET",s),await t("savePlayerData"),!0}catch(s){throw console.error("Buy set error:",s),s}},async earnCoins({commit:i,dispatch:e},t){try{if(typeof t!="number"||t<=0)throw new Error("Invalid coin amount");i("ADD_COINS",t),await e("savePlayerData")}catch(n){throw console.error("Earn coins error:",n),n}},async completeSet({commit:i,dispatch:e},t){try{const{id:n,reward:s}=t;i("INCREMENT_SETS_BUILT"),s&&s>0&&await e("earnCoins",s),await e("savePlayerData")}catch(n){throw console.error("Complete set error:",n),n}},async loadPlayerData({commit:i}){try{if(await $i.isPlayerAuthorized()){const n=$i.getPlayerInfo();n&&i("SET_PLAYER_NAME",n.name)}const t=await $i.loadPlayerData();i("SET_PLAYER_NAME",t.name||"Guest Player"),i("SET_PLAYER_AVATAR",t.avatar||1),i("SET_COINS",t.coins||1e3),t.purchasedSets&&t.purchasedSets.forEach(n=>{i("ADD_PURCHASED_SET",n)})}catch(e){console.error("Load player data error:",e)}},async savePlayerData({state:i}){try{const e={name:i.name,avatar:i.avatar,coins:i.coins,purchasedSets:i.purchasedSets,totalSetsBuilt:i.totalSetsBuilt,totalCoinsEarned:i.totalCoinsEarned,playTime:i.playTime,soundEnabled:i.soundEnabled,musicEnabled:i.musicEnabled};await $i.savePlayerData(e),localStorage.setItem("lego-game-player",JSON.stringify(e))}catch(e){console.error("Save player data error:",e);const t={name:i.name,avatar:i.avatar,coins:i.coins,purchasedSets:i.purchasedSets,totalSetsBuilt:i.totalSetsBuilt,totalCoinsEarned:i.totalCoinsEarned,playTime:i.playTime,soundEnabled:i.soundEnabled,musicEnabled:i.musicEnabled};localStorage.setItem("lego-game-player",JSON.stringify(t))}},async trackEvent({state:i},e){try{const{event:t,data:n={}}=e;if(!t||typeof t!="string")throw new Error("Invalid event data");await $i.trackEvent(t,{...n,playerId:i.name,timestamp:new Date().toISOString()})}catch(t){console.error("Track event error:",t)}},async watchAdForCoins({commit:i,dispatch:e}){try{const t=await $i.showRewardedAd();return t.watched?(i("ADD_COINS",t.reward),await e("savePlayerData"),await e("trackEvent",{event:"ad_watched",data:{type:"rewarded",reward:t.reward}}),{success:!0,reward:t.reward}):{success:!1,reward:0}}catch(t){return console.error("Watch ad error:",t),{success:!1,reward:0}}},async setName({commit:i,dispatch:e},t){try{i("SET_NAME",t),await e("savePlayerData")}catch(n){throw console.error("Set name error:",n),n}},async setAvatar({commit:i,dispatch:e},t){try{i("SET_AVATAR",t),await e("savePlayerData")}catch(n){throw console.error("Set avatar error:",n),n}},async toggleSound({commit:i,dispatch:e}){try{i("TOGGLE_SOUND"),await e("savePlayerData")}catch(t){throw console.error("Toggle sound error:",t),t}},async toggleMusic({commit:i,dispatch:e}){try{i("TOGGLE_MUSIC"),await e("savePlayerData")}catch(t){throw console.error("Toggle music error:",t),t}}},getters:{canAfford:i=>e=>typeof e=="number"&&i.coins>=e,ownsSet:i=>e=>typeof e=="string"&&i.purchasedSets.includes(e),displayName:i=>i.name||"Player",formattedCoins:i=>i.coins.toLocaleString(),purchasedSets:i=>i.purchasedSets||[]}},BW={namespaced:!0,state:{blocks:[]},mutations:{ADD_BLOCKS(i,e){Array.isArray(e)?e.forEach(t=>this.commit("inventory/ADD_SINGLE_BLOCK",t)):block&&typeof block=="object"&&this.commit("inventory/ADD_SINGLE_BLOCK",e)},ADD_SINGLE_BLOCK(i,e){if(!e||typeof e!="object")return;const{type:t,color:n,count:s=1,specialType:r,blockType:a}=e;if(!t||!n||typeof s!="number"||s<=0){console.warn("Invalid block data:",e);return}const o=i.blocks.findIndex(l=>l.type===t&&l.color===n&&l.specialType===(r||null));o>=0?i.blocks[o].count+=s:i.blocks.push({type:t,color:n,count:s,specialType:r||null,blockType:a||null})},REMOVE_BLOCK(i,e){if(!e||typeof e!="object")return;const{type:t,color:n,count:s=1,specialType:r}=e;if(!t||!n||typeof s!="number"||s<=0)return;const a=i.blocks.findIndex(o=>{const l=o.type===t,c=o.color===n,u=(o.specialType||null)===(r||null);return l&&c&&u});if(a>=0){const o=i.blocks[a];o.count>s?o.count-=s:i.blocks.splice(a,1)}},SET_BLOCK_COUNT(i,e){if(!e||typeof e!="object")return;const{type:t,color:n,count:s}=e;if(!t||!n||typeof s!="number"||s<0){console.warn("Invalid block data for count setting:",e);return}const r=i.blocks.findIndex(a=>a.type===t&&a.color===n);s===0?r>=0&&i.blocks.splice(r,1):r>=0?i.blocks[r].count=s:i.blocks.push({type:t,color:n,count:s})},CLEAR_INVENTORY(i){i.blocks=[]},LOAD_INVENTORY(i,e){Array.isArray(e)&&(i.blocks=e.map(t=>({type:t.type||"",color:t.color||"",count:typeof t.count=="number"?t.count:1})))}},actions:{addSetBlocks({commit:i},e){try{if(!Array.isArray(e))throw new Error("Invalid set blocks data");const t={};e.forEach(n=>{if(n&&n.type&&n.color){const s=Lc(n),r=n.specialType||null,a=`${s}-${n.color}`;t[a]||(t[a]={type:s,color:n.color,specialType:r,blockType:n.blockType||null,count:0}),t[a].count++}}),Object.values(t).forEach(n=>{i("ADD_SINGLE_BLOCK",{type:n.type,color:n.color,count:n.count,specialType:n.specialType,blockType:n.blockType})})}catch(t){throw console.error("Add set blocks error:",t),t}},removeBlock({commit:i},e){i("REMOVE_BLOCK",e)},async useBlocks({commit:i,state:e},t){try{if(!Array.isArray(t))throw new Error("Invalid required blocks data");for(const n of t){const{type:s,color:r,count:a=1}=n;if(!s||!r)continue;const o=e.blocks.find(l=>l.type===s&&l.color===r);if(!o||o.count<a)throw new Error(`Insufficient blocks: ${s} ${r}`)}return t.forEach(n=>{i("REMOVE_BLOCK",n)}),!0}catch(n){throw console.error("Use blocks error:",n),n}},saveInventory({state:i}){try{localStorage.setItem("lego-game-inventory",JSON.stringify(i.blocks))}catch(e){console.error("Save inventory error:",e)}},loadInventory({commit:i}){try{const e=localStorage.getItem("lego-game-inventory");if(e){const t=JSON.parse(e);i("LOAD_INVENTORY",t)}}catch(e){console.error("Load inventory error:",e),i("CLEAR_INVENTORY")}}},getters:{getBlockCount:i=>(e,t)=>{if(!e||!t)return 0;const n=i.blocks.find(s=>s.type===e&&s.color===t);return n?n.count:0},hasBlock:i=>(e,t,n=1)=>getters.getBlockCount(i)(e,t)>=n,totalBlocks:i=>i.blocks.reduce((e,t)=>e+t.count,0),uniqueBlockTypes:i=>{const e=new Set;return i.blocks.forEach(t=>e.add(t.type)),Array.from(e)},blocksByType:i=>{const e={};return i.blocks.forEach(t=>{e[t.type]||(e[t.type]=[]),e[t.type].push(t)}),e},inventoryArray:i=>[...i.blocks].sort((e,t)=>e.type!==t.type?e.type.localeCompare(t.type):e.color.localeCompare(t.color))}},OW={namespaced:!0,state:{availableSets:[],currentSet:null,buildProgress:0,currentGhostIndex:0,isLoadingSets:!1,isBuilding:!1},mutations:{SET_AVAILABLE_SETS(i,e){Array.isArray(e)&&(i.availableSets=e)},SET_CURRENT_SET(i,e){i.currentSet=e,e&&(i.buildProgress=0,i.currentGhostIndex=0)},UPDATE_BUILD_PROGRESS(i,e){typeof e=="number"&&e>=0&&e<=100&&(i.buildProgress=e)},SET_CURRENT_GHOST_INDEX(i,e){typeof e=="number"&&e>=0&&(i.currentGhostIndex=e)},NEXT_GHOST_BLOCK(i){if(i.currentSet&&i.currentSet.blocks){const e=i.currentSet.blocks.length-1;if(i.currentGhostIndex<e){i.currentGhostIndex++;const t=(i.currentGhostIndex+1)/i.currentSet.blocks.length*100;i.buildProgress=Math.min(100,t)}}},RESET_BUILD_PROGRESS(i){i.buildProgress=0,i.currentGhostIndex=0},SET_LOADING_SETS(i,e){i.isLoadingSets=e},SET_BUILDING(i,e){i.isBuilding=e}},actions:{async loadSetsFromJSON({commit:i}){try{i("SET_LOADING_SETS",!0);const e=await fetch("/data/lego-sets.json");if(!e.ok)throw new Error(`Failed to load sets: ${e.status}`);const t=await e.json();if(!Array.isArray(t))throw new Error("Invalid sets data format");const n=t.filter(s=>s&&typeof s.id=="string"&&typeof s.name=="string"&&typeof s.price=="number"&&Array.isArray(s.blocks));i("SET_AVAILABLE_SETS",n)}catch(e){throw console.error("Load sets error:",e),i("SET_AVAILABLE_SETS",[]),e}finally{i("SET_LOADING_SETS",!1)}},selectSet({commit:i,state:e},t){try{if(!t||typeof t!="string")throw new Error("Invalid set ID");const n=e.availableSets.find(a=>a.id===t);if(!n)throw new Error("Set not found");const s=[...n.blocks].sort((a,o)=>{const l=a.order||0,c=o.order||0;return l-c}),r={...n,blocks:s};i("SET_CURRENT_SET",r)}catch(n){throw console.error("Select set error:",n),n}},startBuilding({commit:i,state:e}){try{if(!e.currentSet)throw new Error("No set selected");i("SET_BUILDING",!0),i("RESET_BUILD_PROGRESS")}catch(t){throw console.error("Start building error:",t),t}},completeGhostBlock({commit:i,state:e,dispatch:t}){try{if(!e.currentSet||!e.isBuilding)throw new Error("No active build session");const{blocks:n}=e.currentSet;e.currentGhostIndex>=n.length-1?(i("SET_BUILDING",!1),i("UPDATE_BUILD_PROGRESS",100),t("player/completeSet",{id:e.currentSet.id,reward:e.currentSet.reward||50},{root:!0})):i("NEXT_GHOST_BLOCK")}catch(n){throw console.error("Complete ghost block error:",n),n}},stopBuilding({commit:i}){i("SET_BUILDING",!1),i("RESET_BUILD_PROGRESS")},getCurrentGhostBlock({state:i}){if(!i.currentSet||!i.isBuilding)return null;const{blocks:e}=i.currentSet,t=i.currentGhostIndex;return t>=0&&t<e.length?e[t]:null}},getters:{availableForPurchase:(i,e,t,n)=>{const s=n["player/purchasedSets"]||[];return i.availableSets.filter(r=>!s.includes(r.id))},purchasedSets:(i,e,t,n)=>{const s=n["player/purchasedSets"]||[];return i.availableSets.filter(a=>s.includes(a.id))},currentGhostBlock:i=>{if(!i.currentSet||!i.isBuilding)return null;const{blocks:e}=i.currentSet,t=i.currentGhostIndex;return t>=0&&t<e.length?e[t]:null},isBuildCompleted:i=>!i.currentSet||!i.isBuilding?!1:i.currentGhostIndex>=i.currentSet.blocks.length-1,buildProgressPercentage:i=>Math.round(i.buildProgress),setsByDifficulty:i=>e=>e?i.availableSets.filter(t=>{const n=t.pieces||t.blocks.length;switch(e){case"easy":return n<=50;case"medium":return n>50&&n<=150;case"hard":return n>150;default:return!0}}):i.availableSets,setsByPriceRange:i=>(e=0,t=1/0)=>i.availableSets.filter(n=>{const s=n.price||0;return s>=e&&s<=t})}},NW={namespaced:!0,state:{collections:[]},mutations:{LOAD_COLLECTIONS(i,e){Array.isArray(e)&&(i.collections=e)},ADD_COLLECTION(i,e){e&&typeof e=="object"&&i.collections.push(e)},REMOVE_COLLECTION(i,e){const t=i.collections.findIndex(n=>n.id===e);t!==-1&&i.collections.splice(t,1)},UPDATE_COLLECTION(i,e){const t=i.collections.findIndex(n=>n.id===e.id);t!==-1&&(i.collections[t]={...i.collections[t],...e})}},actions:{async loadCollections({commit:i}){var e;try{let t=null;if((e=window.bridge)!=null&&e.storage){const n=window.bridge.STORAGE_TYPE.PLATFORM_INTERNAL;if(await window.bridge.storage.isAvailable(n)){const r=await window.bridge.storage.get("collections_data",n);r&&(t=JSON.parse(r))}}if(!t){const n=localStorage.getItem("lego-game-collections");n&&(t=JSON.parse(n))}t&&Array.isArray(t.collections)?i("LOAD_COLLECTIONS",t.collections):i("LOAD_COLLECTIONS",[])}catch(t){console.error("Load collections error:",t),i("LOAD_COLLECTIONS",[])}},async saveCollectionsToStorage({state:i}){var e;try{const t={collections:i.collections},n=JSON.stringify(t);if(localStorage.setItem("lego-game-collections",n),(e=window.bridge)!=null&&e.storage){const s=window.bridge.STORAGE_TYPE.PLATFORM_INTERNAL;await window.bridge.storage.isAvailable(s)&&await window.bridge.storage.set("collections_data",n,s)}}catch(t){console.error("Save collections error:",t);try{const n={collections:i.collections};localStorage.setItem("lego-game-collections",JSON.stringify(n))}catch(n){console.error("Failed to save to localStorage:",n)}}},async saveCollection({commit:i,dispatch:e},{name:t,buildData:n}){try{if(!t||!t.trim())throw new Error("Collection name is required");if(!n)throw new Error("Build data is required");const s=Zm(n),r={id:`collection-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:t.trim(),buildData:n,encodedCode:s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return i("ADD_COLLECTION",r),await e("saveCollectionsToStorage"),r}catch(s){throw console.error("Save collection error:",s),s}},async deleteCollection({commit:i,dispatch:e},t){try{i("REMOVE_COLLECTION",t),await e("saveCollectionsToStorage")}catch(n){throw console.error("Delete collection error:",n),n}}},getters:{allCollections(i){return i.collections},collectionsCount(i){return i.collections.length}}},FW={namespaced:!0,state:{placedSets:[]},mutations:{SET_PLACED_SETS(i,e){Array.isArray(e)&&(i.placedSets=e)},ADD_PLACED_SET(i,e){e&&typeof e=="object"&&i.placedSets.push(e)},UPDATE_PLACED_SET_POSITION(i,{id:e,position:t,rotation:n}){const s=i.placedSets.findIndex(r=>r.id===e);s!==-1&&(t&&(i.placedSets[s].position={...i.placedSets[s].position,...t}),n!==void 0&&(i.placedSets[s].rotation=n))},REMOVE_PLACED_SET(i,e){const t=i.placedSets.findIndex(n=>n.id===e);t!==-1&&i.placedSets.splice(t,1)}},actions:{async loadBuilderState({commit:i}){var e;try{let t=null;if((e=window.bridge)!=null&&e.storage){const n=window.bridge.STORAGE_TYPE.PLATFORM_INTERNAL;if(await window.bridge.storage.isAvailable(n)){const r=await window.bridge.storage.get("set_builder_data",n);r&&(t=JSON.parse(r))}}if(!t){const n=localStorage.getItem("lego-game-set-builder");n&&(t=JSON.parse(n))}t&&Array.isArray(t.placedSets)?i("SET_PLACED_SETS",t.placedSets):i("SET_PLACED_SETS",[])}catch(t){console.error("Load builder state error:",t),i("SET_PLACED_SETS",[])}},async saveBuilderState({state:i}){var e;try{const t={placedSets:i.placedSets},n=JSON.stringify(t);if(localStorage.setItem("lego-game-set-builder",n),(e=window.bridge)!=null&&e.storage){const s=window.bridge.STORAGE_TYPE.PLATFORM_INTERNAL;await window.bridge.storage.isAvailable(s)&&await window.bridge.storage.set("set_builder_data",n,s)}}catch(t){console.error("Save builder state error:",t);try{const n={placedSets:i.placedSets};localStorage.setItem("lego-game-set-builder",JSON.stringify(n))}catch(n){console.error("Failed to save to localStorage:",n)}}},async placeSet({commit:i,dispatch:e},{setId:t,collectionId:n,position:s,rotation:r=0,buildData:a}){try{if(!s||typeof s.x!="number"||typeof s.y!="number"||typeof s.z!="number")throw new Error("Valid position is required");const o={id:`placed-set-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,setId:t||null,collectionId:n||null,buildData:a||null,position:{x:s.x,y:s.y,z:s.z},rotation:r};return i("ADD_PLACED_SET",o),await e("saveBuilderState"),o}catch(o){throw console.error("Place set error:",o),o}},async moveSet({commit:i,dispatch:e},{id:t,position:n,rotation:s}){try{i("UPDATE_PLACED_SET_POSITION",{id:t,position:n,rotation:s}),await e("saveBuilderState")}catch(r){throw console.error("Move set error:",r),r}},async removeSet({commit:i,dispatch:e},t){try{i("REMOVE_PLACED_SET",t),await e("saveBuilderState")}catch(n){throw console.error("Remove set error:",n),n}}},getters:{allPlacedSets:i=>i.placedSets,placedSetsCount:i=>i.placedSets.length}},Va=YT({modules:{player:kW,inventory:BW,sets:OW,collections:NW,setBuilder:FW},state:{currentScene:"mainMenu",isLoading:!1,error:null},mutations:{SET_CURRENT_SCENE(i,e){i.currentScene=e},SET_LOADING(i,e){i.isLoading=e},SET_ERROR(i,e){i.error=e},CLEAR_ERROR(i){i.error=null}},actions:{navigateToScene({commit:i},e){try{i("SET_CURRENT_SCENE",e),i("CLEAR_ERROR")}catch(t){console.error("Navigation error:",t),i("SET_ERROR","Failed to navigate to scene")}},setLoading({commit:i},e){i("SET_LOADING",e)},setError({commit:i},e){i("SET_ERROR",e)},clearError({commit:i}){i("CLEAR_ERROR")}},getters:{currentScene:i=>i.currentScene,isLoading:i=>i.isLoading,error:i=>i.error,hasError:i=>!!i.error}}),x_=f1(DW);x_.use(Va);x_.use(Ya);x_.mount("#app");async function UW(){try{gD(),await $i.initializeSDK(),await bD(),await Va.dispatch("player/loadPlayerData"),await Va.dispatch("inventory/loadInventory"),await Va.dispatch("sets/loadSetsFromJSON"),await Va.dispatch("collections/loadCollections"),await Va.dispatch("setBuilder/loadBuilderState"),window.addEventListener("game:pause",()=>{}),window.addEventListener("game:resume",()=>{}),setInterval(()=>{Va.dispatch("player/savePlayerData")},3e4)}catch(i){console.error("App initialization error:",i)}}UW();export{ho as B,ul as C,Zn as G,Fn as L,yn as M,Mr as P,Vo as S,fe as V,Sb as a,ja as b,Bs as c,Rs as d,ji as e};
